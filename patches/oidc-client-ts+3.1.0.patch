diff --git a/node_modules/oidc-client-ts/dist/types/oidc-client-ts.d.ts b/node_modules/oidc-client-ts/dist/types/oidc-client-ts.d.ts
index 7d88060..2145ba6 100644
--- a/node_modules/oidc-client-ts/dist/types/oidc-client-ts.d.ts
+++ b/node_modules/oidc-client-ts/dist/types/oidc-client-ts.d.ts
@@ -107,6 +107,8 @@ export declare interface CreateSigninRequestArgs extends Omit<SigninRequestCreat
     dpopJkt?: string;
     /** custom "state", which can be used by a caller to have "data" round tripped */
     state?: unknown;
+    /** oidc-spa extra */
+    transformUrl: (url: string) => string;
 }
 
 /**
@@ -500,9 +502,10 @@ export declare class OidcClient {
     protected readonly _claimsService: ClaimsService;
     protected readonly _validator: ResponseValidator;
     protected readonly _tokenClient: TokenClient;
+    protected readonly _stateQueryParamValue: string;
     constructor(settings: OidcClientSettings);
     constructor(settings: OidcClientSettingsStore, metadataService: MetadataService);
-    createSigninRequest({ state, request, request_uri, request_type, id_token_hint, login_hint, skipUserInfo, nonce, url_state, response_type, scope, redirect_uri, prompt, display, max_age, ui_locales, acr_values, resource, response_mode, extraQueryParams, extraTokenParams, dpopJkt, omitScopeWhenRequesting, }: CreateSigninRequestArgs): Promise<SigninRequest>;
+    createSigninRequest({ state, request, request_uri, request_type, id_token_hint, login_hint, skipUserInfo, nonce, url_state, response_type, scope, redirect_uri, prompt, display, max_age, ui_locales, acr_values, resource, response_mode, extraQueryParams, extraTokenParams, dpopJkt, omitScopeWhenRequesting, transformUrl, }: CreateSigninRequestArgs): Promise<SigninRequest>;
     readSigninResponseState(url: string, removeState?: boolean): Promise<{
         state: SigninState;
         response: SigninResponse;
@@ -511,7 +514,7 @@ export declare class OidcClient {
     getDpopProof(dpopStore: DPoPStore, nonce?: string): Promise<string>;
     processResourceOwnerPasswordCredentials({ username, password, skipUserInfo, extraTokenParams, }: ProcessResourceOwnerPasswordCredentialsArgs): Promise<SigninResponse>;
     useRefreshToken({ state, redirect_uri, resource, timeoutInSeconds, extraHeaders, extraTokenParams, }: UseRefreshTokenArgs): Promise<SigninResponse>;
-    createSignoutRequest({ state, id_token_hint, client_id, request_type, post_logout_redirect_uri, extraQueryParams, }?: CreateSignoutRequestArgs): Promise<SignoutRequest>;
+    createSignoutRequest({ state, id_token_hint, client_id, request_type, post_logout_redirect_uri, extraQueryParams, }: CreateSignoutRequestArgs): Promise<SignoutRequest>;
     readSignoutResponseState(url: string, removeState?: boolean): Promise<{
         state: State | undefined;
         response: SignoutResponse;
@@ -527,6 +530,8 @@ export declare class OidcClient {
  * @public
  */
 export declare interface OidcClientSettings {
+    stateQueryParamValue: string; /** oidc-spa addition */
+    fetch: typeof window.fetch; /** oidc-spa addition */
     /** The URL of the OIDC/OAuth2 provider */
     authority: string;
     metadataUrl?: string;
@@ -649,6 +654,8 @@ export declare interface OidcClientSettings {
  * @see {@link OidcClientSettings}
  */
 export declare class OidcClientSettingsStore {
+    readonly stateQueryParamValue: string;
+    readonly fetch: typeof window.fetch;
     readonly authority: string;
     readonly metadataUrl: string;
     readonly metadata: Partial<OidcMetadata> | undefined;
@@ -685,7 +692,7 @@ export declare class OidcClientSettingsStore {
     readonly refreshTokenAllowedScope: string | undefined;
     readonly disablePKCE: boolean;
     readonly requestTimeoutInSeconds: number | undefined;
-    constructor({ authority, metadataUrl, metadata, signingKeys, metadataSeed, client_id, client_secret, response_type, scope, redirect_uri, post_logout_redirect_uri, client_authentication, prompt, display, max_age, ui_locales, acr_values, resource, response_mode, filterProtocolClaims, loadUserInfo, requestTimeoutInSeconds, staleStateAgeInSeconds, mergeClaimsStrategy, disablePKCE, stateStore, revokeTokenAdditionalContentTypes, fetchRequestCredentials, refreshTokenAllowedScope, extraQueryParams, extraTokenParams, extraHeaders, dpop, omitScopeWhenRequesting, }: OidcClientSettings);
+    constructor({ stateQueryParamValue, fetch, authority, metadataUrl, metadata, signingKeys, metadataSeed, client_id, client_secret, response_type, scope, redirect_uri, post_logout_redirect_uri, client_authentication, prompt, display, max_age, ui_locales, acr_values, resource, response_mode, filterProtocolClaims, loadUserInfo, requestTimeoutInSeconds, staleStateAgeInSeconds, mergeClaimsStrategy, disablePKCE, stateStore, revokeTokenAdditionalContentTypes, fetchRequestCredentials, refreshTokenAllowedScope, extraQueryParams, extraTokenParams, extraHeaders, dpop, omitScopeWhenRequesting, }: OidcClientSettings);
 }
 
 /**
@@ -1159,7 +1166,9 @@ export declare type SigninPopupArgs = PopupWindowParams & ExtraSigninRequestArgs
 /**
  * @public
  */
-export declare type SigninRedirectArgs = RedirectParams & ExtraSigninRequestArgs;
+export declare type SigninRedirectArgs = RedirectParams & ExtraSigninRequestArgs & {
+    transformUrl: (url: string) => string;
+};
 
 /**
  * @public
@@ -1169,7 +1178,7 @@ export declare class SigninRequest {
     readonly url: string;
     readonly state: SigninState;
     private constructor();
-    static create({ url, authority, client_id, redirect_uri, response_type, scope, state_data, response_mode, request_type, client_secret, nonce, url_state, resource, skipUserInfo, extraQueryParams, extraTokenParams, disablePKCE, dpopJkt, omitScopeWhenRequesting, ...optionalParams }: SigninRequestCreateArgs): Promise<SigninRequest>;
+    static create({ stateQueryParamValue, url, authority, client_id, redirect_uri, response_type, scope, state_data, response_mode, request_type, client_secret, nonce, url_state, resource, skipUserInfo, extraQueryParams, extraTokenParams, disablePKCE, dpopJkt, omitScopeWhenRequesting, transformUrl, ...optionalParams }: SigninRequestCreateArgs): Promise<SigninRequest>;
 }
 
 /**
@@ -1177,6 +1186,7 @@ export declare class SigninRequest {
  * @see https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest
  */
 export declare interface SigninRequestCreateArgs {
+    stateQueryParamValue: string;
     url: string;
     authority: string;
     client_id: string;
@@ -1206,6 +1216,8 @@ export declare interface SigninRequestCreateArgs {
     state_data?: unknown;
     url_state?: string;
     omitScopeWhenRequesting?: boolean;
+    /** oidc-spa extra */
+    transformUrl: (url: string) => string;
 }
 
 /**
@@ -1219,6 +1231,7 @@ export declare type SigninResourceOwnerCredentialsArgs = ProcessResourceOwnerPas
  * @see https://openid.net/specs/openid-connect-core-1_0.html#AuthError
  */
 export declare class SigninResponse {
+    __oidc_spa_tokenResponse: Record<string, unknown> | undefined;
     readonly state: string | null;
     /** @see {@link User.session_state} */
     session_state: string | null;
@@ -1255,7 +1268,9 @@ export declare class SigninResponse {
 /**
  * @public
  */
-export declare type SigninSilentArgs = IFrameWindowParams & ExtraSigninRequestArgs;
+export declare type SigninSilentArgs = IFrameWindowParams & ExtraSigninRequestArgs & {
+    transformUrl: (url: string) => string;
+};
 
 /**
  * @public
@@ -1288,7 +1303,7 @@ export declare class SigninState extends State {
 
 /** @public */
 export declare interface SigninStateArgs {
-    id?: string;
+    stateQueryParamValue: string;
     data?: unknown;
     created?: number;
     request_type?: string;
@@ -1327,7 +1342,7 @@ export declare class SignoutRequest {
     private readonly _logger;
     readonly url: string;
     readonly state?: State;
-    constructor({ url, state_data, id_token_hint, post_logout_redirect_uri, extraQueryParams, request_type, client_id, }: SignoutRequestArgs);
+    constructor({ url, stateQueryParamValue, state_data, id_token_hint, post_logout_redirect_uri, extraQueryParams, request_type, client_id, }: SignoutRequestArgs);
 }
 
 /**
@@ -1336,6 +1351,7 @@ export declare class SignoutRequest {
  */
 export declare interface SignoutRequestArgs {
     url: string;
+    stateQueryParamValue: string;
     id_token_hint?: string;
     client_id?: string;
     post_logout_redirect_uri?: string;
@@ -1398,6 +1414,7 @@ export declare class State {
     readonly data?: unknown;
     constructor(args: {
         id?: string;
+        stateQueryParamValue: string | undefined;
         data?: unknown;
         created?: number;
         request_type?: string;
@@ -1457,6 +1474,7 @@ declare class TokenClient {
  * @public
  */
 export declare class User {
+    readonly __oidc_spa_tokenResponse: Record<string, unknown>;
     /**
      * A JSON Web Token (JWT). Only provided if `openid` scope was requested.
      * The application can access the data decoded by using the `profile` property.
@@ -1497,6 +1515,7 @@ export declare class User {
         expires_at?: number;
         userState?: unknown;
         url_state?: string;
+        __oidc_spa_tokenResponse: Record<string, unknown>;
     });
     /** Computed number of seconds the access token has remaining. */
     get expires_in(): number | undefined;
@@ -1556,6 +1575,7 @@ export declare class UserManager {
     protected readonly _events: UserManagerEvents;
     protected readonly _silentRenewService: SilentRenewService;
     protected readonly _sessionMonitor: SessionMonitor | null;
+    protected readonly _stateQueryParamValue: string;
     constructor(settings: UserManagerSettings, redirectNavigator?: INavigator, popupNavigator?: INavigator, iframeNavigator?: INavigator);
     /**
      * Get object used to register for events raised by the `UserManager`.
@@ -1584,7 +1604,7 @@ export declare class UserManager {
      *
      * @throws `Error` In cases of wrong authentication.
      */
-    signinRedirect(args?: SigninRedirectArgs): Promise<void>;
+    signinRedirect(args: SigninRedirectArgs): Promise<void>;
     /**
      * Process the response (callback) from the authorization endpoint.
      * It is recommended to use {@link UserManager.signinCallback} instead.
@@ -1622,7 +1642,7 @@ export declare class UserManager {
       *
       * @returns A promise that contains the authenticated `User`.
       */
-     signinSilent(args?: SigninSilentArgs): Promise<User | null>;
+     signinSilent(args: SigninSilentArgs): Promise<User | null>;
      protected _useRefreshToken(args: UseRefreshTokenArgs): Promise<User>;
      /**
       *
@@ -1695,7 +1715,7 @@ export declare class UserManager {
       */
      signoutPopupCallback(url?: string, keepOpen?: boolean): Promise<void>;
      protected _signout(args: CreateSignoutRequestArgs, handle: IWindow): Promise<SignoutResponse>;
-     protected _signoutStart(args: CreateSignoutRequestArgs | undefined, handle: IWindow): Promise<NavigateResponse>;
+     protected _signoutStart(args: CreateSignoutRequestArgs, handle: IWindow): Promise<NavigateResponse>;
      protected _signoutEnd(url: string): Promise<SignoutResponse>;
      /**
       * Trigger a silent request (via an iframe) to the end session endpoint.
@@ -1833,6 +1853,7 @@ export declare class UserManager {
      * @public
      */
     export declare interface UserManagerSettings extends OidcClientSettings {
+        stateQueryParamValue: string;
         /** The URL for the page containing the call to signinPopupCallback to handle the callback from the OIDC/OAuth2 */
         popup_redirect_uri?: string;
         popup_post_logout_redirect_uri?: string;
diff --git a/node_modules/oidc-client-ts/dist/umd/oidc-client-ts.js b/node_modules/oidc-client-ts/dist/umd/oidc-client-ts.js
index e6e01d3..3d29e51 100644
--- a/node_modules/oidc-client-ts/dist/umd/oidc-client-ts.js
+++ b/node_modules/oidc-client-ts/dist/umd/oidc-client-ts.js
@@ -664,6 +664,18 @@ var ErrorDPoPNonce = class extends Error {
   }
 };
 
+// src/fetch.ts
+var _fetch = void 0;
+function setFetch(fetch) {
+  _fetch = fetch;
+}
+function getFetch() {
+  if (_fetch === void 0) {
+    throw new Error("fetch is not set");
+  }
+  return { fetch: _fetch };
+}
+
 // src/JsonService.ts
 var JsonService = class {
   constructor(additionalContentTypes = [], _jwtHandler = null, _extraHeaders = {}) {
@@ -678,6 +690,7 @@ var JsonService = class {
   }
   async fetchWithTimeout(input, init = {}) {
     const { timeoutInSeconds, ...initFetch } = init;
+    const { fetch } = getFetch();
     if (!timeoutInSeconds) {
       return await fetch(input, initFetch);
     }
@@ -973,6 +986,8 @@ var DefaultClientAuthentication = "client_secret_post";
 var DefaultStaleStateAgeInSeconds = 60 * 15;
 var OidcClientSettingsStore = class {
   constructor({
+    stateQueryParamValue,
+    fetch,
     // metadata related
     authority,
     metadataUrl,
@@ -1015,6 +1030,8 @@ var OidcClientSettingsStore = class {
     omitScopeWhenRequesting = false
   }) {
     var _a;
+    this.stateQueryParamValue = stateQueryParamValue;
+    this.fetch = fetch;
     this.authority = authority;
     if (metadataUrl) {
       this.metadataUrl = metadataUrl;
@@ -1426,6 +1443,7 @@ var ResponseValidator = class {
         ...state.extraTokenParams
       });
       Object.assign(response, tokenResponse);
+      response.__oidc_spa_tokenResponse = tokenResponse;
     } else {
       logger2.debug("No code to process");
     }
@@ -1460,7 +1478,16 @@ var ResponseValidator = class {
 // src/State.ts
 var State = class _State {
   constructor(args) {
-    this.id = args.id || CryptoUtils.generateUUIDv4();
+    var _a;
+    this.id = (_a = args.id) != null ? _a : (() => {
+      const { stateQueryParamValue } = args;
+      if (stateQueryParamValue === void 0) {
+        const message = "Error in oidc-spa patch for oidc-client-ts: stateQueryParamValue is required";
+        console.error(message);
+        throw new Error("Error in oidc-spa patch for oidc-client-ts: stateQueryParamValue is required");
+      }
+      return stateQueryParamValue;
+    })();
     this.data = args.data;
     if (args.created && args.created > 0) {
       this.created = args.created;
@@ -1573,6 +1600,7 @@ var _SigninRequest = class _SigninRequest {
     this.state = args.state;
   }
   static async create({
+    stateQueryParamValue,
     // mandatory
     url,
     authority,
@@ -1594,6 +1622,7 @@ var _SigninRequest = class _SigninRequest {
     disablePKCE,
     dpopJkt,
     omitScopeWhenRequesting,
+    transformUrl,
     ...optionalParams
   }) {
     if (!url) {
@@ -1621,6 +1650,7 @@ var _SigninRequest = class _SigninRequest {
       throw new Error("authority");
     }
     const state = await SigninState.create({
+      stateQueryParamValue,
       data: state_data,
       request_type,
       url_state,
@@ -1666,7 +1696,7 @@ var _SigninRequest = class _SigninRequest {
       }
     }
     return new _SigninRequest({
-      url: parsedUrl.href,
+      url: transformUrl(parsedUrl.href),
       state
     });
   }
@@ -1697,6 +1727,7 @@ var SigninResponse = class {
     this.error_description = params.get("error_description");
     this.error_uri = params.get("error_uri");
     this.code = params.get("code");
+    this.__oidc_spa_tokenResponse = void 0;
   }
   get expires_in() {
     if (this.expires_at === void 0) {
@@ -1720,6 +1751,7 @@ var SigninResponse = class {
 var SignoutRequest = class {
   constructor({
     url,
+    stateQueryParamValue,
     state_data,
     id_token_hint,
     post_logout_redirect_uri,
@@ -1742,7 +1774,7 @@ var SignoutRequest = class {
     if (post_logout_redirect_uri) {
       parsedUrl.searchParams.append("post_logout_redirect_uri", post_logout_redirect_uri);
       if (state_data) {
-        this.state = new State({ data: state_data, request_type });
+        this.state = new State({ stateQueryParamValue, data: state_data, request_type });
         parsedUrl.searchParams.append("state", this.state.id);
       }
     }
@@ -1839,6 +1871,8 @@ var DPoPState = class {
 var OidcClient = class {
   constructor(settings, metadataService) {
     this._logger = new Logger("OidcClient");
+    this._stateQueryParamValue = settings.stateQueryParamValue;
+    setFetch(settings.fetch);
     this.settings = settings instanceof OidcClientSettingsStore ? settings : new OidcClientSettingsStore(settings);
     this.metadataService = metadataService != null ? metadataService : new MetadataService(this.settings);
     this._claimsService = new ClaimsService(this.settings);
@@ -1868,7 +1902,8 @@ var OidcClient = class {
     extraQueryParams = this.settings.extraQueryParams,
     extraTokenParams = this.settings.extraTokenParams,
     dpopJkt,
-    omitScopeWhenRequesting = this.settings.omitScopeWhenRequesting
+    omitScopeWhenRequesting = this.settings.omitScopeWhenRequesting,
+    transformUrl
   }) {
     const logger2 = this._logger.create("createSigninRequest");
     if (response_type !== "code") {
@@ -1877,6 +1912,7 @@ var OidcClient = class {
     const url = await this.metadataService.getAuthorizationEndpoint();
     logger2.debug("Received authorization endpoint", url);
     const signinRequest = await SigninRequest.create({
+      stateQueryParamValue: this._stateQueryParamValue,
       url,
       authority: this.settings.authority,
       client_id: this.settings.client_id,
@@ -1904,7 +1940,8 @@ var OidcClient = class {
       skipUserInfo,
       nonce,
       disablePKCE: this.settings.disablePKCE,
-      omitScopeWhenRequesting
+      omitScopeWhenRequesting,
+      transformUrl
     });
     await this.clearStaleState();
     const signinState = signinRequest.state;
@@ -1977,6 +2014,7 @@ var OidcClient = class {
     const tokenResponse = await this._tokenClient.exchangeCredentials({ username, password, ...extraTokenParams });
     const signinResponse = new SigninResponse(new URLSearchParams());
     Object.assign(signinResponse, tokenResponse);
+    signinResponse.__oidc_spa_tokenResponse = tokenResponse;
     await this._validator.validateCredentialsResponse(signinResponse, skipUserInfo);
     return signinResponse;
   }
@@ -2033,6 +2071,7 @@ var OidcClient = class {
     }
     const response = new SigninResponse(new URLSearchParams());
     Object.assign(response, result);
+    response.__oidc_spa_tokenResponse = result;
     logger2.debug("validating response", response);
     await this._validator.validateRefreshResponse(response, {
       ...state,
@@ -2049,7 +2088,7 @@ var OidcClient = class {
     request_type,
     post_logout_redirect_uri = this.settings.post_logout_redirect_uri,
     extraQueryParams = this.settings.extraQueryParams
-  } = {}) {
+  }) {
     const logger2 = this._logger.create("createSignoutRequest");
     const url = await this.metadataService.getEndSessionEndpoint();
     if (!url) {
@@ -2061,6 +2100,7 @@ var OidcClient = class {
       client_id = this.settings.client_id;
     }
     const request = new SignoutRequest({
+      stateQueryParamValue: this._stateQueryParamValue,
       url,
       id_token_hint,
       client_id,
@@ -2262,6 +2302,7 @@ var User = class _User {
     this.expires_at = args.expires_at;
     this.state = args.userState;
     this.url_state = args.url_state;
+    this.__oidc_spa_tokenResponse = args.__oidc_spa_tokenResponse;
   }
   /** Computed number of seconds the access token has remaining. */
   get expires_in() {
@@ -2298,7 +2339,8 @@ var User = class _User {
       token_type: this.token_type,
       scope: this.scope,
       profile: this.profile,
-      expires_at: this.expires_at
+      expires_at: this.expires_at,
+      __oidc_spa_tokenResponse: this.__oidc_spa_tokenResponse
     });
   }
   static fromStorageString(storageString) {
@@ -2321,6 +2363,7 @@ var AbstractChildWindow = class {
       throw new Error("Attempted to navigate on a disposed window");
     }
     logger2.debug("setting URL in window");
+    console.log("==========================================> replace", params.url);
     this._window.location.replace(params.url);
     const { url, keepOpen } = await new Promise((resolve, reject) => {
       const listener = (e) => {
@@ -2611,7 +2654,13 @@ var RedirectNavigator = class {
         const promise = new Promise((resolve, reject) => {
           abort = reject;
         });
-        redirect(params.url);
+        console.log("==============================> redirect to", params.url);
+        if (redirectMethod === "assign") {
+          console.log("Use oidc safe assign");
+          window.__oidc_safe_assign(params.url);
+        } else {
+          redirect(params.url);
+        }
         return await promise;
       },
       close: () => {
@@ -2759,7 +2808,9 @@ var SilentRenewService = class {
     this._tokenExpiring = async () => {
       const logger2 = this._logger.create("_tokenExpiring");
       try {
-        await this._userManager.signinSilent();
+        await this._userManager.signinSilent({
+          transformUrl: (url) => url
+        });
         logger2.debug("silent token renewal successful");
       } catch (err) {
         if (err instanceof ErrorTimeout) {
@@ -2811,6 +2862,7 @@ var RefreshState = class {
 var UserManager = class {
   constructor(settings, redirectNavigator, popupNavigator, iframeNavigator) {
     this._logger = new Logger("UserManager");
+    this._stateQueryParamValue = settings.stateQueryParamValue;
     this.settings = new UserManagerSettingsStore(settings);
     this._client = new OidcClient(settings);
     this._redirectNavigator = redirectNavigator != null ? redirectNavigator : new RedirectNavigator(this.settings);
@@ -2872,7 +2924,7 @@ var UserManager = class {
    *
    * @throws `Error` In cases of wrong authentication.
    */
-  async signinRedirect(args = {}) {
+  async signinRedirect(args) {
     var _a;
     this._logger.create("signinRedirect");
     const {
@@ -2885,6 +2937,7 @@ var UserManager = class {
     }
     const handle = await this._redirectNavigator.prepare({ redirectMethod });
     await this._signinStart({
+      stateQueryParamValue: this._stateQueryParamValue,
       request_type: "si:r",
       dpopJkt,
       ...requestArgs
@@ -2960,10 +3013,12 @@ var UserManager = class {
     }
     const handle = await this._popupNavigator.prepare({ popupWindowFeatures, popupWindowTarget, popupSignal });
     const user = await this._signin({
+      stateQueryParamValue: this._stateQueryParamValue,
       request_type: "si:p",
       redirect_uri: url,
       display: "popup",
       dpopJkt,
+      transformUrl: (url2) => url2,
       ...requestArgs
     }, handle);
     if (user) {
@@ -2993,7 +3048,7 @@ var UserManager = class {
    *
    * @returns A promise that contains the authenticated `User`.
    */
-  async signinSilent(args = {}) {
+  async signinSilent(args) {
     var _a, _b;
     const logger2 = this._logger.create("signinSilent");
     const {
@@ -3027,6 +3082,7 @@ var UserManager = class {
     }
     const handle = await this._iframeNavigator.prepare({ silentRequestTimeoutInSeconds });
     user = await this._signin({
+      stateQueryParamValue: this._stateQueryParamValue,
       request_type: "si:s",
       redirect_uri: url,
       prompt: "none",
@@ -3048,7 +3104,12 @@ var UserManager = class {
       timeoutInSeconds: this.settings.silentRequestTimeoutInSeconds,
       ...args
     });
-    const user = new User({ ...args.state, ...response });
+    if (response.__oidc_spa_tokenResponse === void 0) {
+      throw new Error(
+        "Wrong Assertion Encountered: Error in oidc-spa mod of oidc-client-ts"
+      );
+    }
+    const user = new User({ ...args.state, ...response, __oidc_spa_tokenResponse: response.__oidc_spa_tokenResponse });
     await this.storeUser(user);
     await this._events.load(user);
     return user;
@@ -3138,6 +3199,7 @@ var UserManager = class {
     const user = await this._loadUser();
     const handle = await this._iframeNavigator.prepare({ silentRequestTimeoutInSeconds });
     const navResponse = await this._signinStart({
+      stateQueryParamValue: this._stateQueryParamValue,
       request_type: "si:s",
       // this acts like a signin silent
       redirect_uri: url,
@@ -3146,6 +3208,7 @@ var UserManager = class {
       response_type: this.settings.query_status_response_type,
       scope: "openid",
       skipUserInfo: true,
+      transformUrl: (url2) => url2,
       ...requestArgs
     }, handle);
     try {
@@ -3209,7 +3272,15 @@ var UserManager = class {
   }
   async _buildUser(signinResponse, verifySub) {
     const logger2 = this._logger.create("_buildUser");
-    const user = new User(signinResponse);
+    if (signinResponse.__oidc_spa_tokenResponse === void 0) {
+      throw new Error(
+        "Wrong Assertion Encountered: Error in oidc-spa mod of oidc-client-ts"
+      );
+    }
+    const user = new User({
+      ...signinResponse,
+      __oidc_spa_tokenResponse: signinResponse.__oidc_spa_tokenResponse
+    });
     if (verifySub) {
       if (verifySub !== user.profile.sub) {
         logger2.debug("current user does not match user returned from signin. sub from signin:", user.profile.sub);
@@ -3235,6 +3306,7 @@ var UserManager = class {
     } = args;
     const handle = await this._redirectNavigator.prepare({ redirectMethod });
     await this._signoutStart({
+      stateQueryParamValue: this._stateQueryParamValue,
       request_type: "so:r",
       post_logout_redirect_uri: this.settings.post_logout_redirect_uri,
       ...requestArgs
@@ -3271,6 +3343,7 @@ var UserManager = class {
     const url = this.settings.popup_post_logout_redirect_uri;
     const handle = await this._popupNavigator.prepare({ popupWindowFeatures, popupWindowTarget, popupSignal });
     await this._signout({
+      stateQueryParamValue: this._stateQueryParamValue,
       request_type: "so:p",
       post_logout_redirect_uri: url,
       // we're putting a dummy entry in here because we
@@ -3300,7 +3373,7 @@ var UserManager = class {
     const navResponse = await this._signoutStart(args, handle);
     return await this._signoutEnd(navResponse.url);
   }
-  async _signoutStart(args = {}, handle) {
+  async _signoutStart(args, handle) {
     var _a;
     const logger2 = this._logger.create("_signoutStart");
     try {
@@ -3351,6 +3424,7 @@ var UserManager = class {
     const url = this.settings.popup_post_logout_redirect_uri;
     const handle = await this._iframeNavigator.prepare({ silentRequestTimeoutInSeconds });
     await this._signout({
+      stateQueryParamValue: this._stateQueryParamValue,
       request_type: "so:s",
       post_logout_redirect_uri: url,
       id_token_hint,
diff --git a/node_modules/oidc-client-ts/dist/umd/oidc-client-ts.js.map b/node_modules/oidc-client-ts/dist/umd/oidc-client-ts.js.map
index a9248c2..3b9ee3a 100644
--- a/node_modules/oidc-client-ts/dist/umd/oidc-client-ts.js.map
+++ b/node_modules/oidc-client-ts/dist/umd/oidc-client-ts.js.map
@@ -1,7 +1,7 @@
 {
   "version": 3,
-  "sources": ["../../src/index.ts", "../../src/utils/Logger.ts", "../../src/utils/JwtUtils.ts", "../../src/utils/CryptoUtils.ts", "../../src/utils/Event.ts", "../../src/utils/PopupUtils.ts", "../../src/utils/Timer.ts", "../../src/utils/UrlUtils.ts", "../../src/errors/ErrorResponse.ts", "../../src/errors/ErrorTimeout.ts", "../../src/AccessTokenEvents.ts", "../../src/CheckSessionIFrame.ts", "../../src/InMemoryWebStorage.ts", "../../src/errors/ErrorDPoPNonce.ts", "../../src/JsonService.ts", "../../src/MetadataService.ts", "../../src/WebStorageStateStore.ts", "../../src/OidcClientSettings.ts", "../../src/UserInfoService.ts", "../../src/TokenClient.ts", "../../src/ResponseValidator.ts", "../../src/State.ts", "../../src/SigninState.ts", "../../src/SigninRequest.ts", "../../src/SigninResponse.ts", "../../src/SignoutRequest.ts", "../../src/SignoutResponse.ts", "../../src/ClaimsService.ts", "../../src/DPoPStore.ts", "../../src/OidcClient.ts", "../../src/SessionMonitor.ts", "../../src/User.ts", "../../src/navigators/AbstractChildWindow.ts", "../../src/UserManagerSettings.ts", "../../src/navigators/IFrameWindow.ts", "../../src/navigators/IFrameNavigator.ts", "../../src/navigators/PopupWindow.ts", "../../src/navigators/PopupNavigator.ts", "../../src/navigators/RedirectNavigator.ts", "../../src/UserManagerEvents.ts", "../../src/SilentRenewService.ts", "../../src/RefreshState.ts", "../../src/UserManager.ts", "../../package.json", "../../src/Version.ts", "../../src/IndexedDbDPoPStore.ts"],
-  "sourcesContent": ["// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nexport { ErrorResponse, ErrorTimeout } from \"./errors\";\nexport type { INavigator, IFrameWindowParams, IWindow, NavigateParams, NavigateResponse, PopupWindowParams, RedirectParams } from \"./navigators\";\nexport { Log, Logger } from \"./utils\";\nexport type { ILogger, PopupWindowFeatures } from \"./utils\";\nexport type { OidcAddressClaim, OidcStandardClaims, IdTokenClaims, JwtClaims } from \"./Claims\";\n\nexport { AccessTokenEvents } from \"./AccessTokenEvents\";\nexport type { AccessTokenCallback } from \"./AccessTokenEvents\";\nexport { CheckSessionIFrame } from \"./CheckSessionIFrame\";\nexport { InMemoryWebStorage } from \"./InMemoryWebStorage\";\nexport type { AsyncStorage } from \"./AsyncStorage\";\nexport { MetadataService } from \"./MetadataService\";\nexport * from \"./OidcClient\";\nexport { OidcClientSettingsStore } from \"./OidcClientSettings\";\nexport type { OidcClientSettings, SigningKey, ExtraHeader } from \"./OidcClientSettings\";\nexport type { OidcMetadata } from \"./OidcMetadata\";\nexport { SessionMonitor } from \"./SessionMonitor\";\nexport type { SessionStatus } from \"./SessionStatus\";\nexport type { SigninRequest, SigninRequestCreateArgs } from \"./SigninRequest\";\nexport type { RefreshState } from \"./RefreshState\";\nexport { SigninResponse } from \"./SigninResponse\";\nexport { SigninState } from \"./SigninState\";\nexport type { SigninStateArgs, SigninStateCreateArgs } from \"./SigninState\";\nexport type { SignoutRequest, SignoutRequestArgs } from \"./SignoutRequest\";\nexport { SignoutResponse } from \"./SignoutResponse\";\nexport { State } from \"./State\";\nexport type { StateStore } from \"./StateStore\";\nexport { User } from \"./User\";\nexport type { UserProfile } from \"./User\";\nexport * from \"./UserManager\";\nexport type {\n    UserManagerEvents,\n    SilentRenewErrorCallback,\n    UserLoadedCallback,\n    UserSessionChangedCallback,\n    UserSignedInCallback,\n    UserSignedOutCallback,\n    UserUnloadedCallback,\n} from \"./UserManagerEvents\";\nexport { UserManagerSettingsStore } from \"./UserManagerSettings\";\nexport type { UserManagerSettings } from \"./UserManagerSettings\";\nexport { Version } from \"./Version\";\nexport { WebStorageStateStore } from \"./WebStorageStateStore\";\nexport { IndexedDbDPoPStore } from \"./IndexedDbDPoPStore\";\nexport { DPoPState } from \"./DPoPStore\";\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\n/**\n * Native interface\n *\n * @public\n */\nexport interface ILogger {\n    debug(...args: unknown[]): void;\n    info(...args: unknown[]): void;\n    warn(...args: unknown[]): void;\n    error(...args: unknown[]): void;\n}\n\nconst nopLogger: ILogger = {\n    debug: () => undefined,\n    info: () => undefined,\n    warn: () => undefined,\n    error: () => undefined,\n};\n\nlet level: number;\nlet logger: ILogger;\n\n/**\n * Log levels\n *\n * @public\n */\nexport enum Log {\n    NONE,\n    ERROR,\n    WARN,\n    INFO,\n    DEBUG\n}\n\n/**\n * Log manager\n *\n * @public\n */\nexport namespace Log { // eslint-disable-line @typescript-eslint/no-namespace\n    export function reset(): void {\n        level = Log.INFO;\n        logger = nopLogger;\n    }\n\n    export function setLevel(value: Log): void {\n        if (!(Log.NONE <= value && value <= Log.DEBUG)) {\n            throw new Error(\"Invalid log level\");\n        }\n        level = value;\n    }\n\n    export function setLogger(value: ILogger): void {\n        logger = value;\n    }\n}\n\n/**\n * Internal logger instance\n *\n * @public\n */\nexport class Logger {\n    private _method?: string;\n    public constructor(private _name: string) {}\n\n    /* eslint-disable @typescript-eslint/no-unsafe-enum-comparison */\n    public debug(...args: unknown[]): void {\n        if (level >= Log.DEBUG) {\n            logger.debug(Logger._format(this._name, this._method), ...args);\n        }\n    }\n    public info(...args: unknown[]): void {\n        if (level >= Log.INFO) {\n            logger.info(Logger._format(this._name, this._method), ...args);\n        }\n    }\n    public warn(...args: unknown[]): void {\n        if (level >= Log.WARN) {\n            logger.warn(Logger._format(this._name, this._method), ...args);\n        }\n    }\n    public error(...args: unknown[]): void {\n        if (level >= Log.ERROR) {\n            logger.error(Logger._format(this._name, this._method), ...args);\n        }\n    }\n    /* eslint-enable @typescript-eslint/no-unsafe-enum-comparison */\n\n    public throw(err: Error): never {\n        this.error(err);\n        throw err;\n    }\n\n    public create(method: string): Logger {\n        const methodLogger: Logger = Object.create(this);\n        methodLogger._method = method;\n        methodLogger.debug(\"begin\");\n        return methodLogger;\n    }\n\n    public static createStatic(name: string, staticMethod: string): Logger {\n        const staticLogger = new Logger(`${name}.${staticMethod}`);\n        staticLogger.debug(\"begin\");\n        return staticLogger;\n    }\n\n    private static _format(name: string, method?: string) {\n        const prefix = `[${name}]`;\n        return method ? `${prefix} ${method}:` : prefix;\n    }\n\n    /* eslint-disable @typescript-eslint/no-unsafe-enum-comparison */\n    // helpers for static class methods\n    public static debug(name: string, ...args: unknown[]): void {\n        if (level >= Log.DEBUG) {\n            logger.debug(Logger._format(name), ...args);\n        }\n    }\n    public static info(name: string, ...args: unknown[]): void {\n        if (level >= Log.INFO) {\n            logger.info(Logger._format(name), ...args);\n        }\n    }\n    public static warn(name: string, ...args: unknown[]): void {\n        if (level >= Log.WARN) {\n            logger.warn(Logger._format(name), ...args);\n        }\n    }\n    public static error(name: string, ...args: unknown[]): void {\n        if (level >= Log.ERROR) {\n            logger.error(Logger._format(name), ...args);\n        }\n    }\n    /* eslint-enable @typescript-eslint/no-unsafe-enum-comparison */\n}\n\nLog.reset();\n", "import { jwtDecode } from \"jwt-decode\";\n\nimport { Logger } from \"./Logger\";\nimport type { JwtClaims } from \"../Claims\";\nimport { CryptoUtils } from \"./CryptoUtils\";\n\n/**\n * @internal\n */\nexport class JwtUtils {\n    // IMPORTANT: doesn't validate the token\n    public static decode(token: string): JwtClaims {\n        try {\n            return jwtDecode<JwtClaims>(token);\n        }\n        catch (err) {\n            Logger.error(\"JwtUtils.decode\", err);\n            throw err;\n        }\n    }\n\n    public static async generateSignedJwt(header: object, payload: object, privateKey: CryptoKey) : Promise<string> {\n        const encodedHeader = CryptoUtils.encodeBase64Url(new TextEncoder().encode(JSON.stringify(header)));\n        const encodedPayload = CryptoUtils.encodeBase64Url(new TextEncoder().encode(JSON.stringify(payload)));\n        const encodedToken = `${encodedHeader}.${encodedPayload}`;\n\n        const signature = await window.crypto.subtle.sign(\n            {\n                name: \"ECDSA\",\n                hash: { name: \"SHA-256\" },\n            },\n            privateKey,\n            new TextEncoder().encode(encodedToken),\n        );\n\n        const encodedSignature = CryptoUtils.encodeBase64Url(new Uint8Array(signature));\n        return `${encodedToken}.${encodedSignature}`;\n    }\n}\n", "import { Logger } from \"./Logger\";\nimport { JwtUtils } from \"./JwtUtils\";\n\nexport interface GenerateDPoPProofOpts {\n    url: string;\n    accessToken?: string;\n    httpMethod?: string;\n    keyPair: CryptoKeyPair;\n    nonce?: string;\n}\n\nconst UUID_V4_TEMPLATE = \"10000000-1000-4000-8000-100000000000\";\n\nconst toBase64 = (val: ArrayBuffer): string =>\n    btoa([...new Uint8Array(val)]\n        .map((chr) => String.fromCharCode(chr))\n        .join(\"\"));\n\n/**\n * @internal\n */\nexport class CryptoUtils {\n    private static _randomWord(): number {\n        const arr = new Uint32Array(1);\n        crypto.getRandomValues(arr);\n        return arr[0];\n    }\n\n    /**\n     * Generates RFC4122 version 4 guid\n     */\n    public static generateUUIDv4(): string {\n        const uuid = UUID_V4_TEMPLATE.replace(/[018]/g, c =>\n            (+c ^ CryptoUtils._randomWord() & 15 >> +c / 4).toString(16),\n        );\n        return uuid.replace(/-/g, \"\");\n    }\n\n    /**\n     * PKCE: Generate a code verifier\n     */\n    public static generateCodeVerifier(): string {\n        return CryptoUtils.generateUUIDv4() + CryptoUtils.generateUUIDv4() + CryptoUtils.generateUUIDv4();\n    }\n\n    /**\n     * PKCE: Generate a code challenge\n     */\n    public static async generateCodeChallenge(code_verifier: string): Promise<string> {\n        if (!crypto.subtle) {\n            throw new Error(\"Crypto.subtle is available only in secure contexts (HTTPS).\");\n        }\n\n        try {\n            const encoder = new TextEncoder();\n            const data = encoder.encode(code_verifier);\n            const hashed = await crypto.subtle.digest(\"SHA-256\", data);\n            return toBase64(hashed).replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/, \"\");\n        }\n        catch (err) {\n            Logger.error(\"CryptoUtils.generateCodeChallenge\", err);\n            throw err;\n        }\n    }\n\n    /**\n     * Generates a base64-encoded string for a basic auth header\n     */\n    public static generateBasicAuth(client_id: string, client_secret: string): string {\n        const encoder = new TextEncoder();\n        const data = encoder.encode([client_id, client_secret].join(\":\"));\n        return toBase64(data);\n    }\n\n    /**\n     * Generates a hash of a string using a given algorithm\n     * @param alg\n     * @param message\n     */\n    public static async hash(alg: string, message: string) : Promise<Uint8Array> {\n        const msgUint8 = new TextEncoder().encode(message);\n        const hashBuffer = await crypto.subtle.digest(alg, msgUint8);\n        return new Uint8Array(hashBuffer);\n    }\n\n    /**\n     * Generates a base64url encoded string\n     */\n    public static encodeBase64Url = (input: Uint8Array) => {\n        return toBase64(input).replace(/=/g, \"\").replace(/\\+/g, \"-\").replace(/\\//g, \"_\");\n    };\n\n    /**\n     * Generates a rfc7638 compliant jwk thumbprint\n     * @param jwk\n     */\n    public static async customCalculateJwkThumbprint(jwk: JsonWebKey): Promise<string> {\n        let jsonObject: object;\n        switch (jwk.kty) {\n            case \"RSA\":\n                jsonObject = {\n                    \"e\": jwk.e,\n                    \"kty\": jwk.kty,\n                    \"n\": jwk.n,\n                };\n                break;\n            case \"EC\":\n                jsonObject = {\n                    \"crv\": jwk.crv,\n                    \"kty\": jwk.kty,\n                    \"x\": jwk.x,\n                    \"y\": jwk.y,\n                };\n                break;\n            case \"OKP\":\n                jsonObject = {\n                    \"crv\": jwk.crv,\n                    \"kty\": jwk.kty,\n                    \"x\": jwk.x,\n                };\n                break;\n            case \"oct\":\n                jsonObject = {\n                    \"crv\": jwk.k,\n                    \"kty\": jwk.kty,\n                };\n                break;\n            default:\n                throw new Error(\"Unknown jwk type\");\n        }\n        const utf8encodedAndHashed = await CryptoUtils.hash(\"SHA-256\", JSON.stringify(jsonObject));\n        return CryptoUtils.encodeBase64Url(utf8encodedAndHashed);\n    }\n\n    public static async generateDPoPProof({\n        url,\n        accessToken,\n        httpMethod,\n        keyPair,\n        nonce,\n    }: GenerateDPoPProofOpts): Promise<string> {\n        let hashedToken: Uint8Array;\n        let encodedHash: string;\n\n        const payload: Record<string, string | number> = {\n            \"jti\": window.crypto.randomUUID(),\n            \"htm\": httpMethod ?? \"GET\",\n            \"htu\": url,\n            \"iat\": Math.floor(Date.now() / 1000),\n        };\n\n        if (accessToken) {\n            hashedToken = await CryptoUtils.hash(\"SHA-256\", accessToken);\n            encodedHash = CryptoUtils.encodeBase64Url(hashedToken);\n            payload.ath = encodedHash;\n        }\n\n        if (nonce) {\n            payload.nonce = nonce;\n        }\n\n        try {\n            const publicJwk = await crypto.subtle.exportKey(\"jwk\", keyPair.publicKey);\n            const header = {\n                \"alg\": \"ES256\",\n                \"typ\": \"dpop+jwt\",\n                \"jwk\": {\n                    \"crv\": publicJwk.crv,\n                    \"kty\": publicJwk.kty,\n                    \"x\": publicJwk.x,\n                    \"y\": publicJwk.y,\n                },\n            };\n            return await JwtUtils.generateSignedJwt(header, payload, keyPair.privateKey);\n        } catch (err) {\n            if (err instanceof TypeError) {\n                throw new Error(`Error exporting dpop public key: ${err.message}`);\n            } else {\n                throw err;\n            }\n        }\n    }\n\n    public static async generateDPoPJkt(keyPair: CryptoKeyPair) : Promise<string> {\n        try {\n            const publicJwk = await crypto.subtle.exportKey(\"jwk\", keyPair.publicKey);\n            return await CryptoUtils.customCalculateJwkThumbprint(publicJwk);\n        } catch (err) {\n            if (err instanceof TypeError) {\n                throw new Error(`Could not retrieve dpop keys from storage: ${err.message}`);\n            } else {\n                throw err;\n            }\n        }\n    }\n\n    public static async generateDPoPKeys() : Promise<CryptoKeyPair> {\n        return await window.crypto.subtle.generateKey(\n            {\n                name: \"ECDSA\",\n                namedCurve: \"P-256\",\n            },\n            false,\n            [\"sign\", \"verify\"],\n        );\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"./Logger\";\n\n/**\n * @internal\n */\nexport type Callback<EventType extends unknown[]> = (...ev: EventType) => (Promise<void> | void);\n\n/**\n * @internal\n */\nexport class Event<EventType extends unknown[]> {\n    protected readonly _logger: Logger;\n\n    private readonly _callbacks: Array<Callback<EventType>> = [];\n\n    public constructor(protected readonly _name: string) {\n        this._logger = new Logger(`Event('${this._name}')`);\n    }\n\n    public addHandler(cb: Callback<EventType>): () => void {\n        this._callbacks.push(cb);\n        return () => this.removeHandler(cb);\n    }\n\n    public removeHandler(cb: Callback<EventType>): void {\n        const idx = this._callbacks.lastIndexOf(cb);\n        if (idx >= 0) {\n            this._callbacks.splice(idx, 1);\n        }\n    }\n\n    public async raise(...ev: EventType): Promise<void> {\n        this._logger.debug(\"raise:\", ...ev);\n        for (const cb of this._callbacks) {\n            await cb(...ev);\n        }\n    }\n}\n", "/**\n *\n * @public\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/open#window_features\n */\nexport interface PopupWindowFeatures {\n    left?: number;\n    top?: number;\n    width?: number;\n    height?: number;\n    menubar?: boolean | string;\n    toolbar?: boolean | string;\n    location?: boolean | string;\n    status?: boolean | string;\n    resizable?: boolean | string;\n    scrollbars?: boolean | string;\n    /** Close popup window after time in seconds, by default it is -1. To enable this feature, set value greater than 0. */\n    closePopupWindowAfterInSeconds?: number;\n\n    [k: string]: boolean | string | number | undefined;\n}\n\nexport class PopupUtils {\n    /**\n     * Populates a map of window features with a placement centered in front of\n     * the current window. If no explicit width is given, a default value is\n     * binned into [800, 720, 600, 480, 360] based on the current window's width.\n     */\n    static center({ ...features }: PopupWindowFeatures): PopupWindowFeatures {\n        if (features.width == null)\n            features.width = [800, 720, 600, 480].find(width => width <= window.outerWidth / 1.618) ?? 360;\n        features.left ??= Math.max(0, Math.round(window.screenX + (window.outerWidth - features.width) / 2));\n        if (features.height != null)\n            features.top ??= Math.max(0, Math.round(window.screenY + (window.outerHeight - features.height) / 2));\n        return features;\n    }\n\n    static serialize(features: PopupWindowFeatures): string {\n        return Object.entries(features)\n            .filter(([, value]) => value != null)\n            .map(([key, value]) => `${key}=${typeof value !== \"boolean\" ? value as string : value ? \"yes\" : \"no\"}`)\n            .join(\",\");\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Event } from \"./Event\";\nimport { Logger } from \"./Logger\";\n\n/**\n * @internal\n */\nexport class Timer extends Event<[void]> {\n    protected readonly _logger = new Logger(`Timer('${this._name}')`);\n    private _timerHandle: ReturnType<typeof setInterval> | null = null;\n    private _expiration = 0;\n\n    // get the time\n    public static getEpochTime(): number {\n        return Math.floor(Date.now() / 1000);\n    }\n\n    public init(durationInSeconds: number): void {\n        const logger = this._logger.create(\"init\");\n        durationInSeconds = Math.max(Math.floor(durationInSeconds), 1);\n        const expiration = Timer.getEpochTime() + durationInSeconds;\n        if (this.expiration === expiration && this._timerHandle) {\n            // no need to reinitialize to same expiration, so bail out\n            logger.debug(\"skipping since already initialized for expiration at\", this.expiration);\n            return;\n        }\n\n        this.cancel();\n\n        logger.debug(\"using duration\", durationInSeconds);\n        this._expiration = expiration;\n\n        // we're using a fairly short timer and then checking the expiration in the\n        // callback to handle scenarios where the browser device sleeps, and then\n        // the timers end up getting delayed.\n        const timerDurationInSeconds = Math.min(durationInSeconds, 5);\n        this._timerHandle = setInterval(this._callback, timerDurationInSeconds * 1000);\n    }\n\n    public get expiration(): number {\n        return this._expiration;\n    }\n\n    public cancel(): void {\n        this._logger.create(\"cancel\");\n        if (this._timerHandle) {\n            clearInterval(this._timerHandle);\n            this._timerHandle = null;\n        }\n    }\n\n    protected _callback = (): void => {\n        const diff = this._expiration - Timer.getEpochTime();\n        this._logger.debug(\"timer completes in\", diff);\n\n        if (this._expiration <= Timer.getEpochTime()) {\n            this.cancel();\n            void super.raise();\n        }\n    };\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\n/**\n * @internal\n */\nexport class UrlUtils {\n    public static readParams(url: string, responseMode: \"query\" | \"fragment\" = \"query\"): URLSearchParams {\n        if (!url) throw new TypeError(\"Invalid URL\");\n        // the base URL is irrelevant, it's just here to support relative url arguments\n        const parsedUrl = new URL(url, \"http://127.0.0.1\");\n        const params = parsedUrl[responseMode === \"fragment\" ? \"hash\" : \"search\"];\n        return new URLSearchParams(params.slice(1));\n    }\n}\n\n/**\n * @internal\n */\nexport const URL_STATE_DELIMITER = \";\";", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"../utils\";\n\n/**\n * Error class thrown in case of an authentication error.\n *\n * @public\n * @see https://openid.net/specs/openid-connect-core-1_0.html#AuthError\n */\nexport class ErrorResponse extends Error {\n    /** Marker to detect class: \"ErrorResponse\" */\n    public readonly name: string = \"ErrorResponse\";\n\n    /** An error code string that can be used to classify the types of errors that occur and to respond to errors. */\n    public readonly error: string | null;\n    /** additional information that can help a developer identify the cause of the error.*/\n    public readonly error_description: string | null;\n    /**\n     * URI identifying a human-readable web page with information about the error, used to provide the client\n       developer with additional information about the error.\n    */\n    public readonly error_uri: string | null;\n\n    /** custom state data set during the initial signin request */\n    public state?: unknown;\n\n    public readonly session_state: string | null;\n\n    public url_state?: string;\n\n    public constructor(\n        args: {\n            error?: string | null; error_description?: string | null; error_uri?: string | null;\n            userState?: unknown; session_state?: string | null; url_state?: string;\n        },\n        /** The x-www-form-urlencoded request body sent to the authority server */\n        public readonly form?: URLSearchParams,\n    ) {\n        super(args.error_description || args.error || \"\");\n\n        if (!args.error) {\n            Logger.error(\"ErrorResponse\", \"No error passed\");\n            throw new Error(\"No error passed\");\n        }\n\n        this.error = args.error;\n        this.error_description = args.error_description ?? null;\n        this.error_uri = args.error_uri ?? null;\n\n        this.state = args.userState;\n        this.session_state = args.session_state ?? null;\n        this.url_state = args.url_state;\n    }\n}\n", "// Copyright (C) 2021 AuthTS Contributors\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\n/**\n * Error class thrown in case of network timeouts (e.g IFrame time out).\n *\n * @public\n */\nexport class ErrorTimeout extends Error {\n    /** Marker to detect class: \"ErrorTimeout\" */\n    public readonly name: string = \"ErrorTimeout\";\n\n    public constructor(message?: string) {\n        super(message);\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, Timer } from \"./utils\";\nimport type { User } from \"./User\";\n\n/**\n * @public\n */\nexport type AccessTokenCallback = (...ev: unknown[]) => (Promise<void> | void);\n\n/**\n * @public\n */\nexport class AccessTokenEvents {\n    protected readonly _logger = new Logger(\"AccessTokenEvents\");\n\n    private readonly _expiringTimer = new Timer(\"Access token expiring\");\n    private readonly _expiredTimer = new Timer(\"Access token expired\");\n    private readonly _expiringNotificationTimeInSeconds: number;\n\n    public constructor(args: { expiringNotificationTimeInSeconds: number }) {\n        this._expiringNotificationTimeInSeconds = args.expiringNotificationTimeInSeconds;\n    }\n\n    public load(container: User): void {\n        const logger = this._logger.create(\"load\");\n        // only register events if there's an access token and it has an expiration\n        if (container.access_token && container.expires_in !== undefined) {\n            const duration = container.expires_in;\n            logger.debug(\"access token present, remaining duration:\", duration);\n\n            if (duration > 0) {\n                // only register expiring if we still have time\n                let expiring = duration - this._expiringNotificationTimeInSeconds;\n                if (expiring <= 0) {\n                    expiring = 1;\n                }\n\n                logger.debug(\"registering expiring timer, raising in\", expiring, \"seconds\");\n                this._expiringTimer.init(expiring);\n            }\n            else {\n                logger.debug(\"canceling existing expiring timer because we're past expiration.\");\n                this._expiringTimer.cancel();\n            }\n\n            // if it's negative, it will still fire\n            const expired = duration + 1;\n            logger.debug(\"registering expired timer, raising in\", expired, \"seconds\");\n            this._expiredTimer.init(expired);\n        }\n        else {\n            this._expiringTimer.cancel();\n            this._expiredTimer.cancel();\n        }\n    }\n\n    public unload(): void {\n        this._logger.debug(\"unload: canceling existing access token timers\");\n        this._expiringTimer.cancel();\n        this._expiredTimer.cancel();\n    }\n\n    /**\n     * Add callback: Raised prior to the access token expiring.\n     */\n    public addAccessTokenExpiring(cb: AccessTokenCallback): () => void {\n        return this._expiringTimer.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised prior to the access token expiring.\n     */\n    public removeAccessTokenExpiring(cb: AccessTokenCallback): void {\n        this._expiringTimer.removeHandler(cb);\n    }\n\n    /**\n     * Add callback: Raised after the access token has expired.\n     */\n    public addAccessTokenExpired(cb: AccessTokenCallback): () => void {\n        return this._expiredTimer.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised after the access token has expired.\n     */\n    public removeAccessTokenExpired(cb: AccessTokenCallback): void {\n        this._expiredTimer.removeHandler(cb);\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"./utils\";\n\n/**\n * @internal\n */\nexport class CheckSessionIFrame {\n    private readonly _logger = new Logger(\"CheckSessionIFrame\");\n    private _frame_origin: string;\n    private _frame: HTMLIFrameElement;\n    private _timer: ReturnType<typeof setInterval> | null = null;\n    private _session_state: string | null = null;\n\n    public constructor(\n        private _callback: () => Promise<void>,\n        private _client_id: string,\n        url: string,\n        private _intervalInSeconds: number,\n        private _stopOnError: boolean,\n    ) {\n        const parsedUrl = new URL(url);\n        this._frame_origin = parsedUrl.origin;\n\n        this._frame = window.document.createElement(\"iframe\");\n\n        // shotgun approach\n        this._frame.style.visibility = \"hidden\";\n        this._frame.style.position = \"fixed\";\n        this._frame.style.left = \"-1000px\";\n        this._frame.style.top = \"0\";\n        this._frame.width = \"0\";\n        this._frame.height = \"0\";\n        this._frame.src = parsedUrl.href;\n    }\n\n    public load(): Promise<void> {\n        return new Promise<void>((resolve) => {\n            this._frame.onload = () => {\n                resolve();\n            };\n\n            window.document.body.appendChild(this._frame);\n            window.addEventListener(\"message\", this._message, false);\n        });\n    }\n\n    private _message = (e: MessageEvent<string>): void => {\n        if (e.origin === this._frame_origin &&\n            e.source === this._frame.contentWindow\n        ) {\n            if (e.data === \"error\") {\n                this._logger.error(\"error message from check session op iframe\");\n                if (this._stopOnError) {\n                    this.stop();\n                }\n            }\n            else if (e.data === \"changed\") {\n                this._logger.debug(\"changed message from check session op iframe\");\n                this.stop();\n                void this._callback();\n            }\n            else {\n                this._logger.debug(e.data + \" message from check session op iframe\");\n            }\n        }\n    };\n\n    public start(session_state: string): void {\n        if (this._session_state === session_state) {\n            return;\n        }\n\n        this._logger.create(\"start\");\n\n        this.stop();\n\n        this._session_state = session_state;\n\n        const send = () => {\n            if (!this._frame.contentWindow || !this._session_state) {\n                return;\n            }\n\n            this._frame.contentWindow.postMessage(this._client_id + \" \" + this._session_state, this._frame_origin);\n        };\n\n        // trigger now\n        send();\n\n        // and setup timer\n        this._timer = setInterval(send, this._intervalInSeconds * 1000);\n    }\n\n    public stop(): void {\n        this._logger.create(\"stop\");\n        this._session_state = null;\n\n        if (this._timer) {\n\n            clearInterval(this._timer);\n            this._timer = null;\n        }\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"./utils\";\n\n/**\n * @public\n */\nexport class InMemoryWebStorage implements Storage {\n    private readonly _logger = new Logger(\"InMemoryWebStorage\");\n    private _data: Record<string, string> = {};\n\n    public clear(): void {\n        this._logger.create(\"clear\");\n        this._data = {};\n    }\n\n    public getItem(key: string): string {\n        this._logger.create(`getItem('${key}')`);\n        return this._data[key];\n    }\n\n    public setItem(key: string, value: string): void {\n        this._logger.create(`setItem('${key}')`);\n        this._data[key] = value;\n    }\n\n    public removeItem(key: string): void {\n        this._logger.create(`removeItem('${key}')`);\n        delete this._data[key];\n    }\n\n    public get length(): number {\n        return Object.getOwnPropertyNames(this._data).length;\n    }\n\n    public key(index: number): string {\n        return Object.getOwnPropertyNames(this._data)[index];\n    }\n}\n", "export class ErrorDPoPNonce extends Error {\n    /** Marker to detect class: \"ErrorDPoPNonce\" */\n    public readonly name: string = \"ErrorDPoPNonce\";\n    public readonly nonce: string;\n\n    public constructor(nonce: string, message?: string) {\n        super(message);\n        this.nonce = nonce;\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { ErrorResponse, ErrorTimeout } from \"./errors\";\nimport type { ExtraHeader } from \"./OidcClientSettings\";\nimport { Logger } from \"./utils\";\nimport { ErrorDPoPNonce } from \"./errors/ErrorDPoPNonce\";\n\n/**\n * @internal\n */\nexport type JwtHandler = (text: string) => Promise<Record<string, unknown>>;\n\n/**\n * @internal\n */\nexport interface GetJsonOpts {\n    token?: string;\n    credentials?: RequestCredentials;\n    timeoutInSeconds?: number;\n}\n\n/**\n * @internal\n */\nexport interface PostFormOpts {\n    body: URLSearchParams;\n    basicAuth?: string;\n    timeoutInSeconds?: number;\n    initCredentials?: \"same-origin\" | \"include\" | \"omit\";\n    extraHeaders?: Record<string, ExtraHeader>;\n}\n\n/**\n * @internal\n */\nexport class JsonService {\n    private readonly _logger = new Logger(\"JsonService\");\n\n    private _contentTypes: string[] = [];\n\n    public constructor(\n        additionalContentTypes: string[] = [],\n        private _jwtHandler: JwtHandler | null = null,\n        private _extraHeaders: Record<string, ExtraHeader> = {},\n    ) {\n        this._contentTypes.push(...additionalContentTypes, \"application/json\");\n        if (_jwtHandler) {\n            this._contentTypes.push(\"application/jwt\");\n        }\n    }\n\n    protected async fetchWithTimeout(input: RequestInfo, init: RequestInit & { timeoutInSeconds?: number } = {}) {\n        const { timeoutInSeconds, ...initFetch } = init;\n        if (!timeoutInSeconds) {\n            return await fetch(input, initFetch);\n        }\n\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), timeoutInSeconds * 1000);\n\n        try {\n            const response = await fetch(input, {\n                ...init,\n                signal: controller.signal,\n            });\n            return response;\n        }\n        catch (err) {\n            if (err instanceof DOMException && err.name === \"AbortError\") {\n                throw new ErrorTimeout(\"Network timed out\");\n            }\n            throw err;\n        }\n        finally {\n            clearTimeout(timeoutId);\n        }\n    }\n\n    public async getJson(url: string, {\n        token,\n        credentials,\n        timeoutInSeconds,\n    }: GetJsonOpts = {}): Promise<Record<string, unknown>> {\n        const logger = this._logger.create(\"getJson\");\n        const headers: HeadersInit = {\n            \"Accept\": this._contentTypes.join(\", \"),\n        };\n        if (token) {\n            logger.debug(\"token passed, setting Authorization header\");\n            headers[\"Authorization\"] = \"Bearer \" + token;\n        }\n\n        this.appendExtraHeaders(headers);\n\n        let response: Response;\n        try {\n            logger.debug(\"url:\", url);\n            response = await this.fetchWithTimeout(url, { method: \"GET\", headers, timeoutInSeconds, credentials });\n        }\n        catch (err) {\n            logger.error(\"Network Error\");\n            throw err;\n        }\n\n        logger.debug(\"HTTP response received, status\", response.status);\n        const contentType = response.headers.get(\"Content-Type\");\n        if (contentType && !this._contentTypes.find(item => contentType.startsWith(item))) {\n            logger.throw(new Error(`Invalid response Content-Type: ${(contentType ?? \"undefined\")}, from URL: ${url}`));\n        }\n        if (response.ok && this._jwtHandler && contentType?.startsWith(\"application/jwt\")) {\n            return await this._jwtHandler(await response.text());\n        }\n        let json: Record<string, unknown>;\n        try {\n            json = await response.json();\n        }\n        catch (err) {\n            logger.error(\"Error parsing JSON response\", err);\n            if (response.ok) throw err;\n            throw new Error(`${response.statusText} (${response.status})`);\n        }\n        if (!response.ok) {\n            logger.error(\"Error from server:\", json);\n            if (json.error) {\n                throw new ErrorResponse(json);\n            }\n            throw new Error(`${response.statusText} (${response.status}): ${JSON.stringify(json)}`);\n        }\n        return json;\n    }\n\n    public async postForm(url: string, {\n        body,\n        basicAuth,\n        timeoutInSeconds,\n        initCredentials,\n        extraHeaders,\n    }: PostFormOpts): Promise<Record<string, unknown>> {\n        const logger = this._logger.create(\"postForm\");\n        const headers: HeadersInit = {\n            \"Accept\": this._contentTypes.join(\", \"),\n            \"Content-Type\": \"application/x-www-form-urlencoded\",\n            ...extraHeaders,\n        };\n        if (basicAuth !== undefined) {\n            headers[\"Authorization\"] = \"Basic \" + basicAuth;\n        }\n\n        this.appendExtraHeaders(headers);\n\n        let response: Response;\n        try {\n            logger.debug(\"url:\", url);\n            response = await this.fetchWithTimeout(url, { method: \"POST\", headers, body, timeoutInSeconds, credentials: initCredentials });\n        }\n        catch (err) {\n            logger.error(\"Network error\");\n            throw err;\n        }\n\n        logger.debug(\"HTTP response received, status\", response.status);\n        const contentType = response.headers.get(\"Content-Type\");\n        if (contentType && !this._contentTypes.find(item => contentType.startsWith(item))) {\n            throw new Error(`Invalid response Content-Type: ${(contentType ?? \"undefined\")}, from URL: ${url}`);\n        }\n\n        const responseText = await response.text();\n\n        let json: Record<string, unknown> = {};\n        if (responseText) {\n            try {\n                json = JSON.parse(responseText);\n            }\n            catch (err) {\n                logger.error(\"Error parsing JSON response\", err);\n                if (response.ok) throw err;\n                throw new Error(`${response.statusText} (${response.status})`);\n            }\n        }\n\n        if (!response.ok) {\n            logger.error(\"Error from server:\", json);\n            if (response.headers.has(\"dpop-nonce\")) {\n                const nonce = response.headers.get(\"dpop-nonce\") as string;\n                throw new ErrorDPoPNonce(nonce, `${JSON.stringify(json)}`);\n            }\n            if (json.error) {\n                throw new ErrorResponse(json, body);\n            }\n            throw new Error(`${response.statusText} (${response.status}): ${JSON.stringify(json)}`);\n        }\n\n        return json;\n    }\n\n    private appendExtraHeaders(\n        headers: Record<string, string>,\n    ): void {\n        const logger = this._logger.create(\"appendExtraHeaders\");\n        const customKeys = Object.keys(this._extraHeaders);\n        const protectedHeaders = [\n            \"authorization\",\n            \"accept\",\n            \"content-type\",\n        ];\n        if (customKeys.length === 0) {\n            return;\n        }\n        customKeys.forEach((headerName) => {\n            if (protectedHeaders.includes(headerName.toLocaleLowerCase())) {\n                logger.warn(\"Protected header could not be overridden\", headerName, protectedHeaders);\n                return;\n            }\n            const content = (typeof this._extraHeaders[headerName] === \"function\") ?\n                (this._extraHeaders[headerName] as ()=>string)() :\n                this._extraHeaders[headerName];\n            if (content && content !== \"\") {\n                headers[headerName] = content as string;\n            }\n        });\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"./utils\";\nimport { JsonService } from \"./JsonService\";\nimport type { OidcClientSettingsStore, SigningKey } from \"./OidcClientSettings\";\nimport type { OidcMetadata } from \"./OidcMetadata\";\n\n/**\n * @public\n * @see https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata\n */\nexport class MetadataService {\n    private readonly _logger = new Logger(\"MetadataService\");\n    private readonly _jsonService;\n\n    // cache\n    private _metadataUrl: string;\n    private _signingKeys: SigningKey[] | null = null;\n    private _metadata: Partial<OidcMetadata> | null = null;\n    private _fetchRequestCredentials: RequestCredentials | undefined;\n\n    public constructor(private readonly _settings: OidcClientSettingsStore) {\n        this._metadataUrl = this._settings.metadataUrl;\n        this._jsonService = new JsonService(\n            [\"application/jwk-set+json\"],\n            null,\n            this._settings.extraHeaders,\n        );\n        if (this._settings.signingKeys) {\n            this._logger.debug(\"using signingKeys from settings\");\n            this._signingKeys = this._settings.signingKeys;\n        }\n\n        if (this._settings.metadata) {\n            this._logger.debug(\"using metadata from settings\");\n            this._metadata = this._settings.metadata;\n        }\n\n        if (this._settings.fetchRequestCredentials) {\n            this._logger.debug(\"using fetchRequestCredentials from settings\");\n            this._fetchRequestCredentials = this._settings.fetchRequestCredentials;\n        }\n    }\n\n    public resetSigningKeys(): void {\n        this._signingKeys = null;\n    }\n\n    public async getMetadata(): Promise<Partial<OidcMetadata>> {\n        const logger = this._logger.create(\"getMetadata\");\n        if (this._metadata) {\n            logger.debug(\"using cached values\");\n            return this._metadata;\n        }\n\n        if (!this._metadataUrl) {\n            logger.throw(new Error(\"No authority or metadataUrl configured on settings\"));\n            throw null;\n        }\n\n        logger.debug(\"getting metadata from\", this._metadataUrl);\n        const metadata = await this._jsonService.getJson(this._metadataUrl, { credentials: this._fetchRequestCredentials, timeoutInSeconds: this._settings.requestTimeoutInSeconds });\n\n        logger.debug(\"merging remote JSON with seed metadata\");\n        this._metadata = Object.assign({}, this._settings.metadataSeed, metadata);\n        return this._metadata;\n    }\n\n    public getIssuer(): Promise<string> {\n        return this._getMetadataProperty(\"issuer\") as Promise<string>;\n    }\n\n    public getAuthorizationEndpoint(): Promise<string> {\n        return this._getMetadataProperty(\"authorization_endpoint\") as Promise<string>;\n    }\n\n    public getUserInfoEndpoint(): Promise<string> {\n        return this._getMetadataProperty(\"userinfo_endpoint\") as Promise<string>;\n    }\n\n    public getTokenEndpoint(optional: false): Promise<string>;\n    public getTokenEndpoint(optional?: true): Promise<string | undefined>;\n    public getTokenEndpoint(optional = true): Promise<string | undefined> {\n        return this._getMetadataProperty(\"token_endpoint\", optional) as Promise<string | undefined>;\n    }\n\n    public getCheckSessionIframe(): Promise<string | undefined> {\n        return this._getMetadataProperty(\"check_session_iframe\", true) as Promise<string | undefined>;\n    }\n\n    public getEndSessionEndpoint(): Promise<string | undefined> {\n        return this._getMetadataProperty(\"end_session_endpoint\", true) as Promise<string | undefined>;\n    }\n\n    public getRevocationEndpoint(optional: false): Promise<string>;\n    public getRevocationEndpoint(optional?: true): Promise<string | undefined>;\n    public getRevocationEndpoint(optional = true): Promise<string | undefined> {\n        return this._getMetadataProperty(\"revocation_endpoint\", optional) as Promise<string | undefined>;\n    }\n\n    public getKeysEndpoint(optional: false): Promise<string>;\n    public getKeysEndpoint(optional?: true): Promise<string | undefined>;\n    public getKeysEndpoint(optional = true): Promise<string | undefined> {\n        return this._getMetadataProperty(\"jwks_uri\", optional) as Promise<string | undefined>;\n    }\n\n    protected async _getMetadataProperty(name: keyof OidcMetadata, optional=false): Promise<string | boolean | string[] | undefined> {\n        const logger = this._logger.create(`_getMetadataProperty('${name}')`);\n\n        const metadata = await this.getMetadata();\n        logger.debug(\"resolved\");\n\n        if (metadata[name] === undefined) {\n            if (optional === true) {\n                logger.warn(\"Metadata does not contain optional property\");\n                return undefined;\n            }\n\n            logger.throw(new Error(\"Metadata does not contain property \" + name));\n        }\n\n        return metadata[name];\n    }\n\n    public async getSigningKeys(): Promise<SigningKey[] | null> {\n        const logger = this._logger.create(\"getSigningKeys\");\n        if (this._signingKeys) {\n            logger.debug(\"returning signingKeys from cache\");\n            return this._signingKeys;\n        }\n\n        const jwks_uri = await this.getKeysEndpoint(false);\n        logger.debug(\"got jwks_uri\", jwks_uri);\n\n        const keySet = await this._jsonService.getJson(jwks_uri, { timeoutInSeconds: this._settings.requestTimeoutInSeconds });\n        logger.debug(\"got key set\", keySet);\n\n        if (!Array.isArray(keySet.keys)) {\n            logger.throw(new Error(\"Missing keys on keyset\"));\n            throw null; // https://github.com/microsoft/TypeScript/issues/46972\n        }\n\n        this._signingKeys = keySet.keys;\n        return this._signingKeys;\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"./utils\";\nimport type { StateStore } from \"./StateStore\";\nimport type { AsyncStorage } from \"./AsyncStorage\";\n\n/**\n * @public\n */\nexport class WebStorageStateStore implements StateStore {\n    private readonly _logger = new Logger(\"WebStorageStateStore\");\n\n    private readonly _store: AsyncStorage | Storage;\n    private readonly _prefix: string;\n\n    public constructor({\n        prefix = \"oidc.\",\n        store = localStorage,\n    }: { prefix?: string; store?: AsyncStorage | Storage } = {}) {\n        this._store = store;\n        this._prefix = prefix;\n    }\n\n    public async set(key: string, value: string): Promise<void> {\n        this._logger.create(`set('${key}')`);\n\n        key = this._prefix + key;\n        await this._store.setItem(key, value);\n    }\n\n    public async get(key: string): Promise<string | null> {\n        this._logger.create(`get('${key}')`);\n\n        key = this._prefix + key;\n        const item = await this._store.getItem(key);\n        return item;\n    }\n\n    public async remove(key: string): Promise<string | null> {\n        this._logger.create(`remove('${key}')`);\n\n        key = this._prefix + key;\n        const item = await this._store.getItem(key);\n        await this._store.removeItem(key);\n        return item;\n    }\n\n    public async getAllKeys(): Promise<string[]> {\n        this._logger.create(\"getAllKeys\");\n        const len = await this._store.length;\n\n        const keys = [];\n        for (let index = 0; index < len; index++) {\n            const key = await this._store.key(index);\n            if (key && key.indexOf(this._prefix) === 0) {\n                keys.push(key.substr(this._prefix.length));\n            }\n        }\n        return keys;\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { WebStorageStateStore } from \"./WebStorageStateStore\";\nimport type { OidcMetadata } from \"./OidcMetadata\";\nimport type { StateStore } from \"./StateStore\";\nimport { InMemoryWebStorage } from \"./InMemoryWebStorage\";\nimport type { DPoPStore } from \"./DPoPStore\";\n\nconst DefaultResponseType = \"code\";\nconst DefaultScope = \"openid\";\nconst DefaultClientAuthentication = \"client_secret_post\";\nconst DefaultStaleStateAgeInSeconds = 60 * 15;\n\n/**\n * @public\n */\nexport type SigningKey = Record<string, string | string[]>;\n\n/**\n * @public\n */\nexport type ExtraHeader = string | (() => string);\n\n/**\n * Optional DPoP settings\n * @public\n */\nexport interface DPoPSettings {\n    bind_authorization_code?: boolean;\n    store: DPoPStore;\n}\n\n/**\n * The settings used to configure the {@link OidcClient}.\n *\n * @public\n */\nexport interface OidcClientSettings {\n    /** The URL of the OIDC/OAuth2 provider */\n    authority: string;\n    metadataUrl?: string;\n    /** Provide metadata when authority server does not allow CORS on the metadata endpoint */\n    metadata?: Partial<OidcMetadata>;\n    /** Can be used to seed or add additional values to the results of the discovery request */\n    metadataSeed?: Partial<OidcMetadata>;\n    /** Provide signingKeys when authority server does not allow CORS on the jwks uri */\n    signingKeys?: SigningKey[];\n\n    /** Your client application's identifier as registered with the OIDC/OAuth2 */\n    client_id: string;\n    client_secret?: string;\n    /** The type of response desired from the OIDC/OAuth2 provider (default: \"code\") */\n    response_type?: string;\n    /** The scope being requested from the OIDC/OAuth2 provider (default: \"openid\") */\n    scope?: string;\n    /** The redirect URI of your client application to receive a response from the OIDC/OAuth2 provider */\n    redirect_uri: string;\n    /** The OIDC/OAuth2 post-logout redirect URI */\n    post_logout_redirect_uri?: string;\n\n    /**\n     * Client authentication method that is used to authenticate when using the token endpoint (default: \"client_secret_post\")\n     * - \"client_secret_basic\": using the HTTP Basic authentication scheme\n     * - \"client_secret_post\": including the client credentials in the request body\n     *\n     * See https://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication\n     */\n    client_authentication?: \"client_secret_basic\" | \"client_secret_post\";\n\n    /** optional protocol param */\n    prompt?: string;\n    /** optional protocol param */\n    display?: string;\n    /** optional protocol param */\n    max_age?: number;\n    /** optional protocol param */\n    ui_locales?: string;\n    /** optional protocol param */\n    acr_values?: string;\n    /** optional protocol param */\n    resource?: string | string[];\n\n    /**\n     * Optional protocol param\n     * The response mode used by the authority server is defined by the response_type unless explicitly specified:\n     * - Response mode for the OAuth 2.0 response type \"code\" is the \"query\" encoding\n     * - Response mode for the OAuth 2.0 response type \"token\" is the \"fragment\" encoding\n     *\n     * @see https://openid.net/specs/oauth-v2-multiple-response-types-1_0.html#ResponseModes\n     */\n    response_mode?: \"query\" | \"fragment\";\n\n    /**\n     * Should optional OIDC protocol claims be removed from profile or specify the ones to be removed (default: true)\n     * When true, the following claims are removed by default: [\"nbf\", \"jti\", \"auth_time\", \"nonce\", \"acr\", \"amr\", \"azp\", \"at_hash\"]\n     * When specifying claims, the following claims are not allowed: [\"sub\", \"iss\", \"aud\", \"exp\", \"iat\"]\n    */\n    filterProtocolClaims?: boolean | string[];\n    /** Flag to control if additional identity data is loaded from the user info endpoint in order to populate the user's profile (default: false) */\n    loadUserInfo?: boolean;\n    /** Number (in seconds) indicating the age of state entries in storage for authorize requests that are considered abandoned and thus can be cleaned up (default: 900) */\n    staleStateAgeInSeconds?: number;\n\n    /**\n     * Indicates how objects returned from the user info endpoint as claims (e.g. `address`) are merged into the claims from the\n     * id token as a single object.  (default: `{ array: \"replace\" }`)\n     * - array: \"replace\": natives (string, int, float) and arrays are replaced, objects are merged as distinct objects\n     * - array: \"merge\": natives (string, int, float) are replaced, arrays and objects are merged as distinct objects\n     */\n    mergeClaimsStrategy?: { array: \"replace\" | \"merge\" };\n\n    /**\n     * Storage object used to persist interaction state (default: window.localStorage, InMemoryWebStorage iff no window).\n     * E.g. `stateStore: new WebStorageStateStore({ store: window.localStorage })`\n     */\n    stateStore?: StateStore;\n\n    /**\n     * An object containing additional query string parameters to be including in the authorization request.\n     * E.g, when using Azure AD to obtain an access token an additional resource parameter is required. extraQueryParams: `{resource:\"some_identifier\"}`\n     */\n    extraQueryParams?: Record<string, string | number | boolean>;\n\n    extraTokenParams?: Record<string, unknown>;\n\n    /**\n     * An object containing additional header to be including in request.\n     */\n    extraHeaders?: Record<string, ExtraHeader>;\n\n    /**\n     * DPoP enabled or disabled\n     */\n    dpop?: DPoPSettings | undefined;\n\n    /**\n     * Will check the content type header of the response of the revocation endpoint to match these passed values (default: [])\n     */\n    revokeTokenAdditionalContentTypes?: string[];\n    /**\n     * Will disable PKCE validation, changing to true will not append to sign in request code_challenge and code_challenge_method. (default: false)\n     */\n    disablePKCE?: boolean;\n    /**\n     * Sets the credentials for fetch requests. (default: \"same-origin\")\n     * Use this if you need to send cookies to the OIDC/OAuth2 provider or if you are using a proxy that requires cookies\n     */\n    fetchRequestCredentials?: RequestCredentials;\n\n    /**\n     * Only scopes in this list will be passed in the token refresh request.\n     */\n    refreshTokenAllowedScope?: string | undefined;\n\n    /**\n     * Defines request timeouts globally across all requests made to the authorisation server\n     */\n    requestTimeoutInSeconds?: number | undefined;\n\n    /**\n     * https://datatracker.ietf.org/doc/html/rfc6749#section-3.3 describes behavior when omitting scopes from sign in requests\n     * If the IDP supports default scopes, this setting will ignore the scopes property passed to the config. (Default: false)\n     */\n    omitScopeWhenRequesting?: boolean;\n}\n\n/**\n * The settings with defaults applied of the {@link OidcClient}.\n *\n * @public\n * @see {@link OidcClientSettings}\n */\nexport class OidcClientSettingsStore {\n    // metadata\n    public readonly authority: string;\n    public readonly metadataUrl: string;\n    public readonly metadata: Partial<OidcMetadata> | undefined;\n    public readonly metadataSeed: Partial<OidcMetadata> | undefined;\n    public readonly signingKeys: SigningKey[] | undefined;\n\n    // client config\n    public readonly client_id: string;\n    public readonly client_secret: string | undefined;\n    public readonly response_type: string;\n    public readonly scope: string;\n    public readonly redirect_uri: string;\n    public readonly post_logout_redirect_uri: string | undefined;\n    public readonly client_authentication: \"client_secret_basic\" | \"client_secret_post\";\n\n    // optional protocol params\n    public readonly prompt: string | undefined;\n    public readonly display: string | undefined;\n    public readonly max_age: number | undefined;\n    public readonly ui_locales: string | undefined;\n    public readonly acr_values: string | undefined;\n    public readonly resource: string | string[] | undefined;\n    public readonly response_mode: \"query\" | \"fragment\" | undefined;\n\n    // behavior flags\n    public readonly filterProtocolClaims: boolean | string[];\n    public readonly loadUserInfo: boolean;\n    public readonly staleStateAgeInSeconds: number;\n    public readonly mergeClaimsStrategy: { array: \"replace\" | \"merge\" };\n    public readonly omitScopeWhenRequesting: boolean;\n\n    public readonly stateStore: StateStore;\n\n    // extra\n    public readonly extraQueryParams: Record<string, string | number | boolean>;\n    public readonly extraTokenParams: Record<string, unknown>;\n    public readonly dpop: DPoPSettings | undefined;\n    public readonly extraHeaders: Record<string, ExtraHeader>;\n\n    public readonly revokeTokenAdditionalContentTypes?: string[];\n    public readonly fetchRequestCredentials: RequestCredentials;\n    public readonly refreshTokenAllowedScope: string | undefined;\n    public readonly disablePKCE: boolean;\n    public readonly requestTimeoutInSeconds: number | undefined;\n\n    public constructor({\n        // metadata related\n        authority, metadataUrl, metadata, signingKeys, metadataSeed,\n        // client related\n        client_id, client_secret, response_type = DefaultResponseType, scope = DefaultScope,\n        redirect_uri, post_logout_redirect_uri,\n        client_authentication = DefaultClientAuthentication,\n        // optional protocol\n        prompt, display, max_age, ui_locales, acr_values, resource, response_mode,\n        // behavior flags\n        filterProtocolClaims = true,\n        loadUserInfo = false,\n        requestTimeoutInSeconds,\n        staleStateAgeInSeconds = DefaultStaleStateAgeInSeconds,\n        mergeClaimsStrategy = { array: \"replace\" },\n        disablePKCE = false,\n        // other behavior\n        stateStore,\n        revokeTokenAdditionalContentTypes,\n        fetchRequestCredentials,\n        refreshTokenAllowedScope,\n        // extra\n        extraQueryParams = {},\n        extraTokenParams = {},\n        extraHeaders = {},\n        dpop,\n        omitScopeWhenRequesting = false,\n    }: OidcClientSettings) {\n\n        this.authority = authority;\n\n        if (metadataUrl) {\n            this.metadataUrl = metadataUrl;\n        } else {\n            this.metadataUrl = authority;\n            if (authority) {\n                if (!this.metadataUrl.endsWith(\"/\")) {\n                    this.metadataUrl += \"/\";\n                }\n                this.metadataUrl += \".well-known/openid-configuration\";\n            }\n        }\n\n        this.metadata = metadata;\n        this.metadataSeed = metadataSeed;\n        this.signingKeys = signingKeys;\n\n        this.client_id = client_id;\n        this.client_secret = client_secret;\n        this.response_type = response_type;\n        this.scope = scope;\n        this.redirect_uri = redirect_uri;\n        this.post_logout_redirect_uri = post_logout_redirect_uri;\n        this.client_authentication = client_authentication;\n\n        this.prompt = prompt;\n        this.display = display;\n        this.max_age = max_age;\n        this.ui_locales = ui_locales;\n        this.acr_values = acr_values;\n        this.resource = resource;\n        this.response_mode = response_mode;\n\n        this.filterProtocolClaims = filterProtocolClaims ?? true;\n        this.loadUserInfo = !!loadUserInfo;\n        this.staleStateAgeInSeconds = staleStateAgeInSeconds;\n        this.mergeClaimsStrategy = mergeClaimsStrategy;\n        this.omitScopeWhenRequesting = omitScopeWhenRequesting;\n        this.disablePKCE = !!disablePKCE;\n        this.revokeTokenAdditionalContentTypes = revokeTokenAdditionalContentTypes;\n\n        this.fetchRequestCredentials = fetchRequestCredentials ? fetchRequestCredentials : \"same-origin\";\n        this.requestTimeoutInSeconds = requestTimeoutInSeconds;\n\n        if (stateStore) {\n            this.stateStore = stateStore;\n        }\n        else {\n            const store = typeof window !== \"undefined\" ? window.localStorage : new InMemoryWebStorage();\n            this.stateStore = new WebStorageStateStore({ store });\n        }\n\n        this.refreshTokenAllowedScope = refreshTokenAllowedScope;\n\n        this.extraQueryParams = extraQueryParams;\n        this.extraTokenParams = extraTokenParams;\n        this.extraHeaders = extraHeaders;\n\n        this.dpop = dpop;\n        if (this.dpop && !this.dpop?.store) {\n            throw new Error(\"A DPoPStore is required when dpop is enabled\");\n        }\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, JwtUtils } from \"./utils\";\nimport { JsonService } from \"./JsonService\";\nimport type { MetadataService } from \"./MetadataService\";\nimport type { JwtClaims } from \"./Claims\";\nimport type { OidcClientSettingsStore } from \"./OidcClientSettings\";\n\n/**\n * @internal\n */\nexport class UserInfoService {\n    protected readonly _logger = new Logger(\"UserInfoService\");\n    private readonly _jsonService: JsonService;\n\n    public constructor(private readonly _settings: OidcClientSettingsStore,\n        private readonly _metadataService: MetadataService,\n    ) {\n        this._jsonService = new JsonService(\n            undefined,\n            this._getClaimsFromJwt,\n            this._settings.extraHeaders,\n        );\n    }\n\n    public async getClaims(token: string): Promise<JwtClaims> {\n        const logger = this._logger.create(\"getClaims\");\n        if (!token) {\n            this._logger.throw(new Error(\"No token passed\"));\n        }\n\n        const url = await this._metadataService.getUserInfoEndpoint();\n        logger.debug(\"got userinfo url\", url);\n\n        const claims = await this._jsonService.getJson(url, {\n            token,\n            credentials: this._settings.fetchRequestCredentials,\n            timeoutInSeconds: this._settings.requestTimeoutInSeconds,\n        });\n        logger.debug(\"got claims\", claims);\n\n        return claims;\n    }\n\n    protected _getClaimsFromJwt = async (responseText: string): Promise<JwtClaims> => {\n        const logger = this._logger.create(\"_getClaimsFromJwt\");\n        try {\n            const payload = JwtUtils.decode(responseText);\n            logger.debug(\"JWT decoding successful\");\n\n            return payload;\n        } catch (err) {\n            logger.error(\"Error parsing JWT response\");\n            throw err;\n        }\n    };\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { CryptoUtils, Logger } from \"./utils\";\nimport { JsonService } from \"./JsonService\";\nimport type { MetadataService } from \"./MetadataService\";\nimport type { ExtraHeader, OidcClientSettingsStore } from \"./OidcClientSettings\";\n\n/**\n * @internal\n */\nexport interface ExchangeCodeArgs {\n    client_id?: string;\n    client_secret?: string;\n    redirect_uri?: string;\n\n    grant_type?: string;\n    code: string;\n    code_verifier?: string;\n\n    extraHeaders?: Record<string, ExtraHeader>;\n}\n\n/**\n * @internal\n */\nexport interface ExchangeCredentialsArgs {\n    client_id?: string;\n    client_secret?: string;\n\n    grant_type?: string;\n    scope?: string;\n\n    username: string;\n    password: string;\n}\n\n/**\n * @internal\n */\nexport interface ExchangeRefreshTokenArgs {\n    client_id?: string;\n    client_secret?: string;\n    redirect_uri?: string;\n\n    grant_type?: string;\n    refresh_token: string;\n    scope?: string;\n    resource?: string | string[];\n\n    timeoutInSeconds?: number;\n\n    extraHeaders?: Record<string, ExtraHeader>;\n}\n\n/**\n * @internal\n */\nexport interface RevokeArgs {\n    token: string;\n    token_type_hint?: \"access_token\" | \"refresh_token\";\n}\n\n/**\n * @internal\n */\nexport class TokenClient {\n    private readonly _logger = new Logger(\"TokenClient\");\n    private readonly _jsonService;\n\n    public constructor(\n        private readonly _settings: OidcClientSettingsStore,\n        private readonly _metadataService: MetadataService,\n    ) {\n        this._jsonService = new JsonService(\n            this._settings.revokeTokenAdditionalContentTypes,\n            null,\n            this._settings.extraHeaders,\n        );\n    }\n\n    /**\n     * Exchange code.\n     *\n     * @see https://www.rfc-editor.org/rfc/rfc6749#section-4.1.3\n     */\n    public async exchangeCode({\n        grant_type = \"authorization_code\",\n        redirect_uri = this._settings.redirect_uri,\n        client_id = this._settings.client_id,\n        client_secret = this._settings.client_secret,\n        extraHeaders,\n        ...args\n    }: ExchangeCodeArgs): Promise<Record<string, unknown>> {\n        const logger = this._logger.create(\"exchangeCode\");\n        if (!client_id) {\n            logger.throw(new Error(\"A client_id is required\"));\n        }\n        if (!redirect_uri) {\n            logger.throw(new Error(\"A redirect_uri is required\"));\n        }\n        if (!args.code) {\n            logger.throw(new Error(\"A code is required\"));\n        }\n\n        const params = new URLSearchParams({ grant_type, redirect_uri });\n        for (const [key, value] of Object.entries(args)) {\n            if (value != null) {\n                params.set(key, value);\n            }\n        }\n        let basicAuth: string | undefined;\n        switch (this._settings.client_authentication) {\n            case \"client_secret_basic\":\n                if (!client_secret) {\n                    logger.throw(new Error(\"A client_secret is required\"));\n                    throw null; // https://github.com/microsoft/TypeScript/issues/46972\n                }\n                basicAuth = CryptoUtils.generateBasicAuth(client_id, client_secret);\n                break;\n            case \"client_secret_post\":\n                params.append(\"client_id\", client_id);\n                if (client_secret) {\n                    params.append(\"client_secret\", client_secret);\n                }\n                break;\n        }\n\n        const url = await this._metadataService.getTokenEndpoint(false);\n        logger.debug(\"got token endpoint\");\n\n        const response = await this._jsonService.postForm(url, {\n            body: params,\n            basicAuth,\n            timeoutInSeconds: this._settings.requestTimeoutInSeconds,\n            initCredentials: this._settings.fetchRequestCredentials,\n            extraHeaders,\n        });\n\n        logger.debug(\"got response\");\n\n        return response;\n    }\n\n    /**\n     * Exchange credentials.\n     *\n     * @see https://www.rfc-editor.org/rfc/rfc6749#section-4.3.2\n     */\n    public async exchangeCredentials({\n        grant_type = \"password\",\n        client_id = this._settings.client_id,\n        client_secret = this._settings.client_secret,\n        scope = this._settings.scope,\n        ...args\n    }: ExchangeCredentialsArgs): Promise<Record<string, unknown>> {\n        const logger = this._logger.create(\"exchangeCredentials\");\n\n        if (!client_id) {\n            logger.throw(new Error(\"A client_id is required\"));\n        }\n\n        const params = new URLSearchParams({ grant_type });\n        if (!this._settings.omitScopeWhenRequesting) {\n            params.set(\"scope\", scope);\n        }\n        for (const [key, value] of Object.entries(args)) {\n            if (value != null) {\n                params.set(key, value);\n            }\n        }\n\n        let basicAuth: string | undefined;\n        switch (this._settings.client_authentication) {\n            case \"client_secret_basic\":\n                if (!client_secret) {\n                    logger.throw(new Error(\"A client_secret is required\"));\n                    throw null; // https://github.com/microsoft/TypeScript/issues/46972\n                }\n                basicAuth = CryptoUtils.generateBasicAuth(client_id, client_secret);\n                break;\n            case \"client_secret_post\":\n                params.append(\"client_id\", client_id);\n                if (client_secret) {\n                    params.append(\"client_secret\", client_secret);\n                }\n                break;\n        }\n\n        const url = await this._metadataService.getTokenEndpoint(false);\n        logger.debug(\"got token endpoint\");\n\n        const response = await this._jsonService.postForm(url, { body: params, basicAuth, timeoutInSeconds: this._settings.requestTimeoutInSeconds, initCredentials: this._settings.fetchRequestCredentials });\n        logger.debug(\"got response\");\n\n        return response;\n    }\n\n    /**\n     * Exchange a refresh token.\n     *\n     * @see https://www.rfc-editor.org/rfc/rfc6749#section-6\n     */\n    public async exchangeRefreshToken({\n        grant_type = \"refresh_token\",\n        client_id = this._settings.client_id,\n        client_secret = this._settings.client_secret,\n        timeoutInSeconds,\n        extraHeaders,\n        ...args\n    }: ExchangeRefreshTokenArgs): Promise<Record<string, unknown>> {\n        const logger = this._logger.create(\"exchangeRefreshToken\");\n        if (!client_id) {\n            logger.throw(new Error(\"A client_id is required\"));\n        }\n        if (!args.refresh_token) {\n            logger.throw(new Error(\"A refresh_token is required\"));\n        }\n\n        const params = new URLSearchParams({ grant_type });\n        for (const [key, value] of Object.entries(args)) {\n            if (Array.isArray(value)) {\n                value.forEach(param => params.append(key, param));\n            }\n            else if (value != null) {\n                params.set(key, value);\n            }\n        }\n        let basicAuth: string | undefined;\n        switch (this._settings.client_authentication) {\n            case \"client_secret_basic\":\n                if (!client_secret) {\n                    logger.throw(new Error(\"A client_secret is required\"));\n                    throw null; // https://github.com/microsoft/TypeScript/issues/46972\n                }\n                basicAuth = CryptoUtils.generateBasicAuth(client_id, client_secret);\n                break;\n            case \"client_secret_post\":\n                params.append(\"client_id\", client_id);\n                if (client_secret) {\n                    params.append(\"client_secret\", client_secret);\n                }\n                break;\n        }\n\n        const url = await this._metadataService.getTokenEndpoint(false);\n        logger.debug(\"got token endpoint\");\n\n        const response = await this._jsonService.postForm(url, { body: params, basicAuth, timeoutInSeconds, initCredentials: this._settings.fetchRequestCredentials, extraHeaders });\n        logger.debug(\"got response\");\n\n        return response;\n    }\n\n    /**\n     * Revoke an access or refresh token.\n     *\n     * @see https://datatracker.ietf.org/doc/html/rfc7009#section-2.1\n     */\n    public async revoke(args: RevokeArgs): Promise<void> {\n        const logger = this._logger.create(\"revoke\");\n        if (!args.token) {\n            logger.throw(new Error(\"A token is required\"));\n        }\n\n        const url = await this._metadataService.getRevocationEndpoint(false);\n\n        logger.debug(`got revocation endpoint, revoking ${args.token_type_hint ?? \"default token type\"}`);\n\n        const params = new URLSearchParams();\n        for (const [key, value] of Object.entries(args)) {\n            if (value != null) {\n                params.set(key, value);\n            }\n        }\n        params.set(\"client_id\", this._settings.client_id);\n        if (this._settings.client_secret) {\n            params.set(\"client_secret\", this._settings.client_secret);\n        }\n\n        await this._jsonService.postForm(url, { body: params, timeoutInSeconds: this._settings.requestTimeoutInSeconds });\n        logger.debug(\"got response\");\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, JwtUtils } from \"./utils\";\nimport { ErrorResponse } from \"./errors\";\nimport type { MetadataService } from \"./MetadataService\";\nimport { UserInfoService } from \"./UserInfoService\";\nimport { TokenClient } from \"./TokenClient\";\nimport type { ExtraHeader, OidcClientSettingsStore } from \"./OidcClientSettings\";\nimport type { SigninState } from \"./SigninState\";\nimport type { SigninResponse } from \"./SigninResponse\";\nimport type { State } from \"./State\";\nimport type { SignoutResponse } from \"./SignoutResponse\";\nimport type { UserProfile } from \"./User\";\nimport type { RefreshState } from \"./RefreshState\";\nimport type { IdTokenClaims } from \"./Claims\";\nimport type { ClaimsService } from \"./ClaimsService\";\n\n/**\n * @internal\n */\nexport class ResponseValidator {\n    protected readonly _logger = new Logger(\"ResponseValidator\");\n    protected readonly _userInfoService: UserInfoService;\n    protected readonly _tokenClient: TokenClient;\n\n    public constructor(\n        protected readonly _settings: OidcClientSettingsStore,\n        protected readonly _metadataService: MetadataService,\n        protected readonly _claimsService: ClaimsService,\n    ) {\n        this._userInfoService = new UserInfoService(this._settings, this._metadataService);\n        this._tokenClient = new TokenClient(this._settings, this._metadataService);\n    }\n\n    public async validateSigninResponse(response: SigninResponse, state: SigninState, extraHeaders?: Record<string, ExtraHeader>): Promise<void> {\n        const logger = this._logger.create(\"validateSigninResponse\");\n\n        this._processSigninState(response, state);\n        logger.debug(\"state processed\");\n\n        await this._processCode(response, state, extraHeaders);\n        logger.debug(\"code processed\");\n\n        if (response.isOpenId) {\n            this._validateIdTokenAttributes(response);\n        }\n        logger.debug(\"tokens validated\");\n\n        await this._processClaims(response, state?.skipUserInfo, response.isOpenId);\n        logger.debug(\"claims processed\");\n    }\n\n    public async validateCredentialsResponse(response: SigninResponse, skipUserInfo: boolean): Promise<void> {\n        const logger = this._logger.create(\"validateCredentialsResponse\");\n\n        if (response.isOpenId && !!response.id_token) {\n            this._validateIdTokenAttributes(response);\n        }\n        logger.debug(\"tokens validated\");\n\n        await this._processClaims(response, skipUserInfo, response.isOpenId);\n        logger.debug(\"claims processed\");\n    }\n\n    public async validateRefreshResponse(response: SigninResponse, state: RefreshState): Promise<void> {\n        const logger = this._logger.create(\"validateRefreshResponse\");\n\n        response.userState = state.data;\n        // if there's no session_state on the response, copy over session_state from original request\n        response.session_state ??= state.session_state;\n        // if there's no scope on the response, then assume all scopes granted (per-spec) and copy over scopes from original request\n        response.scope ??= state.scope;\n\n        // OpenID Connect Core 1.0 says that id_token is optional in refresh response:\n        // https://openid.net/specs/openid-connect-core-1_0.html#RefreshTokenResponse\n        if (response.isOpenId && !!response.id_token) {\n            this._validateIdTokenAttributes(response, state.id_token);\n            logger.debug(\"ID Token validated\");\n        }\n\n        if (!response.id_token) {\n            // if there's no id_token on the response, copy over id_token from original request\n            response.id_token = state.id_token;\n            // and decoded part too\n            response.profile = state.profile;\n        }\n\n        const hasIdToken = response.isOpenId && !!response.id_token;\n        await this._processClaims(response, false, hasIdToken);\n        logger.debug(\"claims processed\");\n    }\n\n    public validateSignoutResponse(response: SignoutResponse, state: State): void {\n        const logger = this._logger.create(\"validateSignoutResponse\");\n        if (state.id !== response.state) {\n            logger.throw(new Error(\"State does not match\"));\n        }\n\n        // now that we know the state matches, take the stored data\n        // and set it into the response so callers can get their state\n        // this is important for both success & error outcomes\n        logger.debug(\"state validated\");\n        response.userState = state.data;\n\n        if (response.error) {\n            logger.warn(\"Response was error\", response.error);\n            throw new ErrorResponse(response);\n        }\n    }\n\n    protected _processSigninState(response: SigninResponse, state: SigninState): void {\n        const logger = this._logger.create(\"_processSigninState\");\n        if (state.id !== response.state) {\n            logger.throw(new Error(\"State does not match\"));\n        }\n\n        if (!state.client_id) {\n            logger.throw(new Error(\"No client_id on state\"));\n        }\n\n        if (!state.authority) {\n            logger.throw(new Error(\"No authority on state\"));\n        }\n\n        // ensure we're using the correct authority\n        if (this._settings.authority !== state.authority) {\n            logger.throw(new Error(\"authority mismatch on settings vs. signin state\"));\n        }\n        if (this._settings.client_id && this._settings.client_id !== state.client_id) {\n            logger.throw(new Error(\"client_id mismatch on settings vs. signin state\"));\n        }\n\n        // now that we know the state matches, take the stored data\n        // and set it into the response so callers can get their state\n        // this is important for both success & error outcomes\n        logger.debug(\"state validated\");\n        response.userState = state.data;\n        response.url_state = state.url_state;\n        // if there's no scope on the response, then assume all scopes granted (per-spec) and copy over scopes from original request\n        response.scope ??= state.scope;\n\n        if (response.error) {\n            logger.warn(\"Response was error\", response.error);\n            throw new ErrorResponse(response);\n        }\n\n        if (state.code_verifier && !response.code) {\n            logger.throw(new Error(\"Expected code in response\"));\n        }\n\n    }\n\n    protected async _processClaims(response: SigninResponse, skipUserInfo = false, validateSub = true): Promise<void> {\n        const logger = this._logger.create(\"_processClaims\");\n        response.profile = this._claimsService.filterProtocolClaims(response.profile);\n\n        if (skipUserInfo || !this._settings.loadUserInfo || !response.access_token) {\n            logger.debug(\"not loading user info\");\n            return;\n        }\n\n        logger.debug(\"loading user info\");\n        const claims = await this._userInfoService.getClaims(response.access_token);\n        logger.debug(\"user info claims received from user info endpoint\");\n\n        if (validateSub && claims.sub !== response.profile.sub) {\n            logger.throw(new Error(\"subject from UserInfo response does not match subject in ID Token\"));\n        }\n\n        response.profile = this._claimsService.mergeClaims(response.profile, this._claimsService.filterProtocolClaims(claims as IdTokenClaims));\n        logger.debug(\"user info claims received, updated profile:\", response.profile);\n    }\n\n    protected async _processCode(response: SigninResponse, state: SigninState, extraHeaders?: Record<string, ExtraHeader>): Promise<void> {\n        const logger = this._logger.create(\"_processCode\");\n        if (response.code) {\n            logger.debug(\"Validating code\");\n            const tokenResponse = await this._tokenClient.exchangeCode({\n                client_id: state.client_id,\n                client_secret: state.client_secret,\n                code: response.code,\n                redirect_uri: state.redirect_uri,\n                code_verifier: state.code_verifier,\n                extraHeaders: extraHeaders,\n                ...state.extraTokenParams,\n            });\n            Object.assign(response, tokenResponse);\n        } else {\n            logger.debug(\"No code to process\");\n        }\n    }\n\n    protected _validateIdTokenAttributes(response: SigninResponse, existingToken?: string): void {\n        const logger = this._logger.create(\"_validateIdTokenAttributes\");\n\n        logger.debug(\"decoding ID Token JWT\");\n        const incoming = JwtUtils.decode(response.id_token ?? \"\");\n\n        if (!incoming.sub) {\n            logger.throw(new Error(\"ID Token is missing a subject claim\"));\n        }\n\n        if (existingToken) {\n            const existing = JwtUtils.decode(existingToken);\n            if (incoming.sub !== existing.sub) {\n                logger.throw(new Error(\"sub in id_token does not match current sub\"));\n            }\n            if (incoming.auth_time && incoming.auth_time !== existing.auth_time) {\n                logger.throw(new Error(\"auth_time in id_token does not match original auth_time\"));\n            }\n            if (incoming.azp && incoming.azp !== existing.azp) {\n                logger.throw(new Error(\"azp in id_token does not match original azp\"));\n            }\n            if (!incoming.azp && existing.azp) {\n                logger.throw(new Error(\"azp not in id_token, but present in original id_token\"));\n            }\n        }\n\n        response.profile = incoming as UserProfile;\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, CryptoUtils, Timer } from \"./utils\";\nimport type { StateStore } from \"./StateStore\";\n\n/**\n * @public\n */\nexport class State {\n    public readonly id: string;\n    public readonly created: number;\n    public readonly request_type: string | undefined;\n    public readonly url_state: string | undefined;\n\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\n    public readonly data?: unknown;\n\n    public constructor(args: {\n        id?: string;\n        data?: unknown;\n        created?: number;\n        request_type?: string;\n        url_state?: string;\n    }) {\n        this.id = args.id || CryptoUtils.generateUUIDv4();\n        this.data = args.data;\n\n        if (args.created && args.created > 0) {\n            this.created = args.created;\n        }\n        else {\n            this.created = Timer.getEpochTime();\n        }\n        this.request_type = args.request_type;\n        this.url_state = args.url_state;\n    }\n\n    public toStorageString(): string {\n        new Logger(\"State\").create(\"toStorageString\");\n        return JSON.stringify({\n            id: this.id,\n            data: this.data,\n            created: this.created,\n            request_type: this.request_type,\n            url_state: this.url_state,\n        });\n    }\n\n    public static fromStorageString(storageString: string): Promise<State> {\n        Logger.createStatic(\"State\", \"fromStorageString\");\n        return Promise.resolve(new State(JSON.parse(storageString)));\n    }\n\n    public static async clearStaleState(storage: StateStore, age: number): Promise<void> {\n        const logger = Logger.createStatic(\"State\", \"clearStaleState\");\n        const cutoff = Timer.getEpochTime() - age;\n\n        const keys = await storage.getAllKeys();\n        logger.debug(\"got keys\", keys);\n\n        for (let i = 0; i < keys.length; i++) {\n            const key = keys[i];\n            const item = await storage.get(key);\n            let remove = false;\n\n            if (item) {\n                try {\n                    const state = await State.fromStorageString(item);\n\n                    logger.debug(\"got item from key:\", key, state.created);\n                    if (state.created <= cutoff) {\n                        remove = true;\n                    }\n                }\n                catch (err) {\n                    logger.error(\"Error parsing state for key:\", key, err);\n                    remove = true;\n                }\n            }\n            else {\n                logger.debug(\"no item in storage for key:\", key);\n                remove = true;\n            }\n\n            if (remove) {\n                logger.debug(\"removed item for key:\", key);\n                void storage.remove(key);\n            }\n        }\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, CryptoUtils } from \"./utils\";\nimport { State } from \"./State\";\n\n/** @public */\nexport interface SigninStateArgs {\n    id?: string;\n    data?: unknown;\n    created?: number;\n    request_type?: string;\n\n    code_verifier?: string;\n    code_challenge?: string;\n    authority: string;\n    client_id: string;\n    redirect_uri: string;\n    scope: string;\n    client_secret?: string;\n    extraTokenParams?: Record<string, unknown>;\n    response_mode?: \"query\" | \"fragment\";\n    skipUserInfo?: boolean;\n    url_state?: string;\n}\n\n/** @public */\nexport type SigninStateCreateArgs = Omit<SigninStateArgs, \"code_verifier\"> & {\n    code_verifier?: string | boolean;\n};\n\n/**\n * @public\n */\nexport class SigninState extends State {\n    // isCode\n    /** The same code_verifier that was used to obtain the authorization_code via PKCE. */\n    public readonly code_verifier: string | undefined;\n    /** Used to secure authorization code grants via Proof Key for Code Exchange (PKCE). */\n    public readonly code_challenge: string | undefined;\n\n    // to ensure state still matches settings\n    /** @see {@link OidcClientSettings.authority} */\n    public readonly authority: string;\n    /** @see {@link OidcClientSettings.client_id} */\n    public readonly client_id: string;\n    /** @see {@link OidcClientSettings.redirect_uri} */\n    public readonly redirect_uri: string;\n    /** @see {@link OidcClientSettings.scope} */\n    public readonly scope: string;\n    /** @see {@link OidcClientSettings.client_secret} */\n    public readonly client_secret: string | undefined;\n    /** @see {@link OidcClientSettings.extraTokenParams} */\n    public readonly extraTokenParams: Record<string, unknown> | undefined;\n    /** @see {@link OidcClientSettings.response_mode} */\n    public readonly response_mode: \"query\" | \"fragment\" | undefined;\n\n    public readonly skipUserInfo: boolean | undefined;\n\n    private constructor(args: SigninStateArgs) {\n        super(args);\n\n        this.code_verifier = args.code_verifier;\n        this.code_challenge = args.code_challenge;\n        this.authority = args.authority;\n        this.client_id = args.client_id;\n        this.redirect_uri = args.redirect_uri;\n        this.scope = args.scope;\n        this.client_secret = args.client_secret;\n        this.extraTokenParams = args.extraTokenParams;\n\n        this.response_mode = args.response_mode;\n        this.skipUserInfo = args.skipUserInfo;\n    }\n\n    public static async create(args: SigninStateCreateArgs): Promise<SigninState> {\n        const code_verifier = args.code_verifier === true ? CryptoUtils.generateCodeVerifier() : (args.code_verifier || undefined);\n        const code_challenge = code_verifier ? (await CryptoUtils.generateCodeChallenge(code_verifier)) : undefined;\n\n        return new SigninState({\n            ...args,\n            code_verifier,\n            code_challenge,\n        });\n    }\n\n    public toStorageString(): string {\n        new Logger(\"SigninState\").create(\"toStorageString\");\n        return JSON.stringify({\n            id: this.id,\n            data: this.data,\n            created: this.created,\n            request_type: this.request_type,\n            url_state: this.url_state,\n\n            code_verifier: this.code_verifier,\n            authority: this.authority,\n            client_id: this.client_id,\n            redirect_uri: this.redirect_uri,\n            scope: this.scope,\n            client_secret: this.client_secret,\n            extraTokenParams : this.extraTokenParams,\n            response_mode: this.response_mode,\n            skipUserInfo: this.skipUserInfo,\n        });\n    }\n\n    public static fromStorageString(storageString: string): Promise<SigninState> {\n        Logger.createStatic(\"SigninState\", \"fromStorageString\");\n        const data = JSON.parse(storageString);\n        return SigninState.create(data);\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, URL_STATE_DELIMITER } from \"./utils\";\nimport { SigninState } from \"./SigninState\";\n\n/**\n * @public\n * @see https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest\n */\nexport interface SigninRequestCreateArgs {\n    // mandatory\n    url: string;\n    authority: string;\n    client_id: string;\n    redirect_uri: string;\n    response_type: string;\n    scope: string;\n\n    // optional\n    response_mode?: \"query\" | \"fragment\";\n    nonce?: string;\n    display?: string;\n    dpopJkt?: string;\n    prompt?: string;\n    max_age?: number;\n    ui_locales?: string;\n    id_token_hint?: string;\n    login_hint?: string;\n    acr_values?: string;\n\n    // other\n    resource?: string | string[];\n    request?: string;\n    request_uri?: string;\n    request_type?: string;\n    extraQueryParams?: Record<string, string | number | boolean>;\n\n    // special\n    extraTokenParams?: Record<string, unknown>;\n    client_secret?: string;\n    skipUserInfo?: boolean;\n    disablePKCE?: boolean;\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\n    state_data?: unknown;\n    url_state?: string;\n    omitScopeWhenRequesting?: boolean;\n}\n\n/**\n * @public\n */\nexport class SigninRequest {\n    private static readonly _logger = new Logger(\"SigninRequest\");\n\n    public readonly url: string;\n    public readonly state: SigninState;\n\n    private constructor(args: {\n        url: string;\n        state: SigninState;\n    }) {\n        this.url = args.url;\n        this.state = args.state;\n    }\n\n    public static async create({\n        // mandatory\n        url, authority, client_id, redirect_uri, response_type, scope,\n        // optional\n        state_data, response_mode, request_type, client_secret, nonce, url_state,\n        resource,\n        skipUserInfo,\n        extraQueryParams,\n        extraTokenParams,\n        disablePKCE,\n        dpopJkt,\n        omitScopeWhenRequesting,\n        ...optionalParams\n    }: SigninRequestCreateArgs): Promise<SigninRequest> {\n        if (!url) {\n            this._logger.error(\"create: No url passed\");\n            throw new Error(\"url\");\n        }\n        if (!client_id) {\n            this._logger.error(\"create: No client_id passed\");\n            throw new Error(\"client_id\");\n        }\n        if (!redirect_uri) {\n            this._logger.error(\"create: No redirect_uri passed\");\n            throw new Error(\"redirect_uri\");\n        }\n        if (!response_type) {\n            this._logger.error(\"create: No response_type passed\");\n            throw new Error(\"response_type\");\n        }\n        if (!scope) {\n            this._logger.error(\"create: No scope passed\");\n            throw new Error(\"scope\");\n        }\n        if (!authority) {\n            this._logger.error(\"create: No authority passed\");\n            throw new Error(\"authority\");\n        }\n\n        const state = await SigninState.create({\n            data: state_data,\n            request_type,\n            url_state,\n            code_verifier: !disablePKCE,\n            client_id, authority, redirect_uri,\n            response_mode,\n            client_secret, scope, extraTokenParams,\n            skipUserInfo,\n        });\n\n        const parsedUrl = new URL(url);\n        parsedUrl.searchParams.append(\"client_id\", client_id);\n        parsedUrl.searchParams.append(\"redirect_uri\", redirect_uri);\n        parsedUrl.searchParams.append(\"response_type\", response_type);\n        if (!omitScopeWhenRequesting) {\n            parsedUrl.searchParams.append(\"scope\", scope);\n        }\n        if (nonce) {\n            parsedUrl.searchParams.append(\"nonce\", nonce);\n        }\n\n        if (dpopJkt) {\n            parsedUrl.searchParams.append(\"dpop_jkt\", dpopJkt);\n        }\n\n        let stateParam = state.id;\n        if (url_state) {\n            stateParam = `${stateParam}${URL_STATE_DELIMITER}${url_state}`;\n        }\n        parsedUrl.searchParams.append(\"state\", stateParam);\n        if (state.code_challenge) {\n            parsedUrl.searchParams.append(\"code_challenge\", state.code_challenge);\n            parsedUrl.searchParams.append(\"code_challenge_method\", \"S256\");\n        }\n\n        if (resource) {\n            // https://datatracker.ietf.org/doc/html/rfc8707\n            const resources = Array.isArray(resource) ? resource : [resource];\n            resources\n                .forEach(r => parsedUrl.searchParams.append(\"resource\", r));\n        }\n\n        for (const [key, value] of Object.entries({ response_mode, ...optionalParams, ...extraQueryParams })) {\n            if (value != null) {\n                parsedUrl.searchParams.append(key, value.toString());\n            }\n        }\n\n        return new SigninRequest({\n            url: parsedUrl.href,\n            state,\n        });\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Timer, URL_STATE_DELIMITER } from \"./utils\";\nimport type { UserProfile } from \"./User\";\n\nconst OidcScope = \"openid\";\n\n/**\n * @public\n * @see https://openid.net/specs/openid-connect-core-1_0.html#AuthResponse\n * @see https://openid.net/specs/openid-connect-core-1_0.html#AuthError\n */\nexport class SigninResponse {\n    // props present in the initial callback response regardless of success\n    public readonly state: string | null;\n    /** @see {@link User.session_state} */\n    public session_state: string | null;\n\n    // error props\n    /** @see {@link ErrorResponse.error} */\n    public readonly error: string | null;\n    /** @see {@link ErrorResponse.error_description} */\n    public readonly error_description: string | null;\n    /** @see {@link ErrorResponse.error_uri} */\n    public readonly error_uri: string | null;\n\n    // success props\n    public readonly code: string | null;\n\n    // props set after validation\n    /** @see {@link User.id_token} */\n    public id_token?: string;\n    /** @see {@link User.access_token} */\n    public access_token = \"\";\n    /** @see {@link User.token_type} */\n    public token_type = \"\";\n    /** @see {@link User.refresh_token} */\n    public refresh_token?: string;\n    /** @see {@link User.scope} */\n    public scope?: string;\n    /** @see {@link User.expires_at} */\n    public expires_at?: number;\n\n    /** custom state data set during the initial signin request */\n    public userState: unknown;\n    public url_state?: string;\n\n    /** @see {@link User.profile} */\n    public profile: UserProfile = {} as UserProfile;\n\n    public constructor(params: URLSearchParams) {\n        this.state = params.get(\"state\");\n        this.session_state = params.get(\"session_state\");\n        if (this.state) {\n            const splitState = decodeURIComponent(this.state).split(URL_STATE_DELIMITER);\n            this.state = splitState[0];\n            if (splitState.length > 1) {\n                this.url_state = splitState.slice(1).join(URL_STATE_DELIMITER);\n            }\n        }\n\n        this.error = params.get(\"error\");\n        this.error_description = params.get(\"error_description\");\n        this.error_uri = params.get(\"error_uri\");\n\n        this.code = params.get(\"code\");\n    }\n\n    public get expires_in(): number | undefined {\n        if (this.expires_at === undefined) {\n            return undefined;\n        }\n        return this.expires_at - Timer.getEpochTime();\n    }\n    public set expires_in(value: number | undefined) {\n        // spec expects a number, but normalize here just in case\n        if (typeof value === \"string\") value = Number(value);\n        if (value !== undefined && value >= 0) {\n            this.expires_at = Math.floor(value) + Timer.getEpochTime();\n        }\n    }\n\n    public get isOpenId(): boolean {\n        return this.scope?.split(\" \").includes(OidcScope) || !!this.id_token;\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"./utils\";\nimport { State } from \"./State\";\n\n/**\n * @public\n * @see https://openid.net/specs/openid-connect-rpinitiated-1_0.html#RPLogout\n */\nexport interface SignoutRequestArgs {\n    // mandatory\n    url: string;\n\n    // optional\n    id_token_hint?: string;\n    client_id?: string;\n    post_logout_redirect_uri?: string;\n    extraQueryParams?: Record<string, string | number | boolean>;\n\n    // special\n    request_type?: string;\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\n    state_data?: unknown;\n}\n\n/**\n * @public\n */\nexport class SignoutRequest {\n    private readonly _logger = new Logger(\"SignoutRequest\");\n\n    public readonly url: string;\n    public readonly state?: State;\n\n    public constructor({\n        url,\n        state_data, id_token_hint, post_logout_redirect_uri, extraQueryParams, request_type, client_id,\n    }: SignoutRequestArgs) {\n        if (!url) {\n            this._logger.error(\"ctor: No url passed\");\n            throw new Error(\"url\");\n        }\n\n        const parsedUrl = new URL(url);\n        if (id_token_hint) {\n            parsedUrl.searchParams.append(\"id_token_hint\", id_token_hint);\n        }\n        if (client_id) {\n            parsedUrl.searchParams.append(\"client_id\", client_id);\n        }\n\n        if (post_logout_redirect_uri) {\n            parsedUrl.searchParams.append(\"post_logout_redirect_uri\", post_logout_redirect_uri);\n\n            if (state_data) {\n                this.state = new State({ data: state_data, request_type });\n\n                parsedUrl.searchParams.append(\"state\", this.state.id);\n            }\n        }\n\n        for (const [key, value] of Object.entries({ ...extraQueryParams })) {\n            if (value != null) {\n                parsedUrl.searchParams.append(key, value.toString());\n            }\n        }\n\n        this.url = parsedUrl.href;\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\n/**\n * @public\n * @see https://openid.net/specs/openid-connect-core-1_0.html#AuthError\n */\nexport class SignoutResponse {\n    public readonly state: string | null;\n\n    // error props\n    /** @see {@link ErrorResponse.error} */\n    public error: string | null;\n    /** @see {@link ErrorResponse.error_description} */\n    public error_description: string | null;\n    /** @see {@link ErrorResponse.error_uri} */\n    public error_uri: string | null;\n\n    /** custom state data set during the initial signin request */\n    public userState: unknown;\n\n    public constructor(params: URLSearchParams) {\n        this.state = params.get(\"state\");\n\n        this.error = params.get(\"error\");\n        this.error_description = params.get(\"error_description\");\n        this.error_uri = params.get(\"error_uri\");\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport type { JwtClaims } from \"./Claims\";\nimport type { OidcClientSettingsStore } from \"./OidcClientSettings\";\nimport type { UserProfile } from \"./User\";\nimport { Logger } from \"./utils\";\n\n/**\n * Protocol claims that could be removed by default from profile.\n * Derived from the following sets of claims:\n * - {@link https://datatracker.ietf.org/doc/html/rfc7519.html#section-4.1}\n * - {@link https://openid.net/specs/openid-connect-core-1_0.html#IDToken}\n * - {@link https://openid.net/specs/openid-connect-core-1_0.html#CodeIDToken}\n *\n * @internal\n */\nconst DefaultProtocolClaims = [\n    \"nbf\",\n    \"jti\",\n    \"auth_time\",\n    \"nonce\",\n    \"acr\",\n    \"amr\",\n    \"azp\",\n    \"at_hash\", // https://openid.net/specs/openid-connect-core-1_0.html#CodeIDToken\n] as const;\n\n/**\n * Protocol claims that should never be removed from profile.\n * \"sub\" is needed internally and others should remain required as per the OIDC specs.\n *\n * @internal\n */\nconst InternalRequiredProtocolClaims = [\"sub\", \"iss\", \"aud\", \"exp\", \"iat\"];\n\n/**\n * @internal\n */\nexport class ClaimsService {\n    protected readonly _logger = new Logger(\"ClaimsService\");\n    public constructor(\n        protected readonly _settings: OidcClientSettingsStore,\n    ) {}\n\n    public filterProtocolClaims(claims: UserProfile): UserProfile {\n        const result = { ...claims };\n\n        if (this._settings.filterProtocolClaims) {\n            let protocolClaims;\n            if (Array.isArray(this._settings.filterProtocolClaims)) {\n                protocolClaims = this._settings.filterProtocolClaims;\n            } else {\n                protocolClaims = DefaultProtocolClaims;\n            }\n\n            for (const claim of protocolClaims) {\n                if (!InternalRequiredProtocolClaims.includes(claim)) {\n                    delete result[claim];\n                }\n            }\n        }\n\n        return result;\n    }\n\n    public mergeClaims(claims1: JwtClaims, claims2: JwtClaims): UserProfile;\n    public mergeClaims(claims1: UserProfile, claims2: JwtClaims): UserProfile {\n        const result = { ...claims1 };\n        for (const [claim, values] of Object.entries(claims2)) {\n            if (result[claim] !== values) {\n                if (Array.isArray(result[claim]) || Array.isArray(values)) {\n                    if (this._settings.mergeClaimsStrategy.array == \"replace\") {\n                        result[claim] = values;\n                    } else {\n                        const mergedValues = Array.isArray(result[claim]) ? result[claim] as unknown[] : [result[claim]];\n                        for (const value of Array.isArray(values) ? values : [values]) {\n                            if (!mergedValues.includes(value)) {\n                                mergedValues.push(value);\n                            }\n                        }\n                        result[claim] = mergedValues;\n                    }\n                } else if (typeof result[claim] === \"object\" && typeof values === \"object\") {\n                    result[claim] = this.mergeClaims(result[claim] as JwtClaims, values as JwtClaims);\n                } else {\n                    result[claim] = values;\n                }\n            }\n        }\n\n        return result;\n    }\n}\n", "/**\n * @public\n */\nexport interface DPoPStore {\n    set(key: string, value: DPoPState): Promise<void>;\n    get(key: string): Promise<DPoPState>;\n    remove(key: string): Promise<DPoPState>;\n    getAllKeys(): Promise<string[]>;\n}\n\n/**\n * @public\n */\nexport class DPoPState {\n    public constructor(\n        public readonly keys: CryptoKeyPair,\n        public nonce?: string,\n    ) { }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { CryptoUtils, Logger, UrlUtils } from \"./utils\";\nimport { ErrorResponse } from \"./errors\";\nimport { type ExtraHeader, type OidcClientSettings, OidcClientSettingsStore } from \"./OidcClientSettings\";\nimport { ResponseValidator } from \"./ResponseValidator\";\nimport { MetadataService } from \"./MetadataService\";\nimport type { RefreshState } from \"./RefreshState\";\nimport { SigninRequest, type SigninRequestCreateArgs } from \"./SigninRequest\";\nimport { SigninResponse } from \"./SigninResponse\";\nimport { SignoutRequest, type SignoutRequestArgs } from \"./SignoutRequest\";\nimport { SignoutResponse } from \"./SignoutResponse\";\nimport { SigninState } from \"./SigninState\";\nimport { State } from \"./State\";\nimport { TokenClient } from \"./TokenClient\";\nimport { ClaimsService } from \"./ClaimsService\";\nimport { DPoPState, type DPoPStore } from \"./DPoPStore\";\nimport { ErrorDPoPNonce } from \"./errors/ErrorDPoPNonce\";\n\n/**\n * @public\n */\nexport interface CreateSigninRequestArgs\n    extends Omit<SigninRequestCreateArgs, \"url\" | \"authority\" | \"client_id\" | \"redirect_uri\" | \"response_type\" | \"scope\" | \"state_data\"> {\n    redirect_uri?: string;\n    response_type?: string;\n    scope?: string;\n    dpopJkt?: string;\n\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\n    state?: unknown;\n}\n\n/**\n * @public\n */\nexport interface UseRefreshTokenArgs {\n    redirect_uri?: string;\n    resource?: string | string[];\n    extraTokenParams?: Record<string, unknown>;\n    timeoutInSeconds?: number;\n\n    state: RefreshState;\n\n    extraHeaders?: Record<string, ExtraHeader>;\n}\n\n/**\n * @public\n */\nexport type CreateSignoutRequestArgs = Omit<SignoutRequestArgs, \"url\" | \"state_data\"> & {\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\n    state?: unknown;\n};\n\n/**\n * @public\n */\nexport type ProcessResourceOwnerPasswordCredentialsArgs = {\n    username: string;\n    password: string;\n    skipUserInfo?: boolean;\n    extraTokenParams?: Record<string, unknown>;\n};\n\n/**\n * Provides the raw OIDC/OAuth2 protocol support for the authorization endpoint and the end session endpoint in the\n * authorization server. It provides a bare-bones protocol implementation and is used by the UserManager class.\n * Only use this class if you simply want protocol support without the additional management features of the\n * UserManager class.\n *\n * @public\n */\nexport class OidcClient {\n    public readonly settings: OidcClientSettingsStore;\n    protected readonly _logger = new Logger(\"OidcClient\");\n\n    public readonly metadataService: MetadataService;\n    protected readonly _claimsService: ClaimsService;\n    protected readonly _validator: ResponseValidator;\n    protected readonly _tokenClient: TokenClient;\n\n    public constructor(settings: OidcClientSettings);\n    public constructor(settings: OidcClientSettingsStore, metadataService: MetadataService);\n    public constructor(settings: OidcClientSettings | OidcClientSettingsStore, metadataService?: MetadataService) {\n        this.settings = settings instanceof OidcClientSettingsStore ? settings : new OidcClientSettingsStore(settings);\n\n        this.metadataService = metadataService ?? new MetadataService(this.settings);\n        this._claimsService = new ClaimsService(this.settings);\n        this._validator = new ResponseValidator(this.settings, this.metadataService, this._claimsService);\n        this._tokenClient = new TokenClient(this.settings, this.metadataService);\n    }\n\n    public async createSigninRequest({\n        state,\n        request,\n        request_uri,\n        request_type,\n        id_token_hint,\n        login_hint,\n        skipUserInfo,\n        nonce,\n        url_state,\n        response_type = this.settings.response_type,\n        scope = this.settings.scope,\n        redirect_uri = this.settings.redirect_uri,\n        prompt = this.settings.prompt,\n        display = this.settings.display,\n        max_age = this.settings.max_age,\n        ui_locales = this.settings.ui_locales,\n        acr_values = this.settings.acr_values,\n        resource = this.settings.resource,\n        response_mode = this.settings.response_mode,\n        extraQueryParams = this.settings.extraQueryParams,\n        extraTokenParams = this.settings.extraTokenParams,\n        dpopJkt,\n        omitScopeWhenRequesting = this.settings.omitScopeWhenRequesting,\n    }: CreateSigninRequestArgs): Promise<SigninRequest> {\n        const logger = this._logger.create(\"createSigninRequest\");\n\n        if (response_type !== \"code\") {\n            throw new Error(\"Only the Authorization Code flow (with PKCE) is supported\");\n        }\n\n        const url = await this.metadataService.getAuthorizationEndpoint();\n        logger.debug(\"Received authorization endpoint\", url);\n\n        const signinRequest = await SigninRequest.create({\n            url,\n            authority: this.settings.authority,\n            client_id: this.settings.client_id,\n            redirect_uri,\n            response_type,\n            scope,\n            state_data: state,\n            url_state,\n            prompt, display, max_age, ui_locales, id_token_hint, login_hint, acr_values, dpopJkt,\n            resource, request, request_uri, extraQueryParams, extraTokenParams, request_type, response_mode,\n            client_secret: this.settings.client_secret,\n            skipUserInfo,\n            nonce,\n            disablePKCE: this.settings.disablePKCE,\n            omitScopeWhenRequesting,\n        });\n\n        // house cleaning\n        await this.clearStaleState();\n\n        const signinState = signinRequest.state;\n        await this.settings.stateStore.set(signinState.id, signinState.toStorageString());\n        return signinRequest;\n    }\n\n    public async readSigninResponseState(url: string, removeState = false): Promise<{ state: SigninState; response: SigninResponse }> {\n        const logger = this._logger.create(\"readSigninResponseState\");\n\n        const response = new SigninResponse(UrlUtils.readParams(url, this.settings.response_mode));\n        if (!response.state) {\n            logger.throw(new Error(\"No state in response\"));\n            // need to throw within this function's body for type narrowing to work\n            throw null; // https://github.com/microsoft/TypeScript/issues/46972\n        }\n\n        const storedStateString = await this.settings.stateStore[removeState ? \"remove\" : \"get\"](response.state);\n        if (!storedStateString) {\n            logger.throw(new Error(\"No matching state found in storage\"));\n            throw null; // https://github.com/microsoft/TypeScript/issues/46972\n        }\n\n        const state = await SigninState.fromStorageString(storedStateString);\n        return { state, response };\n    }\n\n    public async processSigninResponse(url: string, extraHeaders?: Record<string, ExtraHeader>): Promise<SigninResponse> {\n        const logger = this._logger.create(\"processSigninResponse\");\n\n        const { state, response } = await this.readSigninResponseState(url, true);\n        logger.debug(\"received state from storage; validating response\");\n\n        if (this.settings.dpop && this.settings.dpop.store) {\n            const dpopProof = await this.getDpopProof(this.settings.dpop.store);\n            extraHeaders = { ...extraHeaders, \"DPoP\": dpopProof };\n        }\n\n        /**\n         * The DPoP spec describes a method for Authorization Servers to supply a nonce value\n         * in order to limit the lifetime of a given DPoP proof.\n         * See https://datatracker.ietf.org/doc/html/rfc9449#name-authorization-server-provid\n         * This involves the AS returning a 400 bad request with a DPoP-Nonce header containing\n         * the nonce value. The client must then retry the request with a recomputed DPoP proof\n         * containing the supplied nonce value.\n         */\n        try {\n            await this._validator.validateSigninResponse(response, state, extraHeaders);\n        }\n        catch (err) {\n            if (err instanceof ErrorDPoPNonce && this.settings.dpop) {\n                const dpopProof = await this.getDpopProof(this.settings.dpop.store, err.nonce);\n                extraHeaders![\"DPoP\"] = dpopProof;\n                await this._validator.validateSigninResponse(response, state, extraHeaders);\n            } else {\n                throw err;\n            }\n        }\n\n        return response;\n    }\n\n    async getDpopProof(dpopStore: DPoPStore, nonce?: string): Promise<string> {\n        let keyPair: CryptoKeyPair;\n        let dpopState: DPoPState;\n\n        if (!(await dpopStore.getAllKeys()).includes(this.settings.client_id)) {\n            keyPair = await CryptoUtils.generateDPoPKeys();\n            dpopState = new DPoPState(keyPair, nonce);\n            await dpopStore.set(this.settings.client_id, dpopState);\n        } else {\n            dpopState = await dpopStore.get(this.settings.client_id);\n\n            // if the server supplied nonce has changed since the last request, update the nonce\n            if (dpopState.nonce !== nonce && nonce) {\n                dpopState.nonce = nonce;\n                await dpopStore.set(this.settings.client_id, dpopState);\n            }\n        }\n\n        return await CryptoUtils.generateDPoPProof({\n            url: await this.metadataService.getTokenEndpoint(false),\n            httpMethod: \"POST\",\n            keyPair: dpopState.keys,\n            nonce: dpopState.nonce,\n        });\n    }\n\n    public async processResourceOwnerPasswordCredentials({\n        username,\n        password,\n        skipUserInfo = false,\n        extraTokenParams = {},\n    }: ProcessResourceOwnerPasswordCredentialsArgs): Promise<SigninResponse> {\n        const tokenResponse: Record<string, unknown> = await this._tokenClient.exchangeCredentials({ username, password, ...extraTokenParams });\n        const signinResponse: SigninResponse = new SigninResponse(new URLSearchParams());\n        Object.assign(signinResponse, tokenResponse);\n        await this._validator.validateCredentialsResponse(signinResponse, skipUserInfo);\n        return signinResponse;\n    }\n\n    public async useRefreshToken({\n        state,\n        redirect_uri,\n        resource,\n        timeoutInSeconds,\n        extraHeaders,\n        extraTokenParams,\n    }: UseRefreshTokenArgs): Promise<SigninResponse> {\n        const logger = this._logger.create(\"useRefreshToken\");\n\n        // https://github.com/authts/oidc-client-ts/issues/695\n        // In some cases (e.g. AzureAD), not all granted scopes are allowed on token refresh requests.\n        // Therefore, we filter all granted scopes by a list of allowable scopes.\n        let scope;\n        if (this.settings.refreshTokenAllowedScope === undefined) {\n            scope = state.scope;\n        } else {\n            const allowableScopes = this.settings.refreshTokenAllowedScope.split(\" \");\n            const providedScopes = state.scope?.split(\" \") || [];\n\n            scope = providedScopes.filter(s => allowableScopes.includes(s)).join(\" \");\n        }\n\n        if (this.settings.dpop && this.settings.dpop.store) {\n            const dpopProof = await this.getDpopProof(this.settings.dpop.store);\n            extraHeaders = { ...extraHeaders, \"DPoP\": dpopProof };\n        }\n\n        /**\n         * The DPoP spec describes a method for Authorization Servers to supply a nonce value\n         * in order to limit the lifetime of a given DPoP proof.\n         * See https://datatracker.ietf.org/doc/html/rfc9449#name-authorization-server-provid\n         * This involves the AS returning a 400 bad request with a DPoP-Nonce header containing\n         * the nonce value. The client must then retry the request with a recomputed DPoP proof\n         * containing the supplied nonce value.\n         */\n        let result;\n        try {\n            result = await this._tokenClient.exchangeRefreshToken({\n                refresh_token: state.refresh_token,\n                // provide the (possible filtered) scope list\n                scope,\n                redirect_uri,\n                resource,\n                timeoutInSeconds,\n                extraHeaders,\n                ...extraTokenParams,\n            });\n        } catch (err) {\n            if (err instanceof ErrorDPoPNonce && this.settings.dpop) {\n                extraHeaders![\"DPoP\"] = await this.getDpopProof(this.settings.dpop.store, err.nonce);\n                result = await this._tokenClient.exchangeRefreshToken({\n                    refresh_token: state.refresh_token,\n                    // provide the (possible filtered) scope list\n                    scope,\n                    redirect_uri,\n                    resource,\n                    timeoutInSeconds,\n                    extraHeaders,\n                    ...extraTokenParams,\n                });\n            } else {\n                throw err;\n            }\n        }\n\n        const response = new SigninResponse(new URLSearchParams());\n        Object.assign(response, result);\n        logger.debug(\"validating response\", response);\n        await this._validator.validateRefreshResponse(response, {\n            ...state,\n            // override the scope in the state handed over to the validator\n            // so it can set the granted scope to the requested scope in case none is included in the response\n            scope,\n        });\n        return response;\n    }\n\n    public async createSignoutRequest({\n        state,\n        id_token_hint,\n        client_id,\n        request_type,\n        post_logout_redirect_uri = this.settings.post_logout_redirect_uri,\n        extraQueryParams = this.settings.extraQueryParams,\n    }: CreateSignoutRequestArgs = {}): Promise<SignoutRequest> {\n        const logger = this._logger.create(\"createSignoutRequest\");\n\n        const url = await this.metadataService.getEndSessionEndpoint();\n        if (!url) {\n            logger.throw(new Error(\"No end session endpoint\"));\n            throw null; // https://github.com/microsoft/TypeScript/issues/46972\n        }\n\n        logger.debug(\"Received end session endpoint\", url);\n\n        // specify the client identifier when post_logout_redirect_uri is used but id_token_hint is not\n        if (!client_id && post_logout_redirect_uri && !id_token_hint) {\n            client_id = this.settings.client_id;\n        }\n\n        const request = new SignoutRequest({\n            url,\n            id_token_hint,\n            client_id,\n            post_logout_redirect_uri,\n            state_data: state,\n            extraQueryParams,\n            request_type,\n        });\n\n        // house cleaning\n        await this.clearStaleState();\n\n        const signoutState = request.state;\n        if (signoutState) {\n            logger.debug(\"Signout request has state to persist\");\n            await this.settings.stateStore.set(signoutState.id, signoutState.toStorageString());\n        }\n\n        return request;\n    }\n\n    public async readSignoutResponseState(url: string, removeState = false): Promise<{ state: State | undefined; response: SignoutResponse }> {\n        const logger = this._logger.create(\"readSignoutResponseState\");\n\n        const response = new SignoutResponse(UrlUtils.readParams(url, this.settings.response_mode));\n        if (!response.state) {\n            logger.debug(\"No state in response\");\n\n            if (response.error) {\n                logger.warn(\"Response was error:\", response.error);\n                throw new ErrorResponse(response);\n            }\n\n            return { state: undefined, response };\n        }\n\n        const storedStateString = await this.settings.stateStore[removeState ? \"remove\" : \"get\"](response.state);\n        if (!storedStateString) {\n            logger.throw(new Error(\"No matching state found in storage\"));\n            throw null; // https://github.com/microsoft/TypeScript/issues/46972\n        }\n\n        const state = await State.fromStorageString(storedStateString);\n        return { state, response };\n    }\n\n    public async processSignoutResponse(url: string): Promise<SignoutResponse> {\n        const logger = this._logger.create(\"processSignoutResponse\");\n\n        const { state, response } = await this.readSignoutResponseState(url, true);\n        if (state) {\n            logger.debug(\"Received state from storage; validating response\");\n            this._validator.validateSignoutResponse(response, state);\n        } else {\n            logger.debug(\"No state from storage; skipping response validation\");\n        }\n\n        return response;\n    }\n\n    public clearStaleState(): Promise<void> {\n        this._logger.create(\"clearStaleState\");\n        return State.clearStaleState(this.settings.stateStore, this.settings.staleStateAgeInSeconds);\n    }\n\n    public async revokeToken(token: string, type?: \"access_token\" | \"refresh_token\"): Promise<void> {\n        this._logger.create(\"revokeToken\");\n        return await this._tokenClient.revoke({\n            token,\n            token_type_hint: type,\n        });\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"./utils\";\nimport { CheckSessionIFrame } from \"./CheckSessionIFrame\";\nimport type { UserManager } from \"./UserManager\";\nimport type { User } from \"./User\";\n\n/**\n * @public\n */\nexport class SessionMonitor {\n    private readonly _logger = new Logger(\"SessionMonitor\");\n\n    private _sub: string | undefined;\n    private _checkSessionIFrame?: CheckSessionIFrame;\n\n    public constructor(private readonly _userManager: UserManager) {\n        if (!_userManager) {\n            this._logger.throw(new Error(\"No user manager passed\"));\n        }\n\n        this._userManager.events.addUserLoaded(this._start);\n        this._userManager.events.addUserUnloaded(this._stop);\n\n        this._init().catch((err: unknown) => {\n            // catch to suppress errors since we're in a ctor\n            this._logger.error(err);\n        });\n    }\n\n    protected async _init(): Promise<void> {\n        this._logger.create(\"_init\");\n        const user = await this._userManager.getUser();\n        // doing this manually here since calling getUser\n        // doesn't trigger load event.\n        if (user) {\n            void this._start(user);\n        }\n        else if (this._userManager.settings.monitorAnonymousSession) {\n            const session = await this._userManager.querySessionStatus();\n            if (session) {\n                const tmpUser = {\n                    session_state: session.session_state,\n                    profile: session.sub ? {\n                        sub: session.sub,\n                    } : null,\n                };\n                void this._start(tmpUser);\n            }\n        }\n    }\n\n    protected _start = async (\n        user: User | {\n            session_state: string;\n            profile: { sub: string } | null;\n        },\n    ): Promise<void> => {\n        const session_state = user.session_state;\n        if (!session_state) {\n            return;\n        }\n        const logger = this._logger.create(\"_start\");\n\n        if (user.profile) {\n            this._sub = user.profile.sub;\n            logger.debug(\"session_state\", session_state, \", sub\", this._sub);\n        }\n        else {\n            this._sub = undefined;\n            logger.debug(\"session_state\", session_state, \", anonymous user\");\n        }\n\n        if (this._checkSessionIFrame) {\n            this._checkSessionIFrame.start(session_state);\n            return;\n        }\n\n        try {\n            const url = await this._userManager.metadataService.getCheckSessionIframe();\n            if (url) {\n                logger.debug(\"initializing check session iframe\");\n\n                const client_id = this._userManager.settings.client_id;\n                const intervalInSeconds = this._userManager.settings.checkSessionIntervalInSeconds;\n                const stopOnError = this._userManager.settings.stopCheckSessionOnError;\n\n                const checkSessionIFrame = new CheckSessionIFrame(this._callback, client_id, url, intervalInSeconds, stopOnError);\n                await checkSessionIFrame.load();\n                this._checkSessionIFrame = checkSessionIFrame;\n                checkSessionIFrame.start(session_state);\n            }\n            else {\n                logger.warn(\"no check session iframe found in the metadata\");\n            }\n        }\n        catch (err) {\n            // catch to suppress errors since we're in non-promise callback\n            logger.error(\"Error from getCheckSessionIframe:\", err instanceof Error ? err.message : err);\n        }\n    };\n\n    protected _stop = (): void => {\n        const logger = this._logger.create(\"_stop\");\n        this._sub = undefined;\n\n        if (this._checkSessionIFrame) {\n            this._checkSessionIFrame.stop();\n        }\n\n        if (this._userManager.settings.monitorAnonymousSession) {\n            // using a timer to delay re-initialization to avoid race conditions during signout\n            // TODO rewrite to use promise correctly\n            // eslint-disable-next-line @typescript-eslint/no-misused-promises\n            const timerHandle = setInterval(async () => {\n                clearInterval(timerHandle);\n\n                try {\n                    const session = await this._userManager.querySessionStatus();\n                    if (session) {\n                        const tmpUser = {\n                            session_state: session.session_state,\n                            profile: session.sub ? {\n                                sub: session.sub,\n                            } : null,\n                        };\n                        void this._start(tmpUser);\n                    }\n                }\n                catch (err) {\n                    // catch to suppress errors since we're in a callback\n                    logger.error(\"error from querySessionStatus\", err instanceof Error ? err.message : err);\n                }\n            }, 1000);\n        }\n    };\n\n    protected _callback = async (): Promise<void> => {\n        const logger = this._logger.create(\"_callback\");\n        try {\n            const session = await this._userManager.querySessionStatus();\n            let raiseEvent = true;\n\n            if (session && this._checkSessionIFrame) {\n                if (session.sub === this._sub) {\n                    raiseEvent = false;\n                    this._checkSessionIFrame.start(session.session_state);\n\n                    logger.debug(\"same sub still logged in at OP, session state has changed, restarting check session iframe; session_state\", session.session_state);\n                    await this._userManager.events._raiseUserSessionChanged();\n                }\n                else {\n                    logger.debug(\"different subject signed into OP\", session.sub);\n                }\n            }\n            else {\n                logger.debug(\"subject no longer signed into OP\");\n            }\n\n            if (raiseEvent) {\n                if (this._sub) {\n                    await this._userManager.events._raiseUserSignedOut();\n                }\n                else {\n                    await this._userManager.events._raiseUserSignedIn();\n                }\n            } else {\n                logger.debug(\"no change in session detected, no event to raise\");\n            }\n        }\n        catch (err) {\n            if (this._sub) {\n                logger.debug(\"Error calling queryCurrentSigninSession; raising signed out event\", err);\n                await this._userManager.events._raiseUserSignedOut();\n            }\n        }\n    };\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, Timer } from \"./utils\";\nimport type { IdTokenClaims } from \"./Claims\";\n\n/**\n * Holds claims represented by a combination of the `id_token` and the user info endpoint.\n *\n * @public\n */\nexport type UserProfile = IdTokenClaims;\n\n/**\n * @public\n */\nexport class User {\n    /**\n     * A JSON Web Token (JWT). Only provided if `openid` scope was requested.\n     * The application can access the data decoded by using the `profile` property.\n     */\n    public id_token?: string;\n\n    /** The session state value returned from the OIDC provider. */\n    public session_state: string | null;\n\n    /**\n     * The requested access token returned from the OIDC provider. The application can use this token to\n     * authenticate itself to the secured resource.\n     */\n    public access_token: string;\n\n    /**\n     * An OAuth 2.0 refresh token. The app can use this token to acquire additional access tokens after the\n     * current access token expires. Refresh tokens are long-lived and can be used to maintain access to resources\n     * for extended periods of time.\n     */\n    public refresh_token?: string;\n\n    /** Typically \"Bearer\" */\n    public token_type: string;\n\n    /** The scopes that the requested access token is valid for. */\n    public scope?: string;\n\n    /** The claims represented by a combination of the `id_token` and the user info endpoint. */\n    public profile: UserProfile;\n\n    /** The expires at returned from the OIDC provider. */\n    public expires_at?: number;\n\n    /** custom state data set during the initial signin request */\n    public readonly state: unknown;\n    public readonly url_state?: string;\n\n    public constructor(args: {\n        id_token?: string;\n        session_state?: string | null;\n        access_token: string;\n        refresh_token?: string;\n        token_type: string;\n        scope?: string;\n        profile: UserProfile;\n        expires_at?: number;\n        userState?: unknown;\n        url_state?: string;\n    }) {\n        this.id_token = args.id_token;\n        this.session_state = args.session_state ?? null;\n        this.access_token = args.access_token;\n        this.refresh_token = args.refresh_token;\n\n        this.token_type = args.token_type;\n        this.scope = args.scope;\n        this.profile = args.profile;\n        this.expires_at = args.expires_at;\n        this.state = args.userState;\n        this.url_state = args.url_state;\n    }\n\n    /** Computed number of seconds the access token has remaining. */\n    public get expires_in(): number | undefined {\n        if (this.expires_at === undefined) {\n            return undefined;\n        }\n        return this.expires_at - Timer.getEpochTime();\n    }\n\n    public set expires_in(value: number | undefined) {\n        if (value !== undefined) {\n            this.expires_at = Math.floor(value) + Timer.getEpochTime();\n        }\n    }\n\n    /** Computed value indicating if the access token is expired. */\n    public get expired(): boolean | undefined {\n        const expires_in = this.expires_in;\n        if (expires_in === undefined) {\n            return undefined;\n        }\n        return expires_in <= 0;\n    }\n\n    /** Array representing the parsed values from the `scope`. */\n    public get scopes(): string[] {\n        return this.scope?.split(\" \") ?? [];\n    }\n\n    public toStorageString(): string {\n        new Logger(\"User\").create(\"toStorageString\");\n        return JSON.stringify({\n            id_token: this.id_token,\n            session_state: this.session_state,\n            access_token: this.access_token,\n            refresh_token: this.refresh_token,\n            token_type: this.token_type,\n            scope: this.scope,\n            profile: this.profile,\n            expires_at: this.expires_at,\n        });\n    }\n\n    public static fromStorageString(storageString: string): User {\n        Logger.createStatic(\"User\", \"fromStorageString\");\n        return new User(JSON.parse(storageString));\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Event, Logger, UrlUtils } from \"../utils\";\nimport type { IWindow, NavigateParams, NavigateResponse } from \"./IWindow\";\n\nconst messageSource = \"oidc-client\";\n\ninterface MessageData {\n    source: string;\n    url: string;\n    keepOpen: boolean;\n}\n\n/**\n * Window implementation which resolves via communication from a child window\n * via the `Window.postMessage()` interface.\n *\n * @internal\n */\nexport abstract class AbstractChildWindow implements IWindow {\n    protected abstract readonly _logger: Logger;\n    protected readonly _abort = new Event<[reason: Error]>(\"Window navigation aborted\");\n    protected readonly _disposeHandlers = new Set<() => void>();\n\n    protected _window: WindowProxy | null = null;\n\n    public async navigate(params: NavigateParams): Promise<NavigateResponse> {\n        const logger = this._logger.create(\"navigate\");\n        if (!this._window) {\n            throw new Error(\"Attempted to navigate on a disposed window\");\n        }\n\n        logger.debug(\"setting URL in window\");\n        this._window.location.replace(params.url);\n\n        const { url, keepOpen } = await new Promise<MessageData>((resolve, reject) => {\n            const listener = (e: MessageEvent) => {\n                const data: MessageData | undefined = e.data;\n                const origin = params.scriptOrigin ?? window.location.origin;\n                if (e.origin !== origin || data?.source !== messageSource) {\n                    // silently discard events not intended for us\n                    return;\n                }\n                try {\n                    const state = UrlUtils.readParams(data.url, params.response_mode).get(\"state\");\n                    if (!state) {\n                        logger.warn(\"no state found in response url\");\n                    }\n                    if (e.source !== this._window && state !== params.state) {\n                        // MessageEvent source is a relatively modern feature, we can't rely on it\n                        // so we also inspect the payload for a matching state key as an alternative\n                        return;\n                    }\n                }\n                catch (err) {\n                    this._dispose();\n                    reject(new Error(\"Invalid response from window\"));\n                }\n                resolve(data);\n            };\n            window.addEventListener(\"message\", listener, false);\n            this._disposeHandlers.add(() => window.removeEventListener(\"message\", listener, false));\n            this._disposeHandlers.add(this._abort.addHandler((reason) => {\n                this._dispose();\n                reject(reason);\n            }));\n        });\n        logger.debug(\"got response from window\");\n        this._dispose();\n\n        if (!keepOpen) {\n            this.close();\n        }\n\n        return { url };\n    }\n\n    public abstract close(): void;\n\n    private _dispose(): void {\n        this._logger.create(\"_dispose\");\n\n        for (const dispose of this._disposeHandlers) {\n            dispose();\n        }\n        this._disposeHandlers.clear();\n    }\n\n    protected static _notifyParent(parent: Window, url: string, keepOpen = false, targetOrigin = window.location.origin): void {\n        parent.postMessage({\n            source: messageSource,\n            url,\n            keepOpen,\n        } as MessageData, targetOrigin);\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { type OidcClientSettings, OidcClientSettingsStore } from \"./OidcClientSettings\";\nimport type { PopupWindowFeatures } from \"./utils/PopupUtils\";\nimport { WebStorageStateStore } from \"./WebStorageStateStore\";\nimport { InMemoryWebStorage } from \"./InMemoryWebStorage\";\n\nexport const DefaultPopupWindowFeatures: PopupWindowFeatures = {\n    location: false,\n    toolbar: false,\n    height: 640,\n    closePopupWindowAfterInSeconds: -1,\n};\nexport const DefaultPopupTarget = \"_blank\";\nconst DefaultAccessTokenExpiringNotificationTimeInSeconds = 60;\nconst DefaultCheckSessionIntervalInSeconds = 2;\nexport const DefaultSilentRequestTimeoutInSeconds = 10;\n\n/**\n * The settings used to configure the {@link UserManager}.\n *\n * @public\n */\nexport interface UserManagerSettings extends OidcClientSettings {\n    /** The URL for the page containing the call to signinPopupCallback to handle the callback from the OIDC/OAuth2 */\n    popup_redirect_uri?: string;\n    popup_post_logout_redirect_uri?: string;\n    /**\n     * The features parameter to window.open for the popup signin window. By default, the popup is\n     * placed centered in front of the window opener.\n     * (default: \\{ location: false, menubar: false, height: 640, closePopupWindowAfterInSeconds: -1 \\})\n     */\n    popupWindowFeatures?: PopupWindowFeatures;\n    /** The target parameter to window.open for the popup signin window (default: \"_blank\") */\n    popupWindowTarget?: string;\n    /** The methods window.location method used to redirect (default: \"assign\") */\n    redirectMethod?: \"replace\" | \"assign\";\n    /** The methods target window being redirected (default: \"self\") */\n    redirectTarget?: \"top\" | \"self\";\n\n    /** The target to pass while calling postMessage inside iframe for callback (default: window.location.origin) */\n    iframeNotifyParentOrigin?: string;\n\n    /** The script origin to check during 'message' callback execution while performing silent auth via iframe (default: window.location.origin) */\n    iframeScriptOrigin?: string;\n\n    /** The URL for the page containing the code handling the silent renew */\n    silent_redirect_uri?: string;\n    /** Number of seconds to wait for the silent renew to return before assuming it has failed or timed out (default: 10) */\n    silentRequestTimeoutInSeconds?: number;\n    /** Flag to indicate if there should be an automatic attempt to renew the access token prior to its expiration. The automatic renew attempt starts 1 minute before the access token expires (default: true) */\n    automaticSilentRenew?: boolean;\n    /** Flag to validate user.profile.sub in silent renew calls (default: true) */\n    validateSubOnSilentRenew?: boolean;\n    /** Flag to control if id_token is included as id_token_hint in silent renew calls (default: false) */\n    includeIdTokenInSilentRenew?: boolean;\n\n    /** Will raise events for when user has performed a signout at the OP (default: false) */\n    monitorSession?: boolean;\n    monitorAnonymousSession?: boolean;\n    /** Interval in seconds to check the user's session (default: 2) */\n    checkSessionIntervalInSeconds?: number;\n    query_status_response_type?: string;\n    stopCheckSessionOnError?: boolean;\n\n    /**\n     * The `token_type_hint`s to pass to the authority server by default (default: [\"access_token\", \"refresh_token\"])\n     *\n     * Token types will be revoked in the same order as they are given here.\n     */\n    revokeTokenTypes?: (\"access_token\" | \"refresh_token\")[];\n    /** Will invoke the revocation endpoint on signout if there is an access token for the user (default: false) */\n    revokeTokensOnSignout?: boolean;\n    /** Flag to control if id_token is included as id_token_hint in silent signout calls (default: false) */\n    includeIdTokenInSilentSignout?: boolean;\n\n    /** The number of seconds before an access token is to expire to raise the accessTokenExpiring event (default: 60) */\n    accessTokenExpiringNotificationTimeInSeconds?: number;\n\n    /**\n     * Storage object used to persist User for currently authenticated user (default: window.sessionStorage, InMemoryWebStorage iff no window).\n     *  E.g. `userStore: new WebStorageStateStore({ store: window.localStorage })`\n     */\n    userStore?: WebStorageStateStore;\n}\n\n/**\n * The settings with defaults applied of the {@link UserManager}.\n * @see {@link UserManagerSettings}\n *\n * @public\n */\nexport class UserManagerSettingsStore extends OidcClientSettingsStore {\n    public readonly popup_redirect_uri: string;\n    public readonly popup_post_logout_redirect_uri: string | undefined;\n    public readonly popupWindowFeatures: PopupWindowFeatures;\n    public readonly popupWindowTarget: string;\n    public readonly redirectMethod: \"replace\" | \"assign\";\n    public readonly redirectTarget: \"top\" | \"self\";\n\n    public readonly iframeNotifyParentOrigin: string | undefined;\n    public readonly iframeScriptOrigin: string | undefined;\n\n    public readonly silent_redirect_uri: string;\n    public readonly silentRequestTimeoutInSeconds: number;\n    public readonly automaticSilentRenew: boolean;\n    public readonly validateSubOnSilentRenew: boolean;\n    public readonly includeIdTokenInSilentRenew: boolean;\n\n    public readonly monitorSession: boolean;\n    public readonly monitorAnonymousSession: boolean;\n    public readonly checkSessionIntervalInSeconds: number;\n    public readonly query_status_response_type: string;\n    public readonly stopCheckSessionOnError: boolean;\n\n    public readonly revokeTokenTypes: (\"access_token\" | \"refresh_token\")[];\n    public readonly revokeTokensOnSignout: boolean;\n    public readonly includeIdTokenInSilentSignout: boolean;\n\n    public readonly accessTokenExpiringNotificationTimeInSeconds: number;\n\n    public readonly userStore: WebStorageStateStore;\n\n    public constructor(args: UserManagerSettings) {\n        const {\n            popup_redirect_uri = args.redirect_uri,\n            popup_post_logout_redirect_uri = args.post_logout_redirect_uri,\n            popupWindowFeatures = DefaultPopupWindowFeatures,\n            popupWindowTarget = DefaultPopupTarget,\n            redirectMethod = \"assign\",\n            redirectTarget = \"self\",\n\n            iframeNotifyParentOrigin = args.iframeNotifyParentOrigin,\n            iframeScriptOrigin = args.iframeScriptOrigin,\n\n            requestTimeoutInSeconds,\n            silent_redirect_uri = args.redirect_uri,\n            silentRequestTimeoutInSeconds,\n            automaticSilentRenew = true,\n            validateSubOnSilentRenew = true,\n            includeIdTokenInSilentRenew = false,\n\n            monitorSession = false,\n            monitorAnonymousSession = false,\n            checkSessionIntervalInSeconds = DefaultCheckSessionIntervalInSeconds,\n            query_status_response_type = \"code\",\n            stopCheckSessionOnError = true,\n\n            revokeTokenTypes = [\"access_token\", \"refresh_token\"],\n            revokeTokensOnSignout = false,\n            includeIdTokenInSilentSignout = false,\n\n            accessTokenExpiringNotificationTimeInSeconds = DefaultAccessTokenExpiringNotificationTimeInSeconds,\n\n            userStore,\n        } = args;\n\n        super(args);\n\n        this.popup_redirect_uri = popup_redirect_uri;\n        this.popup_post_logout_redirect_uri = popup_post_logout_redirect_uri;\n        this.popupWindowFeatures = popupWindowFeatures;\n        this.popupWindowTarget = popupWindowTarget;\n        this.redirectMethod = redirectMethod;\n        this.redirectTarget = redirectTarget;\n\n        this.iframeNotifyParentOrigin = iframeNotifyParentOrigin;\n        this.iframeScriptOrigin = iframeScriptOrigin;\n\n        this.silent_redirect_uri = silent_redirect_uri;\n        this.silentRequestTimeoutInSeconds = silentRequestTimeoutInSeconds || requestTimeoutInSeconds || DefaultSilentRequestTimeoutInSeconds;\n        this.automaticSilentRenew = automaticSilentRenew;\n        this.validateSubOnSilentRenew = validateSubOnSilentRenew;\n        this.includeIdTokenInSilentRenew = includeIdTokenInSilentRenew;\n\n        this.monitorSession = monitorSession;\n        this.monitorAnonymousSession = monitorAnonymousSession;\n        this.checkSessionIntervalInSeconds = checkSessionIntervalInSeconds;\n        this.stopCheckSessionOnError = stopCheckSessionOnError;\n        this.query_status_response_type = query_status_response_type;\n\n        this.revokeTokenTypes = revokeTokenTypes;\n        this.revokeTokensOnSignout = revokeTokensOnSignout;\n        this.includeIdTokenInSilentSignout = includeIdTokenInSilentSignout;\n\n        this.accessTokenExpiringNotificationTimeInSeconds = accessTokenExpiringNotificationTimeInSeconds;\n\n        if (userStore) {\n            this.userStore = userStore;\n        }\n        else {\n            const store = typeof window !== \"undefined\" ? window.sessionStorage : new InMemoryWebStorage();\n            this.userStore = new WebStorageStateStore({ store });\n        }\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"../utils\";\nimport { ErrorTimeout } from \"../errors\";\nimport type { NavigateParams, NavigateResponse } from \"./IWindow\";\nimport { AbstractChildWindow } from \"./AbstractChildWindow\";\nimport { DefaultSilentRequestTimeoutInSeconds } from \"../UserManagerSettings\";\n\n/**\n * @public\n */\nexport interface IFrameWindowParams {\n    silentRequestTimeoutInSeconds?: number;\n}\n\n/**\n * @internal\n */\nexport class IFrameWindow extends AbstractChildWindow {\n    protected readonly _logger = new Logger(\"IFrameWindow\");\n    private _frame: HTMLIFrameElement | null;\n    private _timeoutInSeconds: number;\n\n    public constructor({\n        silentRequestTimeoutInSeconds = DefaultSilentRequestTimeoutInSeconds,\n    }: IFrameWindowParams) {\n        super();\n        this._timeoutInSeconds = silentRequestTimeoutInSeconds;\n\n        this._frame = IFrameWindow.createHiddenIframe();\n        this._window = this._frame.contentWindow;\n    }\n\n    private static createHiddenIframe(): HTMLIFrameElement {\n        const iframe = window.document.createElement(\"iframe\");\n\n        // shotgun approach\n        iframe.style.visibility = \"hidden\";\n        iframe.style.position = \"fixed\";\n        iframe.style.left = \"-1000px\";\n        iframe.style.top = \"0\";\n        iframe.width = \"0\";\n        iframe.height = \"0\";\n\n        window.document.body.appendChild(iframe);\n        return iframe;\n    }\n\n    public async navigate(params: NavigateParams): Promise<NavigateResponse> {\n        this._logger.debug(\"navigate: Using timeout of:\", this._timeoutInSeconds);\n        const timer = setTimeout(() => void this._abort.raise(new ErrorTimeout(\"IFrame timed out without a response\")), this._timeoutInSeconds * 1000);\n        this._disposeHandlers.add(() => clearTimeout(timer));\n\n        return await super.navigate(params);\n    }\n\n    public close(): void {\n        if (this._frame) {\n            if (this._frame.parentNode) {\n                this._frame.addEventListener(\"load\", (ev) => {\n                    const frame = ev.target as HTMLIFrameElement;\n                    frame.parentNode?.removeChild(frame);\n                    void this._abort.raise(new Error(\"IFrame removed from DOM\"));\n                }, true);\n                this._frame.contentWindow?.location.replace(\"about:blank\");\n            }\n            this._frame = null;\n        }\n        this._window = null;\n    }\n\n    public static notifyParent(url: string, targetOrigin?: string): void {\n        return super._notifyParent(window.parent, url, false, targetOrigin);\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"../utils\";\nimport type { UserManagerSettingsStore } from \"../UserManagerSettings\";\nimport { IFrameWindow, type IFrameWindowParams } from \"./IFrameWindow\";\nimport type { INavigator } from \"./INavigator\";\n\n/**\n * @internal\n */\nexport class IFrameNavigator implements INavigator {\n    private readonly _logger = new Logger(\"IFrameNavigator\");\n\n    constructor(private _settings: UserManagerSettingsStore) {}\n\n    public async prepare({\n        silentRequestTimeoutInSeconds = this._settings.silentRequestTimeoutInSeconds,\n    }: IFrameWindowParams): Promise<IFrameWindow> {\n        return new IFrameWindow({ silentRequestTimeoutInSeconds });\n    }\n\n    public async callback(url: string): Promise<void> {\n        this._logger.create(\"callback\");\n        IFrameWindow.notifyParent(url, this._settings.iframeNotifyParentOrigin);\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, PopupUtils, type PopupWindowFeatures } from \"../utils\";\nimport { DefaultPopupWindowFeatures, DefaultPopupTarget } from \"../UserManagerSettings\";\nimport { AbstractChildWindow } from \"./AbstractChildWindow\";\nimport type { NavigateParams, NavigateResponse } from \"./IWindow\";\n\nconst checkForPopupClosedInterval = 500;\nconst second = 1000;\n\n/**\n * @public\n */\nexport interface PopupWindowParams {\n    popupWindowFeatures?: PopupWindowFeatures;\n    popupWindowTarget?: string;\n    /** An AbortSignal to set request's signal. */\n    popupSignal?: AbortSignal | null;\n}\n\n/**\n * @internal\n */\nexport class PopupWindow extends AbstractChildWindow {\n    protected readonly _logger = new Logger(\"PopupWindow\");\n\n    protected _window: WindowProxy | null;\n\n    public constructor({\n        popupWindowTarget = DefaultPopupTarget,\n        popupWindowFeatures = {},\n        popupSignal,\n    }: PopupWindowParams) {\n        super();\n        const centeredPopup = PopupUtils.center({ ...DefaultPopupWindowFeatures, ...popupWindowFeatures });\n        this._window = window.open(undefined, popupWindowTarget, PopupUtils.serialize(centeredPopup));\n\n        if (popupSignal) {\n            popupSignal.addEventListener(\"abort\", () => {\n                void this._abort.raise(new Error(popupSignal.reason ?? \"Popup aborted\"));\n            });\n        }\n\n        if (popupWindowFeatures.closePopupWindowAfterInSeconds && popupWindowFeatures.closePopupWindowAfterInSeconds > 0) {\n            setTimeout(() => {\n                if (!this._window || typeof this._window.closed !== \"boolean\" || this._window.closed) {\n                    void this._abort.raise(new Error(\"Popup blocked by user\"));\n                    return;\n                }\n\n                this.close();\n            }, popupWindowFeatures.closePopupWindowAfterInSeconds * second);\n        }\n    }\n\n    public async navigate(params: NavigateParams): Promise<NavigateResponse> {\n        this._window?.focus();\n\n        const popupClosedInterval = setInterval(() => {\n            if (!this._window || this._window.closed) {\n                void this._abort.raise(new Error(\"Popup closed by user\"));\n            }\n        }, checkForPopupClosedInterval);\n        this._disposeHandlers.add(() => clearInterval(popupClosedInterval));\n\n        return await super.navigate(params);\n    }\n\n    public close(): void {\n        if (this._window) {\n            if (!this._window.closed) {\n                this._window.close();\n                void this._abort.raise(new Error(\"Popup closed\"));\n            }\n        }\n        this._window = null;\n    }\n\n    public static notifyOpener(url: string, keepOpen: boolean): void {\n        if (!window.opener) {\n            throw new Error(\"No window.opener. Can't complete notification.\");\n        }\n        return super._notifyParent(window.opener, url, keepOpen);\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"../utils\";\nimport { PopupWindow, type PopupWindowParams } from \"./PopupWindow\";\nimport type { INavigator } from \"./INavigator\";\nimport type { UserManagerSettingsStore } from \"../UserManagerSettings\";\n\n/**\n * @internal\n */\nexport class PopupNavigator implements INavigator {\n    private readonly _logger = new Logger(\"PopupNavigator\");\n\n    constructor(private _settings: UserManagerSettingsStore) { }\n\n    public async prepare({\n        popupWindowFeatures = this._settings.popupWindowFeatures,\n        popupWindowTarget = this._settings.popupWindowTarget,\n        popupSignal,\n    }: PopupWindowParams): Promise<PopupWindow> {\n        return new PopupWindow({ popupWindowFeatures, popupWindowTarget, popupSignal });\n    }\n\n    public async callback(url: string, { keepOpen = false }): Promise<void> {\n        this._logger.create(\"callback\");\n\n        PopupWindow.notifyOpener(url, keepOpen);\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"../utils\";\nimport type { UserManagerSettingsStore } from \"../UserManagerSettings\";\nimport type { INavigator } from \"./INavigator\";\nimport type { IWindow } from \"./IWindow\";\n\n/**\n * @public\n */\nexport interface RedirectParams {\n    redirectMethod?: \"replace\" | \"assign\";\n    redirectTarget?: \"top\" | \"self\";\n}\n\n/**\n * @internal\n */\nexport class RedirectNavigator implements INavigator {\n    private readonly _logger = new Logger(\"RedirectNavigator\");\n\n    constructor(private _settings: UserManagerSettingsStore) {}\n\n    public async prepare({\n        redirectMethod = this._settings.redirectMethod,\n        redirectTarget = this._settings.redirectTarget,\n    }: RedirectParams): Promise<IWindow> {\n        this._logger.create(\"prepare\");\n        let targetWindow = window.self as Window;\n\n        if (redirectTarget === \"top\") {\n            targetWindow = window.top ?? window.self;\n        }\n    \n        const redirect = targetWindow.location[redirectMethod].bind(targetWindow.location) as (url: string) => never;\n        let abort: (reason: Error) => void;\n        return {\n            navigate: async (params): Promise<never> => {\n                this._logger.create(\"navigate\");\n                // We use a promise that never resolves to block the caller\n                const promise = new Promise((resolve, reject) => {\n                    abort = reject;\n                });\n                redirect(params.url);\n                return await (promise as Promise<never>);\n            },\n            close: () => {\n                this._logger.create(\"close\");\n                abort?.(new Error(\"Redirect aborted\"));\n                targetWindow.stop();\n            },\n        };\n    }\n\n    public async callback(): Promise<void> {\n        return;\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, Event } from \"./utils\";\nimport { AccessTokenEvents } from \"./AccessTokenEvents\";\nimport type { UserManagerSettingsStore } from \"./UserManagerSettings\";\nimport type { User } from \"./User\";\n\n/**\n * @public\n */\nexport type UserLoadedCallback = (user: User) => Promise<void> | void;\n/**\n * @public\n */\nexport type UserUnloadedCallback = () => Promise<void> | void;\n/**\n * @public\n */\nexport type SilentRenewErrorCallback = (error: Error) => Promise<void> | void;\n/**\n * @public\n */\nexport type UserSignedInCallback = () => Promise<void> | void;\n/**\n * @public\n */\nexport type UserSignedOutCallback = () => Promise<void> | void;\n/**\n * @public\n */\nexport type UserSessionChangedCallback = () => Promise<void> | void;\n\n/**\n * @public\n */\nexport class UserManagerEvents extends AccessTokenEvents {\n    protected readonly _logger = new Logger(\"UserManagerEvents\");\n\n    private readonly _userLoaded = new Event<[User]>(\"User loaded\");\n    private readonly _userUnloaded = new Event<[]>(\"User unloaded\");\n    private readonly _silentRenewError = new Event<[Error]>(\"Silent renew error\");\n    private readonly _userSignedIn = new Event<[]>(\"User signed in\");\n    private readonly _userSignedOut = new Event<[]>(\"User signed out\");\n    private readonly _userSessionChanged = new Event<[]>(\"User session changed\");\n\n    public constructor(settings: UserManagerSettingsStore) {\n        super({ expiringNotificationTimeInSeconds: settings.accessTokenExpiringNotificationTimeInSeconds });\n    }\n\n    public async load(user: User, raiseEvent=true): Promise<void> {\n        super.load(user);\n        if (raiseEvent) {\n            await this._userLoaded.raise(user);\n        }\n    }\n    public async unload(): Promise<void> {\n        super.unload();\n        await this._userUnloaded.raise();\n    }\n\n    /**\n     * Add callback: Raised when a user session has been established (or re-established).\n     */\n    public addUserLoaded(cb: UserLoadedCallback): () => void {\n        return this._userLoaded.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised when a user session has been established (or re-established).\n     */\n    public removeUserLoaded(cb: UserLoadedCallback): void {\n        return this._userLoaded.removeHandler(cb);\n    }\n\n    /**\n     * Add callback: Raised when a user session has been terminated.\n     */\n    public addUserUnloaded(cb: UserUnloadedCallback): () => void {\n        return this._userUnloaded.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised when a user session has been terminated.\n     */\n    public removeUserUnloaded(cb: UserUnloadedCallback): void {\n        return this._userUnloaded.removeHandler(cb);\n    }\n\n    /**\n     * Add callback: Raised when the automatic silent renew has failed.\n     */\n    public addSilentRenewError(cb: SilentRenewErrorCallback): () => void {\n        return this._silentRenewError.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised when the automatic silent renew has failed.\n     */\n    public removeSilentRenewError(cb: SilentRenewErrorCallback): void {\n        return this._silentRenewError.removeHandler(cb);\n    }\n    /**\n     * @internal\n     */\n    public async _raiseSilentRenewError(e: Error): Promise<void> {\n        await this._silentRenewError.raise(e);\n    }\n\n    /**\n     * Add callback: Raised when the user is signed in (when `monitorSession` is set).\n     * @see {@link UserManagerSettings.monitorSession}\n     */\n    public addUserSignedIn(cb: UserSignedInCallback): () => void {\n        return this._userSignedIn.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised when the user is signed in (when `monitorSession` is set).\n     */\n    public removeUserSignedIn(cb: UserSignedInCallback): void {\n        this._userSignedIn.removeHandler(cb);\n    }\n    /**\n     * @internal\n     */\n    public async _raiseUserSignedIn(): Promise<void> {\n        await this._userSignedIn.raise();\n    }\n\n    /**\n     * Add callback: Raised when the user's sign-in status at the OP has changed (when `monitorSession` is set).\n     * @see {@link UserManagerSettings.monitorSession}\n     */\n    public addUserSignedOut(cb: UserSignedOutCallback): () => void {\n        return this._userSignedOut.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised when the user's sign-in status at the OP has changed (when `monitorSession` is set).\n     */\n    public removeUserSignedOut(cb: UserSignedOutCallback): void {\n        this._userSignedOut.removeHandler(cb);\n    }\n    /**\n     * @internal\n     */\n    public async _raiseUserSignedOut(): Promise<void> {\n        await this._userSignedOut.raise();\n    }\n\n    /**\n     * Add callback: Raised when the user session changed (when `monitorSession` is set).\n     * @see {@link UserManagerSettings.monitorSession}\n     */\n    public addUserSessionChanged(cb: UserSessionChangedCallback): () => void {\n        return this._userSessionChanged.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised when the user session changed (when `monitorSession` is set).\n     */\n    public removeUserSessionChanged(cb: UserSessionChangedCallback): void {\n        this._userSessionChanged.removeHandler(cb);\n    }\n    /**\n     * @internal\n     */\n    public async _raiseUserSessionChanged(): Promise<void> {\n        await this._userSessionChanged.raise();\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, Timer } from \"./utils\";\nimport { ErrorTimeout } from \"./errors\";\nimport type { UserManager } from \"./UserManager\";\nimport type { AccessTokenCallback } from \"./AccessTokenEvents\";\n\n/**\n * @internal\n */\nexport class SilentRenewService {\n    protected _logger = new Logger(\"SilentRenewService\");\n    private _isStarted = false;\n    private readonly _retryTimer = new Timer(\"Retry Silent Renew\");\n\n    public constructor(private _userManager: UserManager) {}\n\n    public async start(): Promise<void> {\n        const logger = this._logger.create(\"start\");\n        if (!this._isStarted) {\n            this._isStarted = true;\n            this._userManager.events.addAccessTokenExpiring(this._tokenExpiring);\n            this._retryTimer.addHandler(this._tokenExpiring);\n\n            // this will trigger loading of the user so the expiring events can be initialized\n            try {\n                await this._userManager.getUser();\n                // deliberate nop\n            }\n            catch (err) {\n                // catch to suppress errors since we're in a ctor\n                logger.error(\"getUser error\", err);\n            }\n        }\n    }\n\n    public stop(): void {\n        if (this._isStarted) {\n            this._retryTimer.cancel();\n            this._retryTimer.removeHandler(this._tokenExpiring);\n            this._userManager.events.removeAccessTokenExpiring(this._tokenExpiring);\n            this._isStarted = false;\n        }\n    }\n\n    protected _tokenExpiring: AccessTokenCallback = async () => {\n        const logger = this._logger.create(\"_tokenExpiring\");\n        try {\n            await this._userManager.signinSilent();\n            logger.debug(\"silent token renewal successful\");\n        }\n        catch (err) {\n            if (err instanceof ErrorTimeout) {\n                // no response from authority server, e.g. IFrame timeout, ...\n                logger.warn(\"ErrorTimeout from signinSilent:\", err, \"retry in 5s\");\n                this._retryTimer.init(5);\n                return;\n            }\n\n            logger.error(\"Error from signinSilent:\", err);\n            await this._userManager.events._raiseSilentRenewError(err as Error);\n        }\n    };\n}\n", "// Copyright (C) AuthTS Contributors\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport type { UserProfile } from \"./User\";\n\n/**\n * Fake state store implementation necessary for validating refresh token requests.\n *\n * @public\n */\nexport class RefreshState {\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\n    public readonly data?: unknown;\n\n    public readonly refresh_token: string;\n    public readonly id_token?: string;\n    public readonly session_state: string | null;\n    public readonly scope?: string;\n    public readonly profile: UserProfile;\n\n    constructor(args: {\n        refresh_token: string;\n        id_token?: string;\n        session_state: string | null;\n        scope?: string;\n        profile: UserProfile;\n\n        state?: unknown;\n    }) {\n        this.refresh_token = args.refresh_token;\n        this.id_token = args.id_token;\n        this.session_state = args.session_state;\n        this.scope = args.scope;\n        this.profile = args.profile;\n\n        this.data = args.state;\n\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { CryptoUtils, Logger } from \"./utils\";\nimport { ErrorResponse } from \"./errors\";\nimport { type NavigateResponse, type PopupWindowParams, type IWindow, type IFrameWindowParams, type RedirectParams, RedirectNavigator, PopupNavigator, IFrameNavigator, type INavigator } from \"./navigators\";\nimport { OidcClient, type CreateSigninRequestArgs, type CreateSignoutRequestArgs, type ProcessResourceOwnerPasswordCredentialsArgs, type UseRefreshTokenArgs } from \"./OidcClient\";\nimport { type UserManagerSettings, UserManagerSettingsStore } from \"./UserManagerSettings\";\nimport { User } from \"./User\";\nimport { UserManagerEvents } from \"./UserManagerEvents\";\nimport { SilentRenewService } from \"./SilentRenewService\";\nimport { SessionMonitor } from \"./SessionMonitor\";\nimport type { SessionStatus } from \"./SessionStatus\";\nimport type { SignoutResponse } from \"./SignoutResponse\";\nimport type { MetadataService } from \"./MetadataService\";\nimport { RefreshState } from \"./RefreshState\";\nimport type { SigninResponse } from \"./SigninResponse\";\nimport type { ExtraHeader, DPoPSettings } from \"./OidcClientSettings\";\nimport { DPoPState } from \"./DPoPStore\";\n\n/**\n * @public\n */\nexport type ExtraSigninRequestArgs = Pick<CreateSigninRequestArgs, \"nonce\" | \"extraQueryParams\" | \"extraTokenParams\" | \"state\" | \"redirect_uri\" | \"prompt\" | \"acr_values\" | \"login_hint\" | \"scope\" | \"max_age\" | \"ui_locales\" | \"resource\" | \"url_state\">;\n/**\n * @public\n */\nexport type ExtraSignoutRequestArgs = Pick<CreateSignoutRequestArgs, \"extraQueryParams\" | \"state\" | \"id_token_hint\" | \"post_logout_redirect_uri\">;\n\n/**\n * @public\n */\nexport type RevokeTokensTypes = UserManagerSettings[\"revokeTokenTypes\"];\n\n/**\n * @public\n */\nexport type SigninRedirectArgs = RedirectParams & ExtraSigninRequestArgs;\n\n/**\n * @public\n */\nexport type SigninPopupArgs = PopupWindowParams & ExtraSigninRequestArgs;\n\n/**\n * @public\n */\nexport type SigninSilentArgs = IFrameWindowParams & ExtraSigninRequestArgs;\n\n/**\n * @public\n */\nexport type SigninResourceOwnerCredentialsArgs = ProcessResourceOwnerPasswordCredentialsArgs;\n\n/**\n * @public\n */\nexport type QuerySessionStatusArgs = IFrameWindowParams & ExtraSigninRequestArgs;\n\n/**\n * @public\n */\nexport type SignoutRedirectArgs = RedirectParams & ExtraSignoutRequestArgs;\n\n/**\n * @public\n */\nexport type SignoutPopupArgs = PopupWindowParams & ExtraSignoutRequestArgs;\n\n/**\n * @public\n */\nexport type SignoutSilentArgs = IFrameWindowParams & ExtraSignoutRequestArgs;\n\n/**\n * Provides a higher level API for signing a user in, signing out, managing the user's claims returned from the identity provider,\n * and managing an access token returned from the identity provider (OAuth2/OIDC).\n *\n * @public\n */\nexport class UserManager {\n    /** Get the settings used to configure the `UserManager`. */\n    public readonly settings: UserManagerSettingsStore;\n    protected readonly _logger = new Logger(\"UserManager\");\n\n    protected readonly _client: OidcClient;\n    protected readonly _redirectNavigator: INavigator;\n    protected readonly _popupNavigator: INavigator;\n    protected readonly _iframeNavigator: INavigator;\n    protected readonly _events: UserManagerEvents;\n    protected readonly _silentRenewService: SilentRenewService;\n    protected readonly _sessionMonitor: SessionMonitor | null;\n\n    public constructor(settings: UserManagerSettings, redirectNavigator?: INavigator, popupNavigator?: INavigator, iframeNavigator?: INavigator) {\n        this.settings = new UserManagerSettingsStore(settings);\n\n        this._client = new OidcClient(settings);\n\n        this._redirectNavigator = redirectNavigator ?? new RedirectNavigator(this.settings);\n        this._popupNavigator = popupNavigator ?? new PopupNavigator(this.settings);\n        this._iframeNavigator = iframeNavigator ?? new IFrameNavigator(this.settings);\n\n        this._events = new UserManagerEvents(this.settings);\n        this._silentRenewService = new SilentRenewService(this);\n\n        // order is important for the following properties; these services depend upon the events.\n        if (this.settings.automaticSilentRenew) {\n            this.startSilentRenew();\n        }\n\n        this._sessionMonitor = null;\n        if (this.settings.monitorSession) {\n            this._sessionMonitor = new SessionMonitor(this);\n        }\n    }\n\n    /**\n     * Get object used to register for events raised by the `UserManager`.\n     */\n    public get events(): UserManagerEvents {\n        return this._events;\n    }\n\n    /**\n     * Get object used to access the metadata configuration of the identity provider.\n     */\n    public get metadataService(): MetadataService {\n        return this._client.metadataService;\n    }\n\n    /**\n     * Load the `User` object for the currently authenticated user.\n     *\n     * @returns A promise\n     */\n    public async getUser(): Promise<User | null> {\n        const logger = this._logger.create(\"getUser\");\n        const user = await this._loadUser();\n        if (user) {\n            logger.info(\"user loaded\");\n            await this._events.load(user, false);\n            return user;\n        }\n\n        logger.info(\"user not found in storage\");\n        return null;\n    }\n\n    /**\n     * Remove from any storage the currently authenticated user.\n     *\n     * @returns A promise\n     */\n    public async removeUser(): Promise<void> {\n        const logger = this._logger.create(\"removeUser\");\n        await this.storeUser(null);\n        logger.info(\"user removed from storage\");\n        await this._events.unload();\n    }\n\n    /**\n     * Trigger a redirect of the current window to the authorization endpoint.\n     *\n     * @returns A promise\n     *\n     * @throws `Error` In cases of wrong authentication.\n     */\n    public async signinRedirect(args: SigninRedirectArgs = {}): Promise<void> {\n        this._logger.create(\"signinRedirect\");\n        const {\n            redirectMethod,\n            ...requestArgs\n        } = args;\n\n        let dpopJkt: string | undefined;\n        if (this.settings.dpop?.bind_authorization_code) {\n            dpopJkt = await this.generateDPoPJkt(this.settings.dpop);\n        }\n\n        const handle = await this._redirectNavigator.prepare({ redirectMethod });\n        await this._signinStart({\n            request_type: \"si:r\",\n            dpopJkt,\n            ...requestArgs,\n        }, handle);\n    }\n\n    /**\n     * Process the response (callback) from the authorization endpoint.\n     * It is recommended to use {@link UserManager.signinCallback} instead.\n     *\n     * @returns A promise containing the authenticated `User`.\n     *\n     * @see {@link UserManager.signinCallback}\n     */\n    public async signinRedirectCallback(url = window.location.href): Promise<User> {\n        const logger = this._logger.create(\"signinRedirectCallback\");\n        const user = await this._signinEnd(url);\n        if (user.profile && user.profile.sub) {\n            logger.info(\"success, signed in subject\", user.profile.sub);\n        }\n        else {\n            logger.info(\"no subject\");\n        }\n\n        return user;\n    }\n\n    /**\n     * Trigger the signin with user/password.\n     *\n     * @returns A promise containing the authenticated `User`.\n     * @throws {@link ErrorResponse} In cases of wrong authentication.\n     */\n    public async signinResourceOwnerCredentials({\n        username,\n        password,\n        skipUserInfo = false,\n    }: SigninResourceOwnerCredentialsArgs): Promise<User> {\n        const logger = this._logger.create(\"signinResourceOwnerCredential\");\n\n        const signinResponse = await this._client.processResourceOwnerPasswordCredentials({\n            username,\n            password,\n            skipUserInfo,\n            extraTokenParams: this.settings.extraTokenParams,\n        });\n        logger.debug(\"got signin response\");\n\n        const user = await this._buildUser(signinResponse);\n        if (user.profile && user.profile.sub) {\n            logger.info(\"success, signed in subject\", user.profile.sub);\n        } else {\n            logger.info(\"no subject\");\n        }\n        return user;\n    }\n\n    /**\n     * Trigger a request (via a popup window) to the authorization endpoint.\n     *\n     * @returns A promise containing the authenticated `User`.\n     * @throws `Error` In cases of wrong authentication.\n     */\n    public async signinPopup(args: SigninPopupArgs = {}): Promise<User> {\n        const logger = this._logger.create(\"signinPopup\");\n\n        let dpopJkt: string | undefined;\n        if (this.settings.dpop?.bind_authorization_code) {\n            dpopJkt = await this.generateDPoPJkt(this.settings.dpop);\n        }\n\n        const {\n            popupWindowFeatures,\n            popupWindowTarget,\n            popupSignal,\n            ...requestArgs\n        } = args;\n        const url = this.settings.popup_redirect_uri;\n        if (!url) {\n            logger.throw(new Error(\"No popup_redirect_uri configured\"));\n        }\n\n        const handle = await this._popupNavigator.prepare({ popupWindowFeatures, popupWindowTarget, popupSignal });\n        const user = await this._signin({\n            request_type: \"si:p\",\n            redirect_uri: url,\n            display: \"popup\",\n            dpopJkt,\n            ...requestArgs,\n        }, handle);\n        if (user) {\n            if (user.profile && user.profile.sub) {\n                logger.info(\"success, signed in subject\", user.profile.sub);\n            } else {\n                logger.info(\"no subject\");\n            }\n        }\n\n        return user;\n    }\n\n    /**\n     * Notify the opening window of response (callback) from the authorization endpoint.\n     * It is recommended to use {@link UserManager.signinCallback} instead.\n     *\n     * @returns A promise\n     *\n     * @see {@link UserManager.signinCallback}\n     */\n    public async signinPopupCallback(url = window.location.href, keepOpen = false): Promise<void> {\n        const logger = this._logger.create(\"signinPopupCallback\");\n        await this._popupNavigator.callback(url, { keepOpen });\n        logger.info(\"success\");\n    }\n\n    /**\n     * Trigger a silent request (via refresh token or an iframe) to the authorization endpoint.\n     *\n     * @returns A promise that contains the authenticated `User`.\n     */\n    public async signinSilent(args: SigninSilentArgs = {}): Promise<User | null> {\n        const logger = this._logger.create(\"signinSilent\");\n        const {\n            silentRequestTimeoutInSeconds,\n            ...requestArgs\n        } = args;\n        // first determine if we have a refresh token, or need to use iframe\n        let user = await this._loadUser();\n        if (user?.refresh_token) {\n            logger.debug(\"using refresh token\");\n            const state = new RefreshState(user as Required<User>);\n            return await this._useRefreshToken({\n                state,\n                redirect_uri: requestArgs.redirect_uri,\n                resource: requestArgs.resource,\n                extraTokenParams: requestArgs.extraTokenParams,\n                timeoutInSeconds: silentRequestTimeoutInSeconds,\n            });\n        }\n\n        let dpopJkt: string | undefined;\n        if (this.settings.dpop?.bind_authorization_code) {\n            dpopJkt = await this.generateDPoPJkt(this.settings.dpop);\n        }\n\n        const url = this.settings.silent_redirect_uri;\n        if (!url) {\n            logger.throw(new Error(\"No silent_redirect_uri configured\"));\n        }\n\n        let verifySub: string | undefined;\n        if (user && this.settings.validateSubOnSilentRenew) {\n            logger.debug(\"subject prior to silent renew:\", user.profile.sub);\n            verifySub = user.profile.sub;\n        }\n\n        const handle = await this._iframeNavigator.prepare({ silentRequestTimeoutInSeconds });\n        user = await this._signin({\n            request_type: \"si:s\",\n            redirect_uri: url,\n            prompt: \"none\",\n            id_token_hint: this.settings.includeIdTokenInSilentRenew ? user?.id_token : undefined,\n            dpopJkt,\n            ...requestArgs,\n        }, handle, verifySub);\n        if (user) {\n            if (user.profile?.sub) {\n                logger.info(\"success, signed in subject\", user.profile.sub);\n            }\n            else {\n                logger.info(\"no subject\");\n            }\n        }\n\n        return user;\n    }\n\n    protected async _useRefreshToken(args: UseRefreshTokenArgs): Promise<User> {\n        const response = await this._client.useRefreshToken({\n            timeoutInSeconds: this.settings.silentRequestTimeoutInSeconds,\n            ...args,\n        });\n        const user = new User({ ...args.state, ...response });\n\n        await this.storeUser(user);\n        await this._events.load(user);\n        return user;\n    }\n\n    /**\n     *\n     * Notify the parent window of response (callback) from the authorization endpoint.\n     * It is recommended to use {@link UserManager.signinCallback} instead.\n     *\n     * @returns A promise\n     *\n     * @see {@link UserManager.signinCallback}\n     */\n    public async signinSilentCallback(url = window.location.href): Promise<void> {\n        const logger = this._logger.create(\"signinSilentCallback\");\n        await this._iframeNavigator.callback(url);\n        logger.info(\"success\");\n    }\n\n    /**\n     * Process any response (callback) from the authorization endpoint, by dispatching the request_type\n     * and executing one of the following functions:\n     * - {@link UserManager.signinRedirectCallback}\n     * - {@link UserManager.signinPopupCallback}\n     * - {@link UserManager.signinSilentCallback}\n     *\n     * @throws `Error` If request_type is unknown or signin cannot be processed.\n     */\n    public async signinCallback(url = window.location.href): Promise<User | undefined> {\n        const { state } = await this._client.readSigninResponseState(url);\n        switch (state.request_type) {\n            case \"si:r\":\n                return await this.signinRedirectCallback(url);\n            case \"si:p\":\n                await this.signinPopupCallback(url);\n                break;\n            case \"si:s\":\n                await this.signinSilentCallback(url);\n                break;\n            default:\n                throw new Error(\"invalid response_type in state\");\n        }\n        return undefined;\n    }\n\n    /**\n     * Process any response (callback) from the end session endpoint, by dispatching the request_type\n     * and executing one of the following functions:\n     * - {@link UserManager.signoutRedirectCallback}\n     * - {@link UserManager.signoutPopupCallback}\n     * - {@link UserManager.signoutSilentCallback}\n     *\n     * @throws `Error` If request_type is unknown or signout cannot be processed.\n     */\n    public async signoutCallback(url = window.location.href, keepOpen = false): Promise<SignoutResponse | undefined> {\n        const { state } = await this._client.readSignoutResponseState(url);\n        if (!state) {\n            return undefined;\n        }\n\n        switch (state.request_type) {\n            case \"so:r\":\n                return await this.signoutRedirectCallback(url);\n            case \"so:p\":\n                await this.signoutPopupCallback(url, keepOpen);\n                break;\n            case \"so:s\":\n                await this.signoutSilentCallback(url);\n                break;\n            default:\n                throw new Error(\"invalid response_type in state\");\n        }\n        return undefined;\n    }\n\n    /**\n     * Query OP for user's current signin status.\n     *\n     * @returns A promise object with session_state and subject identifier.\n     */\n    public async querySessionStatus(args: QuerySessionStatusArgs = {}): Promise<SessionStatus | null> {\n        const logger = this._logger.create(\"querySessionStatus\");\n        const {\n            silentRequestTimeoutInSeconds,\n            ...requestArgs\n        } = args;\n        const url = this.settings.silent_redirect_uri;\n        if (!url) {\n            logger.throw(new Error(\"No silent_redirect_uri configured\"));\n        }\n\n        const user = await this._loadUser();\n        const handle = await this._iframeNavigator.prepare({ silentRequestTimeoutInSeconds });\n        const navResponse = await this._signinStart({\n            request_type: \"si:s\", // this acts like a signin silent\n            redirect_uri: url,\n            prompt: \"none\",\n            id_token_hint: this.settings.includeIdTokenInSilentRenew ? user?.id_token : undefined,\n            response_type: this.settings.query_status_response_type,\n            scope: \"openid\",\n            skipUserInfo: true,\n            ...requestArgs,\n        }, handle);\n        try {\n            const extraHeaders: Record<string, ExtraHeader> = {};\n            const signinResponse = await this._client.processSigninResponse(navResponse.url, extraHeaders);\n            logger.debug(\"got signin response\");\n\n            if (signinResponse.session_state && signinResponse.profile.sub) {\n                logger.info(\"success for subject\", signinResponse.profile.sub);\n                return {\n                    session_state: signinResponse.session_state,\n                    sub: signinResponse.profile.sub,\n                };\n            }\n\n            logger.info(\"success, user not authenticated\");\n            return null;\n        } catch (err) {\n            if (this.settings.monitorAnonymousSession && err instanceof ErrorResponse) {\n                switch (err.error) {\n                    case \"login_required\":\n                    case \"consent_required\":\n                    case \"interaction_required\":\n                    case \"account_selection_required\":\n                        logger.info(\"success for anonymous user\");\n                        return {\n                            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                            session_state: err.session_state!,\n                        };\n                }\n            }\n            throw err;\n        }\n    }\n\n    protected async _signin(args: CreateSigninRequestArgs, handle: IWindow, verifySub?: string): Promise<User> {\n        const navResponse = await this._signinStart(args, handle);\n        return await this._signinEnd(navResponse.url, verifySub);\n    }\n\n    protected async _signinStart(args: CreateSigninRequestArgs, handle: IWindow): Promise<NavigateResponse> {\n        const logger = this._logger.create(\"_signinStart\");\n\n        try {\n            const signinRequest = await this._client.createSigninRequest(args);\n            logger.debug(\"got signin request\");\n\n            return await handle.navigate({\n                url: signinRequest.url,\n                state: signinRequest.state.id,\n                response_mode: signinRequest.state.response_mode,\n                scriptOrigin: this.settings.iframeScriptOrigin,\n            });\n        } catch (err) {\n            logger.debug(\"error after preparing navigator, closing navigator window\");\n            handle.close();\n            throw err;\n        }\n    }\n\n    protected async _signinEnd(url: string, verifySub?: string): Promise<User> {\n        const logger = this._logger.create(\"_signinEnd\");\n        const extraHeaders: Record<string, ExtraHeader> = {};\n        const signinResponse = await this._client.processSigninResponse(url, extraHeaders);\n        logger.debug(\"got signin response\");\n\n        const user = await this._buildUser(signinResponse, verifySub);\n        return user;\n    }\n\n    protected async _buildUser(signinResponse: SigninResponse, verifySub?: string) {\n        const logger = this._logger.create(\"_buildUser\");\n        const user = new User(signinResponse);\n        if (verifySub) {\n            if (verifySub !== user.profile.sub) {\n                logger.debug(\"current user does not match user returned from signin. sub from signin:\", user.profile.sub);\n                throw new ErrorResponse({ ...signinResponse, error: \"login_required\" });\n            }\n            logger.debug(\"current user matches user returned from signin\");\n        }\n\n        await this.storeUser(user);\n        logger.debug(\"user stored\");\n        await this._events.load(user);\n\n        return user;\n    }\n\n    /**\n     * Trigger a redirect of the current window to the end session endpoint.\n     *\n     * @returns A promise\n     */\n    public async signoutRedirect(args: SignoutRedirectArgs = {}): Promise<void> {\n        const logger = this._logger.create(\"signoutRedirect\");\n        const {\n            redirectMethod,\n            ...requestArgs\n        } = args;\n        const handle = await this._redirectNavigator.prepare({ redirectMethod });\n        await this._signoutStart({\n            request_type: \"so:r\",\n            post_logout_redirect_uri: this.settings.post_logout_redirect_uri,\n            ...requestArgs,\n        }, handle);\n        logger.info(\"success\");\n    }\n\n    /**\n     * Process response (callback) from the end session endpoint.\n     * It is recommended to use {@link UserManager.signoutCallback} instead.\n     *\n     * @returns A promise containing signout response\n     *\n     * @see {@link UserManager.signoutCallback}\n     */\n    public async signoutRedirectCallback(url = window.location.href): Promise<SignoutResponse> {\n        const logger = this._logger.create(\"signoutRedirectCallback\");\n        const response = await this._signoutEnd(url);\n        logger.info(\"success\");\n        return response;\n    }\n\n    /**\n     * Trigger a redirect of a popup window to the end session endpoint.\n     *\n     * @returns A promise\n     */\n    public async signoutPopup(args: SignoutPopupArgs = {}): Promise<void> {\n        const logger = this._logger.create(\"signoutPopup\");\n        const {\n            popupWindowFeatures,\n            popupWindowTarget,\n            popupSignal,\n            ...requestArgs\n        } = args;\n        const url = this.settings.popup_post_logout_redirect_uri;\n\n        const handle = await this._popupNavigator.prepare({ popupWindowFeatures, popupWindowTarget, popupSignal });\n        await this._signout({\n            request_type: \"so:p\",\n            post_logout_redirect_uri: url,\n            // we're putting a dummy entry in here because we\n            // need a unique id from the state for notification\n            // to the parent window, which is necessary if we\n            // plan to return back to the client after signout\n            // and so we can close the popup after signout\n            state: url == null ? undefined : {},\n            ...requestArgs,\n        }, handle);\n        logger.info(\"success\");\n    }\n\n    /**\n     * Process response (callback) from the end session endpoint from a popup window.\n     * It is recommended to use {@link UserManager.signoutCallback} instead.\n     *\n     * @returns A promise\n     *\n     * @see {@link UserManager.signoutCallback}\n     */\n    public async signoutPopupCallback(url = window.location.href, keepOpen = false): Promise<void> {\n        const logger = this._logger.create(\"signoutPopupCallback\");\n        await this._popupNavigator.callback(url, { keepOpen });\n        logger.info(\"success\");\n    }\n\n    protected async _signout(args: CreateSignoutRequestArgs, handle: IWindow): Promise<SignoutResponse> {\n        const navResponse = await this._signoutStart(args, handle);\n        return await this._signoutEnd(navResponse.url);\n    }\n\n    protected async _signoutStart(args: CreateSignoutRequestArgs = {}, handle: IWindow): Promise<NavigateResponse> {\n        const logger = this._logger.create(\"_signoutStart\");\n\n        try {\n            const user = await this._loadUser();\n            logger.debug(\"loaded current user from storage\");\n\n            if (this.settings.revokeTokensOnSignout) {\n                await this._revokeInternal(user);\n            }\n\n            const id_token = args.id_token_hint || user && user.id_token;\n            if (id_token) {\n                logger.debug(\"setting id_token_hint in signout request\");\n                args.id_token_hint = id_token;\n            }\n\n            await this.removeUser();\n            logger.debug(\"user removed, creating signout request\");\n\n            const signoutRequest = await this._client.createSignoutRequest(args);\n            logger.debug(\"got signout request\");\n\n            return await handle.navigate({\n                url: signoutRequest.url,\n                state: signoutRequest.state?.id,\n                scriptOrigin: this.settings.iframeScriptOrigin,\n            });\n        } catch (err) {\n            logger.debug(\"error after preparing navigator, closing navigator window\");\n            handle.close();\n            throw err;\n        }\n    }\n\n    protected async _signoutEnd(url: string): Promise<SignoutResponse> {\n        const logger = this._logger.create(\"_signoutEnd\");\n        const signoutResponse = await this._client.processSignoutResponse(url);\n        logger.debug(\"got signout response\");\n\n        return signoutResponse;\n    }\n\n    /**\n     * Trigger a silent request (via an iframe) to the end session endpoint.\n     *\n     * @returns A promise\n     */\n    public async signoutSilent(args: SignoutSilentArgs = {}): Promise<void> {\n        const logger = this._logger.create(\"signoutSilent\");\n        const {\n            silentRequestTimeoutInSeconds,\n            ...requestArgs\n        } = args;\n\n        const id_token_hint = this.settings.includeIdTokenInSilentSignout\n            ? (await this._loadUser())?.id_token\n            : undefined;\n\n        const url = this.settings.popup_post_logout_redirect_uri;\n        const handle = await this._iframeNavigator.prepare({ silentRequestTimeoutInSeconds });\n        await this._signout({\n            request_type: \"so:s\",\n            post_logout_redirect_uri: url,\n            id_token_hint: id_token_hint,\n            ...requestArgs,\n        }, handle);\n\n        logger.info(\"success\");\n    }\n\n    /**\n     * Notify the parent window of response (callback) from the end session endpoint.\n     * It is recommended to use {@link UserManager.signoutCallback} instead.\n     *\n     * @returns A promise\n     *\n     * @see {@link UserManager.signoutCallback}\n     */\n    public async signoutSilentCallback(url = window.location.href): Promise<void> {\n        const logger = this._logger.create(\"signoutSilentCallback\");\n        await this._iframeNavigator.callback(url);\n        logger.info(\"success\");\n    }\n\n    public async revokeTokens(types?: RevokeTokensTypes): Promise<void> {\n        const user = await this._loadUser();\n        await this._revokeInternal(user, types);\n    }\n\n    protected async _revokeInternal(user: User | null, types = this.settings.revokeTokenTypes): Promise<void> {\n        const logger = this._logger.create(\"_revokeInternal\");\n        if (!user) return;\n\n        const typesPresent = types.filter(type => typeof user[type] === \"string\");\n\n        if (!typesPresent.length) {\n            logger.debug(\"no need to revoke due to no token(s)\");\n            return;\n        }\n\n        // don't Promise.all, order matters\n        for (const type of typesPresent) {\n            await this._client.revokeToken(\n                user[type]!, // eslint-disable-line @typescript-eslint/no-non-null-assertion\n                type,\n            );\n            logger.info(`${type} revoked successfully`);\n            if (type !== \"access_token\") {\n                user[type] = null as never;\n            }\n        }\n\n        await this.storeUser(user);\n        logger.debug(\"user stored\");\n        await this._events.load(user);\n    }\n\n    /**\n     * Enables silent renew for the `UserManager`.\n     */\n    public startSilentRenew(): void {\n        this._logger.create(\"startSilentRenew\");\n        void this._silentRenewService.start();\n    }\n\n    /**\n     * Disables silent renew for the `UserManager`.\n     */\n    public stopSilentRenew(): void {\n        this._silentRenewService.stop();\n    }\n\n    protected get _userStoreKey(): string {\n        return `user:${this.settings.authority}:${this.settings.client_id}`;\n    }\n\n    protected async _loadUser(): Promise<User | null> {\n        const logger = this._logger.create(\"_loadUser\");\n        const storageString = await this.settings.userStore.get(this._userStoreKey);\n        if (storageString) {\n            logger.debug(\"user storageString loaded\");\n            return User.fromStorageString(storageString);\n        }\n\n        logger.debug(\"no user storageString\");\n        return null;\n    }\n\n    public async storeUser(user: User | null): Promise<void> {\n        const logger = this._logger.create(\"storeUser\");\n        if (user) {\n            logger.debug(\"storing user\");\n            const storageString = user.toStorageString();\n            await this.settings.userStore.set(this._userStoreKey, storageString);\n        } else {\n            this._logger.debug(\"removing user\");\n            await this.settings.userStore.remove(this._userStoreKey);\n            if (this.settings.dpop) {\n                await this.settings.dpop.store.remove(this.settings.client_id);\n            }\n        }\n    }\n\n    /**\n     * Removes stale state entries in storage for incomplete authorize requests.\n     */\n    public async clearStaleState(): Promise<void> {\n        await this._client.clearStaleState();\n    }\n\n    /**\n     * Dynamically generates a DPoP proof for a given user, URL and optional Http method.\n     * This method is useful when you need to make a request to a resource server\n     * with fetch or similar, and you need to include a DPoP proof in a DPoP header.\n     * @param url - The URL to generate the DPoP proof for\n     * @param user - The user to generate the DPoP proof for\n     * @param httpMethod - Optional, defaults to \"GET\"\n     * @param nonce - Optional nonce provided by the resource server\n     *\n     * @returns A promise containing the DPoP proof or undefined if DPoP is not enabled/no user is found.\n     */\n    public async dpopProof(url: string, user: User, httpMethod?: string, nonce?: string): Promise<string | undefined> {\n        const dpopState = await this.settings.dpop?.store?.get(this.settings.client_id);\n        if (dpopState) {\n            return await CryptoUtils.generateDPoPProof({\n                url,\n                accessToken: user?.access_token,\n                httpMethod: httpMethod,\n                keyPair: dpopState.keys,\n                nonce,\n            });\n        }\n        return undefined;\n    }\n\n    async generateDPoPJkt(dpopSettings: DPoPSettings): Promise<string | undefined> {\n        let dpopState = await dpopSettings.store.get(this.settings.client_id);\n        if (!dpopState) {\n            const dpopKeys = await CryptoUtils.generateDPoPKeys();\n            dpopState = new DPoPState(dpopKeys);\n            await dpopSettings.store.set(this.settings.client_id, dpopState);\n        }\n        return await CryptoUtils.generateDPoPJkt(dpopState.keys);\n    }\n}\n", "{\n  \"name\": \"oidc-client-ts\",\n  \"version\": \"3.1.0\",\n  \"description\": \"OpenID Connect (OIDC) & OAuth2 client library\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git+https://github.com/authts/oidc-client-ts.git\"\n  },\n  \"homepage\": \"https://github.com/authts/oidc-client-ts#readme\",\n  \"license\": \"Apache-2.0\",\n  \"main\": \"dist/umd/oidc-client-ts.js\",\n  \"types\": \"dist/types/oidc-client-ts.d.ts\",\n  \"exports\": {\n    \".\": {\n      \"types\": \"./dist/types/oidc-client-ts.d.ts\",\n      \"import\": \"./dist/esm/oidc-client-ts.js\",\n      \"require\": \"./dist/umd/oidc-client-ts.js\"\n    },\n    \"./package.json\": \"./package.json\"\n  },\n  \"files\": [\n    \"dist\"\n  ],\n  \"keywords\": [\n    \"authentication\",\n    \"oauth2\",\n    \"oidc\",\n    \"openid\",\n    \"OpenID Connect\"\n  ],\n  \"scripts\": {\n    \"build\": \"node scripts/build.js && npm run build-types\",\n    \"build-types\": \"tsc -p tsconfig.build.json && api-extractor run\",\n    \"clean\": \"git clean -fdX dist lib *.tsbuildinfo\",\n    \"prepack\": \"npm run build\",\n    \"test\": \"tsc && jest\",\n    \"typedoc\": \"typedoc\",\n    \"lint\": \"eslint --max-warnings=0 --cache .\",\n    \"prepare\": \"husky\"\n  },\n  \"dependencies\": {\n    \"jwt-decode\": \"^4.0.0\"\n  },\n  \"devDependencies\": {\n    \"@microsoft/api-extractor\": \"^7.47.2\",\n    \"@testing-library/jest-dom\": \"^6.4.6\",\n    \"@types/jest\": \"^29.5.12\",\n    \"@types/node\": \"^22.4.1\",\n    \"@typescript-eslint/eslint-plugin\": \"^7.16.1\",\n    \"@typescript-eslint/parser\": \"^7.16.1\",\n    \"esbuild\": \"^0.24.0\",\n    \"eslint\": \"^8.57.0\",\n    \"eslint-plugin-testing-library\": \"^6.2.2\",\n    \"http-proxy-middleware\": \"^3.0.0\",\n    \"fake-indexeddb\": \"^6.0.0\",\n    \"husky\": \"^9.0.11\",\n    \"jest\": \"^29.7.0\",\n    \"jest-environment-jsdom\": \"^29.7.0\",\n    \"jest-mock\": \"^29.7.0\",\n    \"jose\": \"^5.6.3\",\n    \"lint-staged\": \"^15.2.7\",\n    \"ts-jest\": \"^29.2.2\",\n    \"typedoc\": \"^0.26.4\",\n    \"typescript\": \"~5.4.2\",\n    \"yn\": \"^5.0.0\"\n  },\n  \"engines\": {\n    \"node\": \">=18\"\n  },\n  \"lint-staged\": {\n    \"*.{js,jsx,ts,tsx}\": \"eslint --cache --fix\"\n  }\n}\n", "// @ts-expect-error avoid enabling resolveJsonModule to keep build process simple\nimport { version } from \"../package.json\";\n\n/**\n * @public\n */\nexport const Version: string = version;\n", "import { DPoPState, type DPoPStore } from \"./DPoPStore\";\n\n/**\n * Provides a default implementation of the DPoP store using IndexedDB.\n *\n * @public\n */\nexport class IndexedDbDPoPStore implements DPoPStore {\n    readonly _dbName: string = \"oidc\";\n    readonly _storeName: string = \"dpop\";\n\n    public async set(key: string, value: DPoPState): Promise<void> {\n        const store = await this.createStore(this._dbName, this._storeName);\n        await store(\"readwrite\", (str: IDBObjectStore) => {\n            str.put(value, key);\n            return this.promisifyRequest(str.transaction);\n        });\n    }\n\n    public async get(key: string): Promise<DPoPState> {\n        const store = await this.createStore(this._dbName, this._storeName);\n        return await store(\"readonly\", (str) => {\n            return this.promisifyRequest(str.get(key));\n        }) as DPoPState;\n    }\n\n    public async remove(key: string): Promise<DPoPState> {\n        const item = await this.get(key);\n        const store = await this.createStore(this._dbName, this._storeName);\n        await store(\"readwrite\", (str) => {\n            return this.promisifyRequest(str.delete(key));\n        });\n        return item;\n    }\n\n    public async getAllKeys(): Promise<string[]> {\n        const store = await this.createStore(this._dbName, this._storeName);\n        return await store(\"readonly\", (str) => {\n            return this.promisifyRequest(str.getAllKeys());\n        }) as string[];\n    }\n\n    promisifyRequest<T = undefined>(\n        request: IDBRequest<T> | IDBTransaction): Promise<T> {\n        return new Promise<T>((resolve, reject) => {\n            (request as IDBTransaction).oncomplete = (request as IDBRequest<T>).onsuccess = () => resolve((request as IDBRequest<T>).result);\n            (request as IDBTransaction).onabort = (request as IDBRequest<T>).onerror = () => reject((request as IDBRequest<T>).error);\n        });\n    }\n\n    async createStore<T>(\n        dbName: string,\n        storeName: string,\n    ): Promise<(txMode: IDBTransactionMode, callback: (store: IDBObjectStore) => T | PromiseLike<T>) => Promise<T>> {\n        const request = indexedDB.open(dbName);\n        request.onupgradeneeded = () => request.result.createObjectStore(storeName);\n        const db = await this.promisifyRequest<IDBDatabase>(request);\n\n        return async (\n            txMode: IDBTransactionMode,\n            callback: (store: IDBObjectStore) => T | PromiseLike<T>,\n        ) => {\n            const tx = db.transaction(storeName, txMode);\n            const store = tx.objectStore(storeName);\n            return await callback(store);\n        };\n    }\n}\n"],
-  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACeA,IAAM,YAAqB;AAAA,EACvB,OAAO,MAAM;AAAA,EACb,MAAM,MAAM;AAAA,EACZ,MAAM,MAAM;AAAA,EACZ,OAAO,MAAM;AACjB;AAEA,IAAI;AACJ,IAAI;AAOG,IAAK,MAAL,kBAAKA,SAAL;AACH,EAAAA,UAAA;AACA,EAAAA,UAAA;AACA,EAAAA,UAAA;AACA,EAAAA,UAAA;AACA,EAAAA,UAAA;AALQ,SAAAA;AAAA,GAAA;AAAA,CAaL,CAAUA,SAAV;AACI,WAAS,QAAc;AAC1B,YAAQ;AACR,aAAS;AAAA,EACb;AAHO,EAAAA,KAAS;AAKT,WAAS,SAAS,OAAkB;AACvC,QAAI,EAAE,gBAAY,SAAS,SAAS,gBAAY;AAC5C,YAAM,IAAI,MAAM,mBAAmB;AAAA,IACvC;AACA,YAAQ;AAAA,EACZ;AALO,EAAAA,KAAS;AAOT,WAAS,UAAU,OAAsB;AAC5C,aAAS;AAAA,EACb;AAFO,EAAAA,KAAS;AAAA,GAbH;AAuBV,IAAM,SAAN,MAAM,QAAO;AAAA,EAET,YAAoB,OAAe;AAAf;AAAA,EAAgB;AAAA;AAAA,EAGpC,SAAS,MAAuB;AACnC,QAAI,SAAS,eAAW;AACpB,aAAO,MAAM,QAAO,QAAQ,KAAK,OAAO,KAAK,OAAO,GAAG,GAAG,IAAI;AAAA,IAClE;AAAA,EACJ;AAAA,EACO,QAAQ,MAAuB;AAClC,QAAI,SAAS,cAAU;AACnB,aAAO,KAAK,QAAO,QAAQ,KAAK,OAAO,KAAK,OAAO,GAAG,GAAG,IAAI;AAAA,IACjE;AAAA,EACJ;AAAA,EACO,QAAQ,MAAuB;AAClC,QAAI,SAAS,cAAU;AACnB,aAAO,KAAK,QAAO,QAAQ,KAAK,OAAO,KAAK,OAAO,GAAG,GAAG,IAAI;AAAA,IACjE;AAAA,EACJ;AAAA,EACO,SAAS,MAAuB;AACnC,QAAI,SAAS,eAAW;AACpB,aAAO,MAAM,QAAO,QAAQ,KAAK,OAAO,KAAK,OAAO,GAAG,GAAG,IAAI;AAAA,IAClE;AAAA,EACJ;AAAA;AAAA,EAGO,MAAM,KAAmB;AAC5B,SAAK,MAAM,GAAG;AACd,UAAM;AAAA,EACV;AAAA,EAEO,OAAO,QAAwB;AAClC,UAAM,eAAuB,OAAO,OAAO,IAAI;AAC/C,iBAAa,UAAU;AACvB,iBAAa,MAAM,OAAO;AAC1B,WAAO;AAAA,EACX;AAAA,EAEA,OAAc,aAAa,MAAc,cAA8B;AACnE,UAAM,eAAe,IAAI,QAAO,GAAG,IAAI,IAAI,YAAY,EAAE;AACzD,iBAAa,MAAM,OAAO;AAC1B,WAAO;AAAA,EACX;AAAA,EAEA,OAAe,QAAQ,MAAc,QAAiB;AAClD,UAAM,SAAS,IAAI,IAAI;AACvB,WAAO,SAAS,GAAG,MAAM,IAAI,MAAM,MAAM;AAAA,EAC7C;AAAA;AAAA;AAAA,EAIA,OAAc,MAAM,SAAiB,MAAuB;AACxD,QAAI,SAAS,eAAW;AACpB,aAAO,MAAM,QAAO,QAAQ,IAAI,GAAG,GAAG,IAAI;AAAA,IAC9C;AAAA,EACJ;AAAA,EACA,OAAc,KAAK,SAAiB,MAAuB;AACvD,QAAI,SAAS,cAAU;AACnB,aAAO,KAAK,QAAO,QAAQ,IAAI,GAAG,GAAG,IAAI;AAAA,IAC7C;AAAA,EACJ;AAAA,EACA,OAAc,KAAK,SAAiB,MAAuB;AACvD,QAAI,SAAS,cAAU;AACnB,aAAO,KAAK,QAAO,QAAQ,IAAI,GAAG,GAAG,IAAI;AAAA,IAC7C;AAAA,EACJ;AAAA,EACA,OAAc,MAAM,SAAiB,MAAuB;AACxD,QAAI,SAAS,eAAW;AACpB,aAAO,MAAM,QAAO,QAAQ,IAAI,GAAG,GAAG,IAAI;AAAA,IAC9C;AAAA,EACJ;AAAA;AAEJ;AAEA,IAAI,MAAM;;;AC7IV,wBAA0B;AASnB,IAAM,WAAN,MAAe;AAAA;AAAA,EAElB,OAAc,OAAO,OAA0B;AAC3C,QAAI;AACA,iBAAO,6BAAqB,KAAK;AAAA,IACrC,SACO,KAAK;AACR,aAAO,MAAM,mBAAmB,GAAG;AACnC,YAAM;AAAA,IACV;AAAA,EACJ;AAAA,EAEA,aAAoB,kBAAkB,QAAgB,SAAiB,YAAyC;AAC5G,UAAM,gBAAgB,YAAY,gBAAgB,IAAI,YAAY,EAAE,OAAO,KAAK,UAAU,MAAM,CAAC,CAAC;AAClG,UAAM,iBAAiB,YAAY,gBAAgB,IAAI,YAAY,EAAE,OAAO,KAAK,UAAU,OAAO,CAAC,CAAC;AACpG,UAAM,eAAe,GAAG,aAAa,IAAI,cAAc;AAEvD,UAAM,YAAY,MAAM,OAAO,OAAO,OAAO;AAAA,MACzC;AAAA,QACI,MAAM;AAAA,QACN,MAAM,EAAE,MAAM,UAAU;AAAA,MAC5B;AAAA,MACA;AAAA,MACA,IAAI,YAAY,EAAE,OAAO,YAAY;AAAA,IACzC;AAEA,UAAM,mBAAmB,YAAY,gBAAgB,IAAI,WAAW,SAAS,CAAC;AAC9E,WAAO,GAAG,YAAY,IAAI,gBAAgB;AAAA,EAC9C;AACJ;;;AC3BA,IAAM,mBAAmB;AAEzB,IAAM,WAAW,CAAC,QACd,KAAK,CAAC,GAAG,IAAI,WAAW,GAAG,CAAC,EACvB,IAAI,CAAC,QAAQ,OAAO,aAAa,GAAG,CAAC,EACrC,KAAK,EAAE,CAAC;AAKV,IAAM,eAAN,MAAM,aAAY;AAAA,EACrB,OAAe,cAAsB;AACjC,UAAM,MAAM,IAAI,YAAY,CAAC;AAC7B,WAAO,gBAAgB,GAAG;AAC1B,WAAO,IAAI,CAAC;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA,EAKA,OAAc,iBAAyB;AACnC,UAAM,OAAO,iBAAiB;AAAA,MAAQ;AAAA,MAAU,QAC3C,CAAC,IAAI,aAAY,YAAY,IAAI,MAAM,CAAC,IAAI,GAAG,SAAS,EAAE;AAAA,IAC/D;AACA,WAAO,KAAK,QAAQ,MAAM,EAAE;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAc,uBAA+B;AACzC,WAAO,aAAY,eAAe,IAAI,aAAY,eAAe,IAAI,aAAY,eAAe;AAAA,EACpG;AAAA;AAAA;AAAA;AAAA,EAKA,aAAoB,sBAAsB,eAAwC;AAC9E,QAAI,CAAC,OAAO,QAAQ;AAChB,YAAM,IAAI,MAAM,6DAA6D;AAAA,IACjF;AAEA,QAAI;AACA,YAAM,UAAU,IAAI,YAAY;AAChC,YAAM,OAAO,QAAQ,OAAO,aAAa;AACzC,YAAM,SAAS,MAAM,OAAO,OAAO,OAAO,WAAW,IAAI;AACzD,aAAO,SAAS,MAAM,EAAE,QAAQ,OAAO,GAAG,EAAE,QAAQ,OAAO,GAAG,EAAE,QAAQ,OAAO,EAAE;AAAA,IACrF,SACO,KAAK;AACR,aAAO,MAAM,qCAAqC,GAAG;AACrD,YAAM;AAAA,IACV;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKA,OAAc,kBAAkB,WAAmB,eAA+B;AAC9E,UAAM,UAAU,IAAI,YAAY;AAChC,UAAM,OAAO,QAAQ,OAAO,CAAC,WAAW,aAAa,EAAE,KAAK,GAAG,CAAC;AAChE,WAAO,SAAS,IAAI;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,aAAoB,KAAK,KAAa,SAAuC;AACzE,UAAM,WAAW,IAAI,YAAY,EAAE,OAAO,OAAO;AACjD,UAAM,aAAa,MAAM,OAAO,OAAO,OAAO,KAAK,QAAQ;AAC3D,WAAO,IAAI,WAAW,UAAU;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,aAAoB,6BAA6B,KAAkC;AAC/E,QAAI;AACJ,YAAQ,IAAI,KAAK;AAAA,MACb,KAAK;AACD,qBAAa;AAAA,UACT,KAAK,IAAI;AAAA,UACT,OAAO,IAAI;AAAA,UACX,KAAK,IAAI;AAAA,QACb;AACA;AAAA,MACJ,KAAK;AACD,qBAAa;AAAA,UACT,OAAO,IAAI;AAAA,UACX,OAAO,IAAI;AAAA,UACX,KAAK,IAAI;AAAA,UACT,KAAK,IAAI;AAAA,QACb;AACA;AAAA,MACJ,KAAK;AACD,qBAAa;AAAA,UACT,OAAO,IAAI;AAAA,UACX,OAAO,IAAI;AAAA,UACX,KAAK,IAAI;AAAA,QACb;AACA;AAAA,MACJ,KAAK;AACD,qBAAa;AAAA,UACT,OAAO,IAAI;AAAA,UACX,OAAO,IAAI;AAAA,QACf;AACA;AAAA,MACJ;AACI,cAAM,IAAI,MAAM,kBAAkB;AAAA,IAC1C;AACA,UAAM,uBAAuB,MAAM,aAAY,KAAK,WAAW,KAAK,UAAU,UAAU,CAAC;AACzF,WAAO,aAAY,gBAAgB,oBAAoB;AAAA,EAC3D;AAAA,EAEA,aAAoB,kBAAkB;AAAA,IAClC;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACJ,GAA2C;AACvC,QAAI;AACJ,QAAI;AAEJ,UAAM,UAA2C;AAAA,MAC7C,OAAO,OAAO,OAAO,WAAW;AAAA,MAChC,OAAO,kCAAc;AAAA,MACrB,OAAO;AAAA,MACP,OAAO,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI;AAAA,IACvC;AAEA,QAAI,aAAa;AACb,oBAAc,MAAM,aAAY,KAAK,WAAW,WAAW;AAC3D,oBAAc,aAAY,gBAAgB,WAAW;AACrD,cAAQ,MAAM;AAAA,IAClB;AAEA,QAAI,OAAO;AACP,cAAQ,QAAQ;AAAA,IACpB;AAEA,QAAI;AACA,YAAM,YAAY,MAAM,OAAO,OAAO,UAAU,OAAO,QAAQ,SAAS;AACxE,YAAM,SAAS;AAAA,QACX,OAAO;AAAA,QACP,OAAO;AAAA,QACP,OAAO;AAAA,UACH,OAAO,UAAU;AAAA,UACjB,OAAO,UAAU;AAAA,UACjB,KAAK,UAAU;AAAA,UACf,KAAK,UAAU;AAAA,QACnB;AAAA,MACJ;AACA,aAAO,MAAM,SAAS,kBAAkB,QAAQ,SAAS,QAAQ,UAAU;AAAA,IAC/E,SAAS,KAAK;AACV,UAAI,eAAe,WAAW;AAC1B,cAAM,IAAI,MAAM,oCAAoC,IAAI,OAAO,EAAE;AAAA,MACrE,OAAO;AACH,cAAM;AAAA,MACV;AAAA,IACJ;AAAA,EACJ;AAAA,EAEA,aAAoB,gBAAgB,SAA0C;AAC1E,QAAI;AACA,YAAM,YAAY,MAAM,OAAO,OAAO,UAAU,OAAO,QAAQ,SAAS;AACxE,aAAO,MAAM,aAAY,6BAA6B,SAAS;AAAA,IACnE,SAAS,KAAK;AACV,UAAI,eAAe,WAAW;AAC1B,cAAM,IAAI,MAAM,8CAA8C,IAAI,OAAO,EAAE;AAAA,MAC/E,OAAO;AACH,cAAM;AAAA,MACV;AAAA,IACJ;AAAA,EACJ;AAAA,EAEA,aAAoB,mBAA4C;AAC5D,WAAO,MAAM,OAAO,OAAO,OAAO;AAAA,MAC9B;AAAA,QACI,MAAM;AAAA,QACN,YAAY;AAAA,MAChB;AAAA,MACA;AAAA,MACA,CAAC,QAAQ,QAAQ;AAAA,IACrB;AAAA,EACJ;AACJ;AAAA;AAAA;AAAA;AAzLa,aAmEK,kBAAkB,CAAC,UAAsB;AACnD,SAAO,SAAS,KAAK,EAAE,QAAQ,MAAM,EAAE,EAAE,QAAQ,OAAO,GAAG,EAAE,QAAQ,OAAO,GAAG;AACnF;AArEG,IAAM,cAAN;;;ACRA,IAAM,QAAN,MAAyC;AAAA,EAKrC,YAA+B,OAAe;AAAf;AAFtC,SAAiB,aAAyC,CAAC;AAGvD,SAAK,UAAU,IAAI,OAAO,UAAU,KAAK,KAAK,IAAI;AAAA,EACtD;AAAA,EAEO,WAAW,IAAqC;AACnD,SAAK,WAAW,KAAK,EAAE;AACvB,WAAO,MAAM,KAAK,cAAc,EAAE;AAAA,EACtC;AAAA,EAEO,cAAc,IAA+B;AAChD,UAAM,MAAM,KAAK,WAAW,YAAY,EAAE;AAC1C,QAAI,OAAO,GAAG;AACV,WAAK,WAAW,OAAO,KAAK,CAAC;AAAA,IACjC;AAAA,EACJ;AAAA,EAEA,MAAa,SAAS,IAA8B;AAChD,SAAK,QAAQ,MAAM,UAAU,GAAG,EAAE;AAClC,eAAW,MAAM,KAAK,YAAY;AAC9B,YAAM,GAAG,GAAG,EAAE;AAAA,IAClB;AAAA,EACJ;AACJ;;;AClBO,IAAM,aAAN,MAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMpB,OAAO,OAAO,EAAE,GAAG,SAAS,GAA6C;AA5B7E;AA6BQ,QAAI,SAAS,SAAS;AAClB,eAAS,SAAQ,MAAC,KAAK,KAAK,KAAK,GAAG,EAAE,KAAK,WAAS,SAAS,OAAO,aAAa,KAAK,MAArE,YAA0E;AAC/F,mBAAS,SAAT,qBAAS,OAAS,KAAK,IAAI,GAAG,KAAK,MAAM,OAAO,WAAW,OAAO,aAAa,SAAS,SAAS,CAAC,CAAC;AACnG,QAAI,SAAS,UAAU;AACnB,qBAAS,QAAT,qBAAS,MAAQ,KAAK,IAAI,GAAG,KAAK,MAAM,OAAO,WAAW,OAAO,cAAc,SAAS,UAAU,CAAC,CAAC;AACxG,WAAO;AAAA,EACX;AAAA,EAEA,OAAO,UAAU,UAAuC;AACpD,WAAO,OAAO,QAAQ,QAAQ,EACzB,OAAO,CAAC,CAAC,EAAE,KAAK,MAAM,SAAS,IAAI,EACnC,IAAI,CAAC,CAAC,KAAK,KAAK,MAAM,GAAG,GAAG,IAAI,OAAO,UAAU,YAAY,QAAkB,QAAQ,QAAQ,IAAI,EAAE,EACrG,KAAK,GAAG;AAAA,EACjB;AACJ;;;AClCO,IAAM,QAAN,MAAM,eAAc,MAAc;AAAA,EAAlC;AAAA;AACH,SAAmB,UAAU,IAAI,OAAO,UAAU,KAAK,KAAK,IAAI;AAChE,SAAQ,eAAsD;AAC9D,SAAQ,cAAc;AAyCtB,SAAU,YAAY,MAAY;AAC9B,YAAM,OAAO,KAAK,cAAc,OAAM,aAAa;AACnD,WAAK,QAAQ,MAAM,sBAAsB,IAAI;AAE7C,UAAI,KAAK,eAAe,OAAM,aAAa,GAAG;AAC1C,aAAK,OAAO;AACZ,aAAK,MAAM,MAAM;AAAA,MACrB;AAAA,IACJ;AAAA;AAAA;AAAA,EA9CA,OAAc,eAAuB;AACjC,WAAO,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI;AAAA,EACvC;AAAA,EAEO,KAAK,mBAAiC;AACzC,UAAMC,UAAS,KAAK,QAAQ,OAAO,MAAM;AACzC,wBAAoB,KAAK,IAAI,KAAK,MAAM,iBAAiB,GAAG,CAAC;AAC7D,UAAM,aAAa,OAAM,aAAa,IAAI;AAC1C,QAAI,KAAK,eAAe,cAAc,KAAK,cAAc;AAErD,MAAAA,QAAO,MAAM,wDAAwD,KAAK,UAAU;AACpF;AAAA,IACJ;AAEA,SAAK,OAAO;AAEZ,IAAAA,QAAO,MAAM,kBAAkB,iBAAiB;AAChD,SAAK,cAAc;AAKnB,UAAM,yBAAyB,KAAK,IAAI,mBAAmB,CAAC;AAC5D,SAAK,eAAe,YAAY,KAAK,WAAW,yBAAyB,GAAI;AAAA,EACjF;AAAA,EAEA,IAAW,aAAqB;AAC5B,WAAO,KAAK;AAAA,EAChB;AAAA,EAEO,SAAe;AAClB,SAAK,QAAQ,OAAO,QAAQ;AAC5B,QAAI,KAAK,cAAc;AACnB,oBAAc,KAAK,YAAY;AAC/B,WAAK,eAAe;AAAA,IACxB;AAAA,EACJ;AAWJ;;;ACxDO,IAAM,WAAN,MAAe;AAAA,EAClB,OAAc,WAAW,KAAa,eAAqC,SAA0B;AACjG,QAAI,CAAC,IAAK,OAAM,IAAI,UAAU,aAAa;AAE3C,UAAM,YAAY,IAAI,IAAI,KAAK,kBAAkB;AACjD,UAAM,SAAS,UAAU,iBAAiB,aAAa,SAAS,QAAQ;AACxE,WAAO,IAAI,gBAAgB,OAAO,MAAM,CAAC,CAAC;AAAA,EAC9C;AACJ;AAKO,IAAM,sBAAsB;;;ACR5B,IAAM,gBAAN,cAA4B,MAAM;AAAA,EAqB9B,YACH,MAKgB,MAClB;AAvCN;AAwCQ,UAAM,KAAK,qBAAqB,KAAK,SAAS,EAAE;AAFhC;AAzBpB;AAAA,SAAgB,OAAe;AA6B3B,QAAI,CAAC,KAAK,OAAO;AACb,aAAO,MAAM,iBAAiB,iBAAiB;AAC/C,YAAM,IAAI,MAAM,iBAAiB;AAAA,IACrC;AAEA,SAAK,QAAQ,KAAK;AAClB,SAAK,qBAAoB,UAAK,sBAAL,YAA0B;AACnD,SAAK,aAAY,UAAK,cAAL,YAAkB;AAEnC,SAAK,QAAQ,KAAK;AAClB,SAAK,iBAAgB,UAAK,kBAAL,YAAsB;AAC3C,SAAK,YAAY,KAAK;AAAA,EAC1B;AACJ;;;AC/CO,IAAM,eAAN,cAA2B,MAAM;AAAA,EAI7B,YAAY,SAAkB;AACjC,UAAM,OAAO;AAHjB;AAAA,SAAgB,OAAe;AAAA,EAI/B;AACJ;;;ACDO,IAAM,oBAAN,MAAwB;AAAA,EAOpB,YAAY,MAAqD;AANxE,SAAmB,UAAU,IAAI,OAAO,mBAAmB;AAE3D,SAAiB,iBAAiB,IAAI,MAAM,uBAAuB;AACnE,SAAiB,gBAAgB,IAAI,MAAM,sBAAsB;AAI7D,SAAK,qCAAqC,KAAK;AAAA,EACnD;AAAA,EAEO,KAAK,WAAuB;AAC/B,UAAMC,UAAS,KAAK,QAAQ,OAAO,MAAM;AAEzC,QAAI,UAAU,gBAAgB,UAAU,eAAe,QAAW;AAC9D,YAAM,WAAW,UAAU;AAC3B,MAAAA,QAAO,MAAM,6CAA6C,QAAQ;AAElE,UAAI,WAAW,GAAG;AAEd,YAAI,WAAW,WAAW,KAAK;AAC/B,YAAI,YAAY,GAAG;AACf,qBAAW;AAAA,QACf;AAEA,QAAAA,QAAO,MAAM,0CAA0C,UAAU,SAAS;AAC1E,aAAK,eAAe,KAAK,QAAQ;AAAA,MACrC,OACK;AACD,QAAAA,QAAO,MAAM,kEAAkE;AAC/E,aAAK,eAAe,OAAO;AAAA,MAC/B;AAGA,YAAM,UAAU,WAAW;AAC3B,MAAAA,QAAO,MAAM,yCAAyC,SAAS,SAAS;AACxE,WAAK,cAAc,KAAK,OAAO;AAAA,IACnC,OACK;AACD,WAAK,eAAe,OAAO;AAC3B,WAAK,cAAc,OAAO;AAAA,IAC9B;AAAA,EACJ;AAAA,EAEO,SAAe;AAClB,SAAK,QAAQ,MAAM,gDAAgD;AACnE,SAAK,eAAe,OAAO;AAC3B,SAAK,cAAc,OAAO;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA,EAKO,uBAAuB,IAAqC;AAC/D,WAAO,KAAK,eAAe,WAAW,EAAE;AAAA,EAC5C;AAAA;AAAA;AAAA;AAAA,EAIO,0BAA0B,IAA+B;AAC5D,SAAK,eAAe,cAAc,EAAE;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKO,sBAAsB,IAAqC;AAC9D,WAAO,KAAK,cAAc,WAAW,EAAE;AAAA,EAC3C;AAAA;AAAA;AAAA;AAAA,EAIO,yBAAyB,IAA+B;AAC3D,SAAK,cAAc,cAAc,EAAE;AAAA,EACvC;AACJ;;;ACjFO,IAAM,qBAAN,MAAyB;AAAA,EAOrB,YACK,WACA,YACR,KACQ,oBACA,cACV;AALU;AACA;AAEA;AACA;AAXZ,SAAiB,UAAU,IAAI,OAAO,oBAAoB;AAG1D,SAAQ,SAAgD;AACxD,SAAQ,iBAAgC;AAmCxC,SAAQ,WAAW,CAAC,MAAkC;AAClD,UAAI,EAAE,WAAW,KAAK,iBAClB,EAAE,WAAW,KAAK,OAAO,eAC3B;AACE,YAAI,EAAE,SAAS,SAAS;AACpB,eAAK,QAAQ,MAAM,4CAA4C;AAC/D,cAAI,KAAK,cAAc;AACnB,iBAAK,KAAK;AAAA,UACd;AAAA,QACJ,WACS,EAAE,SAAS,WAAW;AAC3B,eAAK,QAAQ,MAAM,8CAA8C;AACjE,eAAK,KAAK;AACV,eAAK,KAAK,UAAU;AAAA,QACxB,OACK;AACD,eAAK,QAAQ,MAAM,EAAE,OAAO,uCAAuC;AAAA,QACvE;AAAA,MACJ;AAAA,IACJ;AA7CI,UAAM,YAAY,IAAI,IAAI,GAAG;AAC7B,SAAK,gBAAgB,UAAU;AAE/B,SAAK,SAAS,OAAO,SAAS,cAAc,QAAQ;AAGpD,SAAK,OAAO,MAAM,aAAa;AAC/B,SAAK,OAAO,MAAM,WAAW;AAC7B,SAAK,OAAO,MAAM,OAAO;AACzB,SAAK,OAAO,MAAM,MAAM;AACxB,SAAK,OAAO,QAAQ;AACpB,SAAK,OAAO,SAAS;AACrB,SAAK,OAAO,MAAM,UAAU;AAAA,EAChC;AAAA,EAEO,OAAsB;AACzB,WAAO,IAAI,QAAc,CAAC,YAAY;AAClC,WAAK,OAAO,SAAS,MAAM;AACvB,gBAAQ;AAAA,MACZ;AAEA,aAAO,SAAS,KAAK,YAAY,KAAK,MAAM;AAC5C,aAAO,iBAAiB,WAAW,KAAK,UAAU,KAAK;AAAA,IAC3D,CAAC;AAAA,EACL;AAAA,EAuBO,MAAM,eAA6B;AACtC,QAAI,KAAK,mBAAmB,eAAe;AACvC;AAAA,IACJ;AAEA,SAAK,QAAQ,OAAO,OAAO;AAE3B,SAAK,KAAK;AAEV,SAAK,iBAAiB;AAEtB,UAAM,OAAO,MAAM;AACf,UAAI,CAAC,KAAK,OAAO,iBAAiB,CAAC,KAAK,gBAAgB;AACpD;AAAA,MACJ;AAEA,WAAK,OAAO,cAAc,YAAY,KAAK,aAAa,MAAM,KAAK,gBAAgB,KAAK,aAAa;AAAA,IACzG;AAGA,SAAK;AAGL,SAAK,SAAS,YAAY,MAAM,KAAK,qBAAqB,GAAI;AAAA,EAClE;AAAA,EAEO,OAAa;AAChB,SAAK,QAAQ,OAAO,MAAM;AAC1B,SAAK,iBAAiB;AAEtB,QAAI,KAAK,QAAQ;AAEb,oBAAc,KAAK,MAAM;AACzB,WAAK,SAAS;AAAA,IAClB;AAAA,EACJ;AACJ;;;ACjGO,IAAM,qBAAN,MAA4C;AAAA,EAA5C;AACH,SAAiB,UAAU,IAAI,OAAO,oBAAoB;AAC1D,SAAQ,QAAgC,CAAC;AAAA;AAAA,EAElC,QAAc;AACjB,SAAK,QAAQ,OAAO,OAAO;AAC3B,SAAK,QAAQ,CAAC;AAAA,EAClB;AAAA,EAEO,QAAQ,KAAqB;AAChC,SAAK,QAAQ,OAAO,YAAY,GAAG,IAAI;AACvC,WAAO,KAAK,MAAM,GAAG;AAAA,EACzB;AAAA,EAEO,QAAQ,KAAa,OAAqB;AAC7C,SAAK,QAAQ,OAAO,YAAY,GAAG,IAAI;AACvC,SAAK,MAAM,GAAG,IAAI;AAAA,EACtB;AAAA,EAEO,WAAW,KAAmB;AACjC,SAAK,QAAQ,OAAO,eAAe,GAAG,IAAI;AAC1C,WAAO,KAAK,MAAM,GAAG;AAAA,EACzB;AAAA,EAEA,IAAW,SAAiB;AACxB,WAAO,OAAO,oBAAoB,KAAK,KAAK,EAAE;AAAA,EAClD;AAAA,EAEO,IAAI,OAAuB;AAC9B,WAAO,OAAO,oBAAoB,KAAK,KAAK,EAAE,KAAK;AAAA,EACvD;AACJ;;;ACvCO,IAAM,iBAAN,cAA6B,MAAM;AAAA,EAK/B,YAAY,OAAe,SAAkB;AAChD,UAAM,OAAO;AAJjB;AAAA,SAAgB,OAAe;AAK3B,SAAK,QAAQ;AAAA,EACjB;AACJ;;;AC2BO,IAAM,cAAN,MAAkB;AAAA,EAKd,YACH,yBAAmC,CAAC,GAC5B,cAAiC,MACjC,gBAA6C,CAAC,GACxD;AAFU;AACA;AAPZ,SAAiB,UAAU,IAAI,OAAO,aAAa;AAEnD,SAAQ,gBAA0B,CAAC;AAO/B,SAAK,cAAc,KAAK,GAAG,wBAAwB,kBAAkB;AACrE,QAAI,aAAa;AACb,WAAK,cAAc,KAAK,iBAAiB;AAAA,IAC7C;AAAA,EACJ;AAAA,EAEA,MAAgB,iBAAiB,OAAoB,OAAoD,CAAC,GAAG;AACzG,UAAM,EAAE,kBAAkB,GAAG,UAAU,IAAI;AAC3C,QAAI,CAAC,kBAAkB;AACnB,aAAO,MAAM,MAAM,OAAO,SAAS;AAAA,IACvC;AAEA,UAAM,aAAa,IAAI,gBAAgB;AACvC,UAAM,YAAY,WAAW,MAAM,WAAW,MAAM,GAAG,mBAAmB,GAAI;AAE9E,QAAI;AACA,YAAM,WAAW,MAAM,MAAM,OAAO;AAAA,QAChC,GAAG;AAAA,QACH,QAAQ,WAAW;AAAA,MACvB,CAAC;AACD,aAAO;AAAA,IACX,SACO,KAAK;AACR,UAAI,eAAe,gBAAgB,IAAI,SAAS,cAAc;AAC1D,cAAM,IAAI,aAAa,mBAAmB;AAAA,MAC9C;AACA,YAAM;AAAA,IACV,UACA;AACI,mBAAa,SAAS;AAAA,IAC1B;AAAA,EACJ;AAAA,EAEA,MAAa,QAAQ,KAAa;AAAA,IAC9B;AAAA,IACA;AAAA,IACA;AAAA,EACJ,IAAiB,CAAC,GAAqC;AACnD,UAAMC,UAAS,KAAK,QAAQ,OAAO,SAAS;AAC5C,UAAM,UAAuB;AAAA,MACzB,UAAU,KAAK,cAAc,KAAK,IAAI;AAAA,IAC1C;AACA,QAAI,OAAO;AACP,MAAAA,QAAO,MAAM,4CAA4C;AACzD,cAAQ,eAAe,IAAI,YAAY;AAAA,IAC3C;AAEA,SAAK,mBAAmB,OAAO;AAE/B,QAAI;AACJ,QAAI;AACA,MAAAA,QAAO,MAAM,QAAQ,GAAG;AACxB,iBAAW,MAAM,KAAK,iBAAiB,KAAK,EAAE,QAAQ,OAAO,SAAS,kBAAkB,YAAY,CAAC;AAAA,IACzG,SACO,KAAK;AACR,MAAAA,QAAO,MAAM,eAAe;AAC5B,YAAM;AAAA,IACV;AAEA,IAAAA,QAAO,MAAM,kCAAkC,SAAS,MAAM;AAC9D,UAAM,cAAc,SAAS,QAAQ,IAAI,cAAc;AACvD,QAAI,eAAe,CAAC,KAAK,cAAc,KAAK,UAAQ,YAAY,WAAW,IAAI,CAAC,GAAG;AAC/E,MAAAA,QAAO,MAAM,IAAI,MAAM,kCAAmC,oCAAe,WAAY,eAAe,GAAG,EAAE,CAAC;AAAA,IAC9G;AACA,QAAI,SAAS,MAAM,KAAK,gBAAe,2CAAa,WAAW,qBAAoB;AAC/E,aAAO,MAAM,KAAK,YAAY,MAAM,SAAS,KAAK,CAAC;AAAA,IACvD;AACA,QAAI;AACJ,QAAI;AACA,aAAO,MAAM,SAAS,KAAK;AAAA,IAC/B,SACO,KAAK;AACR,MAAAA,QAAO,MAAM,+BAA+B,GAAG;AAC/C,UAAI,SAAS,GAAI,OAAM;AACvB,YAAM,IAAI,MAAM,GAAG,SAAS,UAAU,KAAK,SAAS,MAAM,GAAG;AAAA,IACjE;AACA,QAAI,CAAC,SAAS,IAAI;AACd,MAAAA,QAAO,MAAM,sBAAsB,IAAI;AACvC,UAAI,KAAK,OAAO;AACZ,cAAM,IAAI,cAAc,IAAI;AAAA,MAChC;AACA,YAAM,IAAI,MAAM,GAAG,SAAS,UAAU,KAAK,SAAS,MAAM,MAAM,KAAK,UAAU,IAAI,CAAC,EAAE;AAAA,IAC1F;AACA,WAAO;AAAA,EACX;AAAA,EAEA,MAAa,SAAS,KAAa;AAAA,IAC/B;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACJ,GAAmD;AAC/C,UAAMA,UAAS,KAAK,QAAQ,OAAO,UAAU;AAC7C,UAAM,UAAuB;AAAA,MACzB,UAAU,KAAK,cAAc,KAAK,IAAI;AAAA,MACtC,gBAAgB;AAAA,MAChB,GAAG;AAAA,IACP;AACA,QAAI,cAAc,QAAW;AACzB,cAAQ,eAAe,IAAI,WAAW;AAAA,IAC1C;AAEA,SAAK,mBAAmB,OAAO;AAE/B,QAAI;AACJ,QAAI;AACA,MAAAA,QAAO,MAAM,QAAQ,GAAG;AACxB,iBAAW,MAAM,KAAK,iBAAiB,KAAK,EAAE,QAAQ,QAAQ,SAAS,MAAM,kBAAkB,aAAa,gBAAgB,CAAC;AAAA,IACjI,SACO,KAAK;AACR,MAAAA,QAAO,MAAM,eAAe;AAC5B,YAAM;AAAA,IACV;AAEA,IAAAA,QAAO,MAAM,kCAAkC,SAAS,MAAM;AAC9D,UAAM,cAAc,SAAS,QAAQ,IAAI,cAAc;AACvD,QAAI,eAAe,CAAC,KAAK,cAAc,KAAK,UAAQ,YAAY,WAAW,IAAI,CAAC,GAAG;AAC/E,YAAM,IAAI,MAAM,kCAAmC,oCAAe,WAAY,eAAe,GAAG,EAAE;AAAA,IACtG;AAEA,UAAM,eAAe,MAAM,SAAS,KAAK;AAEzC,QAAI,OAAgC,CAAC;AACrC,QAAI,cAAc;AACd,UAAI;AACA,eAAO,KAAK,MAAM,YAAY;AAAA,MAClC,SACO,KAAK;AACR,QAAAA,QAAO,MAAM,+BAA+B,GAAG;AAC/C,YAAI,SAAS,GAAI,OAAM;AACvB,cAAM,IAAI,MAAM,GAAG,SAAS,UAAU,KAAK,SAAS,MAAM,GAAG;AAAA,MACjE;AAAA,IACJ;AAEA,QAAI,CAAC,SAAS,IAAI;AACd,MAAAA,QAAO,MAAM,sBAAsB,IAAI;AACvC,UAAI,SAAS,QAAQ,IAAI,YAAY,GAAG;AACpC,cAAM,QAAQ,SAAS,QAAQ,IAAI,YAAY;AAC/C,cAAM,IAAI,eAAe,OAAO,GAAG,KAAK,UAAU,IAAI,CAAC,EAAE;AAAA,MAC7D;AACA,UAAI,KAAK,OAAO;AACZ,cAAM,IAAI,cAAc,MAAM,IAAI;AAAA,MACtC;AACA,YAAM,IAAI,MAAM,GAAG,SAAS,UAAU,KAAK,SAAS,MAAM,MAAM,KAAK,UAAU,IAAI,CAAC,EAAE;AAAA,IAC1F;AAEA,WAAO;AAAA,EACX;AAAA,EAEQ,mBACJ,SACI;AACJ,UAAMA,UAAS,KAAK,QAAQ,OAAO,oBAAoB;AACvD,UAAM,aAAa,OAAO,KAAK,KAAK,aAAa;AACjD,UAAM,mBAAmB;AAAA,MACrB;AAAA,MACA;AAAA,MACA;AAAA,IACJ;AACA,QAAI,WAAW,WAAW,GAAG;AACzB;AAAA,IACJ;AACA,eAAW,QAAQ,CAAC,eAAe;AAC/B,UAAI,iBAAiB,SAAS,WAAW,kBAAkB,CAAC,GAAG;AAC3D,QAAAA,QAAO,KAAK,4CAA4C,YAAY,gBAAgB;AACpF;AAAA,MACJ;AACA,YAAM,UAAW,OAAO,KAAK,cAAc,UAAU,MAAM,aACtD,KAAK,cAAc,UAAU,EAAiB,IAC/C,KAAK,cAAc,UAAU;AACjC,UAAI,WAAW,YAAY,IAAI;AAC3B,gBAAQ,UAAU,IAAI;AAAA,MAC1B;AAAA,IACJ,CAAC;AAAA,EACL;AACJ;;;AClNO,IAAM,kBAAN,MAAsB;AAAA,EAUlB,YAA6B,WAAoC;AAApC;AATpC,SAAiB,UAAU,IAAI,OAAO,iBAAiB;AAKvD,SAAQ,eAAoC;AAC5C,SAAQ,YAA0C;AAI9C,SAAK,eAAe,KAAK,UAAU;AACnC,SAAK,eAAe,IAAI;AAAA,MACpB,CAAC,0BAA0B;AAAA,MAC3B;AAAA,MACA,KAAK,UAAU;AAAA,IACnB;AACA,QAAI,KAAK,UAAU,aAAa;AAC5B,WAAK,QAAQ,MAAM,iCAAiC;AACpD,WAAK,eAAe,KAAK,UAAU;AAAA,IACvC;AAEA,QAAI,KAAK,UAAU,UAAU;AACzB,WAAK,QAAQ,MAAM,8BAA8B;AACjD,WAAK,YAAY,KAAK,UAAU;AAAA,IACpC;AAEA,QAAI,KAAK,UAAU,yBAAyB;AACxC,WAAK,QAAQ,MAAM,6CAA6C;AAChE,WAAK,2BAA2B,KAAK,UAAU;AAAA,IACnD;AAAA,EACJ;AAAA,EAEO,mBAAyB;AAC5B,SAAK,eAAe;AAAA,EACxB;AAAA,EAEA,MAAa,cAA8C;AACvD,UAAMC,UAAS,KAAK,QAAQ,OAAO,aAAa;AAChD,QAAI,KAAK,WAAW;AAChB,MAAAA,QAAO,MAAM,qBAAqB;AAClC,aAAO,KAAK;AAAA,IAChB;AAEA,QAAI,CAAC,KAAK,cAAc;AACpB,MAAAA,QAAO,MAAM,IAAI,MAAM,oDAAoD,CAAC;AAC5E,YAAM;AAAA,IACV;AAEA,IAAAA,QAAO,MAAM,yBAAyB,KAAK,YAAY;AACvD,UAAM,WAAW,MAAM,KAAK,aAAa,QAAQ,KAAK,cAAc,EAAE,aAAa,KAAK,0BAA0B,kBAAkB,KAAK,UAAU,wBAAwB,CAAC;AAE5K,IAAAA,QAAO,MAAM,wCAAwC;AACrD,SAAK,YAAY,OAAO,OAAO,CAAC,GAAG,KAAK,UAAU,cAAc,QAAQ;AACxE,WAAO,KAAK;AAAA,EAChB;AAAA,EAEO,YAA6B;AAChC,WAAO,KAAK,qBAAqB,QAAQ;AAAA,EAC7C;AAAA,EAEO,2BAA4C;AAC/C,WAAO,KAAK,qBAAqB,wBAAwB;AAAA,EAC7D;AAAA,EAEO,sBAAuC;AAC1C,WAAO,KAAK,qBAAqB,mBAAmB;AAAA,EACxD;AAAA,EAIO,iBAAiB,WAAW,MAAmC;AAClE,WAAO,KAAK,qBAAqB,kBAAkB,QAAQ;AAAA,EAC/D;AAAA,EAEO,wBAAqD;AACxD,WAAO,KAAK,qBAAqB,wBAAwB,IAAI;AAAA,EACjE;AAAA,EAEO,wBAAqD;AACxD,WAAO,KAAK,qBAAqB,wBAAwB,IAAI;AAAA,EACjE;AAAA,EAIO,sBAAsB,WAAW,MAAmC;AACvE,WAAO,KAAK,qBAAqB,uBAAuB,QAAQ;AAAA,EACpE;AAAA,EAIO,gBAAgB,WAAW,MAAmC;AACjE,WAAO,KAAK,qBAAqB,YAAY,QAAQ;AAAA,EACzD;AAAA,EAEA,MAAgB,qBAAqB,MAA0B,WAAS,OAAyD;AAC7H,UAAMA,UAAS,KAAK,QAAQ,OAAO,yBAAyB,IAAI,IAAI;AAEpE,UAAM,WAAW,MAAM,KAAK,YAAY;AACxC,IAAAA,QAAO,MAAM,UAAU;AAEvB,QAAI,SAAS,IAAI,MAAM,QAAW;AAC9B,UAAI,aAAa,MAAM;AACnB,QAAAA,QAAO,KAAK,6CAA6C;AACzD,eAAO;AAAA,MACX;AAEA,MAAAA,QAAO,MAAM,IAAI,MAAM,wCAAwC,IAAI,CAAC;AAAA,IACxE;AAEA,WAAO,SAAS,IAAI;AAAA,EACxB;AAAA,EAEA,MAAa,iBAA+C;AACxD,UAAMA,UAAS,KAAK,QAAQ,OAAO,gBAAgB;AACnD,QAAI,KAAK,cAAc;AACnB,MAAAA,QAAO,MAAM,kCAAkC;AAC/C,aAAO,KAAK;AAAA,IAChB;AAEA,UAAM,WAAW,MAAM,KAAK,gBAAgB,KAAK;AACjD,IAAAA,QAAO,MAAM,gBAAgB,QAAQ;AAErC,UAAM,SAAS,MAAM,KAAK,aAAa,QAAQ,UAAU,EAAE,kBAAkB,KAAK,UAAU,wBAAwB,CAAC;AACrH,IAAAA,QAAO,MAAM,eAAe,MAAM;AAElC,QAAI,CAAC,MAAM,QAAQ,OAAO,IAAI,GAAG;AAC7B,MAAAA,QAAO,MAAM,IAAI,MAAM,wBAAwB,CAAC;AAChD,YAAM;AAAA,IACV;AAEA,SAAK,eAAe,OAAO;AAC3B,WAAO,KAAK;AAAA,EAChB;AACJ;;;ACxIO,IAAM,uBAAN,MAAiD;AAAA,EAM7C,YAAY;AAAA,IACf,SAAS;AAAA,IACT,QAAQ;AAAA,EACZ,IAAyD,CAAC,GAAG;AAR7D,SAAiB,UAAU,IAAI,OAAO,sBAAsB;AASxD,SAAK,SAAS;AACd,SAAK,UAAU;AAAA,EACnB;AAAA,EAEA,MAAa,IAAI,KAAa,OAA8B;AACxD,SAAK,QAAQ,OAAO,QAAQ,GAAG,IAAI;AAEnC,UAAM,KAAK,UAAU;AACrB,UAAM,KAAK,OAAO,QAAQ,KAAK,KAAK;AAAA,EACxC;AAAA,EAEA,MAAa,IAAI,KAAqC;AAClD,SAAK,QAAQ,OAAO,QAAQ,GAAG,IAAI;AAEnC,UAAM,KAAK,UAAU;AACrB,UAAM,OAAO,MAAM,KAAK,OAAO,QAAQ,GAAG;AAC1C,WAAO;AAAA,EACX;AAAA,EAEA,MAAa,OAAO,KAAqC;AACrD,SAAK,QAAQ,OAAO,WAAW,GAAG,IAAI;AAEtC,UAAM,KAAK,UAAU;AACrB,UAAM,OAAO,MAAM,KAAK,OAAO,QAAQ,GAAG;AAC1C,UAAM,KAAK,OAAO,WAAW,GAAG;AAChC,WAAO;AAAA,EACX;AAAA,EAEA,MAAa,aAAgC;AACzC,SAAK,QAAQ,OAAO,YAAY;AAChC,UAAM,MAAM,MAAM,KAAK,OAAO;AAE9B,UAAM,OAAO,CAAC;AACd,aAAS,QAAQ,GAAG,QAAQ,KAAK,SAAS;AACtC,YAAM,MAAM,MAAM,KAAK,OAAO,IAAI,KAAK;AACvC,UAAI,OAAO,IAAI,QAAQ,KAAK,OAAO,MAAM,GAAG;AACxC,aAAK,KAAK,IAAI,OAAO,KAAK,QAAQ,MAAM,CAAC;AAAA,MAC7C;AAAA,IACJ;AACA,WAAO;AAAA,EACX;AACJ;;;ACpDA,IAAM,sBAAsB;AAC5B,IAAM,eAAe;AACrB,IAAM,8BAA8B;AACpC,IAAM,gCAAgC,KAAK;AAiKpC,IAAM,0BAAN,MAA8B;AAAA,EA+C1B,YAAY;AAAA;AAAA,IAEf;AAAA,IAAW;AAAA,IAAa;AAAA,IAAU;AAAA,IAAa;AAAA;AAAA,IAE/C;AAAA,IAAW;AAAA,IAAe,gBAAgB;AAAA,IAAqB,QAAQ;AAAA,IACvE;AAAA,IAAc;AAAA,IACd,wBAAwB;AAAA;AAAA,IAExB;AAAA,IAAQ;AAAA,IAAS;AAAA,IAAS;AAAA,IAAY;AAAA,IAAY;AAAA,IAAU;AAAA;AAAA,IAE5D,uBAAuB;AAAA,IACvB,eAAe;AAAA,IACf;AAAA,IACA,yBAAyB;AAAA,IACzB,sBAAsB,EAAE,OAAO,UAAU;AAAA,IACzC,cAAc;AAAA;AAAA,IAEd;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA;AAAA,IAEA,mBAAmB,CAAC;AAAA,IACpB,mBAAmB,CAAC;AAAA,IACpB,eAAe,CAAC;AAAA,IAChB;AAAA,IACA,0BAA0B;AAAA,EAC9B,GAAuB;AAvP3B;AAyPQ,SAAK,YAAY;AAEjB,QAAI,aAAa;AACb,WAAK,cAAc;AAAA,IACvB,OAAO;AACH,WAAK,cAAc;AACnB,UAAI,WAAW;AACX,YAAI,CAAC,KAAK,YAAY,SAAS,GAAG,GAAG;AACjC,eAAK,eAAe;AAAA,QACxB;AACA,aAAK,eAAe;AAAA,MACxB;AAAA,IACJ;AAEA,SAAK,WAAW;AAChB,SAAK,eAAe;AACpB,SAAK,cAAc;AAEnB,SAAK,YAAY;AACjB,SAAK,gBAAgB;AACrB,SAAK,gBAAgB;AACrB,SAAK,QAAQ;AACb,SAAK,eAAe;AACpB,SAAK,2BAA2B;AAChC,SAAK,wBAAwB;AAE7B,SAAK,SAAS;AACd,SAAK,UAAU;AACf,SAAK,UAAU;AACf,SAAK,aAAa;AAClB,SAAK,aAAa;AAClB,SAAK,WAAW;AAChB,SAAK,gBAAgB;AAErB,SAAK,uBAAuB,sDAAwB;AACpD,SAAK,eAAe,CAAC,CAAC;AACtB,SAAK,yBAAyB;AAC9B,SAAK,sBAAsB;AAC3B,SAAK,0BAA0B;AAC/B,SAAK,cAAc,CAAC,CAAC;AACrB,SAAK,oCAAoC;AAEzC,SAAK,0BAA0B,0BAA0B,0BAA0B;AACnF,SAAK,0BAA0B;AAE/B,QAAI,YAAY;AACZ,WAAK,aAAa;AAAA,IACtB,OACK;AACD,YAAM,QAAQ,OAAO,WAAW,cAAc,OAAO,eAAe,IAAI,mBAAmB;AAC3F,WAAK,aAAa,IAAI,qBAAqB,EAAE,MAAM,CAAC;AAAA,IACxD;AAEA,SAAK,2BAA2B;AAEhC,SAAK,mBAAmB;AACxB,SAAK,mBAAmB;AACxB,SAAK,eAAe;AAEpB,SAAK,OAAO;AACZ,QAAI,KAAK,QAAQ,GAAC,UAAK,SAAL,mBAAW,QAAO;AAChC,YAAM,IAAI,MAAM,8CAA8C;AAAA,IAClE;AAAA,EACJ;AACJ;;;AC7SO,IAAM,kBAAN,MAAsB;AAAA,EAIlB,YAA6B,WACf,kBACnB;AAFkC;AACf;AAJrB,SAAmB,UAAU,IAAI,OAAO,iBAAiB;AAgCzD,SAAU,oBAAoB,OAAO,iBAA6C;AAC9E,YAAMC,UAAS,KAAK,QAAQ,OAAO,mBAAmB;AACtD,UAAI;AACA,cAAM,UAAU,SAAS,OAAO,YAAY;AAC5C,QAAAA,QAAO,MAAM,yBAAyB;AAEtC,eAAO;AAAA,MACX,SAAS,KAAK;AACV,QAAAA,QAAO,MAAM,4BAA4B;AACzC,cAAM;AAAA,MACV;AAAA,IACJ;AArCI,SAAK,eAAe,IAAI;AAAA,MACpB;AAAA,MACA,KAAK;AAAA,MACL,KAAK,UAAU;AAAA,IACnB;AAAA,EACJ;AAAA,EAEA,MAAa,UAAU,OAAmC;AACtD,UAAMA,UAAS,KAAK,QAAQ,OAAO,WAAW;AAC9C,QAAI,CAAC,OAAO;AACR,WAAK,QAAQ,MAAM,IAAI,MAAM,iBAAiB,CAAC;AAAA,IACnD;AAEA,UAAM,MAAM,MAAM,KAAK,iBAAiB,oBAAoB;AAC5D,IAAAA,QAAO,MAAM,oBAAoB,GAAG;AAEpC,UAAM,SAAS,MAAM,KAAK,aAAa,QAAQ,KAAK;AAAA,MAChD;AAAA,MACA,aAAa,KAAK,UAAU;AAAA,MAC5B,kBAAkB,KAAK,UAAU;AAAA,IACrC,CAAC;AACD,IAAAA,QAAO,MAAM,cAAc,MAAM;AAEjC,WAAO;AAAA,EACX;AAcJ;;;ACSO,IAAM,cAAN,MAAkB;AAAA,EAId,YACc,WACA,kBACnB;AAFmB;AACA;AALrB,SAAiB,UAAU,IAAI,OAAO,aAAa;AAO/C,SAAK,eAAe,IAAI;AAAA,MACpB,KAAK,UAAU;AAAA,MACf;AAAA,MACA,KAAK,UAAU;AAAA,IACnB;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAa,aAAa;AAAA,IACtB,aAAa;AAAA,IACb,eAAe,KAAK,UAAU;AAAA,IAC9B,YAAY,KAAK,UAAU;AAAA,IAC3B,gBAAgB,KAAK,UAAU;AAAA,IAC/B;AAAA,IACA,GAAG;AAAA,EACP,GAAuD;AACnD,UAAMC,UAAS,KAAK,QAAQ,OAAO,cAAc;AACjD,QAAI,CAAC,WAAW;AACZ,MAAAA,QAAO,MAAM,IAAI,MAAM,yBAAyB,CAAC;AAAA,IACrD;AACA,QAAI,CAAC,cAAc;AACf,MAAAA,QAAO,MAAM,IAAI,MAAM,4BAA4B,CAAC;AAAA,IACxD;AACA,QAAI,CAAC,KAAK,MAAM;AACZ,MAAAA,QAAO,MAAM,IAAI,MAAM,oBAAoB,CAAC;AAAA,IAChD;AAEA,UAAM,SAAS,IAAI,gBAAgB,EAAE,YAAY,aAAa,CAAC;AAC/D,eAAW,CAAC,KAAK,KAAK,KAAK,OAAO,QAAQ,IAAI,GAAG;AAC7C,UAAI,SAAS,MAAM;AACf,eAAO,IAAI,KAAK,KAAK;AAAA,MACzB;AAAA,IACJ;AACA,QAAI;AACJ,YAAQ,KAAK,UAAU,uBAAuB;AAAA,MAC1C,KAAK;AACD,YAAI,CAAC,eAAe;AAChB,UAAAA,QAAO,MAAM,IAAI,MAAM,6BAA6B,CAAC;AACrD,gBAAM;AAAA,QACV;AACA,oBAAY,YAAY,kBAAkB,WAAW,aAAa;AAClE;AAAA,MACJ,KAAK;AACD,eAAO,OAAO,aAAa,SAAS;AACpC,YAAI,eAAe;AACf,iBAAO,OAAO,iBAAiB,aAAa;AAAA,QAChD;AACA;AAAA,IACR;AAEA,UAAM,MAAM,MAAM,KAAK,iBAAiB,iBAAiB,KAAK;AAC9D,IAAAA,QAAO,MAAM,oBAAoB;AAEjC,UAAM,WAAW,MAAM,KAAK,aAAa,SAAS,KAAK;AAAA,MACnD,MAAM;AAAA,MACN;AAAA,MACA,kBAAkB,KAAK,UAAU;AAAA,MACjC,iBAAiB,KAAK,UAAU;AAAA,MAChC;AAAA,IACJ,CAAC;AAED,IAAAA,QAAO,MAAM,cAAc;AAE3B,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAa,oBAAoB;AAAA,IAC7B,aAAa;AAAA,IACb,YAAY,KAAK,UAAU;AAAA,IAC3B,gBAAgB,KAAK,UAAU;AAAA,IAC/B,QAAQ,KAAK,UAAU;AAAA,IACvB,GAAG;AAAA,EACP,GAA8D;AAC1D,UAAMA,UAAS,KAAK,QAAQ,OAAO,qBAAqB;AAExD,QAAI,CAAC,WAAW;AACZ,MAAAA,QAAO,MAAM,IAAI,MAAM,yBAAyB,CAAC;AAAA,IACrD;AAEA,UAAM,SAAS,IAAI,gBAAgB,EAAE,WAAW,CAAC;AACjD,QAAI,CAAC,KAAK,UAAU,yBAAyB;AACzC,aAAO,IAAI,SAAS,KAAK;AAAA,IAC7B;AACA,eAAW,CAAC,KAAK,KAAK,KAAK,OAAO,QAAQ,IAAI,GAAG;AAC7C,UAAI,SAAS,MAAM;AACf,eAAO,IAAI,KAAK,KAAK;AAAA,MACzB;AAAA,IACJ;AAEA,QAAI;AACJ,YAAQ,KAAK,UAAU,uBAAuB;AAAA,MAC1C,KAAK;AACD,YAAI,CAAC,eAAe;AAChB,UAAAA,QAAO,MAAM,IAAI,MAAM,6BAA6B,CAAC;AACrD,gBAAM;AAAA,QACV;AACA,oBAAY,YAAY,kBAAkB,WAAW,aAAa;AAClE;AAAA,MACJ,KAAK;AACD,eAAO,OAAO,aAAa,SAAS;AACpC,YAAI,eAAe;AACf,iBAAO,OAAO,iBAAiB,aAAa;AAAA,QAChD;AACA;AAAA,IACR;AAEA,UAAM,MAAM,MAAM,KAAK,iBAAiB,iBAAiB,KAAK;AAC9D,IAAAA,QAAO,MAAM,oBAAoB;AAEjC,UAAM,WAAW,MAAM,KAAK,aAAa,SAAS,KAAK,EAAE,MAAM,QAAQ,WAAW,kBAAkB,KAAK,UAAU,yBAAyB,iBAAiB,KAAK,UAAU,wBAAwB,CAAC;AACrM,IAAAA,QAAO,MAAM,cAAc;AAE3B,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAa,qBAAqB;AAAA,IAC9B,aAAa;AAAA,IACb,YAAY,KAAK,UAAU;AAAA,IAC3B,gBAAgB,KAAK,UAAU;AAAA,IAC/B;AAAA,IACA;AAAA,IACA,GAAG;AAAA,EACP,GAA+D;AAC3D,UAAMA,UAAS,KAAK,QAAQ,OAAO,sBAAsB;AACzD,QAAI,CAAC,WAAW;AACZ,MAAAA,QAAO,MAAM,IAAI,MAAM,yBAAyB,CAAC;AAAA,IACrD;AACA,QAAI,CAAC,KAAK,eAAe;AACrB,MAAAA,QAAO,MAAM,IAAI,MAAM,6BAA6B,CAAC;AAAA,IACzD;AAEA,UAAM,SAAS,IAAI,gBAAgB,EAAE,WAAW,CAAC;AACjD,eAAW,CAAC,KAAK,KAAK,KAAK,OAAO,QAAQ,IAAI,GAAG;AAC7C,UAAI,MAAM,QAAQ,KAAK,GAAG;AACtB,cAAM,QAAQ,WAAS,OAAO,OAAO,KAAK,KAAK,CAAC;AAAA,MACpD,WACS,SAAS,MAAM;AACpB,eAAO,IAAI,KAAK,KAAK;AAAA,MACzB;AAAA,IACJ;AACA,QAAI;AACJ,YAAQ,KAAK,UAAU,uBAAuB;AAAA,MAC1C,KAAK;AACD,YAAI,CAAC,eAAe;AAChB,UAAAA,QAAO,MAAM,IAAI,MAAM,6BAA6B,CAAC;AACrD,gBAAM;AAAA,QACV;AACA,oBAAY,YAAY,kBAAkB,WAAW,aAAa;AAClE;AAAA,MACJ,KAAK;AACD,eAAO,OAAO,aAAa,SAAS;AACpC,YAAI,eAAe;AACf,iBAAO,OAAO,iBAAiB,aAAa;AAAA,QAChD;AACA;AAAA,IACR;AAEA,UAAM,MAAM,MAAM,KAAK,iBAAiB,iBAAiB,KAAK;AAC9D,IAAAA,QAAO,MAAM,oBAAoB;AAEjC,UAAM,WAAW,MAAM,KAAK,aAAa,SAAS,KAAK,EAAE,MAAM,QAAQ,WAAW,kBAAkB,iBAAiB,KAAK,UAAU,yBAAyB,aAAa,CAAC;AAC3K,IAAAA,QAAO,MAAM,cAAc;AAE3B,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAa,OAAO,MAAiC;AAnQzD;AAoQQ,UAAMA,UAAS,KAAK,QAAQ,OAAO,QAAQ;AAC3C,QAAI,CAAC,KAAK,OAAO;AACb,MAAAA,QAAO,MAAM,IAAI,MAAM,qBAAqB,CAAC;AAAA,IACjD;AAEA,UAAM,MAAM,MAAM,KAAK,iBAAiB,sBAAsB,KAAK;AAEnE,IAAAA,QAAO,MAAM,sCAAqC,UAAK,oBAAL,YAAwB,oBAAoB,EAAE;AAEhG,UAAM,SAAS,IAAI,gBAAgB;AACnC,eAAW,CAAC,KAAK,KAAK,KAAK,OAAO,QAAQ,IAAI,GAAG;AAC7C,UAAI,SAAS,MAAM;AACf,eAAO,IAAI,KAAK,KAAK;AAAA,MACzB;AAAA,IACJ;AACA,WAAO,IAAI,aAAa,KAAK,UAAU,SAAS;AAChD,QAAI,KAAK,UAAU,eAAe;AAC9B,aAAO,IAAI,iBAAiB,KAAK,UAAU,aAAa;AAAA,IAC5D;AAEA,UAAM,KAAK,aAAa,SAAS,KAAK,EAAE,MAAM,QAAQ,kBAAkB,KAAK,UAAU,wBAAwB,CAAC;AAChH,IAAAA,QAAO,MAAM,cAAc;AAAA,EAC/B;AACJ;;;ACtQO,IAAM,oBAAN,MAAwB;AAAA,EAKpB,YACgB,WACA,kBACA,gBACrB;AAHqB;AACA;AACA;AAPvB,SAAmB,UAAU,IAAI,OAAO,mBAAmB;AASvD,SAAK,mBAAmB,IAAI,gBAAgB,KAAK,WAAW,KAAK,gBAAgB;AACjF,SAAK,eAAe,IAAI,YAAY,KAAK,WAAW,KAAK,gBAAgB;AAAA,EAC7E;AAAA,EAEA,MAAa,uBAAuB,UAA0B,OAAoB,cAA2D;AACzI,UAAMC,UAAS,KAAK,QAAQ,OAAO,wBAAwB;AAE3D,SAAK,oBAAoB,UAAU,KAAK;AACxC,IAAAA,QAAO,MAAM,iBAAiB;AAE9B,UAAM,KAAK,aAAa,UAAU,OAAO,YAAY;AACrD,IAAAA,QAAO,MAAM,gBAAgB;AAE7B,QAAI,SAAS,UAAU;AACnB,WAAK,2BAA2B,QAAQ;AAAA,IAC5C;AACA,IAAAA,QAAO,MAAM,kBAAkB;AAE/B,UAAM,KAAK,eAAe,UAAU,+BAAO,cAAc,SAAS,QAAQ;AAC1E,IAAAA,QAAO,MAAM,kBAAkB;AAAA,EACnC;AAAA,EAEA,MAAa,4BAA4B,UAA0B,cAAsC;AACrG,UAAMA,UAAS,KAAK,QAAQ,OAAO,6BAA6B;AAEhE,QAAI,SAAS,YAAY,CAAC,CAAC,SAAS,UAAU;AAC1C,WAAK,2BAA2B,QAAQ;AAAA,IAC5C;AACA,IAAAA,QAAO,MAAM,kBAAkB;AAE/B,UAAM,KAAK,eAAe,UAAU,cAAc,SAAS,QAAQ;AACnE,IAAAA,QAAO,MAAM,kBAAkB;AAAA,EACnC;AAAA,EAEA,MAAa,wBAAwB,UAA0B,OAAoC;AAjEvG;AAkEQ,UAAMA,UAAS,KAAK,QAAQ,OAAO,yBAAyB;AAE5D,aAAS,YAAY,MAAM;AAE3B,mBAAS,kBAAT,qBAAS,gBAAkB,MAAM;AAEjC,mBAAS,UAAT,qBAAS,QAAU,MAAM;AAIzB,QAAI,SAAS,YAAY,CAAC,CAAC,SAAS,UAAU;AAC1C,WAAK,2BAA2B,UAAU,MAAM,QAAQ;AACxD,MAAAA,QAAO,MAAM,oBAAoB;AAAA,IACrC;AAEA,QAAI,CAAC,SAAS,UAAU;AAEpB,eAAS,WAAW,MAAM;AAE1B,eAAS,UAAU,MAAM;AAAA,IAC7B;AAEA,UAAM,aAAa,SAAS,YAAY,CAAC,CAAC,SAAS;AACnD,UAAM,KAAK,eAAe,UAAU,OAAO,UAAU;AACrD,IAAAA,QAAO,MAAM,kBAAkB;AAAA,EACnC;AAAA,EAEO,wBAAwB,UAA2B,OAAoB;AAC1E,UAAMA,UAAS,KAAK,QAAQ,OAAO,yBAAyB;AAC5D,QAAI,MAAM,OAAO,SAAS,OAAO;AAC7B,MAAAA,QAAO,MAAM,IAAI,MAAM,sBAAsB,CAAC;AAAA,IAClD;AAKA,IAAAA,QAAO,MAAM,iBAAiB;AAC9B,aAAS,YAAY,MAAM;AAE3B,QAAI,SAAS,OAAO;AAChB,MAAAA,QAAO,KAAK,sBAAsB,SAAS,KAAK;AAChD,YAAM,IAAI,cAAc,QAAQ;AAAA,IACpC;AAAA,EACJ;AAAA,EAEU,oBAAoB,UAA0B,OAA0B;AA/GtF;AAgHQ,UAAMA,UAAS,KAAK,QAAQ,OAAO,qBAAqB;AACxD,QAAI,MAAM,OAAO,SAAS,OAAO;AAC7B,MAAAA,QAAO,MAAM,IAAI,MAAM,sBAAsB,CAAC;AAAA,IAClD;AAEA,QAAI,CAAC,MAAM,WAAW;AAClB,MAAAA,QAAO,MAAM,IAAI,MAAM,uBAAuB,CAAC;AAAA,IACnD;AAEA,QAAI,CAAC,MAAM,WAAW;AAClB,MAAAA,QAAO,MAAM,IAAI,MAAM,uBAAuB,CAAC;AAAA,IACnD;AAGA,QAAI,KAAK,UAAU,cAAc,MAAM,WAAW;AAC9C,MAAAA,QAAO,MAAM,IAAI,MAAM,iDAAiD,CAAC;AAAA,IAC7E;AACA,QAAI,KAAK,UAAU,aAAa,KAAK,UAAU,cAAc,MAAM,WAAW;AAC1E,MAAAA,QAAO,MAAM,IAAI,MAAM,iDAAiD,CAAC;AAAA,IAC7E;AAKA,IAAAA,QAAO,MAAM,iBAAiB;AAC9B,aAAS,YAAY,MAAM;AAC3B,aAAS,YAAY,MAAM;AAE3B,mBAAS,UAAT,qBAAS,QAAU,MAAM;AAEzB,QAAI,SAAS,OAAO;AAChB,MAAAA,QAAO,KAAK,sBAAsB,SAAS,KAAK;AAChD,YAAM,IAAI,cAAc,QAAQ;AAAA,IACpC;AAEA,QAAI,MAAM,iBAAiB,CAAC,SAAS,MAAM;AACvC,MAAAA,QAAO,MAAM,IAAI,MAAM,2BAA2B,CAAC;AAAA,IACvD;AAAA,EAEJ;AAAA,EAEA,MAAgB,eAAe,UAA0B,eAAe,OAAO,cAAc,MAAqB;AAC9G,UAAMA,UAAS,KAAK,QAAQ,OAAO,gBAAgB;AACnD,aAAS,UAAU,KAAK,eAAe,qBAAqB,SAAS,OAAO;AAE5E,QAAI,gBAAgB,CAAC,KAAK,UAAU,gBAAgB,CAAC,SAAS,cAAc;AACxE,MAAAA,QAAO,MAAM,uBAAuB;AACpC;AAAA,IACJ;AAEA,IAAAA,QAAO,MAAM,mBAAmB;AAChC,UAAM,SAAS,MAAM,KAAK,iBAAiB,UAAU,SAAS,YAAY;AAC1E,IAAAA,QAAO,MAAM,mDAAmD;AAEhE,QAAI,eAAe,OAAO,QAAQ,SAAS,QAAQ,KAAK;AACpD,MAAAA,QAAO,MAAM,IAAI,MAAM,mEAAmE,CAAC;AAAA,IAC/F;AAEA,aAAS,UAAU,KAAK,eAAe,YAAY,SAAS,SAAS,KAAK,eAAe,qBAAqB,MAAuB,CAAC;AACtI,IAAAA,QAAO,MAAM,+CAA+C,SAAS,OAAO;AAAA,EAChF;AAAA,EAEA,MAAgB,aAAa,UAA0B,OAAoB,cAA2D;AAClI,UAAMA,UAAS,KAAK,QAAQ,OAAO,cAAc;AACjD,QAAI,SAAS,MAAM;AACf,MAAAA,QAAO,MAAM,iBAAiB;AAC9B,YAAM,gBAAgB,MAAM,KAAK,aAAa,aAAa;AAAA,QACvD,WAAW,MAAM;AAAA,QACjB,eAAe,MAAM;AAAA,QACrB,MAAM,SAAS;AAAA,QACf,cAAc,MAAM;AAAA,QACpB,eAAe,MAAM;AAAA,QACrB;AAAA,QACA,GAAG,MAAM;AAAA,MACb,CAAC;AACD,aAAO,OAAO,UAAU,aAAa;AAAA,IACzC,OAAO;AACH,MAAAA,QAAO,MAAM,oBAAoB;AAAA,IACrC;AAAA,EACJ;AAAA,EAEU,2BAA2B,UAA0B,eAA8B;AAjMjG;AAkMQ,UAAMA,UAAS,KAAK,QAAQ,OAAO,4BAA4B;AAE/D,IAAAA,QAAO,MAAM,uBAAuB;AACpC,UAAM,WAAW,SAAS,QAAO,cAAS,aAAT,YAAqB,EAAE;AAExD,QAAI,CAAC,SAAS,KAAK;AACf,MAAAA,QAAO,MAAM,IAAI,MAAM,qCAAqC,CAAC;AAAA,IACjE;AAEA,QAAI,eAAe;AACf,YAAM,WAAW,SAAS,OAAO,aAAa;AAC9C,UAAI,SAAS,QAAQ,SAAS,KAAK;AAC/B,QAAAA,QAAO,MAAM,IAAI,MAAM,4CAA4C,CAAC;AAAA,MACxE;AACA,UAAI,SAAS,aAAa,SAAS,cAAc,SAAS,WAAW;AACjE,QAAAA,QAAO,MAAM,IAAI,MAAM,yDAAyD,CAAC;AAAA,MACrF;AACA,UAAI,SAAS,OAAO,SAAS,QAAQ,SAAS,KAAK;AAC/C,QAAAA,QAAO,MAAM,IAAI,MAAM,6CAA6C,CAAC;AAAA,MACzE;AACA,UAAI,CAAC,SAAS,OAAO,SAAS,KAAK;AAC/B,QAAAA,QAAO,MAAM,IAAI,MAAM,uDAAuD,CAAC;AAAA,MACnF;AAAA,IACJ;AAEA,aAAS,UAAU;AAAA,EACvB;AACJ;;;ACpNO,IAAM,QAAN,MAAM,OAAM;AAAA,EASR,YAAY,MAMhB;AACC,SAAK,KAAK,KAAK,MAAM,YAAY,eAAe;AAChD,SAAK,OAAO,KAAK;AAEjB,QAAI,KAAK,WAAW,KAAK,UAAU,GAAG;AAClC,WAAK,UAAU,KAAK;AAAA,IACxB,OACK;AACD,WAAK,UAAU,MAAM,aAAa;AAAA,IACtC;AACA,SAAK,eAAe,KAAK;AACzB,SAAK,YAAY,KAAK;AAAA,EAC1B;AAAA,EAEO,kBAA0B;AAC7B,QAAI,OAAO,OAAO,EAAE,OAAO,iBAAiB;AAC5C,WAAO,KAAK,UAAU;AAAA,MAClB,IAAI,KAAK;AAAA,MACT,MAAM,KAAK;AAAA,MACX,SAAS,KAAK;AAAA,MACd,cAAc,KAAK;AAAA,MACnB,WAAW,KAAK;AAAA,IACpB,CAAC;AAAA,EACL;AAAA,EAEA,OAAc,kBAAkB,eAAuC;AACnE,WAAO,aAAa,SAAS,mBAAmB;AAChD,WAAO,QAAQ,QAAQ,IAAI,OAAM,KAAK,MAAM,aAAa,CAAC,CAAC;AAAA,EAC/D;AAAA,EAEA,aAAoB,gBAAgB,SAAqB,KAA4B;AACjF,UAAMC,UAAS,OAAO,aAAa,SAAS,iBAAiB;AAC7D,UAAM,SAAS,MAAM,aAAa,IAAI;AAEtC,UAAM,OAAO,MAAM,QAAQ,WAAW;AACtC,IAAAA,QAAO,MAAM,YAAY,IAAI;AAE7B,aAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AAClC,YAAM,MAAM,KAAK,CAAC;AAClB,YAAM,OAAO,MAAM,QAAQ,IAAI,GAAG;AAClC,UAAI,SAAS;AAEb,UAAI,MAAM;AACN,YAAI;AACA,gBAAM,QAAQ,MAAM,OAAM,kBAAkB,IAAI;AAEhD,UAAAA,QAAO,MAAM,sBAAsB,KAAK,MAAM,OAAO;AACrD,cAAI,MAAM,WAAW,QAAQ;AACzB,qBAAS;AAAA,UACb;AAAA,QACJ,SACO,KAAK;AACR,UAAAA,QAAO,MAAM,gCAAgC,KAAK,GAAG;AACrD,mBAAS;AAAA,QACb;AAAA,MACJ,OACK;AACD,QAAAA,QAAO,MAAM,+BAA+B,GAAG;AAC/C,iBAAS;AAAA,MACb;AAEA,UAAI,QAAQ;AACR,QAAAA,QAAO,MAAM,yBAAyB,GAAG;AACzC,aAAK,QAAQ,OAAO,GAAG;AAAA,MAC3B;AAAA,IACJ;AAAA,EACJ;AACJ;;;ACzDO,IAAM,cAAN,MAAM,qBAAoB,MAAM;AAAA,EAyB3B,YAAY,MAAuB;AACvC,UAAM,IAAI;AAEV,SAAK,gBAAgB,KAAK;AAC1B,SAAK,iBAAiB,KAAK;AAC3B,SAAK,YAAY,KAAK;AACtB,SAAK,YAAY,KAAK;AACtB,SAAK,eAAe,KAAK;AACzB,SAAK,QAAQ,KAAK;AAClB,SAAK,gBAAgB,KAAK;AAC1B,SAAK,mBAAmB,KAAK;AAE7B,SAAK,gBAAgB,KAAK;AAC1B,SAAK,eAAe,KAAK;AAAA,EAC7B;AAAA,EAEA,aAAoB,OAAO,MAAmD;AAC1E,UAAM,gBAAgB,KAAK,kBAAkB,OAAO,YAAY,qBAAqB,IAAK,KAAK,iBAAiB;AAChH,UAAM,iBAAiB,gBAAiB,MAAM,YAAY,sBAAsB,aAAa,IAAK;AAElG,WAAO,IAAI,aAAY;AAAA,MACnB,GAAG;AAAA,MACH;AAAA,MACA;AAAA,IACJ,CAAC;AAAA,EACL;AAAA,EAEO,kBAA0B;AAC7B,QAAI,OAAO,aAAa,EAAE,OAAO,iBAAiB;AAClD,WAAO,KAAK,UAAU;AAAA,MAClB,IAAI,KAAK;AAAA,MACT,MAAM,KAAK;AAAA,MACX,SAAS,KAAK;AAAA,MACd,cAAc,KAAK;AAAA,MACnB,WAAW,KAAK;AAAA,MAEhB,eAAe,KAAK;AAAA,MACpB,WAAW,KAAK;AAAA,MAChB,WAAW,KAAK;AAAA,MAChB,cAAc,KAAK;AAAA,MACnB,OAAO,KAAK;AAAA,MACZ,eAAe,KAAK;AAAA,MACpB,kBAAmB,KAAK;AAAA,MACxB,eAAe,KAAK;AAAA,MACpB,cAAc,KAAK;AAAA,IACvB,CAAC;AAAA,EACL;AAAA,EAEA,OAAc,kBAAkB,eAA6C;AACzE,WAAO,aAAa,eAAe,mBAAmB;AACtD,UAAM,OAAO,KAAK,MAAM,aAAa;AACrC,WAAO,aAAY,OAAO,IAAI;AAAA,EAClC;AACJ;;;AC5DO,IAAM,iBAAN,MAAM,eAAc;AAAA,EAMf,YAAY,MAGjB;AACC,SAAK,MAAM,KAAK;AAChB,SAAK,QAAQ,KAAK;AAAA,EACtB;AAAA,EAEA,aAAoB,OAAO;AAAA;AAAA,IAEvB;AAAA,IAAK;AAAA,IAAW;AAAA,IAAW;AAAA,IAAc;AAAA,IAAe;AAAA;AAAA,IAExD;AAAA,IAAY;AAAA,IAAe;AAAA,IAAc;AAAA,IAAe;AAAA,IAAO;AAAA,IAC/D;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,GAAG;AAAA,EACP,GAAoD;AAChD,QAAI,CAAC,KAAK;AACN,WAAK,QAAQ,MAAM,uBAAuB;AAC1C,YAAM,IAAI,MAAM,KAAK;AAAA,IACzB;AACA,QAAI,CAAC,WAAW;AACZ,WAAK,QAAQ,MAAM,6BAA6B;AAChD,YAAM,IAAI,MAAM,WAAW;AAAA,IAC/B;AACA,QAAI,CAAC,cAAc;AACf,WAAK,QAAQ,MAAM,gCAAgC;AACnD,YAAM,IAAI,MAAM,cAAc;AAAA,IAClC;AACA,QAAI,CAAC,eAAe;AAChB,WAAK,QAAQ,MAAM,iCAAiC;AACpD,YAAM,IAAI,MAAM,eAAe;AAAA,IACnC;AACA,QAAI,CAAC,OAAO;AACR,WAAK,QAAQ,MAAM,yBAAyB;AAC5C,YAAM,IAAI,MAAM,OAAO;AAAA,IAC3B;AACA,QAAI,CAAC,WAAW;AACZ,WAAK,QAAQ,MAAM,6BAA6B;AAChD,YAAM,IAAI,MAAM,WAAW;AAAA,IAC/B;AAEA,UAAM,QAAQ,MAAM,YAAY,OAAO;AAAA,MACnC,MAAM;AAAA,MACN;AAAA,MACA;AAAA,MACA,eAAe,CAAC;AAAA,MAChB;AAAA,MAAW;AAAA,MAAW;AAAA,MACtB;AAAA,MACA;AAAA,MAAe;AAAA,MAAO;AAAA,MACtB;AAAA,IACJ,CAAC;AAED,UAAM,YAAY,IAAI,IAAI,GAAG;AAC7B,cAAU,aAAa,OAAO,aAAa,SAAS;AACpD,cAAU,aAAa,OAAO,gBAAgB,YAAY;AAC1D,cAAU,aAAa,OAAO,iBAAiB,aAAa;AAC5D,QAAI,CAAC,yBAAyB;AAC1B,gBAAU,aAAa,OAAO,SAAS,KAAK;AAAA,IAChD;AACA,QAAI,OAAO;AACP,gBAAU,aAAa,OAAO,SAAS,KAAK;AAAA,IAChD;AAEA,QAAI,SAAS;AACT,gBAAU,aAAa,OAAO,YAAY,OAAO;AAAA,IACrD;AAEA,QAAI,aAAa,MAAM;AACvB,QAAI,WAAW;AACX,mBAAa,GAAG,UAAU,GAAG,mBAAmB,GAAG,SAAS;AAAA,IAChE;AACA,cAAU,aAAa,OAAO,SAAS,UAAU;AACjD,QAAI,MAAM,gBAAgB;AACtB,gBAAU,aAAa,OAAO,kBAAkB,MAAM,cAAc;AACpE,gBAAU,aAAa,OAAO,yBAAyB,MAAM;AAAA,IACjE;AAEA,QAAI,UAAU;AAEV,YAAM,YAAY,MAAM,QAAQ,QAAQ,IAAI,WAAW,CAAC,QAAQ;AAChE,gBACK,QAAQ,OAAK,UAAU,aAAa,OAAO,YAAY,CAAC,CAAC;AAAA,IAClE;AAEA,eAAW,CAAC,KAAK,KAAK,KAAK,OAAO,QAAQ,EAAE,eAAe,GAAG,gBAAgB,GAAG,iBAAiB,CAAC,GAAG;AAClG,UAAI,SAAS,MAAM;AACf,kBAAU,aAAa,OAAO,KAAK,MAAM,SAAS,CAAC;AAAA,MACvD;AAAA,IACJ;AAEA,WAAO,IAAI,eAAc;AAAA,MACrB,KAAK,UAAU;AAAA,MACf;AAAA,IACJ,CAAC;AAAA,EACL;AACJ;AA3Ga,eACe,UAAU,IAAI,OAAO,eAAe;AADzD,IAAM,gBAAN;;;AC9CP,IAAM,YAAY;AAOX,IAAM,iBAAN,MAAqB;AAAA,EAsCjB,YAAY,QAAyB;AAjB5C;AAAA,SAAO,eAAe;AAEtB;AAAA,SAAO,aAAa;AAapB;AAAA,SAAO,UAAuB,CAAC;AAG3B,SAAK,QAAQ,OAAO,IAAI,OAAO;AAC/B,SAAK,gBAAgB,OAAO,IAAI,eAAe;AAC/C,QAAI,KAAK,OAAO;AACZ,YAAM,aAAa,mBAAmB,KAAK,KAAK,EAAE,MAAM,mBAAmB;AAC3E,WAAK,QAAQ,WAAW,CAAC;AACzB,UAAI,WAAW,SAAS,GAAG;AACvB,aAAK,YAAY,WAAW,MAAM,CAAC,EAAE,KAAK,mBAAmB;AAAA,MACjE;AAAA,IACJ;AAEA,SAAK,QAAQ,OAAO,IAAI,OAAO;AAC/B,SAAK,oBAAoB,OAAO,IAAI,mBAAmB;AACvD,SAAK,YAAY,OAAO,IAAI,WAAW;AAEvC,SAAK,OAAO,OAAO,IAAI,MAAM;AAAA,EACjC;AAAA,EAEA,IAAW,aAAiC;AACxC,QAAI,KAAK,eAAe,QAAW;AAC/B,aAAO;AAAA,IACX;AACA,WAAO,KAAK,aAAa,MAAM,aAAa;AAAA,EAChD;AAAA,EACA,IAAW,WAAW,OAA2B;AAE7C,QAAI,OAAO,UAAU,SAAU,SAAQ,OAAO,KAAK;AACnD,QAAI,UAAU,UAAa,SAAS,GAAG;AACnC,WAAK,aAAa,KAAK,MAAM,KAAK,IAAI,MAAM,aAAa;AAAA,IAC7D;AAAA,EACJ;AAAA,EAEA,IAAW,WAAoB;AAnFnC;AAoFQ,aAAO,UAAK,UAAL,mBAAY,MAAM,KAAK,SAAS,eAAc,CAAC,CAAC,KAAK;AAAA,EAChE;AACJ;;;ACzDO,IAAM,iBAAN,MAAqB;AAAA,EAMjB,YAAY;AAAA,IACf;AAAA,IACA;AAAA,IAAY;AAAA,IAAe;AAAA,IAA0B;AAAA,IAAkB;AAAA,IAAc;AAAA,EACzF,GAAuB;AARvB,SAAiB,UAAU,IAAI,OAAO,gBAAgB;AASlD,QAAI,CAAC,KAAK;AACN,WAAK,QAAQ,MAAM,qBAAqB;AACxC,YAAM,IAAI,MAAM,KAAK;AAAA,IACzB;AAEA,UAAM,YAAY,IAAI,IAAI,GAAG;AAC7B,QAAI,eAAe;AACf,gBAAU,aAAa,OAAO,iBAAiB,aAAa;AAAA,IAChE;AACA,QAAI,WAAW;AACX,gBAAU,aAAa,OAAO,aAAa,SAAS;AAAA,IACxD;AAEA,QAAI,0BAA0B;AAC1B,gBAAU,aAAa,OAAO,4BAA4B,wBAAwB;AAElF,UAAI,YAAY;AACZ,aAAK,QAAQ,IAAI,MAAM,EAAE,MAAM,YAAY,aAAa,CAAC;AAEzD,kBAAU,aAAa,OAAO,SAAS,KAAK,MAAM,EAAE;AAAA,MACxD;AAAA,IACJ;AAEA,eAAW,CAAC,KAAK,KAAK,KAAK,OAAO,QAAQ,EAAE,GAAG,iBAAiB,CAAC,GAAG;AAChE,UAAI,SAAS,MAAM;AACf,kBAAU,aAAa,OAAO,KAAK,MAAM,SAAS,CAAC;AAAA,MACvD;AAAA,IACJ;AAEA,SAAK,MAAM,UAAU;AAAA,EACzB;AACJ;;;AC/DO,IAAM,kBAAN,MAAsB;AAAA,EAclB,YAAY,QAAyB;AACxC,SAAK,QAAQ,OAAO,IAAI,OAAO;AAE/B,SAAK,QAAQ,OAAO,IAAI,OAAO;AAC/B,SAAK,oBAAoB,OAAO,IAAI,mBAAmB;AACvD,SAAK,YAAY,OAAO,IAAI,WAAW;AAAA,EAC3C;AACJ;;;ACXA,IAAM,wBAAwB;AAAA,EAC1B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA;AACJ;AAQA,IAAM,iCAAiC,CAAC,OAAO,OAAO,OAAO,OAAO,KAAK;AAKlE,IAAM,gBAAN,MAAoB;AAAA,EAEhB,YACgB,WACrB;AADqB;AAFvB,SAAmB,UAAU,IAAI,OAAO,eAAe;AAAA,EAGpD;AAAA,EAEI,qBAAqB,QAAkC;AAC1D,UAAM,SAAS,EAAE,GAAG,OAAO;AAE3B,QAAI,KAAK,UAAU,sBAAsB;AACrC,UAAI;AACJ,UAAI,MAAM,QAAQ,KAAK,UAAU,oBAAoB,GAAG;AACpD,yBAAiB,KAAK,UAAU;AAAA,MACpC,OAAO;AACH,yBAAiB;AAAA,MACrB;AAEA,iBAAW,SAAS,gBAAgB;AAChC,YAAI,CAAC,+BAA+B,SAAS,KAAK,GAAG;AACjD,iBAAO,OAAO,KAAK;AAAA,QACvB;AAAA,MACJ;AAAA,IACJ;AAEA,WAAO;AAAA,EACX;AAAA,EAGO,YAAY,SAAsB,SAAiC;AACtE,UAAM,SAAS,EAAE,GAAG,QAAQ;AAC5B,eAAW,CAAC,OAAO,MAAM,KAAK,OAAO,QAAQ,OAAO,GAAG;AACnD,UAAI,OAAO,KAAK,MAAM,QAAQ;AAC1B,YAAI,MAAM,QAAQ,OAAO,KAAK,CAAC,KAAK,MAAM,QAAQ,MAAM,GAAG;AACvD,cAAI,KAAK,UAAU,oBAAoB,SAAS,WAAW;AACvD,mBAAO,KAAK,IAAI;AAAA,UACpB,OAAO;AACH,kBAAM,eAAe,MAAM,QAAQ,OAAO,KAAK,CAAC,IAAI,OAAO,KAAK,IAAiB,CAAC,OAAO,KAAK,CAAC;AAC/F,uBAAW,SAAS,MAAM,QAAQ,MAAM,IAAI,SAAS,CAAC,MAAM,GAAG;AAC3D,kBAAI,CAAC,aAAa,SAAS,KAAK,GAAG;AAC/B,6BAAa,KAAK,KAAK;AAAA,cAC3B;AAAA,YACJ;AACA,mBAAO,KAAK,IAAI;AAAA,UACpB;AAAA,QACJ,WAAW,OAAO,OAAO,KAAK,MAAM,YAAY,OAAO,WAAW,UAAU;AACxE,iBAAO,KAAK,IAAI,KAAK,YAAY,OAAO,KAAK,GAAgB,MAAmB;AAAA,QACpF,OAAO;AACH,iBAAO,KAAK,IAAI;AAAA,QACpB;AAAA,MACJ;AAAA,IACJ;AAEA,WAAO;AAAA,EACX;AACJ;;;AChFO,IAAM,YAAN,MAAgB;AAAA,EACZ,YACa,MACT,OACT;AAFkB;AACT;AAAA,EACP;AACR;;;ACwDO,IAAM,aAAN,MAAiB;AAAA,EAWb,YAAY,UAAwD,iBAAmC;AAT9G,SAAmB,UAAU,IAAI,OAAO,YAAY;AAUhD,SAAK,WAAW,oBAAoB,0BAA0B,WAAW,IAAI,wBAAwB,QAAQ;AAE7G,SAAK,kBAAkB,4CAAmB,IAAI,gBAAgB,KAAK,QAAQ;AAC3E,SAAK,iBAAiB,IAAI,cAAc,KAAK,QAAQ;AACrD,SAAK,aAAa,IAAI,kBAAkB,KAAK,UAAU,KAAK,iBAAiB,KAAK,cAAc;AAChG,SAAK,eAAe,IAAI,YAAY,KAAK,UAAU,KAAK,eAAe;AAAA,EAC3E;AAAA,EAEA,MAAa,oBAAoB;AAAA,IAC7B;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,gBAAgB,KAAK,SAAS;AAAA,IAC9B,QAAQ,KAAK,SAAS;AAAA,IACtB,eAAe,KAAK,SAAS;AAAA,IAC7B,SAAS,KAAK,SAAS;AAAA,IACvB,UAAU,KAAK,SAAS;AAAA,IACxB,UAAU,KAAK,SAAS;AAAA,IACxB,aAAa,KAAK,SAAS;AAAA,IAC3B,aAAa,KAAK,SAAS;AAAA,IAC3B,WAAW,KAAK,SAAS;AAAA,IACzB,gBAAgB,KAAK,SAAS;AAAA,IAC9B,mBAAmB,KAAK,SAAS;AAAA,IACjC,mBAAmB,KAAK,SAAS;AAAA,IACjC;AAAA,IACA,0BAA0B,KAAK,SAAS;AAAA,EAC5C,GAAoD;AAChD,UAAMC,UAAS,KAAK,QAAQ,OAAO,qBAAqB;AAExD,QAAI,kBAAkB,QAAQ;AAC1B,YAAM,IAAI,MAAM,2DAA2D;AAAA,IAC/E;AAEA,UAAM,MAAM,MAAM,KAAK,gBAAgB,yBAAyB;AAChE,IAAAA,QAAO,MAAM,mCAAmC,GAAG;AAEnD,UAAM,gBAAgB,MAAM,cAAc,OAAO;AAAA,MAC7C;AAAA,MACA,WAAW,KAAK,SAAS;AAAA,MACzB,WAAW,KAAK,SAAS;AAAA,MACzB;AAAA,MACA;AAAA,MACA;AAAA,MACA,YAAY;AAAA,MACZ;AAAA,MACA;AAAA,MAAQ;AAAA,MAAS;AAAA,MAAS;AAAA,MAAY;AAAA,MAAe;AAAA,MAAY;AAAA,MAAY;AAAA,MAC7E;AAAA,MAAU;AAAA,MAAS;AAAA,MAAa;AAAA,MAAkB;AAAA,MAAkB;AAAA,MAAc;AAAA,MAClF,eAAe,KAAK,SAAS;AAAA,MAC7B;AAAA,MACA;AAAA,MACA,aAAa,KAAK,SAAS;AAAA,MAC3B;AAAA,IACJ,CAAC;AAGD,UAAM,KAAK,gBAAgB;AAE3B,UAAM,cAAc,cAAc;AAClC,UAAM,KAAK,SAAS,WAAW,IAAI,YAAY,IAAI,YAAY,gBAAgB,CAAC;AAChF,WAAO;AAAA,EACX;AAAA,EAEA,MAAa,wBAAwB,KAAa,cAAc,OAAkE;AAC9H,UAAMA,UAAS,KAAK,QAAQ,OAAO,yBAAyB;AAE5D,UAAM,WAAW,IAAI,eAAe,SAAS,WAAW,KAAK,KAAK,SAAS,aAAa,CAAC;AACzF,QAAI,CAAC,SAAS,OAAO;AACjB,MAAAA,QAAO,MAAM,IAAI,MAAM,sBAAsB,CAAC;AAE9C,YAAM;AAAA,IACV;AAEA,UAAM,oBAAoB,MAAM,KAAK,SAAS,WAAW,cAAc,WAAW,KAAK,EAAE,SAAS,KAAK;AACvG,QAAI,CAAC,mBAAmB;AACpB,MAAAA,QAAO,MAAM,IAAI,MAAM,oCAAoC,CAAC;AAC5D,YAAM;AAAA,IACV;AAEA,UAAM,QAAQ,MAAM,YAAY,kBAAkB,iBAAiB;AACnE,WAAO,EAAE,OAAO,SAAS;AAAA,EAC7B;AAAA,EAEA,MAAa,sBAAsB,KAAa,cAAqE;AACjH,UAAMA,UAAS,KAAK,QAAQ,OAAO,uBAAuB;AAE1D,UAAM,EAAE,OAAO,SAAS,IAAI,MAAM,KAAK,wBAAwB,KAAK,IAAI;AACxE,IAAAA,QAAO,MAAM,kDAAkD;AAE/D,QAAI,KAAK,SAAS,QAAQ,KAAK,SAAS,KAAK,OAAO;AAChD,YAAM,YAAY,MAAM,KAAK,aAAa,KAAK,SAAS,KAAK,KAAK;AAClE,qBAAe,EAAE,GAAG,cAAc,QAAQ,UAAU;AAAA,IACxD;AAUA,QAAI;AACA,YAAM,KAAK,WAAW,uBAAuB,UAAU,OAAO,YAAY;AAAA,IAC9E,SACO,KAAK;AACR,UAAI,eAAe,kBAAkB,KAAK,SAAS,MAAM;AACrD,cAAM,YAAY,MAAM,KAAK,aAAa,KAAK,SAAS,KAAK,OAAO,IAAI,KAAK;AAC7E,qBAAc,MAAM,IAAI;AACxB,cAAM,KAAK,WAAW,uBAAuB,UAAU,OAAO,YAAY;AAAA,MAC9E,OAAO;AACH,cAAM;AAAA,MACV;AAAA,IACJ;AAEA,WAAO;AAAA,EACX;AAAA,EAEA,MAAM,aAAa,WAAsB,OAAiC;AACtE,QAAI;AACJ,QAAI;AAEJ,QAAI,EAAE,MAAM,UAAU,WAAW,GAAG,SAAS,KAAK,SAAS,SAAS,GAAG;AACnE,gBAAU,MAAM,YAAY,iBAAiB;AAC7C,kBAAY,IAAI,UAAU,SAAS,KAAK;AACxC,YAAM,UAAU,IAAI,KAAK,SAAS,WAAW,SAAS;AAAA,IAC1D,OAAO;AACH,kBAAY,MAAM,UAAU,IAAI,KAAK,SAAS,SAAS;AAGvD,UAAI,UAAU,UAAU,SAAS,OAAO;AACpC,kBAAU,QAAQ;AAClB,cAAM,UAAU,IAAI,KAAK,SAAS,WAAW,SAAS;AAAA,MAC1D;AAAA,IACJ;AAEA,WAAO,MAAM,YAAY,kBAAkB;AAAA,MACvC,KAAK,MAAM,KAAK,gBAAgB,iBAAiB,KAAK;AAAA,MACtD,YAAY;AAAA,MACZ,SAAS,UAAU;AAAA,MACnB,OAAO,UAAU;AAAA,IACrB,CAAC;AAAA,EACL;AAAA,EAEA,MAAa,wCAAwC;AAAA,IACjD;AAAA,IACA;AAAA,IACA,eAAe;AAAA,IACf,mBAAmB,CAAC;AAAA,EACxB,GAAyE;AACrE,UAAM,gBAAyC,MAAM,KAAK,aAAa,oBAAoB,EAAE,UAAU,UAAU,GAAG,iBAAiB,CAAC;AACtI,UAAM,iBAAiC,IAAI,eAAe,IAAI,gBAAgB,CAAC;AAC/E,WAAO,OAAO,gBAAgB,aAAa;AAC3C,UAAM,KAAK,WAAW,4BAA4B,gBAAgB,YAAY;AAC9E,WAAO;AAAA,EACX;AAAA,EAEA,MAAa,gBAAgB;AAAA,IACzB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACJ,GAAiD;AA/PrD;AAgQQ,UAAMA,UAAS,KAAK,QAAQ,OAAO,iBAAiB;AAKpD,QAAI;AACJ,QAAI,KAAK,SAAS,6BAA6B,QAAW;AACtD,cAAQ,MAAM;AAAA,IAClB,OAAO;AACH,YAAM,kBAAkB,KAAK,SAAS,yBAAyB,MAAM,GAAG;AACxE,YAAM,mBAAiB,WAAM,UAAN,mBAAa,MAAM,SAAQ,CAAC;AAEnD,cAAQ,eAAe,OAAO,OAAK,gBAAgB,SAAS,CAAC,CAAC,EAAE,KAAK,GAAG;AAAA,IAC5E;AAEA,QAAI,KAAK,SAAS,QAAQ,KAAK,SAAS,KAAK,OAAO;AAChD,YAAM,YAAY,MAAM,KAAK,aAAa,KAAK,SAAS,KAAK,KAAK;AAClE,qBAAe,EAAE,GAAG,cAAc,QAAQ,UAAU;AAAA,IACxD;AAUA,QAAI;AACJ,QAAI;AACA,eAAS,MAAM,KAAK,aAAa,qBAAqB;AAAA,QAClD,eAAe,MAAM;AAAA;AAAA,QAErB;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,GAAG;AAAA,MACP,CAAC;AAAA,IACL,SAAS,KAAK;AACV,UAAI,eAAe,kBAAkB,KAAK,SAAS,MAAM;AACrD,qBAAc,MAAM,IAAI,MAAM,KAAK,aAAa,KAAK,SAAS,KAAK,OAAO,IAAI,KAAK;AACnF,iBAAS,MAAM,KAAK,aAAa,qBAAqB;AAAA,UAClD,eAAe,MAAM;AAAA;AAAA,UAErB;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA,GAAG;AAAA,QACP,CAAC;AAAA,MACL,OAAO;AACH,cAAM;AAAA,MACV;AAAA,IACJ;AAEA,UAAM,WAAW,IAAI,eAAe,IAAI,gBAAgB,CAAC;AACzD,WAAO,OAAO,UAAU,MAAM;AAC9B,IAAAA,QAAO,MAAM,uBAAuB,QAAQ;AAC5C,UAAM,KAAK,WAAW,wBAAwB,UAAU;AAAA,MACpD,GAAG;AAAA;AAAA;AAAA,MAGH;AAAA,IACJ,CAAC;AACD,WAAO;AAAA,EACX;AAAA,EAEA,MAAa,qBAAqB;AAAA,IAC9B;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,2BAA2B,KAAK,SAAS;AAAA,IACzC,mBAAmB,KAAK,SAAS;AAAA,EACrC,IAA8B,CAAC,GAA4B;AACvD,UAAMA,UAAS,KAAK,QAAQ,OAAO,sBAAsB;AAEzD,UAAM,MAAM,MAAM,KAAK,gBAAgB,sBAAsB;AAC7D,QAAI,CAAC,KAAK;AACN,MAAAA,QAAO,MAAM,IAAI,MAAM,yBAAyB,CAAC;AACjD,YAAM;AAAA,IACV;AAEA,IAAAA,QAAO,MAAM,iCAAiC,GAAG;AAGjD,QAAI,CAAC,aAAa,4BAA4B,CAAC,eAAe;AAC1D,kBAAY,KAAK,SAAS;AAAA,IAC9B;AAEA,UAAM,UAAU,IAAI,eAAe;AAAA,MAC/B;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,YAAY;AAAA,MACZ;AAAA,MACA;AAAA,IACJ,CAAC;AAGD,UAAM,KAAK,gBAAgB;AAE3B,UAAM,eAAe,QAAQ;AAC7B,QAAI,cAAc;AACd,MAAAA,QAAO,MAAM,sCAAsC;AACnD,YAAM,KAAK,SAAS,WAAW,IAAI,aAAa,IAAI,aAAa,gBAAgB,CAAC;AAAA,IACtF;AAEA,WAAO;AAAA,EACX;AAAA,EAEA,MAAa,yBAAyB,KAAa,cAAc,OAAyE;AACtI,UAAMA,UAAS,KAAK,QAAQ,OAAO,0BAA0B;AAE7D,UAAM,WAAW,IAAI,gBAAgB,SAAS,WAAW,KAAK,KAAK,SAAS,aAAa,CAAC;AAC1F,QAAI,CAAC,SAAS,OAAO;AACjB,MAAAA,QAAO,MAAM,sBAAsB;AAEnC,UAAI,SAAS,OAAO;AAChB,QAAAA,QAAO,KAAK,uBAAuB,SAAS,KAAK;AACjD,cAAM,IAAI,cAAc,QAAQ;AAAA,MACpC;AAEA,aAAO,EAAE,OAAO,QAAW,SAAS;AAAA,IACxC;AAEA,UAAM,oBAAoB,MAAM,KAAK,SAAS,WAAW,cAAc,WAAW,KAAK,EAAE,SAAS,KAAK;AACvG,QAAI,CAAC,mBAAmB;AACpB,MAAAA,QAAO,MAAM,IAAI,MAAM,oCAAoC,CAAC;AAC5D,YAAM;AAAA,IACV;AAEA,UAAM,QAAQ,MAAM,MAAM,kBAAkB,iBAAiB;AAC7D,WAAO,EAAE,OAAO,SAAS;AAAA,EAC7B;AAAA,EAEA,MAAa,uBAAuB,KAAuC;AACvE,UAAMA,UAAS,KAAK,QAAQ,OAAO,wBAAwB;AAE3D,UAAM,EAAE,OAAO,SAAS,IAAI,MAAM,KAAK,yBAAyB,KAAK,IAAI;AACzE,QAAI,OAAO;AACP,MAAAA,QAAO,MAAM,kDAAkD;AAC/D,WAAK,WAAW,wBAAwB,UAAU,KAAK;AAAA,IAC3D,OAAO;AACH,MAAAA,QAAO,MAAM,qDAAqD;AAAA,IACtE;AAEA,WAAO;AAAA,EACX;AAAA,EAEO,kBAAiC;AACpC,SAAK,QAAQ,OAAO,iBAAiB;AACrC,WAAO,MAAM,gBAAgB,KAAK,SAAS,YAAY,KAAK,SAAS,sBAAsB;AAAA,EAC/F;AAAA,EAEA,MAAa,YAAY,OAAe,MAAwD;AAC5F,SAAK,QAAQ,OAAO,aAAa;AACjC,WAAO,MAAM,KAAK,aAAa,OAAO;AAAA,MAClC;AAAA,MACA,iBAAiB;AAAA,IACrB,CAAC;AAAA,EACL;AACJ;;;AC3ZO,IAAM,iBAAN,MAAqB;AAAA,EAMjB,YAA6B,cAA2B;AAA3B;AALpC,SAAiB,UAAU,IAAI,OAAO,gBAAgB;AAyCtD,SAAU,SAAS,OACf,SAIgB;AAChB,YAAM,gBAAgB,KAAK;AAC3B,UAAI,CAAC,eAAe;AAChB;AAAA,MACJ;AACA,YAAMC,UAAS,KAAK,QAAQ,OAAO,QAAQ;AAE3C,UAAI,KAAK,SAAS;AACd,aAAK,OAAO,KAAK,QAAQ;AACzB,QAAAA,QAAO,MAAM,iBAAiB,eAAe,SAAS,KAAK,IAAI;AAAA,MACnE,OACK;AACD,aAAK,OAAO;AACZ,QAAAA,QAAO,MAAM,iBAAiB,eAAe,kBAAkB;AAAA,MACnE;AAEA,UAAI,KAAK,qBAAqB;AAC1B,aAAK,oBAAoB,MAAM,aAAa;AAC5C;AAAA,MACJ;AAEA,UAAI;AACA,cAAM,MAAM,MAAM,KAAK,aAAa,gBAAgB,sBAAsB;AAC1E,YAAI,KAAK;AACL,UAAAA,QAAO,MAAM,mCAAmC;AAEhD,gBAAM,YAAY,KAAK,aAAa,SAAS;AAC7C,gBAAM,oBAAoB,KAAK,aAAa,SAAS;AACrD,gBAAM,cAAc,KAAK,aAAa,SAAS;AAE/C,gBAAM,qBAAqB,IAAI,mBAAmB,KAAK,WAAW,WAAW,KAAK,mBAAmB,WAAW;AAChH,gBAAM,mBAAmB,KAAK;AAC9B,eAAK,sBAAsB;AAC3B,6BAAmB,MAAM,aAAa;AAAA,QAC1C,OACK;AACD,UAAAA,QAAO,KAAK,+CAA+C;AAAA,QAC/D;AAAA,MACJ,SACO,KAAK;AAER,QAAAA,QAAO,MAAM,qCAAqC,eAAe,QAAQ,IAAI,UAAU,GAAG;AAAA,MAC9F;AAAA,IACJ;AAEA,SAAU,QAAQ,MAAY;AAC1B,YAAMA,UAAS,KAAK,QAAQ,OAAO,OAAO;AAC1C,WAAK,OAAO;AAEZ,UAAI,KAAK,qBAAqB;AAC1B,aAAK,oBAAoB,KAAK;AAAA,MAClC;AAEA,UAAI,KAAK,aAAa,SAAS,yBAAyB;AAIpD,cAAM,cAAc,YAAY,YAAY;AACxC,wBAAc,WAAW;AAEzB,cAAI;AACA,kBAAM,UAAU,MAAM,KAAK,aAAa,mBAAmB;AAC3D,gBAAI,SAAS;AACT,oBAAM,UAAU;AAAA,gBACZ,eAAe,QAAQ;AAAA,gBACvB,SAAS,QAAQ,MAAM;AAAA,kBACnB,KAAK,QAAQ;AAAA,gBACjB,IAAI;AAAA,cACR;AACA,mBAAK,KAAK,OAAO,OAAO;AAAA,YAC5B;AAAA,UACJ,SACO,KAAK;AAER,YAAAA,QAAO,MAAM,iCAAiC,eAAe,QAAQ,IAAI,UAAU,GAAG;AAAA,UAC1F;AAAA,QACJ,GAAG,GAAI;AAAA,MACX;AAAA,IACJ;AAEA,SAAU,YAAY,YAA2B;AAC7C,YAAMA,UAAS,KAAK,QAAQ,OAAO,WAAW;AAC9C,UAAI;AACA,cAAM,UAAU,MAAM,KAAK,aAAa,mBAAmB;AAC3D,YAAI,aAAa;AAEjB,YAAI,WAAW,KAAK,qBAAqB;AACrC,cAAI,QAAQ,QAAQ,KAAK,MAAM;AAC3B,yBAAa;AACb,iBAAK,oBAAoB,MAAM,QAAQ,aAAa;AAEpD,YAAAA,QAAO,MAAM,6GAA6G,QAAQ,aAAa;AAC/I,kBAAM,KAAK,aAAa,OAAO,yBAAyB;AAAA,UAC5D,OACK;AACD,YAAAA,QAAO,MAAM,oCAAoC,QAAQ,GAAG;AAAA,UAChE;AAAA,QACJ,OACK;AACD,UAAAA,QAAO,MAAM,kCAAkC;AAAA,QACnD;AAEA,YAAI,YAAY;AACZ,cAAI,KAAK,MAAM;AACX,kBAAM,KAAK,aAAa,OAAO,oBAAoB;AAAA,UACvD,OACK;AACD,kBAAM,KAAK,aAAa,OAAO,mBAAmB;AAAA,UACtD;AAAA,QACJ,OAAO;AACH,UAAAA,QAAO,MAAM,kDAAkD;AAAA,QACnE;AAAA,MACJ,SACO,KAAK;AACR,YAAI,KAAK,MAAM;AACX,UAAAA,QAAO,MAAM,qEAAqE,GAAG;AACrF,gBAAM,KAAK,aAAa,OAAO,oBAAoB;AAAA,QACvD;AAAA,MACJ;AAAA,IACJ;AA/JI,QAAI,CAAC,cAAc;AACf,WAAK,QAAQ,MAAM,IAAI,MAAM,wBAAwB,CAAC;AAAA,IAC1D;AAEA,SAAK,aAAa,OAAO,cAAc,KAAK,MAAM;AAClD,SAAK,aAAa,OAAO,gBAAgB,KAAK,KAAK;AAEnD,SAAK,MAAM,EAAE,MAAM,CAAC,QAAiB;AAEjC,WAAK,QAAQ,MAAM,GAAG;AAAA,IAC1B,CAAC;AAAA,EACL;AAAA,EAEA,MAAgB,QAAuB;AACnC,SAAK,QAAQ,OAAO,OAAO;AAC3B,UAAM,OAAO,MAAM,KAAK,aAAa,QAAQ;AAG7C,QAAI,MAAM;AACN,WAAK,KAAK,OAAO,IAAI;AAAA,IACzB,WACS,KAAK,aAAa,SAAS,yBAAyB;AACzD,YAAM,UAAU,MAAM,KAAK,aAAa,mBAAmB;AAC3D,UAAI,SAAS;AACT,cAAM,UAAU;AAAA,UACZ,eAAe,QAAQ;AAAA,UACvB,SAAS,QAAQ,MAAM;AAAA,YACnB,KAAK,QAAQ;AAAA,UACjB,IAAI;AAAA,QACR;AACA,aAAK,KAAK,OAAO,OAAO;AAAA,MAC5B;AAAA,IACJ;AAAA,EACJ;AA+HJ;;;AClKO,IAAM,OAAN,MAAM,MAAK;AAAA,EAuCP,YAAY,MAWhB;AAlEP;AAmEQ,SAAK,WAAW,KAAK;AACrB,SAAK,iBAAgB,UAAK,kBAAL,YAAsB;AAC3C,SAAK,eAAe,KAAK;AACzB,SAAK,gBAAgB,KAAK;AAE1B,SAAK,aAAa,KAAK;AACvB,SAAK,QAAQ,KAAK;AAClB,SAAK,UAAU,KAAK;AACpB,SAAK,aAAa,KAAK;AACvB,SAAK,QAAQ,KAAK;AAClB,SAAK,YAAY,KAAK;AAAA,EAC1B;AAAA;AAAA,EAGA,IAAW,aAAiC;AACxC,QAAI,KAAK,eAAe,QAAW;AAC/B,aAAO;AAAA,IACX;AACA,WAAO,KAAK,aAAa,MAAM,aAAa;AAAA,EAChD;AAAA,EAEA,IAAW,WAAW,OAA2B;AAC7C,QAAI,UAAU,QAAW;AACrB,WAAK,aAAa,KAAK,MAAM,KAAK,IAAI,MAAM,aAAa;AAAA,IAC7D;AAAA,EACJ;AAAA;AAAA,EAGA,IAAW,UAA+B;AACtC,UAAM,aAAa,KAAK;AACxB,QAAI,eAAe,QAAW;AAC1B,aAAO;AAAA,IACX;AACA,WAAO,cAAc;AAAA,EACzB;AAAA;AAAA,EAGA,IAAW,SAAmB;AAxGlC;AAyGQ,YAAO,gBAAK,UAAL,mBAAY,MAAM,SAAlB,YAA0B,CAAC;AAAA,EACtC;AAAA,EAEO,kBAA0B;AAC7B,QAAI,OAAO,MAAM,EAAE,OAAO,iBAAiB;AAC3C,WAAO,KAAK,UAAU;AAAA,MAClB,UAAU,KAAK;AAAA,MACf,eAAe,KAAK;AAAA,MACpB,cAAc,KAAK;AAAA,MACnB,eAAe,KAAK;AAAA,MACpB,YAAY,KAAK;AAAA,MACjB,OAAO,KAAK;AAAA,MACZ,SAAS,KAAK;AAAA,MACd,YAAY,KAAK;AAAA,IACrB,CAAC;AAAA,EACL;AAAA,EAEA,OAAc,kBAAkB,eAA6B;AACzD,WAAO,aAAa,QAAQ,mBAAmB;AAC/C,WAAO,IAAI,MAAK,KAAK,MAAM,aAAa,CAAC;AAAA,EAC7C;AACJ;;;ACxHA,IAAM,gBAAgB;AAcf,IAAe,sBAAf,MAAsD;AAAA,EAAtD;AAEH,SAAmB,SAAS,IAAI,MAAuB,2BAA2B;AAClF,SAAmB,mBAAmB,oBAAI,IAAgB;AAE1D,SAAU,UAA8B;AAAA;AAAA,EAExC,MAAa,SAAS,QAAmD;AACrE,UAAMC,UAAS,KAAK,QAAQ,OAAO,UAAU;AAC7C,QAAI,CAAC,KAAK,SAAS;AACf,YAAM,IAAI,MAAM,4CAA4C;AAAA,IAChE;AAEA,IAAAA,QAAO,MAAM,uBAAuB;AACpC,SAAK,QAAQ,SAAS,QAAQ,OAAO,GAAG;AAExC,UAAM,EAAE,KAAK,SAAS,IAAI,MAAM,IAAI,QAAqB,CAAC,SAAS,WAAW;AAC1E,YAAM,WAAW,CAAC,MAAoB;AArClD;AAsCgB,cAAM,OAAgC,EAAE;AACxC,cAAM,UAAS,YAAO,iBAAP,YAAuB,OAAO,SAAS;AACtD,YAAI,EAAE,WAAW,WAAU,6BAAM,YAAW,eAAe;AAEvD;AAAA,QACJ;AACA,YAAI;AACA,gBAAM,QAAQ,SAAS,WAAW,KAAK,KAAK,OAAO,aAAa,EAAE,IAAI,OAAO;AAC7E,cAAI,CAAC,OAAO;AACR,YAAAA,QAAO,KAAK,gCAAgC;AAAA,UAChD;AACA,cAAI,EAAE,WAAW,KAAK,WAAW,UAAU,OAAO,OAAO;AAGrD;AAAA,UACJ;AAAA,QACJ,SACO,KAAK;AACR,eAAK,SAAS;AACd,iBAAO,IAAI,MAAM,8BAA8B,CAAC;AAAA,QACpD;AACA,gBAAQ,IAAI;AAAA,MAChB;AACA,aAAO,iBAAiB,WAAW,UAAU,KAAK;AAClD,WAAK,iBAAiB,IAAI,MAAM,OAAO,oBAAoB,WAAW,UAAU,KAAK,CAAC;AACtF,WAAK,iBAAiB,IAAI,KAAK,OAAO,WAAW,CAAC,WAAW;AACzD,aAAK,SAAS;AACd,eAAO,MAAM;AAAA,MACjB,CAAC,CAAC;AAAA,IACN,CAAC;AACD,IAAAA,QAAO,MAAM,0BAA0B;AACvC,SAAK,SAAS;AAEd,QAAI,CAAC,UAAU;AACX,WAAK,MAAM;AAAA,IACf;AAEA,WAAO,EAAE,IAAI;AAAA,EACjB;AAAA,EAIQ,WAAiB;AACrB,SAAK,QAAQ,OAAO,UAAU;AAE9B,eAAW,WAAW,KAAK,kBAAkB;AACzC,cAAQ;AAAA,IACZ;AACA,SAAK,iBAAiB,MAAM;AAAA,EAChC;AAAA,EAEA,OAAiB,cAAc,QAAgB,KAAa,WAAW,OAAO,eAAe,OAAO,SAAS,QAAc;AACvH,WAAO,YAAY;AAAA,MACf,QAAQ;AAAA,MACR;AAAA,MACA;AAAA,IACJ,GAAkB,YAAY;AAAA,EAClC;AACJ;;;ACxFO,IAAM,6BAAkD;AAAA,EAC3D,UAAU;AAAA,EACV,SAAS;AAAA,EACT,QAAQ;AAAA,EACR,gCAAgC;AACpC;AACO,IAAM,qBAAqB;AAClC,IAAM,sDAAsD;AAC5D,IAAM,uCAAuC;AACtC,IAAM,uCAAuC;AA4E7C,IAAM,2BAAN,cAAuC,wBAAwB;AAAA,EA+B3D,YAAY,MAA2B;AAC1C,UAAM;AAAA,MACF,qBAAqB,KAAK;AAAA,MAC1B,iCAAiC,KAAK;AAAA,MACtC,sBAAsB;AAAA,MACtB,oBAAoB;AAAA,MACpB,iBAAiB;AAAA,MACjB,iBAAiB;AAAA,MAEjB,2BAA2B,KAAK;AAAA,MAChC,qBAAqB,KAAK;AAAA,MAE1B;AAAA,MACA,sBAAsB,KAAK;AAAA,MAC3B;AAAA,MACA,uBAAuB;AAAA,MACvB,2BAA2B;AAAA,MAC3B,8BAA8B;AAAA,MAE9B,iBAAiB;AAAA,MACjB,0BAA0B;AAAA,MAC1B,gCAAgC;AAAA,MAChC,6BAA6B;AAAA,MAC7B,0BAA0B;AAAA,MAE1B,mBAAmB,CAAC,gBAAgB,eAAe;AAAA,MACnD,wBAAwB;AAAA,MACxB,gCAAgC;AAAA,MAEhC,+CAA+C;AAAA,MAE/C;AAAA,IACJ,IAAI;AAEJ,UAAM,IAAI;AAEV,SAAK,qBAAqB;AAC1B,SAAK,iCAAiC;AACtC,SAAK,sBAAsB;AAC3B,SAAK,oBAAoB;AACzB,SAAK,iBAAiB;AACtB,SAAK,iBAAiB;AAEtB,SAAK,2BAA2B;AAChC,SAAK,qBAAqB;AAE1B,SAAK,sBAAsB;AAC3B,SAAK,gCAAgC,iCAAiC,2BAA2B;AACjG,SAAK,uBAAuB;AAC5B,SAAK,2BAA2B;AAChC,SAAK,8BAA8B;AAEnC,SAAK,iBAAiB;AACtB,SAAK,0BAA0B;AAC/B,SAAK,gCAAgC;AACrC,SAAK,0BAA0B;AAC/B,SAAK,6BAA6B;AAElC,SAAK,mBAAmB;AACxB,SAAK,wBAAwB;AAC7B,SAAK,gCAAgC;AAErC,SAAK,+CAA+C;AAEpD,QAAI,WAAW;AACX,WAAK,YAAY;AAAA,IACrB,OACK;AACD,YAAM,QAAQ,OAAO,WAAW,cAAc,OAAO,iBAAiB,IAAI,mBAAmB;AAC7F,WAAK,YAAY,IAAI,qBAAqB,EAAE,MAAM,CAAC;AAAA,IACvD;AAAA,EACJ;AACJ;;;ACjLO,IAAM,eAAN,MAAM,sBAAqB,oBAAoB;AAAA,EAK3C,YAAY;AAAA,IACf,gCAAgC;AAAA,EACpC,GAAuB;AACnB,UAAM;AAPV,SAAmB,UAAU,IAAI,OAAO,cAAc;AAQlD,SAAK,oBAAoB;AAEzB,SAAK,SAAS,cAAa,mBAAmB;AAC9C,SAAK,UAAU,KAAK,OAAO;AAAA,EAC/B;AAAA,EAEA,OAAe,qBAAwC;AACnD,UAAM,SAAS,OAAO,SAAS,cAAc,QAAQ;AAGrD,WAAO,MAAM,aAAa;AAC1B,WAAO,MAAM,WAAW;AACxB,WAAO,MAAM,OAAO;AACpB,WAAO,MAAM,MAAM;AACnB,WAAO,QAAQ;AACf,WAAO,SAAS;AAEhB,WAAO,SAAS,KAAK,YAAY,MAAM;AACvC,WAAO;AAAA,EACX;AAAA,EAEA,MAAa,SAAS,QAAmD;AACrE,SAAK,QAAQ,MAAM,+BAA+B,KAAK,iBAAiB;AACxE,UAAM,QAAQ,WAAW,MAAM,KAAK,KAAK,OAAO,MAAM,IAAI,aAAa,qCAAqC,CAAC,GAAG,KAAK,oBAAoB,GAAI;AAC7I,SAAK,iBAAiB,IAAI,MAAM,aAAa,KAAK,CAAC;AAEnD,WAAO,MAAM,MAAM,SAAS,MAAM;AAAA,EACtC;AAAA,EAEO,QAAc;AAzDzB;AA0DQ,QAAI,KAAK,QAAQ;AACb,UAAI,KAAK,OAAO,YAAY;AACxB,aAAK,OAAO,iBAAiB,QAAQ,CAAC,OAAO;AA5D7D,cAAAC;AA6DoB,gBAAM,QAAQ,GAAG;AACjB,WAAAA,MAAA,MAAM,eAAN,gBAAAA,IAAkB,YAAY;AAC9B,eAAK,KAAK,OAAO,MAAM,IAAI,MAAM,yBAAyB,CAAC;AAAA,QAC/D,GAAG,IAAI;AACP,mBAAK,OAAO,kBAAZ,mBAA2B,SAAS,QAAQ;AAAA,MAChD;AACA,WAAK,SAAS;AAAA,IAClB;AACA,SAAK,UAAU;AAAA,EACnB;AAAA,EAEA,OAAc,aAAa,KAAa,cAA6B;AACjE,WAAO,MAAM,cAAc,OAAO,QAAQ,KAAK,OAAO,YAAY;AAAA,EACtE;AACJ;;;AChEO,IAAM,kBAAN,MAA4C;AAAA,EAG/C,YAAoB,WAAqC;AAArC;AAFpB,SAAiB,UAAU,IAAI,OAAO,iBAAiB;AAAA,EAEG;AAAA,EAE1D,MAAa,QAAQ;AAAA,IACjB,gCAAgC,KAAK,UAAU;AAAA,EACnD,GAA8C;AAC1C,WAAO,IAAI,aAAa,EAAE,8BAA8B,CAAC;AAAA,EAC7D;AAAA,EAEA,MAAa,SAAS,KAA4B;AAC9C,SAAK,QAAQ,OAAO,UAAU;AAC9B,iBAAa,aAAa,KAAK,KAAK,UAAU,wBAAwB;AAAA,EAC1E;AACJ;;;AClBA,IAAM,8BAA8B;AACpC,IAAM,SAAS;AAeR,IAAM,cAAN,cAA0B,oBAAoB;AAAA,EAK1C,YAAY;AAAA,IACf,oBAAoB;AAAA,IACpB,sBAAsB,CAAC;AAAA,IACvB;AAAA,EACJ,GAAsB;AAClB,UAAM;AATV,SAAmB,UAAU,IAAI,OAAO,aAAa;AAUjD,UAAM,gBAAgB,WAAW,OAAO,EAAE,GAAG,4BAA4B,GAAG,oBAAoB,CAAC;AACjG,SAAK,UAAU,OAAO,KAAK,QAAW,mBAAmB,WAAW,UAAU,aAAa,CAAC;AAE5F,QAAI,aAAa;AACb,kBAAY,iBAAiB,SAAS,MAAM;AAvCxD;AAwCgB,aAAK,KAAK,OAAO,MAAM,IAAI,OAAM,iBAAY,WAAZ,YAAsB,eAAe,CAAC;AAAA,MAC3E,CAAC;AAAA,IACL;AAEA,QAAI,oBAAoB,kCAAkC,oBAAoB,iCAAiC,GAAG;AAC9G,iBAAW,MAAM;AACb,YAAI,CAAC,KAAK,WAAW,OAAO,KAAK,QAAQ,WAAW,aAAa,KAAK,QAAQ,QAAQ;AAClF,eAAK,KAAK,OAAO,MAAM,IAAI,MAAM,uBAAuB,CAAC;AACzD;AAAA,QACJ;AAEA,aAAK,MAAM;AAAA,MACf,GAAG,oBAAoB,iCAAiC,MAAM;AAAA,IAClE;AAAA,EACJ;AAAA,EAEA,MAAa,SAAS,QAAmD;AAxD7E;AAyDQ,eAAK,YAAL,mBAAc;AAEd,UAAM,sBAAsB,YAAY,MAAM;AAC1C,UAAI,CAAC,KAAK,WAAW,KAAK,QAAQ,QAAQ;AACtC,aAAK,KAAK,OAAO,MAAM,IAAI,MAAM,sBAAsB,CAAC;AAAA,MAC5D;AAAA,IACJ,GAAG,2BAA2B;AAC9B,SAAK,iBAAiB,IAAI,MAAM,cAAc,mBAAmB,CAAC;AAElE,WAAO,MAAM,MAAM,SAAS,MAAM;AAAA,EACtC;AAAA,EAEO,QAAc;AACjB,QAAI,KAAK,SAAS;AACd,UAAI,CAAC,KAAK,QAAQ,QAAQ;AACtB,aAAK,QAAQ,MAAM;AACnB,aAAK,KAAK,OAAO,MAAM,IAAI,MAAM,cAAc,CAAC;AAAA,MACpD;AAAA,IACJ;AACA,SAAK,UAAU;AAAA,EACnB;AAAA,EAEA,OAAc,aAAa,KAAa,UAAyB;AAC7D,QAAI,CAAC,OAAO,QAAQ;AAChB,YAAM,IAAI,MAAM,gDAAgD;AAAA,IACpE;AACA,WAAO,MAAM,cAAc,OAAO,QAAQ,KAAK,QAAQ;AAAA,EAC3D;AACJ;;;AC1EO,IAAM,iBAAN,MAA2C;AAAA,EAG9C,YAAoB,WAAqC;AAArC;AAFpB,SAAiB,UAAU,IAAI,OAAO,gBAAgB;AAAA,EAEK;AAAA,EAE3D,MAAa,QAAQ;AAAA,IACjB,sBAAsB,KAAK,UAAU;AAAA,IACrC,oBAAoB,KAAK,UAAU;AAAA,IACnC;AAAA,EACJ,GAA4C;AACxC,WAAO,IAAI,YAAY,EAAE,qBAAqB,mBAAmB,YAAY,CAAC;AAAA,EAClF;AAAA,EAEA,MAAa,SAAS,KAAa,EAAE,WAAW,MAAM,GAAkB;AACpE,SAAK,QAAQ,OAAO,UAAU;AAE9B,gBAAY,aAAa,KAAK,QAAQ;AAAA,EAC1C;AACJ;;;ACVO,IAAM,oBAAN,MAA8C;AAAA,EAGjD,YAAoB,WAAqC;AAArC;AAFpB,SAAiB,UAAU,IAAI,OAAO,mBAAmB;AAAA,EAEC;AAAA,EAE1D,MAAa,QAAQ;AAAA,IACjB,iBAAiB,KAAK,UAAU;AAAA,IAChC,iBAAiB,KAAK,UAAU;AAAA,EACpC,GAAqC;AA3BzC;AA4BQ,SAAK,QAAQ,OAAO,SAAS;AAC7B,QAAI,eAAe,OAAO;AAE1B,QAAI,mBAAmB,OAAO;AAC1B,sBAAe,YAAO,QAAP,YAAc,OAAO;AAAA,IACxC;AAEA,UAAM,WAAW,aAAa,SAAS,cAAc,EAAE,KAAK,aAAa,QAAQ;AACjF,QAAI;AACJ,WAAO;AAAA,MACH,UAAU,OAAO,WAA2B;AACxC,aAAK,QAAQ,OAAO,UAAU;AAE9B,cAAM,UAAU,IAAI,QAAQ,CAAC,SAAS,WAAW;AAC7C,kBAAQ;AAAA,QACZ,CAAC;AACD,iBAAS,OAAO,GAAG;AACnB,eAAO,MAAO;AAAA,MAClB;AAAA,MACA,OAAO,MAAM;AACT,aAAK,QAAQ,OAAO,OAAO;AAC3B,uCAAQ,IAAI,MAAM,kBAAkB;AACpC,qBAAa,KAAK;AAAA,MACtB;AAAA,IACJ;AAAA,EACJ;AAAA,EAEA,MAAa,WAA0B;AACnC;AAAA,EACJ;AACJ;;;ACtBO,IAAM,oBAAN,cAAgC,kBAAkB;AAAA,EAU9C,YAAY,UAAoC;AACnD,UAAM,EAAE,mCAAmC,SAAS,6CAA6C,CAAC;AAVtG,SAAmB,UAAU,IAAI,OAAO,mBAAmB;AAE3D,SAAiB,cAAc,IAAI,MAAc,aAAa;AAC9D,SAAiB,gBAAgB,IAAI,MAAU,eAAe;AAC9D,SAAiB,oBAAoB,IAAI,MAAe,oBAAoB;AAC5E,SAAiB,gBAAgB,IAAI,MAAU,gBAAgB;AAC/D,SAAiB,iBAAiB,IAAI,MAAU,iBAAiB;AACjE,SAAiB,sBAAsB,IAAI,MAAU,sBAAsB;AAAA,EAI3E;AAAA,EAEA,MAAa,KAAK,MAAY,aAAW,MAAqB;AAC1D,UAAM,KAAK,IAAI;AACf,QAAI,YAAY;AACZ,YAAM,KAAK,YAAY,MAAM,IAAI;AAAA,IACrC;AAAA,EACJ;AAAA,EACA,MAAa,SAAwB;AACjC,UAAM,OAAO;AACb,UAAM,KAAK,cAAc,MAAM;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKO,cAAc,IAAoC;AACrD,WAAO,KAAK,YAAY,WAAW,EAAE;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAIO,iBAAiB,IAA8B;AAClD,WAAO,KAAK,YAAY,cAAc,EAAE;AAAA,EAC5C;AAAA;AAAA;AAAA;AAAA,EAKO,gBAAgB,IAAsC;AACzD,WAAO,KAAK,cAAc,WAAW,EAAE;AAAA,EAC3C;AAAA;AAAA;AAAA;AAAA,EAIO,mBAAmB,IAAgC;AACtD,WAAO,KAAK,cAAc,cAAc,EAAE;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKO,oBAAoB,IAA0C;AACjE,WAAO,KAAK,kBAAkB,WAAW,EAAE;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA,EAIO,uBAAuB,IAAoC;AAC9D,WAAO,KAAK,kBAAkB,cAAc,EAAE;AAAA,EAClD;AAAA;AAAA;AAAA;AAAA,EAIA,MAAa,uBAAuB,GAAyB;AACzD,UAAM,KAAK,kBAAkB,MAAM,CAAC;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMO,gBAAgB,IAAsC;AACzD,WAAO,KAAK,cAAc,WAAW,EAAE;AAAA,EAC3C;AAAA;AAAA;AAAA;AAAA,EAIO,mBAAmB,IAAgC;AACtD,SAAK,cAAc,cAAc,EAAE;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA,EAIA,MAAa,qBAAoC;AAC7C,UAAM,KAAK,cAAc,MAAM;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMO,iBAAiB,IAAuC;AAC3D,WAAO,KAAK,eAAe,WAAW,EAAE;AAAA,EAC5C;AAAA;AAAA;AAAA;AAAA,EAIO,oBAAoB,IAAiC;AACxD,SAAK,eAAe,cAAc,EAAE;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAIA,MAAa,sBAAqC;AAC9C,UAAM,KAAK,eAAe,MAAM;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMO,sBAAsB,IAA4C;AACrE,WAAO,KAAK,oBAAoB,WAAW,EAAE;AAAA,EACjD;AAAA;AAAA;AAAA;AAAA,EAIO,yBAAyB,IAAsC;AAClE,SAAK,oBAAoB,cAAc,EAAE;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA,EAIA,MAAa,2BAA0C;AACnD,UAAM,KAAK,oBAAoB,MAAM;AAAA,EACzC;AACJ;;;AC1JO,IAAM,qBAAN,MAAyB;AAAA,EAKrB,YAAoB,cAA2B;AAA3B;AAJ3B,SAAU,UAAU,IAAI,OAAO,oBAAoB;AACnD,SAAQ,aAAa;AACrB,SAAiB,cAAc,IAAI,MAAM,oBAAoB;AAgC7D,SAAU,iBAAsC,YAAY;AACxD,YAAMC,UAAS,KAAK,QAAQ,OAAO,gBAAgB;AACnD,UAAI;AACA,cAAM,KAAK,aAAa,aAAa;AACrC,QAAAA,QAAO,MAAM,iCAAiC;AAAA,MAClD,SACO,KAAK;AACR,YAAI,eAAe,cAAc;AAE7B,UAAAA,QAAO,KAAK,mCAAmC,KAAK,aAAa;AACjE,eAAK,YAAY,KAAK,CAAC;AACvB;AAAA,QACJ;AAEA,QAAAA,QAAO,MAAM,4BAA4B,GAAG;AAC5C,cAAM,KAAK,aAAa,OAAO,uBAAuB,GAAY;AAAA,MACtE;AAAA,IACJ;AAAA,EA/CuD;AAAA,EAEvD,MAAa,QAAuB;AAChC,UAAMA,UAAS,KAAK,QAAQ,OAAO,OAAO;AAC1C,QAAI,CAAC,KAAK,YAAY;AAClB,WAAK,aAAa;AAClB,WAAK,aAAa,OAAO,uBAAuB,KAAK,cAAc;AACnE,WAAK,YAAY,WAAW,KAAK,cAAc;AAG/C,UAAI;AACA,cAAM,KAAK,aAAa,QAAQ;AAAA,MAEpC,SACO,KAAK;AAER,QAAAA,QAAO,MAAM,iBAAiB,GAAG;AAAA,MACrC;AAAA,IACJ;AAAA,EACJ;AAAA,EAEO,OAAa;AAChB,QAAI,KAAK,YAAY;AACjB,WAAK,YAAY,OAAO;AACxB,WAAK,YAAY,cAAc,KAAK,cAAc;AAClD,WAAK,aAAa,OAAO,0BAA0B,KAAK,cAAc;AACtE,WAAK,aAAa;AAAA,IACtB;AAAA,EACJ;AAoBJ;;;ACtDO,IAAM,eAAN,MAAmB;AAAA,EAUtB,YAAY,MAQT;AACC,SAAK,gBAAgB,KAAK;AAC1B,SAAK,WAAW,KAAK;AACrB,SAAK,gBAAgB,KAAK;AAC1B,SAAK,QAAQ,KAAK;AAClB,SAAK,UAAU,KAAK;AAEpB,SAAK,OAAO,KAAK;AAAA,EAErB;AACJ;;;AC0CO,IAAM,cAAN,MAAkB;AAAA,EAad,YAAY,UAA+B,mBAAgC,gBAA6B,iBAA8B;AAV7I,SAAmB,UAAU,IAAI,OAAO,aAAa;AAWjD,SAAK,WAAW,IAAI,yBAAyB,QAAQ;AAErD,SAAK,UAAU,IAAI,WAAW,QAAQ;AAEtC,SAAK,qBAAqB,gDAAqB,IAAI,kBAAkB,KAAK,QAAQ;AAClF,SAAK,kBAAkB,0CAAkB,IAAI,eAAe,KAAK,QAAQ;AACzE,SAAK,mBAAmB,4CAAmB,IAAI,gBAAgB,KAAK,QAAQ;AAE5E,SAAK,UAAU,IAAI,kBAAkB,KAAK,QAAQ;AAClD,SAAK,sBAAsB,IAAI,mBAAmB,IAAI;AAGtD,QAAI,KAAK,SAAS,sBAAsB;AACpC,WAAK,iBAAiB;AAAA,IAC1B;AAEA,SAAK,kBAAkB;AACvB,QAAI,KAAK,SAAS,gBAAgB;AAC9B,WAAK,kBAAkB,IAAI,eAAe,IAAI;AAAA,IAClD;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKA,IAAW,SAA4B;AACnC,WAAO,KAAK;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA,EAKA,IAAW,kBAAmC;AAC1C,WAAO,KAAK,QAAQ;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAa,UAAgC;AACzC,UAAMC,UAAS,KAAK,QAAQ,OAAO,SAAS;AAC5C,UAAM,OAAO,MAAM,KAAK,UAAU;AAClC,QAAI,MAAM;AACN,MAAAA,QAAO,KAAK,aAAa;AACzB,YAAM,KAAK,QAAQ,KAAK,MAAM,KAAK;AACnC,aAAO;AAAA,IACX;AAEA,IAAAA,QAAO,KAAK,2BAA2B;AACvC,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAa,aAA4B;AACrC,UAAMA,UAAS,KAAK,QAAQ,OAAO,YAAY;AAC/C,UAAM,KAAK,UAAU,IAAI;AACzB,IAAAA,QAAO,KAAK,2BAA2B;AACvC,UAAM,KAAK,QAAQ,OAAO;AAAA,EAC9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAa,eAAe,OAA2B,CAAC,GAAkB;AAvK9E;AAwKQ,SAAK,QAAQ,OAAO,gBAAgB;AACpC,UAAM;AAAA,MACF;AAAA,MACA,GAAG;AAAA,IACP,IAAI;AAEJ,QAAI;AACJ,SAAI,UAAK,SAAS,SAAd,mBAAoB,yBAAyB;AAC7C,gBAAU,MAAM,KAAK,gBAAgB,KAAK,SAAS,IAAI;AAAA,IAC3D;AAEA,UAAM,SAAS,MAAM,KAAK,mBAAmB,QAAQ,EAAE,eAAe,CAAC;AACvE,UAAM,KAAK,aAAa;AAAA,MACpB,cAAc;AAAA,MACd;AAAA,MACA,GAAG;AAAA,IACP,GAAG,MAAM;AAAA,EACb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAa,uBAAuB,MAAM,OAAO,SAAS,MAAqB;AAC3E,UAAMA,UAAS,KAAK,QAAQ,OAAO,wBAAwB;AAC3D,UAAM,OAAO,MAAM,KAAK,WAAW,GAAG;AACtC,QAAI,KAAK,WAAW,KAAK,QAAQ,KAAK;AAClC,MAAAA,QAAO,KAAK,8BAA8B,KAAK,QAAQ,GAAG;AAAA,IAC9D,OACK;AACD,MAAAA,QAAO,KAAK,YAAY;AAAA,IAC5B;AAEA,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAa,+BAA+B;AAAA,IACxC;AAAA,IACA;AAAA,IACA,eAAe;AAAA,EACnB,GAAsD;AAClD,UAAMA,UAAS,KAAK,QAAQ,OAAO,+BAA+B;AAElE,UAAM,iBAAiB,MAAM,KAAK,QAAQ,wCAAwC;AAAA,MAC9E;AAAA,MACA;AAAA,MACA;AAAA,MACA,kBAAkB,KAAK,SAAS;AAAA,IACpC,CAAC;AACD,IAAAA,QAAO,MAAM,qBAAqB;AAElC,UAAM,OAAO,MAAM,KAAK,WAAW,cAAc;AACjD,QAAI,KAAK,WAAW,KAAK,QAAQ,KAAK;AAClC,MAAAA,QAAO,KAAK,8BAA8B,KAAK,QAAQ,GAAG;AAAA,IAC9D,OAAO;AACH,MAAAA,QAAO,KAAK,YAAY;AAAA,IAC5B;AACA,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAa,YAAY,OAAwB,CAAC,GAAkB;AApPxE;AAqPQ,UAAMA,UAAS,KAAK,QAAQ,OAAO,aAAa;AAEhD,QAAI;AACJ,SAAI,UAAK,SAAS,SAAd,mBAAoB,yBAAyB;AAC7C,gBAAU,MAAM,KAAK,gBAAgB,KAAK,SAAS,IAAI;AAAA,IAC3D;AAEA,UAAM;AAAA,MACF;AAAA,MACA;AAAA,MACA;AAAA,MACA,GAAG;AAAA,IACP,IAAI;AACJ,UAAM,MAAM,KAAK,SAAS;AAC1B,QAAI,CAAC,KAAK;AACN,MAAAA,QAAO,MAAM,IAAI,MAAM,kCAAkC,CAAC;AAAA,IAC9D;AAEA,UAAM,SAAS,MAAM,KAAK,gBAAgB,QAAQ,EAAE,qBAAqB,mBAAmB,YAAY,CAAC;AACzG,UAAM,OAAO,MAAM,KAAK,QAAQ;AAAA,MAC5B,cAAc;AAAA,MACd,cAAc;AAAA,MACd,SAAS;AAAA,MACT;AAAA,MACA,GAAG;AAAA,IACP,GAAG,MAAM;AACT,QAAI,MAAM;AACN,UAAI,KAAK,WAAW,KAAK,QAAQ,KAAK;AAClC,QAAAA,QAAO,KAAK,8BAA8B,KAAK,QAAQ,GAAG;AAAA,MAC9D,OAAO;AACH,QAAAA,QAAO,KAAK,YAAY;AAAA,MAC5B;AAAA,IACJ;AAEA,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAa,oBAAoB,MAAM,OAAO,SAAS,MAAM,WAAW,OAAsB;AAC1F,UAAMA,UAAS,KAAK,QAAQ,OAAO,qBAAqB;AACxD,UAAM,KAAK,gBAAgB,SAAS,KAAK,EAAE,SAAS,CAAC;AACrD,IAAAA,QAAO,KAAK,SAAS;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAa,aAAa,OAAyB,CAAC,GAAyB;AA7SjF;AA8SQ,UAAMA,UAAS,KAAK,QAAQ,OAAO,cAAc;AACjD,UAAM;AAAA,MACF;AAAA,MACA,GAAG;AAAA,IACP,IAAI;AAEJ,QAAI,OAAO,MAAM,KAAK,UAAU;AAChC,QAAI,6BAAM,eAAe;AACrB,MAAAA,QAAO,MAAM,qBAAqB;AAClC,YAAM,QAAQ,IAAI,aAAa,IAAsB;AACrD,aAAO,MAAM,KAAK,iBAAiB;AAAA,QAC/B;AAAA,QACA,cAAc,YAAY;AAAA,QAC1B,UAAU,YAAY;AAAA,QACtB,kBAAkB,YAAY;AAAA,QAC9B,kBAAkB;AAAA,MACtB,CAAC;AAAA,IACL;AAEA,QAAI;AACJ,SAAI,UAAK,SAAS,SAAd,mBAAoB,yBAAyB;AAC7C,gBAAU,MAAM,KAAK,gBAAgB,KAAK,SAAS,IAAI;AAAA,IAC3D;AAEA,UAAM,MAAM,KAAK,SAAS;AAC1B,QAAI,CAAC,KAAK;AACN,MAAAA,QAAO,MAAM,IAAI,MAAM,mCAAmC,CAAC;AAAA,IAC/D;AAEA,QAAI;AACJ,QAAI,QAAQ,KAAK,SAAS,0BAA0B;AAChD,MAAAA,QAAO,MAAM,kCAAkC,KAAK,QAAQ,GAAG;AAC/D,kBAAY,KAAK,QAAQ;AAAA,IAC7B;AAEA,UAAM,SAAS,MAAM,KAAK,iBAAiB,QAAQ,EAAE,8BAA8B,CAAC;AACpF,WAAO,MAAM,KAAK,QAAQ;AAAA,MACtB,cAAc;AAAA,MACd,cAAc;AAAA,MACd,QAAQ;AAAA,MACR,eAAe,KAAK,SAAS,8BAA8B,6BAAM,WAAW;AAAA,MAC5E;AAAA,MACA,GAAG;AAAA,IACP,GAAG,QAAQ,SAAS;AACpB,QAAI,MAAM;AACN,WAAI,UAAK,YAAL,mBAAc,KAAK;AACnB,QAAAA,QAAO,KAAK,8BAA8B,KAAK,QAAQ,GAAG;AAAA,MAC9D,OACK;AACD,QAAAA,QAAO,KAAK,YAAY;AAAA,MAC5B;AAAA,IACJ;AAEA,WAAO;AAAA,EACX;AAAA,EAEA,MAAgB,iBAAiB,MAA0C;AACvE,UAAM,WAAW,MAAM,KAAK,QAAQ,gBAAgB;AAAA,MAChD,kBAAkB,KAAK,SAAS;AAAA,MAChC,GAAG;AAAA,IACP,CAAC;AACD,UAAM,OAAO,IAAI,KAAK,EAAE,GAAG,KAAK,OAAO,GAAG,SAAS,CAAC;AAEpD,UAAM,KAAK,UAAU,IAAI;AACzB,UAAM,KAAK,QAAQ,KAAK,IAAI;AAC5B,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,MAAa,qBAAqB,MAAM,OAAO,SAAS,MAAqB;AACzE,UAAMA,UAAS,KAAK,QAAQ,OAAO,sBAAsB;AACzD,UAAM,KAAK,iBAAiB,SAAS,GAAG;AACxC,IAAAA,QAAO,KAAK,SAAS;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,MAAa,eAAe,MAAM,OAAO,SAAS,MAAiC;AAC/E,UAAM,EAAE,MAAM,IAAI,MAAM,KAAK,QAAQ,wBAAwB,GAAG;AAChE,YAAQ,MAAM,cAAc;AAAA,MACxB,KAAK;AACD,eAAO,MAAM,KAAK,uBAAuB,GAAG;AAAA,MAChD,KAAK;AACD,cAAM,KAAK,oBAAoB,GAAG;AAClC;AAAA,MACJ,KAAK;AACD,cAAM,KAAK,qBAAqB,GAAG;AACnC;AAAA,MACJ;AACI,cAAM,IAAI,MAAM,gCAAgC;AAAA,IACxD;AACA,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,MAAa,gBAAgB,MAAM,OAAO,SAAS,MAAM,WAAW,OAA6C;AAC7G,UAAM,EAAE,MAAM,IAAI,MAAM,KAAK,QAAQ,yBAAyB,GAAG;AACjE,QAAI,CAAC,OAAO;AACR,aAAO;AAAA,IACX;AAEA,YAAQ,MAAM,cAAc;AAAA,MACxB,KAAK;AACD,eAAO,MAAM,KAAK,wBAAwB,GAAG;AAAA,MACjD,KAAK;AACD,cAAM,KAAK,qBAAqB,KAAK,QAAQ;AAC7C;AAAA,MACJ,KAAK;AACD,cAAM,KAAK,sBAAsB,GAAG;AACpC;AAAA,MACJ;AACI,cAAM,IAAI,MAAM,gCAAgC;AAAA,IACxD;AACA,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAa,mBAAmB,OAA+B,CAAC,GAAkC;AAC9F,UAAMA,UAAS,KAAK,QAAQ,OAAO,oBAAoB;AACvD,UAAM;AAAA,MACF;AAAA,MACA,GAAG;AAAA,IACP,IAAI;AACJ,UAAM,MAAM,KAAK,SAAS;AAC1B,QAAI,CAAC,KAAK;AACN,MAAAA,QAAO,MAAM,IAAI,MAAM,mCAAmC,CAAC;AAAA,IAC/D;AAEA,UAAM,OAAO,MAAM,KAAK,UAAU;AAClC,UAAM,SAAS,MAAM,KAAK,iBAAiB,QAAQ,EAAE,8BAA8B,CAAC;AACpF,UAAM,cAAc,MAAM,KAAK,aAAa;AAAA,MACxC,cAAc;AAAA;AAAA,MACd,cAAc;AAAA,MACd,QAAQ;AAAA,MACR,eAAe,KAAK,SAAS,8BAA8B,6BAAM,WAAW;AAAA,MAC5E,eAAe,KAAK,SAAS;AAAA,MAC7B,OAAO;AAAA,MACP,cAAc;AAAA,MACd,GAAG;AAAA,IACP,GAAG,MAAM;AACT,QAAI;AACA,YAAM,eAA4C,CAAC;AACnD,YAAM,iBAAiB,MAAM,KAAK,QAAQ,sBAAsB,YAAY,KAAK,YAAY;AAC7F,MAAAA,QAAO,MAAM,qBAAqB;AAElC,UAAI,eAAe,iBAAiB,eAAe,QAAQ,KAAK;AAC5D,QAAAA,QAAO,KAAK,uBAAuB,eAAe,QAAQ,GAAG;AAC7D,eAAO;AAAA,UACH,eAAe,eAAe;AAAA,UAC9B,KAAK,eAAe,QAAQ;AAAA,QAChC;AAAA,MACJ;AAEA,MAAAA,QAAO,KAAK,iCAAiC;AAC7C,aAAO;AAAA,IACX,SAAS,KAAK;AACV,UAAI,KAAK,SAAS,2BAA2B,eAAe,eAAe;AACvE,gBAAQ,IAAI,OAAO;AAAA,UACf,KAAK;AAAA,UACL,KAAK;AAAA,UACL,KAAK;AAAA,UACL,KAAK;AACD,YAAAA,QAAO,KAAK,4BAA4B;AACxC,mBAAO;AAAA;AAAA,cAEH,eAAe,IAAI;AAAA,YACvB;AAAA,QACR;AAAA,MACJ;AACA,YAAM;AAAA,IACV;AAAA,EACJ;AAAA,EAEA,MAAgB,QAAQ,MAA+B,QAAiB,WAAmC;AACvG,UAAM,cAAc,MAAM,KAAK,aAAa,MAAM,MAAM;AACxD,WAAO,MAAM,KAAK,WAAW,YAAY,KAAK,SAAS;AAAA,EAC3D;AAAA,EAEA,MAAgB,aAAa,MAA+B,QAA4C;AACpG,UAAMA,UAAS,KAAK,QAAQ,OAAO,cAAc;AAEjD,QAAI;AACA,YAAM,gBAAgB,MAAM,KAAK,QAAQ,oBAAoB,IAAI;AACjE,MAAAA,QAAO,MAAM,oBAAoB;AAEjC,aAAO,MAAM,OAAO,SAAS;AAAA,QACzB,KAAK,cAAc;AAAA,QACnB,OAAO,cAAc,MAAM;AAAA,QAC3B,eAAe,cAAc,MAAM;AAAA,QACnC,cAAc,KAAK,SAAS;AAAA,MAChC,CAAC;AAAA,IACL,SAAS,KAAK;AACV,MAAAA,QAAO,MAAM,2DAA2D;AACxE,aAAO,MAAM;AACb,YAAM;AAAA,IACV;AAAA,EACJ;AAAA,EAEA,MAAgB,WAAW,KAAa,WAAmC;AACvE,UAAMA,UAAS,KAAK,QAAQ,OAAO,YAAY;AAC/C,UAAM,eAA4C,CAAC;AACnD,UAAM,iBAAiB,MAAM,KAAK,QAAQ,sBAAsB,KAAK,YAAY;AACjF,IAAAA,QAAO,MAAM,qBAAqB;AAElC,UAAM,OAAO,MAAM,KAAK,WAAW,gBAAgB,SAAS;AAC5D,WAAO;AAAA,EACX;AAAA,EAEA,MAAgB,WAAW,gBAAgC,WAAoB;AAC3E,UAAMA,UAAS,KAAK,QAAQ,OAAO,YAAY;AAC/C,UAAM,OAAO,IAAI,KAAK,cAAc;AACpC,QAAI,WAAW;AACX,UAAI,cAAc,KAAK,QAAQ,KAAK;AAChC,QAAAA,QAAO,MAAM,2EAA2E,KAAK,QAAQ,GAAG;AACxG,cAAM,IAAI,cAAc,EAAE,GAAG,gBAAgB,OAAO,iBAAiB,CAAC;AAAA,MAC1E;AACA,MAAAA,QAAO,MAAM,gDAAgD;AAAA,IACjE;AAEA,UAAM,KAAK,UAAU,IAAI;AACzB,IAAAA,QAAO,MAAM,aAAa;AAC1B,UAAM,KAAK,QAAQ,KAAK,IAAI;AAE5B,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAa,gBAAgB,OAA4B,CAAC,GAAkB;AACxE,UAAMA,UAAS,KAAK,QAAQ,OAAO,iBAAiB;AACpD,UAAM;AAAA,MACF;AAAA,MACA,GAAG;AAAA,IACP,IAAI;AACJ,UAAM,SAAS,MAAM,KAAK,mBAAmB,QAAQ,EAAE,eAAe,CAAC;AACvE,UAAM,KAAK,cAAc;AAAA,MACrB,cAAc;AAAA,MACd,0BAA0B,KAAK,SAAS;AAAA,MACxC,GAAG;AAAA,IACP,GAAG,MAAM;AACT,IAAAA,QAAO,KAAK,SAAS;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAa,wBAAwB,MAAM,OAAO,SAAS,MAAgC;AACvF,UAAMA,UAAS,KAAK,QAAQ,OAAO,yBAAyB;AAC5D,UAAM,WAAW,MAAM,KAAK,YAAY,GAAG;AAC3C,IAAAA,QAAO,KAAK,SAAS;AACrB,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAa,aAAa,OAAyB,CAAC,GAAkB;AAClE,UAAMA,UAAS,KAAK,QAAQ,OAAO,cAAc;AACjD,UAAM;AAAA,MACF;AAAA,MACA;AAAA,MACA;AAAA,MACA,GAAG;AAAA,IACP,IAAI;AACJ,UAAM,MAAM,KAAK,SAAS;AAE1B,UAAM,SAAS,MAAM,KAAK,gBAAgB,QAAQ,EAAE,qBAAqB,mBAAmB,YAAY,CAAC;AACzG,UAAM,KAAK,SAAS;AAAA,MAChB,cAAc;AAAA,MACd,0BAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAM1B,OAAO,OAAO,OAAO,SAAY,CAAC;AAAA,MAClC,GAAG;AAAA,IACP,GAAG,MAAM;AACT,IAAAA,QAAO,KAAK,SAAS;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAa,qBAAqB,MAAM,OAAO,SAAS,MAAM,WAAW,OAAsB;AAC3F,UAAMA,UAAS,KAAK,QAAQ,OAAO,sBAAsB;AACzD,UAAM,KAAK,gBAAgB,SAAS,KAAK,EAAE,SAAS,CAAC;AACrD,IAAAA,QAAO,KAAK,SAAS;AAAA,EACzB;AAAA,EAEA,MAAgB,SAAS,MAAgC,QAA2C;AAChG,UAAM,cAAc,MAAM,KAAK,cAAc,MAAM,MAAM;AACzD,WAAO,MAAM,KAAK,YAAY,YAAY,GAAG;AAAA,EACjD;AAAA,EAEA,MAAgB,cAAc,OAAiC,CAAC,GAAG,QAA4C;AA/nBnH;AAgoBQ,UAAMA,UAAS,KAAK,QAAQ,OAAO,eAAe;AAElD,QAAI;AACA,YAAM,OAAO,MAAM,KAAK,UAAU;AAClC,MAAAA,QAAO,MAAM,kCAAkC;AAE/C,UAAI,KAAK,SAAS,uBAAuB;AACrC,cAAM,KAAK,gBAAgB,IAAI;AAAA,MACnC;AAEA,YAAM,WAAW,KAAK,iBAAiB,QAAQ,KAAK;AACpD,UAAI,UAAU;AACV,QAAAA,QAAO,MAAM,0CAA0C;AACvD,aAAK,gBAAgB;AAAA,MACzB;AAEA,YAAM,KAAK,WAAW;AACtB,MAAAA,QAAO,MAAM,wCAAwC;AAErD,YAAM,iBAAiB,MAAM,KAAK,QAAQ,qBAAqB,IAAI;AACnE,MAAAA,QAAO,MAAM,qBAAqB;AAElC,aAAO,MAAM,OAAO,SAAS;AAAA,QACzB,KAAK,eAAe;AAAA,QACpB,QAAO,oBAAe,UAAf,mBAAsB;AAAA,QAC7B,cAAc,KAAK,SAAS;AAAA,MAChC,CAAC;AAAA,IACL,SAAS,KAAK;AACV,MAAAA,QAAO,MAAM,2DAA2D;AACxE,aAAO,MAAM;AACb,YAAM;AAAA,IACV;AAAA,EACJ;AAAA,EAEA,MAAgB,YAAY,KAAuC;AAC/D,UAAMA,UAAS,KAAK,QAAQ,OAAO,aAAa;AAChD,UAAM,kBAAkB,MAAM,KAAK,QAAQ,uBAAuB,GAAG;AACrE,IAAAA,QAAO,MAAM,sBAAsB;AAEnC,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAa,cAAc,OAA0B,CAAC,GAAkB;AA/qB5E;AAgrBQ,UAAMA,UAAS,KAAK,QAAQ,OAAO,eAAe;AAClD,UAAM;AAAA,MACF;AAAA,MACA,GAAG;AAAA,IACP,IAAI;AAEJ,UAAM,gBAAgB,KAAK,SAAS,iCAC7B,WAAM,KAAK,UAAU,MAArB,mBAAyB,WAC1B;AAEN,UAAM,MAAM,KAAK,SAAS;AAC1B,UAAM,SAAS,MAAM,KAAK,iBAAiB,QAAQ,EAAE,8BAA8B,CAAC;AACpF,UAAM,KAAK,SAAS;AAAA,MAChB,cAAc;AAAA,MACd,0BAA0B;AAAA,MAC1B;AAAA,MACA,GAAG;AAAA,IACP,GAAG,MAAM;AAET,IAAAA,QAAO,KAAK,SAAS;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,MAAa,sBAAsB,MAAM,OAAO,SAAS,MAAqB;AAC1E,UAAMA,UAAS,KAAK,QAAQ,OAAO,uBAAuB;AAC1D,UAAM,KAAK,iBAAiB,SAAS,GAAG;AACxC,IAAAA,QAAO,KAAK,SAAS;AAAA,EACzB;AAAA,EAEA,MAAa,aAAa,OAA0C;AAChE,UAAM,OAAO,MAAM,KAAK,UAAU;AAClC,UAAM,KAAK,gBAAgB,MAAM,KAAK;AAAA,EAC1C;AAAA,EAEA,MAAgB,gBAAgB,MAAmB,QAAQ,KAAK,SAAS,kBAAiC;AACtG,UAAMA,UAAS,KAAK,QAAQ,OAAO,iBAAiB;AACpD,QAAI,CAAC,KAAM;AAEX,UAAM,eAAe,MAAM,OAAO,UAAQ,OAAO,KAAK,IAAI,MAAM,QAAQ;AAExE,QAAI,CAAC,aAAa,QAAQ;AACtB,MAAAA,QAAO,MAAM,sCAAsC;AACnD;AAAA,IACJ;AAGA,eAAW,QAAQ,cAAc;AAC7B,YAAM,KAAK,QAAQ;AAAA,QACf,KAAK,IAAI;AAAA;AAAA,QACT;AAAA,MACJ;AACA,MAAAA,QAAO,KAAK,GAAG,IAAI,uBAAuB;AAC1C,UAAI,SAAS,gBAAgB;AACzB,aAAK,IAAI,IAAI;AAAA,MACjB;AAAA,IACJ;AAEA,UAAM,KAAK,UAAU,IAAI;AACzB,IAAAA,QAAO,MAAM,aAAa;AAC1B,UAAM,KAAK,QAAQ,KAAK,IAAI;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKO,mBAAyB;AAC5B,SAAK,QAAQ,OAAO,kBAAkB;AACtC,SAAK,KAAK,oBAAoB,MAAM;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA,EAKO,kBAAwB;AAC3B,SAAK,oBAAoB,KAAK;AAAA,EAClC;AAAA,EAEA,IAAc,gBAAwB;AAClC,WAAO,QAAQ,KAAK,SAAS,SAAS,IAAI,KAAK,SAAS,SAAS;AAAA,EACrE;AAAA,EAEA,MAAgB,YAAkC;AAC9C,UAAMA,UAAS,KAAK,QAAQ,OAAO,WAAW;AAC9C,UAAM,gBAAgB,MAAM,KAAK,SAAS,UAAU,IAAI,KAAK,aAAa;AAC1E,QAAI,eAAe;AACf,MAAAA,QAAO,MAAM,2BAA2B;AACxC,aAAO,KAAK,kBAAkB,aAAa;AAAA,IAC/C;AAEA,IAAAA,QAAO,MAAM,uBAAuB;AACpC,WAAO;AAAA,EACX;AAAA,EAEA,MAAa,UAAU,MAAkC;AACrD,UAAMA,UAAS,KAAK,QAAQ,OAAO,WAAW;AAC9C,QAAI,MAAM;AACN,MAAAA,QAAO,MAAM,cAAc;AAC3B,YAAM,gBAAgB,KAAK,gBAAgB;AAC3C,YAAM,KAAK,SAAS,UAAU,IAAI,KAAK,eAAe,aAAa;AAAA,IACvE,OAAO;AACH,WAAK,QAAQ,MAAM,eAAe;AAClC,YAAM,KAAK,SAAS,UAAU,OAAO,KAAK,aAAa;AACvD,UAAI,KAAK,SAAS,MAAM;AACpB,cAAM,KAAK,SAAS,KAAK,MAAM,OAAO,KAAK,SAAS,SAAS;AAAA,MACjE;AAAA,IACJ;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKA,MAAa,kBAAiC;AAC1C,UAAM,KAAK,QAAQ,gBAAgB;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,MAAa,UAAU,KAAa,MAAY,YAAqB,OAA6C;AArzBtH;AAszBQ,UAAM,YAAY,QAAM,gBAAK,SAAS,SAAd,mBAAoB,UAApB,mBAA2B,IAAI,KAAK,SAAS;AACrE,QAAI,WAAW;AACX,aAAO,MAAM,YAAY,kBAAkB;AAAA,QACvC;AAAA,QACA,aAAa,6BAAM;AAAA,QACnB;AAAA,QACA,SAAS,UAAU;AAAA,QACnB;AAAA,MACJ,CAAC;AAAA,IACL;AACA,WAAO;AAAA,EACX;AAAA,EAEA,MAAM,gBAAgB,cAAyD;AAC3E,QAAI,YAAY,MAAM,aAAa,MAAM,IAAI,KAAK,SAAS,SAAS;AACpE,QAAI,CAAC,WAAW;AACZ,YAAM,WAAW,MAAM,YAAY,iBAAiB;AACpD,kBAAY,IAAI,UAAU,QAAQ;AAClC,YAAM,aAAa,MAAM,IAAI,KAAK,SAAS,WAAW,SAAS;AAAA,IACnE;AACA,WAAO,MAAM,YAAY,gBAAgB,UAAU,IAAI;AAAA,EAC3D;AACJ;;;AC10BE,cAAW;;;ACIN,IAAM,UAAkB;;;ACCxB,IAAM,qBAAN,MAA8C;AAAA,EAA9C;AACH,SAAS,UAAkB;AAC3B,SAAS,aAAqB;AAAA;AAAA,EAE9B,MAAa,IAAI,KAAa,OAAiC;AAC3D,UAAM,QAAQ,MAAM,KAAK,YAAY,KAAK,SAAS,KAAK,UAAU;AAClE,UAAM,MAAM,aAAa,CAAC,QAAwB;AAC9C,UAAI,IAAI,OAAO,GAAG;AAClB,aAAO,KAAK,iBAAiB,IAAI,WAAW;AAAA,IAChD,CAAC;AAAA,EACL;AAAA,EAEA,MAAa,IAAI,KAAiC;AAC9C,UAAM,QAAQ,MAAM,KAAK,YAAY,KAAK,SAAS,KAAK,UAAU;AAClE,WAAO,MAAM,MAAM,YAAY,CAAC,QAAQ;AACpC,aAAO,KAAK,iBAAiB,IAAI,IAAI,GAAG,CAAC;AAAA,IAC7C,CAAC;AAAA,EACL;AAAA,EAEA,MAAa,OAAO,KAAiC;AACjD,UAAM,OAAO,MAAM,KAAK,IAAI,GAAG;AAC/B,UAAM,QAAQ,MAAM,KAAK,YAAY,KAAK,SAAS,KAAK,UAAU;AAClE,UAAM,MAAM,aAAa,CAAC,QAAQ;AAC9B,aAAO,KAAK,iBAAiB,IAAI,OAAO,GAAG,CAAC;AAAA,IAChD,CAAC;AACD,WAAO;AAAA,EACX;AAAA,EAEA,MAAa,aAAgC;AACzC,UAAM,QAAQ,MAAM,KAAK,YAAY,KAAK,SAAS,KAAK,UAAU;AAClE,WAAO,MAAM,MAAM,YAAY,CAAC,QAAQ;AACpC,aAAO,KAAK,iBAAiB,IAAI,WAAW,CAAC;AAAA,IACjD,CAAC;AAAA,EACL;AAAA,EAEA,iBACI,SAAqD;AACrD,WAAO,IAAI,QAAW,CAAC,SAAS,WAAW;AACvC,MAAC,QAA2B,aAAc,QAA0B,YAAY,MAAM,QAAS,QAA0B,MAAM;AAC/H,MAAC,QAA2B,UAAW,QAA0B,UAAU,MAAM,OAAQ,QAA0B,KAAK;AAAA,IAC5H,CAAC;AAAA,EACL;AAAA,EAEA,MAAM,YACF,QACA,WAC4G;AAC5G,UAAM,UAAU,UAAU,KAAK,MAAM;AACrC,YAAQ,kBAAkB,MAAM,QAAQ,OAAO,kBAAkB,SAAS;AAC1E,UAAM,KAAK,MAAM,KAAK,iBAA8B,OAAO;AAE3D,WAAO,OACH,QACA,aACC;AACD,YAAM,KAAK,GAAG,YAAY,WAAW,MAAM;AAC3C,YAAM,QAAQ,GAAG,YAAY,SAAS;AACtC,aAAO,MAAM,SAAS,KAAK;AAAA,IAC/B;AAAA,EACJ;AACJ;",
-  "names": ["Log", "logger", "logger", "logger", "logger", "logger", "logger", "logger", "logger", "logger", "logger", "logger", "_a", "logger", "logger"]
+  "sources": ["../../src/index.ts", "../../src/utils/Logger.ts", "../../src/utils/JwtUtils.ts", "../../src/utils/CryptoUtils.ts", "../../src/utils/Event.ts", "../../src/utils/PopupUtils.ts", "../../src/utils/Timer.ts", "../../src/utils/UrlUtils.ts", "../../src/errors/ErrorResponse.ts", "../../src/errors/ErrorTimeout.ts", "../../src/AccessTokenEvents.ts", "../../src/CheckSessionIFrame.ts", "../../src/InMemoryWebStorage.ts", "../../src/errors/ErrorDPoPNonce.ts", "../../src/fetch.ts", "../../src/JsonService.ts", "../../src/MetadataService.ts", "../../src/WebStorageStateStore.ts", "../../src/OidcClientSettings.ts", "../../src/UserInfoService.ts", "../../src/TokenClient.ts", "../../src/ResponseValidator.ts", "../../src/State.ts", "../../src/SigninState.ts", "../../src/SigninRequest.ts", "../../src/SigninResponse.ts", "../../src/SignoutRequest.ts", "../../src/SignoutResponse.ts", "../../src/ClaimsService.ts", "../../src/DPoPStore.ts", "../../src/OidcClient.ts", "../../src/SessionMonitor.ts", "../../src/User.ts", "../../src/navigators/AbstractChildWindow.ts", "../../src/UserManagerSettings.ts", "../../src/navigators/IFrameWindow.ts", "../../src/navigators/IFrameNavigator.ts", "../../src/navigators/PopupWindow.ts", "../../src/navigators/PopupNavigator.ts", "../../src/navigators/RedirectNavigator.ts", "../../src/UserManagerEvents.ts", "../../src/SilentRenewService.ts", "../../src/RefreshState.ts", "../../src/UserManager.ts", "../../package.json", "../../src/Version.ts", "../../src/IndexedDbDPoPStore.ts"],
+  "sourcesContent": ["// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nexport { ErrorResponse, ErrorTimeout } from \"./errors\";\nexport type { INavigator, IFrameWindowParams, IWindow, NavigateParams, NavigateResponse, PopupWindowParams, RedirectParams } from \"./navigators\";\nexport { Log, Logger } from \"./utils\";\nexport type { ILogger, PopupWindowFeatures } from \"./utils\";\nexport type { OidcAddressClaim, OidcStandardClaims, IdTokenClaims, JwtClaims } from \"./Claims\";\n\nexport { AccessTokenEvents } from \"./AccessTokenEvents\";\nexport type { AccessTokenCallback } from \"./AccessTokenEvents\";\nexport { CheckSessionIFrame } from \"./CheckSessionIFrame\";\nexport { InMemoryWebStorage } from \"./InMemoryWebStorage\";\nexport type { AsyncStorage } from \"./AsyncStorage\";\nexport { MetadataService } from \"./MetadataService\";\nexport * from \"./OidcClient\";\nexport { OidcClientSettingsStore } from \"./OidcClientSettings\";\nexport type { OidcClientSettings, SigningKey, ExtraHeader } from \"./OidcClientSettings\";\nexport type { OidcMetadata } from \"./OidcMetadata\";\nexport { SessionMonitor } from \"./SessionMonitor\";\nexport type { SessionStatus } from \"./SessionStatus\";\nexport type { SigninRequest, SigninRequestCreateArgs } from \"./SigninRequest\";\nexport type { RefreshState } from \"./RefreshState\";\nexport { SigninResponse } from \"./SigninResponse\";\nexport { SigninState } from \"./SigninState\";\nexport type { SigninStateArgs, SigninStateCreateArgs } from \"./SigninState\";\nexport type { SignoutRequest, SignoutRequestArgs } from \"./SignoutRequest\";\nexport { SignoutResponse } from \"./SignoutResponse\";\nexport { State } from \"./State\";\nexport type { StateStore } from \"./StateStore\";\nexport { User } from \"./User\";\nexport type { UserProfile } from \"./User\";\nexport * from \"./UserManager\";\nexport type {\n    UserManagerEvents,\n    SilentRenewErrorCallback,\n    UserLoadedCallback,\n    UserSessionChangedCallback,\n    UserSignedInCallback,\n    UserSignedOutCallback,\n    UserUnloadedCallback,\n} from \"./UserManagerEvents\";\nexport { UserManagerSettingsStore } from \"./UserManagerSettings\";\nexport type { UserManagerSettings } from \"./UserManagerSettings\";\nexport { Version } from \"./Version\";\nexport { WebStorageStateStore } from \"./WebStorageStateStore\";\nexport { IndexedDbDPoPStore } from \"./IndexedDbDPoPStore\";\nexport { DPoPState } from \"./DPoPStore\";\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\n/**\n * Native interface\n *\n * @public\n */\nexport interface ILogger {\n    debug(...args: unknown[]): void;\n    info(...args: unknown[]): void;\n    warn(...args: unknown[]): void;\n    error(...args: unknown[]): void;\n}\n\nconst nopLogger: ILogger = {\n    debug: () => undefined,\n    info: () => undefined,\n    warn: () => undefined,\n    error: () => undefined,\n};\n\nlet level: number;\nlet logger: ILogger;\n\n/**\n * Log levels\n *\n * @public\n */\nexport enum Log {\n    NONE,\n    ERROR,\n    WARN,\n    INFO,\n    DEBUG\n}\n\n/**\n * Log manager\n *\n * @public\n */\nexport namespace Log { // eslint-disable-line @typescript-eslint/no-namespace\n    export function reset(): void {\n        level = Log.INFO;\n        logger = nopLogger;\n    }\n\n    export function setLevel(value: Log): void {\n        if (!(Log.NONE <= value && value <= Log.DEBUG)) {\n            throw new Error(\"Invalid log level\");\n        }\n        level = value;\n    }\n\n    export function setLogger(value: ILogger): void {\n        logger = value;\n    }\n}\n\n/**\n * Internal logger instance\n *\n * @public\n */\nexport class Logger {\n    private _method?: string;\n    public constructor(private _name: string) {}\n\n    /* eslint-disable @typescript-eslint/no-unsafe-enum-comparison */\n    public debug(...args: unknown[]): void {\n        if (level >= Log.DEBUG) {\n            logger.debug(Logger._format(this._name, this._method), ...args);\n        }\n    }\n    public info(...args: unknown[]): void {\n        if (level >= Log.INFO) {\n            logger.info(Logger._format(this._name, this._method), ...args);\n        }\n    }\n    public warn(...args: unknown[]): void {\n        if (level >= Log.WARN) {\n            logger.warn(Logger._format(this._name, this._method), ...args);\n        }\n    }\n    public error(...args: unknown[]): void {\n        if (level >= Log.ERROR) {\n            logger.error(Logger._format(this._name, this._method), ...args);\n        }\n    }\n    /* eslint-enable @typescript-eslint/no-unsafe-enum-comparison */\n\n    public throw(err: Error): never {\n        this.error(err);\n        throw err;\n    }\n\n    public create(method: string): Logger {\n        const methodLogger: Logger = Object.create(this);\n        methodLogger._method = method;\n        methodLogger.debug(\"begin\");\n        return methodLogger;\n    }\n\n    public static createStatic(name: string, staticMethod: string): Logger {\n        const staticLogger = new Logger(`${name}.${staticMethod}`);\n        staticLogger.debug(\"begin\");\n        return staticLogger;\n    }\n\n    private static _format(name: string, method?: string) {\n        const prefix = `[${name}]`;\n        return method ? `${prefix} ${method}:` : prefix;\n    }\n\n    /* eslint-disable @typescript-eslint/no-unsafe-enum-comparison */\n    // helpers for static class methods\n    public static debug(name: string, ...args: unknown[]): void {\n        if (level >= Log.DEBUG) {\n            logger.debug(Logger._format(name), ...args);\n        }\n    }\n    public static info(name: string, ...args: unknown[]): void {\n        if (level >= Log.INFO) {\n            logger.info(Logger._format(name), ...args);\n        }\n    }\n    public static warn(name: string, ...args: unknown[]): void {\n        if (level >= Log.WARN) {\n            logger.warn(Logger._format(name), ...args);\n        }\n    }\n    public static error(name: string, ...args: unknown[]): void {\n        if (level >= Log.ERROR) {\n            logger.error(Logger._format(name), ...args);\n        }\n    }\n    /* eslint-enable @typescript-eslint/no-unsafe-enum-comparison */\n}\n\nLog.reset();\n", "import { jwtDecode } from \"jwt-decode\";\n\nimport { Logger } from \"./Logger\";\nimport type { JwtClaims } from \"../Claims\";\nimport { CryptoUtils } from \"./CryptoUtils\";\n\n/**\n * @internal\n */\nexport class JwtUtils {\n    // IMPORTANT: doesn't validate the token\n    public static decode(token: string): JwtClaims {\n        try {\n            return jwtDecode<JwtClaims>(token);\n        }\n        catch (err) {\n            Logger.error(\"JwtUtils.decode\", err);\n            throw err;\n        }\n    }\n\n    public static async generateSignedJwt(header: object, payload: object, privateKey: CryptoKey) : Promise<string> {\n        const encodedHeader = CryptoUtils.encodeBase64Url(new TextEncoder().encode(JSON.stringify(header)));\n        const encodedPayload = CryptoUtils.encodeBase64Url(new TextEncoder().encode(JSON.stringify(payload)));\n        const encodedToken = `${encodedHeader}.${encodedPayload}`;\n\n        const signature = await window.crypto.subtle.sign(\n            {\n                name: \"ECDSA\",\n                hash: { name: \"SHA-256\" },\n            },\n            privateKey,\n            new TextEncoder().encode(encodedToken),\n        );\n\n        const encodedSignature = CryptoUtils.encodeBase64Url(new Uint8Array(signature));\n        return `${encodedToken}.${encodedSignature}`;\n    }\n}\n", "import { Logger } from \"./Logger\";\nimport { JwtUtils } from \"./JwtUtils\";\n\nexport interface GenerateDPoPProofOpts {\n    url: string;\n    accessToken?: string;\n    httpMethod?: string;\n    keyPair: CryptoKeyPair;\n    nonce?: string;\n}\n\nconst UUID_V4_TEMPLATE = \"10000000-1000-4000-8000-100000000000\";\n\nconst toBase64 = (val: ArrayBuffer): string =>\n    btoa([...new Uint8Array(val)]\n        .map((chr) => String.fromCharCode(chr))\n        .join(\"\"));\n\n/**\n * @internal\n */\nexport class CryptoUtils {\n    private static _randomWord(): number {\n        const arr = new Uint32Array(1);\n        crypto.getRandomValues(arr);\n        return arr[0];\n    }\n\n    /**\n     * Generates RFC4122 version 4 guid\n     */\n    public static generateUUIDv4(): string {\n        const uuid = UUID_V4_TEMPLATE.replace(/[018]/g, c =>\n            (+c ^ CryptoUtils._randomWord() & 15 >> +c / 4).toString(16),\n        );\n        return uuid.replace(/-/g, \"\");\n    }\n\n    /**\n     * PKCE: Generate a code verifier\n     */\n    public static generateCodeVerifier(): string {\n        return CryptoUtils.generateUUIDv4() + CryptoUtils.generateUUIDv4() + CryptoUtils.generateUUIDv4();\n    }\n\n    /**\n     * PKCE: Generate a code challenge\n     */\n    public static async generateCodeChallenge(code_verifier: string): Promise<string> {\n        if (!crypto.subtle) {\n            throw new Error(\"Crypto.subtle is available only in secure contexts (HTTPS).\");\n        }\n\n        try {\n            const encoder = new TextEncoder();\n            const data = encoder.encode(code_verifier);\n            const hashed = await crypto.subtle.digest(\"SHA-256\", data);\n            return toBase64(hashed).replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/, \"\");\n        }\n        catch (err) {\n            Logger.error(\"CryptoUtils.generateCodeChallenge\", err);\n            throw err;\n        }\n    }\n\n    /**\n     * Generates a base64-encoded string for a basic auth header\n     */\n    public static generateBasicAuth(client_id: string, client_secret: string): string {\n        const encoder = new TextEncoder();\n        const data = encoder.encode([client_id, client_secret].join(\":\"));\n        return toBase64(data);\n    }\n\n    /**\n     * Generates a hash of a string using a given algorithm\n     * @param alg\n     * @param message\n     */\n    public static async hash(alg: string, message: string) : Promise<Uint8Array> {\n        const msgUint8 = new TextEncoder().encode(message);\n        const hashBuffer = await crypto.subtle.digest(alg, msgUint8);\n        return new Uint8Array(hashBuffer);\n    }\n\n    /**\n     * Generates a base64url encoded string\n     */\n    public static encodeBase64Url = (input: Uint8Array) => {\n        return toBase64(input).replace(/=/g, \"\").replace(/\\+/g, \"-\").replace(/\\//g, \"_\");\n    };\n\n    /**\n     * Generates a rfc7638 compliant jwk thumbprint\n     * @param jwk\n     */\n    public static async customCalculateJwkThumbprint(jwk: JsonWebKey): Promise<string> {\n        let jsonObject: object;\n        switch (jwk.kty) {\n            case \"RSA\":\n                jsonObject = {\n                    \"e\": jwk.e,\n                    \"kty\": jwk.kty,\n                    \"n\": jwk.n,\n                };\n                break;\n            case \"EC\":\n                jsonObject = {\n                    \"crv\": jwk.crv,\n                    \"kty\": jwk.kty,\n                    \"x\": jwk.x,\n                    \"y\": jwk.y,\n                };\n                break;\n            case \"OKP\":\n                jsonObject = {\n                    \"crv\": jwk.crv,\n                    \"kty\": jwk.kty,\n                    \"x\": jwk.x,\n                };\n                break;\n            case \"oct\":\n                jsonObject = {\n                    \"crv\": jwk.k,\n                    \"kty\": jwk.kty,\n                };\n                break;\n            default:\n                throw new Error(\"Unknown jwk type\");\n        }\n        const utf8encodedAndHashed = await CryptoUtils.hash(\"SHA-256\", JSON.stringify(jsonObject));\n        return CryptoUtils.encodeBase64Url(utf8encodedAndHashed);\n    }\n\n    public static async generateDPoPProof({\n        url,\n        accessToken,\n        httpMethod,\n        keyPair,\n        nonce,\n    }: GenerateDPoPProofOpts): Promise<string> {\n        let hashedToken: Uint8Array;\n        let encodedHash: string;\n\n        const payload: Record<string, string | number> = {\n            \"jti\": window.crypto.randomUUID(),\n            \"htm\": httpMethod ?? \"GET\",\n            \"htu\": url,\n            \"iat\": Math.floor(Date.now() / 1000),\n        };\n\n        if (accessToken) {\n            hashedToken = await CryptoUtils.hash(\"SHA-256\", accessToken);\n            encodedHash = CryptoUtils.encodeBase64Url(hashedToken);\n            payload.ath = encodedHash;\n        }\n\n        if (nonce) {\n            payload.nonce = nonce;\n        }\n\n        try {\n            const publicJwk = await crypto.subtle.exportKey(\"jwk\", keyPair.publicKey);\n            const header = {\n                \"alg\": \"ES256\",\n                \"typ\": \"dpop+jwt\",\n                \"jwk\": {\n                    \"crv\": publicJwk.crv,\n                    \"kty\": publicJwk.kty,\n                    \"x\": publicJwk.x,\n                    \"y\": publicJwk.y,\n                },\n            };\n            return await JwtUtils.generateSignedJwt(header, payload, keyPair.privateKey);\n        } catch (err) {\n            if (err instanceof TypeError) {\n                throw new Error(`Error exporting dpop public key: ${err.message}`);\n            } else {\n                throw err;\n            }\n        }\n    }\n\n    public static async generateDPoPJkt(keyPair: CryptoKeyPair) : Promise<string> {\n        try {\n            const publicJwk = await crypto.subtle.exportKey(\"jwk\", keyPair.publicKey);\n            return await CryptoUtils.customCalculateJwkThumbprint(publicJwk);\n        } catch (err) {\n            if (err instanceof TypeError) {\n                throw new Error(`Could not retrieve dpop keys from storage: ${err.message}`);\n            } else {\n                throw err;\n            }\n        }\n    }\n\n    public static async generateDPoPKeys() : Promise<CryptoKeyPair> {\n        return await window.crypto.subtle.generateKey(\n            {\n                name: \"ECDSA\",\n                namedCurve: \"P-256\",\n            },\n            false,\n            [\"sign\", \"verify\"],\n        );\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"./Logger\";\n\n/**\n * @internal\n */\nexport type Callback<EventType extends unknown[]> = (...ev: EventType) => (Promise<void> | void);\n\n/**\n * @internal\n */\nexport class Event<EventType extends unknown[]> {\n    protected readonly _logger: Logger;\n\n    private readonly _callbacks: Array<Callback<EventType>> = [];\n\n    public constructor(protected readonly _name: string) {\n        this._logger = new Logger(`Event('${this._name}')`);\n    }\n\n    public addHandler(cb: Callback<EventType>): () => void {\n        this._callbacks.push(cb);\n        return () => this.removeHandler(cb);\n    }\n\n    public removeHandler(cb: Callback<EventType>): void {\n        const idx = this._callbacks.lastIndexOf(cb);\n        if (idx >= 0) {\n            this._callbacks.splice(idx, 1);\n        }\n    }\n\n    public async raise(...ev: EventType): Promise<void> {\n        this._logger.debug(\"raise:\", ...ev);\n        for (const cb of this._callbacks) {\n            await cb(...ev);\n        }\n    }\n}\n", "/**\n *\n * @public\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/open#window_features\n */\nexport interface PopupWindowFeatures {\n    left?: number;\n    top?: number;\n    width?: number;\n    height?: number;\n    menubar?: boolean | string;\n    toolbar?: boolean | string;\n    location?: boolean | string;\n    status?: boolean | string;\n    resizable?: boolean | string;\n    scrollbars?: boolean | string;\n    /** Close popup window after time in seconds, by default it is -1. To enable this feature, set value greater than 0. */\n    closePopupWindowAfterInSeconds?: number;\n\n    [k: string]: boolean | string | number | undefined;\n}\n\nexport class PopupUtils {\n    /**\n     * Populates a map of window features with a placement centered in front of\n     * the current window. If no explicit width is given, a default value is\n     * binned into [800, 720, 600, 480, 360] based on the current window's width.\n     */\n    static center({ ...features }: PopupWindowFeatures): PopupWindowFeatures {\n        if (features.width == null)\n            features.width = [800, 720, 600, 480].find(width => width <= window.outerWidth / 1.618) ?? 360;\n        features.left ??= Math.max(0, Math.round(window.screenX + (window.outerWidth - features.width) / 2));\n        if (features.height != null)\n            features.top ??= Math.max(0, Math.round(window.screenY + (window.outerHeight - features.height) / 2));\n        return features;\n    }\n\n    static serialize(features: PopupWindowFeatures): string {\n        return Object.entries(features)\n            .filter(([, value]) => value != null)\n            .map(([key, value]) => `${key}=${typeof value !== \"boolean\" ? value as string : value ? \"yes\" : \"no\"}`)\n            .join(\",\");\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Event } from \"./Event\";\nimport { Logger } from \"./Logger\";\n\n/**\n * @internal\n */\nexport class Timer extends Event<[void]> {\n    protected readonly _logger = new Logger(`Timer('${this._name}')`);\n    private _timerHandle: ReturnType<typeof setInterval> | null = null;\n    private _expiration = 0;\n\n    // get the time\n    public static getEpochTime(): number {\n        return Math.floor(Date.now() / 1000);\n    }\n\n    public init(durationInSeconds: number): void {\n        const logger = this._logger.create(\"init\");\n        durationInSeconds = Math.max(Math.floor(durationInSeconds), 1);\n        const expiration = Timer.getEpochTime() + durationInSeconds;\n        if (this.expiration === expiration && this._timerHandle) {\n            // no need to reinitialize to same expiration, so bail out\n            logger.debug(\"skipping since already initialized for expiration at\", this.expiration);\n            return;\n        }\n\n        this.cancel();\n\n        logger.debug(\"using duration\", durationInSeconds);\n        this._expiration = expiration;\n\n        // we're using a fairly short timer and then checking the expiration in the\n        // callback to handle scenarios where the browser device sleeps, and then\n        // the timers end up getting delayed.\n        const timerDurationInSeconds = Math.min(durationInSeconds, 5);\n        this._timerHandle = setInterval(this._callback, timerDurationInSeconds * 1000);\n    }\n\n    public get expiration(): number {\n        return this._expiration;\n    }\n\n    public cancel(): void {\n        this._logger.create(\"cancel\");\n        if (this._timerHandle) {\n            clearInterval(this._timerHandle);\n            this._timerHandle = null;\n        }\n    }\n\n    protected _callback = (): void => {\n        const diff = this._expiration - Timer.getEpochTime();\n        this._logger.debug(\"timer completes in\", diff);\n\n        if (this._expiration <= Timer.getEpochTime()) {\n            this.cancel();\n            void super.raise();\n        }\n    };\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\n/**\n * @internal\n */\nexport class UrlUtils {\n    public static readParams(url: string, responseMode: \"query\" | \"fragment\" = \"query\"): URLSearchParams {\n        if (!url) throw new TypeError(\"Invalid URL\");\n        // the base URL is irrelevant, it's just here to support relative url arguments\n        const parsedUrl = new URL(url, \"http://127.0.0.1\");\n        const params = parsedUrl[responseMode === \"fragment\" ? \"hash\" : \"search\"];\n        return new URLSearchParams(params.slice(1));\n    }\n}\n\n/**\n * @internal\n */\nexport const URL_STATE_DELIMITER = \";\";", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"../utils\";\n\n/**\n * Error class thrown in case of an authentication error.\n *\n * @public\n * @see https://openid.net/specs/openid-connect-core-1_0.html#AuthError\n */\nexport class ErrorResponse extends Error {\n    /** Marker to detect class: \"ErrorResponse\" */\n    public readonly name: string = \"ErrorResponse\";\n\n    /** An error code string that can be used to classify the types of errors that occur and to respond to errors. */\n    public readonly error: string | null;\n    /** additional information that can help a developer identify the cause of the error.*/\n    public readonly error_description: string | null;\n    /**\n     * URI identifying a human-readable web page with information about the error, used to provide the client\n       developer with additional information about the error.\n    */\n    public readonly error_uri: string | null;\n\n    /** custom state data set during the initial signin request */\n    public state?: unknown;\n\n    public readonly session_state: string | null;\n\n    public url_state?: string;\n\n    public constructor(\n        args: {\n            error?: string | null; error_description?: string | null; error_uri?: string | null;\n            userState?: unknown; session_state?: string | null; url_state?: string;\n        },\n        /** The x-www-form-urlencoded request body sent to the authority server */\n        public readonly form?: URLSearchParams,\n    ) {\n        super(args.error_description || args.error || \"\");\n\n        if (!args.error) {\n            Logger.error(\"ErrorResponse\", \"No error passed\");\n            throw new Error(\"No error passed\");\n        }\n\n        this.error = args.error;\n        this.error_description = args.error_description ?? null;\n        this.error_uri = args.error_uri ?? null;\n\n        this.state = args.userState;\n        this.session_state = args.session_state ?? null;\n        this.url_state = args.url_state;\n    }\n}\n", "// Copyright (C) 2021 AuthTS Contributors\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\n/**\n * Error class thrown in case of network timeouts (e.g IFrame time out).\n *\n * @public\n */\nexport class ErrorTimeout extends Error {\n    /** Marker to detect class: \"ErrorTimeout\" */\n    public readonly name: string = \"ErrorTimeout\";\n\n    public constructor(message?: string) {\n        super(message);\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, Timer } from \"./utils\";\nimport type { User } from \"./User\";\n\n/**\n * @public\n */\nexport type AccessTokenCallback = (...ev: unknown[]) => (Promise<void> | void);\n\n/**\n * @public\n */\nexport class AccessTokenEvents {\n    protected readonly _logger = new Logger(\"AccessTokenEvents\");\n\n    private readonly _expiringTimer = new Timer(\"Access token expiring\");\n    private readonly _expiredTimer = new Timer(\"Access token expired\");\n    private readonly _expiringNotificationTimeInSeconds: number;\n\n    public constructor(args: { expiringNotificationTimeInSeconds: number }) {\n        this._expiringNotificationTimeInSeconds = args.expiringNotificationTimeInSeconds;\n    }\n\n    public load(container: User): void {\n        const logger = this._logger.create(\"load\");\n        // only register events if there's an access token and it has an expiration\n        if (container.access_token && container.expires_in !== undefined) {\n            const duration = container.expires_in;\n            logger.debug(\"access token present, remaining duration:\", duration);\n\n            if (duration > 0) {\n                // only register expiring if we still have time\n                let expiring = duration - this._expiringNotificationTimeInSeconds;\n                if (expiring <= 0) {\n                    expiring = 1;\n                }\n\n                logger.debug(\"registering expiring timer, raising in\", expiring, \"seconds\");\n                this._expiringTimer.init(expiring);\n            }\n            else {\n                logger.debug(\"canceling existing expiring timer because we're past expiration.\");\n                this._expiringTimer.cancel();\n            }\n\n            // if it's negative, it will still fire\n            const expired = duration + 1;\n            logger.debug(\"registering expired timer, raising in\", expired, \"seconds\");\n            this._expiredTimer.init(expired);\n        }\n        else {\n            this._expiringTimer.cancel();\n            this._expiredTimer.cancel();\n        }\n    }\n\n    public unload(): void {\n        this._logger.debug(\"unload: canceling existing access token timers\");\n        this._expiringTimer.cancel();\n        this._expiredTimer.cancel();\n    }\n\n    /**\n     * Add callback: Raised prior to the access token expiring.\n     */\n    public addAccessTokenExpiring(cb: AccessTokenCallback): () => void {\n        return this._expiringTimer.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised prior to the access token expiring.\n     */\n    public removeAccessTokenExpiring(cb: AccessTokenCallback): void {\n        this._expiringTimer.removeHandler(cb);\n    }\n\n    /**\n     * Add callback: Raised after the access token has expired.\n     */\n    public addAccessTokenExpired(cb: AccessTokenCallback): () => void {\n        return this._expiredTimer.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised after the access token has expired.\n     */\n    public removeAccessTokenExpired(cb: AccessTokenCallback): void {\n        this._expiredTimer.removeHandler(cb);\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"./utils\";\n\n/**\n * @internal\n */\nexport class CheckSessionIFrame {\n    private readonly _logger = new Logger(\"CheckSessionIFrame\");\n    private _frame_origin: string;\n    private _frame: HTMLIFrameElement;\n    private _timer: ReturnType<typeof setInterval> | null = null;\n    private _session_state: string | null = null;\n\n    public constructor(\n        private _callback: () => Promise<void>,\n        private _client_id: string,\n        url: string,\n        private _intervalInSeconds: number,\n        private _stopOnError: boolean,\n    ) {\n        const parsedUrl = new URL(url);\n        this._frame_origin = parsedUrl.origin;\n\n        this._frame = window.document.createElement(\"iframe\");\n\n        // shotgun approach\n        this._frame.style.visibility = \"hidden\";\n        this._frame.style.position = \"fixed\";\n        this._frame.style.left = \"-1000px\";\n        this._frame.style.top = \"0\";\n        this._frame.width = \"0\";\n        this._frame.height = \"0\";\n        this._frame.src = parsedUrl.href;\n    }\n\n    public load(): Promise<void> {\n        return new Promise<void>((resolve) => {\n            this._frame.onload = () => {\n                resolve();\n            };\n\n            window.document.body.appendChild(this._frame);\n            window.addEventListener(\"message\", this._message, false);\n        });\n    }\n\n    private _message = (e: MessageEvent<string>): void => {\n        if (e.origin === this._frame_origin &&\n            e.source === this._frame.contentWindow\n        ) {\n            if (e.data === \"error\") {\n                this._logger.error(\"error message from check session op iframe\");\n                if (this._stopOnError) {\n                    this.stop();\n                }\n            }\n            else if (e.data === \"changed\") {\n                this._logger.debug(\"changed message from check session op iframe\");\n                this.stop();\n                void this._callback();\n            }\n            else {\n                this._logger.debug(e.data + \" message from check session op iframe\");\n            }\n        }\n    };\n\n    public start(session_state: string): void {\n        if (this._session_state === session_state) {\n            return;\n        }\n\n        this._logger.create(\"start\");\n\n        this.stop();\n\n        this._session_state = session_state;\n\n        const send = () => {\n            if (!this._frame.contentWindow || !this._session_state) {\n                return;\n            }\n\n            this._frame.contentWindow.postMessage(this._client_id + \" \" + this._session_state, this._frame_origin);\n        };\n\n        // trigger now\n        send();\n\n        // and setup timer\n        this._timer = setInterval(send, this._intervalInSeconds * 1000);\n    }\n\n    public stop(): void {\n        this._logger.create(\"stop\");\n        this._session_state = null;\n\n        if (this._timer) {\n\n            clearInterval(this._timer);\n            this._timer = null;\n        }\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"./utils\";\n\n/**\n * @public\n */\nexport class InMemoryWebStorage implements Storage {\n    private readonly _logger = new Logger(\"InMemoryWebStorage\");\n    private _data: Record<string, string> = {};\n\n    public clear(): void {\n        this._logger.create(\"clear\");\n        this._data = {};\n    }\n\n    public getItem(key: string): string {\n        this._logger.create(`getItem('${key}')`);\n        return this._data[key];\n    }\n\n    public setItem(key: string, value: string): void {\n        this._logger.create(`setItem('${key}')`);\n        this._data[key] = value;\n    }\n\n    public removeItem(key: string): void {\n        this._logger.create(`removeItem('${key}')`);\n        delete this._data[key];\n    }\n\n    public get length(): number {\n        return Object.getOwnPropertyNames(this._data).length;\n    }\n\n    public key(index: number): string {\n        return Object.getOwnPropertyNames(this._data)[index];\n    }\n}\n", "export class ErrorDPoPNonce extends Error {\n    /** Marker to detect class: \"ErrorDPoPNonce\" */\n    public readonly name: string = \"ErrorDPoPNonce\";\n    public readonly nonce: string;\n\n    public constructor(nonce: string, message?: string) {\n        super(message);\n        this.nonce = nonce;\n    }\n}\n", "let _fetch: typeof window.fetch | undefined = undefined;\n\nexport function setFetch(fetch: typeof window.fetch) {\n    _fetch = fetch;\n}\n\nexport function getFetch() {\n    if (_fetch === undefined) {\n        throw new Error(\"fetch is not set\");\n    }\n    return { fetch:_fetch };\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { ErrorResponse, ErrorTimeout } from \"./errors\";\nimport type { ExtraHeader } from \"./OidcClientSettings\";\nimport { Logger } from \"./utils\";\nimport { ErrorDPoPNonce } from \"./errors/ErrorDPoPNonce\";\nimport { getFetch } from \"./fetch\";\n\n/**\n * @internal\n */\nexport type JwtHandler = (text: string) => Promise<Record<string, unknown>>;\n\n/**\n * @internal\n */\nexport interface GetJsonOpts {\n    token?: string;\n    credentials?: RequestCredentials;\n    timeoutInSeconds?: number;\n}\n\n/**\n * @internal\n */\nexport interface PostFormOpts {\n    body: URLSearchParams;\n    basicAuth?: string;\n    timeoutInSeconds?: number;\n    initCredentials?: \"same-origin\" | \"include\" | \"omit\";\n    extraHeaders?: Record<string, ExtraHeader>;\n}\n\n/**\n * @internal\n */\nexport class JsonService {\n    private readonly _logger = new Logger(\"JsonService\");\n\n    private _contentTypes: string[] = [];\n\n    public constructor(\n        additionalContentTypes: string[] = [],\n        private _jwtHandler: JwtHandler | null = null,\n        private _extraHeaders: Record<string, ExtraHeader> = {},\n    ) {\n        this._contentTypes.push(...additionalContentTypes, \"application/json\");\n        if (_jwtHandler) {\n            this._contentTypes.push(\"application/jwt\");\n        }\n    }\n\n    protected async fetchWithTimeout(input: RequestInfo, init: RequestInit & { timeoutInSeconds?: number } = {}) {\n        const { timeoutInSeconds, ...initFetch } = init;\n\n        const { fetch } = getFetch();\n\n        if (!timeoutInSeconds) {\n            return await fetch(input, initFetch);\n        }\n\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), timeoutInSeconds * 1000);\n\n        try {\n            const response = await fetch(input, {\n                ...init,\n                signal: controller.signal,\n            });\n            return response;\n        }\n        catch (err) {\n            if (err instanceof DOMException && err.name === \"AbortError\") {\n                throw new ErrorTimeout(\"Network timed out\");\n            }\n            throw err;\n        }\n        finally {\n            clearTimeout(timeoutId);\n        }\n    }\n\n    public async getJson(url: string, {\n        token,\n        credentials,\n        timeoutInSeconds,\n    }: GetJsonOpts = {}): Promise<Record<string, unknown>> {\n        const logger = this._logger.create(\"getJson\");\n        const headers: HeadersInit = {\n            \"Accept\": this._contentTypes.join(\", \"),\n        };\n        if (token) {\n            logger.debug(\"token passed, setting Authorization header\");\n            headers[\"Authorization\"] = \"Bearer \" + token;\n        }\n\n        this.appendExtraHeaders(headers);\n\n        let response: Response;\n        try {\n            logger.debug(\"url:\", url);\n            response = await this.fetchWithTimeout(url, { method: \"GET\", headers, timeoutInSeconds, credentials });\n        }\n        catch (err) {\n            logger.error(\"Network Error\");\n            throw err;\n        }\n\n        logger.debug(\"HTTP response received, status\", response.status);\n        const contentType = response.headers.get(\"Content-Type\");\n        if (contentType && !this._contentTypes.find(item => contentType.startsWith(item))) {\n            logger.throw(new Error(`Invalid response Content-Type: ${(contentType ?? \"undefined\")}, from URL: ${url}`));\n        }\n        if (response.ok && this._jwtHandler && contentType?.startsWith(\"application/jwt\")) {\n            return await this._jwtHandler(await response.text());\n        }\n        let json: Record<string, unknown>;\n        try {\n            json = await response.json();\n        }\n        catch (err) {\n            logger.error(\"Error parsing JSON response\", err);\n            if (response.ok) throw err;\n            throw new Error(`${response.statusText} (${response.status})`);\n        }\n        if (!response.ok) {\n            logger.error(\"Error from server:\", json);\n            if (json.error) {\n                throw new ErrorResponse(json);\n            }\n            throw new Error(`${response.statusText} (${response.status}): ${JSON.stringify(json)}`);\n        }\n        return json;\n    }\n\n    public async postForm(url: string, {\n        body,\n        basicAuth,\n        timeoutInSeconds,\n        initCredentials,\n        extraHeaders,\n    }: PostFormOpts): Promise<Record<string, unknown>> {\n        const logger = this._logger.create(\"postForm\");\n        const headers: HeadersInit = {\n            \"Accept\": this._contentTypes.join(\", \"),\n            \"Content-Type\": \"application/x-www-form-urlencoded\",\n            ...extraHeaders,\n        };\n        if (basicAuth !== undefined) {\n            headers[\"Authorization\"] = \"Basic \" + basicAuth;\n        }\n\n        this.appendExtraHeaders(headers);\n\n        let response: Response;\n        try {\n            logger.debug(\"url:\", url);\n            response = await this.fetchWithTimeout(url, { method: \"POST\", headers, body, timeoutInSeconds, credentials: initCredentials });\n        }\n        catch (err) {\n            logger.error(\"Network error\");\n            throw err;\n        }\n\n        logger.debug(\"HTTP response received, status\", response.status);\n        const contentType = response.headers.get(\"Content-Type\");\n        if (contentType && !this._contentTypes.find(item => contentType.startsWith(item))) {\n            throw new Error(`Invalid response Content-Type: ${(contentType ?? \"undefined\")}, from URL: ${url}`);\n        }\n\n        const responseText = await response.text();\n\n        let json: Record<string, unknown> = {};\n        if (responseText) {\n            try {\n                json = JSON.parse(responseText);\n            }\n            catch (err) {\n                logger.error(\"Error parsing JSON response\", err);\n                if (response.ok) throw err;\n                throw new Error(`${response.statusText} (${response.status})`);\n            }\n        }\n\n        if (!response.ok) {\n            logger.error(\"Error from server:\", json);\n            if (response.headers.has(\"dpop-nonce\")) {\n                const nonce = response.headers.get(\"dpop-nonce\") as string;\n                throw new ErrorDPoPNonce(nonce, `${JSON.stringify(json)}`);\n            }\n            if (json.error) {\n                throw new ErrorResponse(json, body);\n            }\n            throw new Error(`${response.statusText} (${response.status}): ${JSON.stringify(json)}`);\n        }\n\n        return json;\n    }\n\n    private appendExtraHeaders(\n        headers: Record<string, string>,\n    ): void {\n        const logger = this._logger.create(\"appendExtraHeaders\");\n        const customKeys = Object.keys(this._extraHeaders);\n        const protectedHeaders = [\n            \"authorization\",\n            \"accept\",\n            \"content-type\",\n        ];\n        if (customKeys.length === 0) {\n            return;\n        }\n        customKeys.forEach((headerName) => {\n            if (protectedHeaders.includes(headerName.toLocaleLowerCase())) {\n                logger.warn(\"Protected header could not be overridden\", headerName, protectedHeaders);\n                return;\n            }\n            const content = (typeof this._extraHeaders[headerName] === \"function\") ?\n                (this._extraHeaders[headerName] as ()=>string)() :\n                this._extraHeaders[headerName];\n            if (content && content !== \"\") {\n                headers[headerName] = content as string;\n            }\n        });\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"./utils\";\nimport { JsonService } from \"./JsonService\";\nimport type { OidcClientSettingsStore, SigningKey } from \"./OidcClientSettings\";\nimport type { OidcMetadata } from \"./OidcMetadata\";\n\n/**\n * @public\n * @see https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata\n */\nexport class MetadataService {\n    private readonly _logger = new Logger(\"MetadataService\");\n    private readonly _jsonService;\n\n    // cache\n    private _metadataUrl: string;\n    private _signingKeys: SigningKey[] | null = null;\n    private _metadata: Partial<OidcMetadata> | null = null;\n    private _fetchRequestCredentials: RequestCredentials | undefined;\n\n    public constructor(private readonly _settings: OidcClientSettingsStore) {\n        this._metadataUrl = this._settings.metadataUrl;\n        this._jsonService = new JsonService(\n            [\"application/jwk-set+json\"],\n            null,\n            this._settings.extraHeaders,\n        );\n        if (this._settings.signingKeys) {\n            this._logger.debug(\"using signingKeys from settings\");\n            this._signingKeys = this._settings.signingKeys;\n        }\n\n        if (this._settings.metadata) {\n            this._logger.debug(\"using metadata from settings\");\n            this._metadata = this._settings.metadata;\n        }\n\n        if (this._settings.fetchRequestCredentials) {\n            this._logger.debug(\"using fetchRequestCredentials from settings\");\n            this._fetchRequestCredentials = this._settings.fetchRequestCredentials;\n        }\n    }\n\n    public resetSigningKeys(): void {\n        this._signingKeys = null;\n    }\n\n    public async getMetadata(): Promise<Partial<OidcMetadata>> {\n        const logger = this._logger.create(\"getMetadata\");\n        if (this._metadata) {\n            logger.debug(\"using cached values\");\n            return this._metadata;\n        }\n\n        if (!this._metadataUrl) {\n            logger.throw(new Error(\"No authority or metadataUrl configured on settings\"));\n            throw null;\n        }\n\n        logger.debug(\"getting metadata from\", this._metadataUrl);\n        const metadata = await this._jsonService.getJson(this._metadataUrl, { credentials: this._fetchRequestCredentials, timeoutInSeconds: this._settings.requestTimeoutInSeconds });\n\n        logger.debug(\"merging remote JSON with seed metadata\");\n        this._metadata = Object.assign({}, this._settings.metadataSeed, metadata);\n        return this._metadata;\n    }\n\n    public getIssuer(): Promise<string> {\n        return this._getMetadataProperty(\"issuer\") as Promise<string>;\n    }\n\n    public getAuthorizationEndpoint(): Promise<string> {\n        return this._getMetadataProperty(\"authorization_endpoint\") as Promise<string>;\n    }\n\n    public getUserInfoEndpoint(): Promise<string> {\n        return this._getMetadataProperty(\"userinfo_endpoint\") as Promise<string>;\n    }\n\n    public getTokenEndpoint(optional: false): Promise<string>;\n    public getTokenEndpoint(optional?: true): Promise<string | undefined>;\n    public getTokenEndpoint(optional = true): Promise<string | undefined> {\n        return this._getMetadataProperty(\"token_endpoint\", optional) as Promise<string | undefined>;\n    }\n\n    public getCheckSessionIframe(): Promise<string | undefined> {\n        return this._getMetadataProperty(\"check_session_iframe\", true) as Promise<string | undefined>;\n    }\n\n    public getEndSessionEndpoint(): Promise<string | undefined> {\n        return this._getMetadataProperty(\"end_session_endpoint\", true) as Promise<string | undefined>;\n    }\n\n    public getRevocationEndpoint(optional: false): Promise<string>;\n    public getRevocationEndpoint(optional?: true): Promise<string | undefined>;\n    public getRevocationEndpoint(optional = true): Promise<string | undefined> {\n        return this._getMetadataProperty(\"revocation_endpoint\", optional) as Promise<string | undefined>;\n    }\n\n    public getKeysEndpoint(optional: false): Promise<string>;\n    public getKeysEndpoint(optional?: true): Promise<string | undefined>;\n    public getKeysEndpoint(optional = true): Promise<string | undefined> {\n        return this._getMetadataProperty(\"jwks_uri\", optional) as Promise<string | undefined>;\n    }\n\n    protected async _getMetadataProperty(name: keyof OidcMetadata, optional=false): Promise<string | boolean | string[] | undefined> {\n        const logger = this._logger.create(`_getMetadataProperty('${name}')`);\n\n        const metadata = await this.getMetadata();\n        logger.debug(\"resolved\");\n\n        if (metadata[name] === undefined) {\n            if (optional === true) {\n                logger.warn(\"Metadata does not contain optional property\");\n                return undefined;\n            }\n\n            logger.throw(new Error(\"Metadata does not contain property \" + name));\n        }\n\n        return metadata[name];\n    }\n\n    public async getSigningKeys(): Promise<SigningKey[] | null> {\n        const logger = this._logger.create(\"getSigningKeys\");\n        if (this._signingKeys) {\n            logger.debug(\"returning signingKeys from cache\");\n            return this._signingKeys;\n        }\n\n        const jwks_uri = await this.getKeysEndpoint(false);\n        logger.debug(\"got jwks_uri\", jwks_uri);\n\n        const keySet = await this._jsonService.getJson(jwks_uri, { timeoutInSeconds: this._settings.requestTimeoutInSeconds });\n        logger.debug(\"got key set\", keySet);\n\n        if (!Array.isArray(keySet.keys)) {\n            logger.throw(new Error(\"Missing keys on keyset\"));\n            throw null; // https://github.com/microsoft/TypeScript/issues/46972\n        }\n\n        this._signingKeys = keySet.keys;\n        return this._signingKeys;\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"./utils\";\nimport type { StateStore } from \"./StateStore\";\nimport type { AsyncStorage } from \"./AsyncStorage\";\n\n/**\n * @public\n */\nexport class WebStorageStateStore implements StateStore {\n    private readonly _logger = new Logger(\"WebStorageStateStore\");\n\n    private readonly _store: AsyncStorage | Storage;\n    private readonly _prefix: string;\n\n    public constructor({\n        prefix = \"oidc.\",\n        store = localStorage,\n    }: { prefix?: string; store?: AsyncStorage | Storage } = {}) {\n        this._store = store;\n        this._prefix = prefix;\n    }\n\n    public async set(key: string, value: string): Promise<void> {\n        this._logger.create(`set('${key}')`);\n\n        key = this._prefix + key;\n        await this._store.setItem(key, value);\n    }\n\n    public async get(key: string): Promise<string | null> {\n        this._logger.create(`get('${key}')`);\n\n        key = this._prefix + key;\n        const item = await this._store.getItem(key);\n        return item;\n    }\n\n    public async remove(key: string): Promise<string | null> {\n        this._logger.create(`remove('${key}')`);\n\n        key = this._prefix + key;\n        const item = await this._store.getItem(key);\n        await this._store.removeItem(key);\n        return item;\n    }\n\n    public async getAllKeys(): Promise<string[]> {\n        this._logger.create(\"getAllKeys\");\n        const len = await this._store.length;\n\n        const keys = [];\n        for (let index = 0; index < len; index++) {\n            const key = await this._store.key(index);\n            if (key && key.indexOf(this._prefix) === 0) {\n                keys.push(key.substr(this._prefix.length));\n            }\n        }\n        return keys;\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { WebStorageStateStore } from \"./WebStorageStateStore\";\nimport type { OidcMetadata } from \"./OidcMetadata\";\nimport type { StateStore } from \"./StateStore\";\nimport { InMemoryWebStorage } from \"./InMemoryWebStorage\";\nimport type { DPoPStore } from \"./DPoPStore\";\n\nconst DefaultResponseType = \"code\";\nconst DefaultScope = \"openid\";\nconst DefaultClientAuthentication = \"client_secret_post\";\nconst DefaultStaleStateAgeInSeconds = 60 * 15;\n\n/**\n * @public\n */\nexport type SigningKey = Record<string, string | string[]>;\n\n/**\n * @public\n */\nexport type ExtraHeader = string | (() => string);\n\n/**\n * Optional DPoP settings\n * @public\n */\nexport interface DPoPSettings {\n    bind_authorization_code?: boolean;\n    store: DPoPStore;\n}\n\n/**\n * The settings used to configure the {@link OidcClient}.\n *\n * @public\n */\nexport interface OidcClientSettings {\n    stateQueryParamValue: string; /** oidc-spa addition */\n    fetch: typeof window.fetch; /** oidc-spa addition */\n\n    /** The URL of the OIDC/OAuth2 provider */\n    authority: string;\n    metadataUrl?: string;\n    /** Provide metadata when authority server does not allow CORS on the metadata endpoint */\n    metadata?: Partial<OidcMetadata>;\n    /** Can be used to seed or add additional values to the results of the discovery request */\n    metadataSeed?: Partial<OidcMetadata>;\n    /** Provide signingKeys when authority server does not allow CORS on the jwks uri */\n    signingKeys?: SigningKey[];\n\n    /** Your client application's identifier as registered with the OIDC/OAuth2 */\n    client_id: string;\n    client_secret?: string;\n    /** The type of response desired from the OIDC/OAuth2 provider (default: \"code\") */\n    response_type?: string;\n    /** The scope being requested from the OIDC/OAuth2 provider (default: \"openid\") */\n    scope?: string;\n    /** The redirect URI of your client application to receive a response from the OIDC/OAuth2 provider */\n    redirect_uri: string;\n    /** The OIDC/OAuth2 post-logout redirect URI */\n    post_logout_redirect_uri?: string;\n\n    /**\n     * Client authentication method that is used to authenticate when using the token endpoint (default: \"client_secret_post\")\n     * - \"client_secret_basic\": using the HTTP Basic authentication scheme\n     * - \"client_secret_post\": including the client credentials in the request body\n     *\n     * See https://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication\n     */\n    client_authentication?: \"client_secret_basic\" | \"client_secret_post\";\n\n    /** optional protocol param */\n    prompt?: string;\n    /** optional protocol param */\n    display?: string;\n    /** optional protocol param */\n    max_age?: number;\n    /** optional protocol param */\n    ui_locales?: string;\n    /** optional protocol param */\n    acr_values?: string;\n    /** optional protocol param */\n    resource?: string | string[];\n\n    /**\n     * Optional protocol param\n     * The response mode used by the authority server is defined by the response_type unless explicitly specified:\n     * - Response mode for the OAuth 2.0 response type \"code\" is the \"query\" encoding\n     * - Response mode for the OAuth 2.0 response type \"token\" is the \"fragment\" encoding\n     *\n     * @see https://openid.net/specs/oauth-v2-multiple-response-types-1_0.html#ResponseModes\n     */\n    response_mode?: \"query\" | \"fragment\";\n\n    /**\n     * Should optional OIDC protocol claims be removed from profile or specify the ones to be removed (default: true)\n     * When true, the following claims are removed by default: [\"nbf\", \"jti\", \"auth_time\", \"nonce\", \"acr\", \"amr\", \"azp\", \"at_hash\"]\n     * When specifying claims, the following claims are not allowed: [\"sub\", \"iss\", \"aud\", \"exp\", \"iat\"]\n    */\n    filterProtocolClaims?: boolean | string[];\n    /** Flag to control if additional identity data is loaded from the user info endpoint in order to populate the user's profile (default: false) */\n    loadUserInfo?: boolean;\n    /** Number (in seconds) indicating the age of state entries in storage for authorize requests that are considered abandoned and thus can be cleaned up (default: 900) */\n    staleStateAgeInSeconds?: number;\n\n    /**\n     * Indicates how objects returned from the user info endpoint as claims (e.g. `address`) are merged into the claims from the\n     * id token as a single object.  (default: `{ array: \"replace\" }`)\n     * - array: \"replace\": natives (string, int, float) and arrays are replaced, objects are merged as distinct objects\n     * - array: \"merge\": natives (string, int, float) are replaced, arrays and objects are merged as distinct objects\n     */\n    mergeClaimsStrategy?: { array: \"replace\" | \"merge\" };\n\n    /**\n     * Storage object used to persist interaction state (default: window.localStorage, InMemoryWebStorage iff no window).\n     * E.g. `stateStore: new WebStorageStateStore({ store: window.localStorage })`\n     */\n    stateStore?: StateStore;\n\n    /**\n     * An object containing additional query string parameters to be including in the authorization request.\n     * E.g, when using Azure AD to obtain an access token an additional resource parameter is required. extraQueryParams: `{resource:\"some_identifier\"}`\n     */\n    extraQueryParams?: Record<string, string | number | boolean>;\n\n    extraTokenParams?: Record<string, unknown>;\n\n    /**\n     * An object containing additional header to be including in request.\n     */\n    extraHeaders?: Record<string, ExtraHeader>;\n\n    /**\n     * DPoP enabled or disabled\n     */\n    dpop?: DPoPSettings | undefined;\n\n    /**\n     * Will check the content type header of the response of the revocation endpoint to match these passed values (default: [])\n     */\n    revokeTokenAdditionalContentTypes?: string[];\n    /**\n     * Will disable PKCE validation, changing to true will not append to sign in request code_challenge and code_challenge_method. (default: false)\n     */\n    disablePKCE?: boolean;\n    /**\n     * Sets the credentials for fetch requests. (default: \"same-origin\")\n     * Use this if you need to send cookies to the OIDC/OAuth2 provider or if you are using a proxy that requires cookies\n     */\n    fetchRequestCredentials?: RequestCredentials;\n\n    /**\n     * Only scopes in this list will be passed in the token refresh request.\n     */\n    refreshTokenAllowedScope?: string | undefined;\n\n    /**\n     * Defines request timeouts globally across all requests made to the authorisation server\n     */\n    requestTimeoutInSeconds?: number | undefined;\n\n    /**\n     * https://datatracker.ietf.org/doc/html/rfc6749#section-3.3 describes behavior when omitting scopes from sign in requests\n     * If the IDP supports default scopes, this setting will ignore the scopes property passed to the config. (Default: false)\n     */\n    omitScopeWhenRequesting?: boolean;\n}\n\n/**\n * The settings with defaults applied of the {@link OidcClient}.\n *\n * @public\n * @see {@link OidcClientSettings}\n */\nexport class OidcClientSettingsStore {\n\n    public readonly stateQueryParamValue: string;\n    public readonly fetch: typeof window.fetch;\n\n    // metadata\n    public readonly authority: string;\n    public readonly metadataUrl: string;\n    public readonly metadata: Partial<OidcMetadata> | undefined;\n    public readonly metadataSeed: Partial<OidcMetadata> | undefined;\n    public readonly signingKeys: SigningKey[] | undefined;\n\n    // client config\n    public readonly client_id: string;\n    public readonly client_secret: string | undefined;\n    public readonly response_type: string;\n    public readonly scope: string;\n    public readonly redirect_uri: string;\n    public readonly post_logout_redirect_uri: string | undefined;\n    public readonly client_authentication: \"client_secret_basic\" | \"client_secret_post\";\n\n    // optional protocol params\n    public readonly prompt: string | undefined;\n    public readonly display: string | undefined;\n    public readonly max_age: number | undefined;\n    public readonly ui_locales: string | undefined;\n    public readonly acr_values: string | undefined;\n    public readonly resource: string | string[] | undefined;\n    public readonly response_mode: \"query\" | \"fragment\" | undefined;\n\n    // behavior flags\n    public readonly filterProtocolClaims: boolean | string[];\n    public readonly loadUserInfo: boolean;\n    public readonly staleStateAgeInSeconds: number;\n    public readonly mergeClaimsStrategy: { array: \"replace\" | \"merge\" };\n    public readonly omitScopeWhenRequesting: boolean;\n\n    public readonly stateStore: StateStore;\n\n    // extra\n    public readonly extraQueryParams: Record<string, string | number | boolean>;\n    public readonly extraTokenParams: Record<string, unknown>;\n    public readonly dpop: DPoPSettings | undefined;\n    public readonly extraHeaders: Record<string, ExtraHeader>;\n\n    public readonly revokeTokenAdditionalContentTypes?: string[];\n    public readonly fetchRequestCredentials: RequestCredentials;\n    public readonly refreshTokenAllowedScope: string | undefined;\n    public readonly disablePKCE: boolean;\n    public readonly requestTimeoutInSeconds: number | undefined;\n\n    public constructor({\n        stateQueryParamValue,\n        fetch,\n        // metadata related\n        authority, metadataUrl, metadata, signingKeys, metadataSeed,\n        // client related\n        client_id, client_secret, response_type = DefaultResponseType, scope = DefaultScope,\n        redirect_uri, post_logout_redirect_uri,\n        client_authentication = DefaultClientAuthentication,\n        // optional protocol\n        prompt, display, max_age, ui_locales, acr_values, resource, response_mode,\n        // behavior flags\n        filterProtocolClaims = true,\n        loadUserInfo = false,\n        requestTimeoutInSeconds,\n        staleStateAgeInSeconds = DefaultStaleStateAgeInSeconds,\n        mergeClaimsStrategy = { array: \"replace\" },\n        disablePKCE = false,\n        // other behavior\n        stateStore,\n        revokeTokenAdditionalContentTypes,\n        fetchRequestCredentials,\n        refreshTokenAllowedScope,\n        // extra\n        extraQueryParams = {},\n        extraTokenParams = {},\n        extraHeaders = {},\n        dpop,\n        omitScopeWhenRequesting = false,\n    }: OidcClientSettings) {\n\n        this.stateQueryParamValue = stateQueryParamValue;\n\n        this.fetch = fetch;\n\n        this.authority = authority;\n\n        if (metadataUrl) {\n            this.metadataUrl = metadataUrl;\n        } else {\n            this.metadataUrl = authority;\n            if (authority) {\n                if (!this.metadataUrl.endsWith(\"/\")) {\n                    this.metadataUrl += \"/\";\n                }\n                this.metadataUrl += \".well-known/openid-configuration\";\n            }\n        }\n\n        this.metadata = metadata;\n        this.metadataSeed = metadataSeed;\n        this.signingKeys = signingKeys;\n\n        this.client_id = client_id;\n        this.client_secret = client_secret;\n        this.response_type = response_type;\n        this.scope = scope;\n        this.redirect_uri = redirect_uri;\n        this.post_logout_redirect_uri = post_logout_redirect_uri;\n        this.client_authentication = client_authentication;\n\n        this.prompt = prompt;\n        this.display = display;\n        this.max_age = max_age;\n        this.ui_locales = ui_locales;\n        this.acr_values = acr_values;\n        this.resource = resource;\n        this.response_mode = response_mode;\n\n        this.filterProtocolClaims = filterProtocolClaims ?? true;\n        this.loadUserInfo = !!loadUserInfo;\n        this.staleStateAgeInSeconds = staleStateAgeInSeconds;\n        this.mergeClaimsStrategy = mergeClaimsStrategy;\n        this.omitScopeWhenRequesting = omitScopeWhenRequesting;\n        this.disablePKCE = !!disablePKCE;\n        this.revokeTokenAdditionalContentTypes = revokeTokenAdditionalContentTypes;\n\n        this.fetchRequestCredentials = fetchRequestCredentials ? fetchRequestCredentials : \"same-origin\";\n        this.requestTimeoutInSeconds = requestTimeoutInSeconds;\n\n        if (stateStore) {\n            this.stateStore = stateStore;\n        }\n        else {\n            const store = typeof window !== \"undefined\" ? window.localStorage : new InMemoryWebStorage();\n            this.stateStore = new WebStorageStateStore({ store });\n        }\n\n        this.refreshTokenAllowedScope = refreshTokenAllowedScope;\n\n        this.extraQueryParams = extraQueryParams;\n        this.extraTokenParams = extraTokenParams;\n        this.extraHeaders = extraHeaders;\n\n        this.dpop = dpop;\n        if (this.dpop && !this.dpop?.store) {\n            throw new Error(\"A DPoPStore is required when dpop is enabled\");\n        }\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, JwtUtils } from \"./utils\";\nimport { JsonService } from \"./JsonService\";\nimport type { MetadataService } from \"./MetadataService\";\nimport type { JwtClaims } from \"./Claims\";\nimport type { OidcClientSettingsStore } from \"./OidcClientSettings\";\n\n/**\n * @internal\n */\nexport class UserInfoService {\n    protected readonly _logger = new Logger(\"UserInfoService\");\n    private readonly _jsonService: JsonService;\n\n    public constructor(private readonly _settings: OidcClientSettingsStore,\n        private readonly _metadataService: MetadataService,\n    ) {\n        this._jsonService = new JsonService(\n            undefined,\n            this._getClaimsFromJwt,\n            this._settings.extraHeaders,\n        );\n    }\n\n    public async getClaims(token: string): Promise<JwtClaims> {\n        const logger = this._logger.create(\"getClaims\");\n        if (!token) {\n            this._logger.throw(new Error(\"No token passed\"));\n        }\n\n        const url = await this._metadataService.getUserInfoEndpoint();\n        logger.debug(\"got userinfo url\", url);\n\n        const claims = await this._jsonService.getJson(url, {\n            token,\n            credentials: this._settings.fetchRequestCredentials,\n            timeoutInSeconds: this._settings.requestTimeoutInSeconds,\n        });\n        logger.debug(\"got claims\", claims);\n\n        return claims;\n    }\n\n    protected _getClaimsFromJwt = async (responseText: string): Promise<JwtClaims> => {\n        const logger = this._logger.create(\"_getClaimsFromJwt\");\n        try {\n            const payload = JwtUtils.decode(responseText);\n            logger.debug(\"JWT decoding successful\");\n\n            return payload;\n        } catch (err) {\n            logger.error(\"Error parsing JWT response\");\n            throw err;\n        }\n    };\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { CryptoUtils, Logger } from \"./utils\";\nimport { JsonService } from \"./JsonService\";\nimport type { MetadataService } from \"./MetadataService\";\nimport type { ExtraHeader, OidcClientSettingsStore } from \"./OidcClientSettings\";\n\n/**\n * @internal\n */\nexport interface ExchangeCodeArgs {\n    client_id?: string;\n    client_secret?: string;\n    redirect_uri?: string;\n\n    grant_type?: string;\n    code: string;\n    code_verifier?: string;\n\n    extraHeaders?: Record<string, ExtraHeader>;\n}\n\n/**\n * @internal\n */\nexport interface ExchangeCredentialsArgs {\n    client_id?: string;\n    client_secret?: string;\n\n    grant_type?: string;\n    scope?: string;\n\n    username: string;\n    password: string;\n}\n\n/**\n * @internal\n */\nexport interface ExchangeRefreshTokenArgs {\n    client_id?: string;\n    client_secret?: string;\n    redirect_uri?: string;\n\n    grant_type?: string;\n    refresh_token: string;\n    scope?: string;\n    resource?: string | string[];\n\n    timeoutInSeconds?: number;\n\n    extraHeaders?: Record<string, ExtraHeader>;\n}\n\n/**\n * @internal\n */\nexport interface RevokeArgs {\n    token: string;\n    token_type_hint?: \"access_token\" | \"refresh_token\";\n}\n\n/**\n * @internal\n */\nexport class TokenClient {\n    private readonly _logger = new Logger(\"TokenClient\");\n    private readonly _jsonService;\n\n    public constructor(\n        private readonly _settings: OidcClientSettingsStore,\n        private readonly _metadataService: MetadataService,\n    ) {\n        this._jsonService = new JsonService(\n            this._settings.revokeTokenAdditionalContentTypes,\n            null,\n            this._settings.extraHeaders,\n        );\n    }\n\n    /**\n     * Exchange code.\n     *\n     * @see https://www.rfc-editor.org/rfc/rfc6749#section-4.1.3\n     */\n    public async exchangeCode({\n        grant_type = \"authorization_code\",\n        redirect_uri = this._settings.redirect_uri,\n        client_id = this._settings.client_id,\n        client_secret = this._settings.client_secret,\n        extraHeaders,\n        ...args\n    }: ExchangeCodeArgs): Promise<Record<string, unknown>> {\n        const logger = this._logger.create(\"exchangeCode\");\n        if (!client_id) {\n            logger.throw(new Error(\"A client_id is required\"));\n        }\n        if (!redirect_uri) {\n            logger.throw(new Error(\"A redirect_uri is required\"));\n        }\n        if (!args.code) {\n            logger.throw(new Error(\"A code is required\"));\n        }\n\n        const params = new URLSearchParams({ grant_type, redirect_uri });\n        for (const [key, value] of Object.entries(args)) {\n            if (value != null) {\n                params.set(key, value);\n            }\n        }\n        let basicAuth: string | undefined;\n        switch (this._settings.client_authentication) {\n            case \"client_secret_basic\":\n                if (!client_secret) {\n                    logger.throw(new Error(\"A client_secret is required\"));\n                    throw null; // https://github.com/microsoft/TypeScript/issues/46972\n                }\n                basicAuth = CryptoUtils.generateBasicAuth(client_id, client_secret);\n                break;\n            case \"client_secret_post\":\n                params.append(\"client_id\", client_id);\n                if (client_secret) {\n                    params.append(\"client_secret\", client_secret);\n                }\n                break;\n        }\n\n        const url = await this._metadataService.getTokenEndpoint(false);\n        logger.debug(\"got token endpoint\");\n\n        const response = await this._jsonService.postForm(url, {\n            body: params,\n            basicAuth,\n            timeoutInSeconds: this._settings.requestTimeoutInSeconds,\n            initCredentials: this._settings.fetchRequestCredentials,\n            extraHeaders,\n        });\n\n        logger.debug(\"got response\");\n\n        return response;\n    }\n\n    /**\n     * Exchange credentials.\n     *\n     * @see https://www.rfc-editor.org/rfc/rfc6749#section-4.3.2\n     */\n    public async exchangeCredentials({\n        grant_type = \"password\",\n        client_id = this._settings.client_id,\n        client_secret = this._settings.client_secret,\n        scope = this._settings.scope,\n        ...args\n    }: ExchangeCredentialsArgs): Promise<Record<string, unknown>> {\n        const logger = this._logger.create(\"exchangeCredentials\");\n\n        if (!client_id) {\n            logger.throw(new Error(\"A client_id is required\"));\n        }\n\n        const params = new URLSearchParams({ grant_type });\n        if (!this._settings.omitScopeWhenRequesting) {\n            params.set(\"scope\", scope);\n        }\n        for (const [key, value] of Object.entries(args)) {\n            if (value != null) {\n                params.set(key, value);\n            }\n        }\n\n        let basicAuth: string | undefined;\n        switch (this._settings.client_authentication) {\n            case \"client_secret_basic\":\n                if (!client_secret) {\n                    logger.throw(new Error(\"A client_secret is required\"));\n                    throw null; // https://github.com/microsoft/TypeScript/issues/46972\n                }\n                basicAuth = CryptoUtils.generateBasicAuth(client_id, client_secret);\n                break;\n            case \"client_secret_post\":\n                params.append(\"client_id\", client_id);\n                if (client_secret) {\n                    params.append(\"client_secret\", client_secret);\n                }\n                break;\n        }\n\n        const url = await this._metadataService.getTokenEndpoint(false);\n        logger.debug(\"got token endpoint\");\n\n        const response = await this._jsonService.postForm(url, { body: params, basicAuth, timeoutInSeconds: this._settings.requestTimeoutInSeconds, initCredentials: this._settings.fetchRequestCredentials });\n        logger.debug(\"got response\");\n\n        return response;\n    }\n\n    /**\n     * Exchange a refresh token.\n     *\n     * @see https://www.rfc-editor.org/rfc/rfc6749#section-6\n     */\n    public async exchangeRefreshToken({\n        grant_type = \"refresh_token\",\n        client_id = this._settings.client_id,\n        client_secret = this._settings.client_secret,\n        timeoutInSeconds,\n        extraHeaders,\n        ...args\n    }: ExchangeRefreshTokenArgs): Promise<Record<string, unknown>> {\n        const logger = this._logger.create(\"exchangeRefreshToken\");\n        if (!client_id) {\n            logger.throw(new Error(\"A client_id is required\"));\n        }\n        if (!args.refresh_token) {\n            logger.throw(new Error(\"A refresh_token is required\"));\n        }\n\n        const params = new URLSearchParams({ grant_type });\n        for (const [key, value] of Object.entries(args)) {\n            if (Array.isArray(value)) {\n                value.forEach(param => params.append(key, param));\n            }\n            else if (value != null) {\n                params.set(key, value);\n            }\n        }\n        let basicAuth: string | undefined;\n        switch (this._settings.client_authentication) {\n            case \"client_secret_basic\":\n                if (!client_secret) {\n                    logger.throw(new Error(\"A client_secret is required\"));\n                    throw null; // https://github.com/microsoft/TypeScript/issues/46972\n                }\n                basicAuth = CryptoUtils.generateBasicAuth(client_id, client_secret);\n                break;\n            case \"client_secret_post\":\n                params.append(\"client_id\", client_id);\n                if (client_secret) {\n                    params.append(\"client_secret\", client_secret);\n                }\n                break;\n        }\n\n        const url = await this._metadataService.getTokenEndpoint(false);\n        logger.debug(\"got token endpoint\");\n\n        const response = await this._jsonService.postForm(url, { body: params, basicAuth, timeoutInSeconds, initCredentials: this._settings.fetchRequestCredentials, extraHeaders });\n        logger.debug(\"got response\");\n\n        return response;\n    }\n\n    /**\n     * Revoke an access or refresh token.\n     *\n     * @see https://datatracker.ietf.org/doc/html/rfc7009#section-2.1\n     */\n    public async revoke(args: RevokeArgs): Promise<void> {\n        const logger = this._logger.create(\"revoke\");\n        if (!args.token) {\n            logger.throw(new Error(\"A token is required\"));\n        }\n\n        const url = await this._metadataService.getRevocationEndpoint(false);\n\n        logger.debug(`got revocation endpoint, revoking ${args.token_type_hint ?? \"default token type\"}`);\n\n        const params = new URLSearchParams();\n        for (const [key, value] of Object.entries(args)) {\n            if (value != null) {\n                params.set(key, value);\n            }\n        }\n        params.set(\"client_id\", this._settings.client_id);\n        if (this._settings.client_secret) {\n            params.set(\"client_secret\", this._settings.client_secret);\n        }\n\n        await this._jsonService.postForm(url, { body: params, timeoutInSeconds: this._settings.requestTimeoutInSeconds });\n        logger.debug(\"got response\");\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, JwtUtils } from \"./utils\";\nimport { ErrorResponse } from \"./errors\";\nimport type { MetadataService } from \"./MetadataService\";\nimport { UserInfoService } from \"./UserInfoService\";\nimport { TokenClient } from \"./TokenClient\";\nimport type { ExtraHeader, OidcClientSettingsStore } from \"./OidcClientSettings\";\nimport type { SigninState } from \"./SigninState\";\nimport type { SigninResponse } from \"./SigninResponse\";\nimport type { State } from \"./State\";\nimport type { SignoutResponse } from \"./SignoutResponse\";\nimport type { UserProfile } from \"./User\";\nimport type { RefreshState } from \"./RefreshState\";\nimport type { IdTokenClaims } from \"./Claims\";\nimport type { ClaimsService } from \"./ClaimsService\";\n\n/**\n * @internal\n */\nexport class ResponseValidator {\n    protected readonly _logger = new Logger(\"ResponseValidator\");\n    protected readonly _userInfoService: UserInfoService;\n    protected readonly _tokenClient: TokenClient;\n\n    public constructor(\n        protected readonly _settings: OidcClientSettingsStore,\n        protected readonly _metadataService: MetadataService,\n        protected readonly _claimsService: ClaimsService,\n    ) {\n        this._userInfoService = new UserInfoService(this._settings, this._metadataService);\n        this._tokenClient = new TokenClient(this._settings, this._metadataService);\n    }\n\n    public async validateSigninResponse(response: SigninResponse, state: SigninState, extraHeaders?: Record<string, ExtraHeader>): Promise<void> {\n        const logger = this._logger.create(\"validateSigninResponse\");\n\n        this._processSigninState(response, state);\n        logger.debug(\"state processed\");\n\n        await this._processCode(response, state, extraHeaders);\n        logger.debug(\"code processed\");\n\n        if (response.isOpenId) {\n            this._validateIdTokenAttributes(response);\n        }\n        logger.debug(\"tokens validated\");\n\n        await this._processClaims(response, state?.skipUserInfo, response.isOpenId);\n        logger.debug(\"claims processed\");\n    }\n\n    public async validateCredentialsResponse(response: SigninResponse, skipUserInfo: boolean): Promise<void> {\n        const logger = this._logger.create(\"validateCredentialsResponse\");\n\n        if (response.isOpenId && !!response.id_token) {\n            this._validateIdTokenAttributes(response);\n        }\n        logger.debug(\"tokens validated\");\n\n        await this._processClaims(response, skipUserInfo, response.isOpenId);\n        logger.debug(\"claims processed\");\n    }\n\n    public async validateRefreshResponse(response: SigninResponse, state: RefreshState): Promise<void> {\n        const logger = this._logger.create(\"validateRefreshResponse\");\n\n        response.userState = state.data;\n        // if there's no session_state on the response, copy over session_state from original request\n        response.session_state ??= state.session_state;\n        // if there's no scope on the response, then assume all scopes granted (per-spec) and copy over scopes from original request\n        response.scope ??= state.scope;\n\n        // OpenID Connect Core 1.0 says that id_token is optional in refresh response:\n        // https://openid.net/specs/openid-connect-core-1_0.html#RefreshTokenResponse\n        if (response.isOpenId && !!response.id_token) {\n            this._validateIdTokenAttributes(response, state.id_token);\n            logger.debug(\"ID Token validated\");\n        }\n\n        if (!response.id_token) {\n            // if there's no id_token on the response, copy over id_token from original request\n            response.id_token = state.id_token;\n            // and decoded part too\n            response.profile = state.profile;\n        }\n\n        const hasIdToken = response.isOpenId && !!response.id_token;\n        await this._processClaims(response, false, hasIdToken);\n        logger.debug(\"claims processed\");\n    }\n\n    public validateSignoutResponse(response: SignoutResponse, state: State): void {\n        const logger = this._logger.create(\"validateSignoutResponse\");\n        if (state.id !== response.state) {\n            logger.throw(new Error(\"State does not match\"));\n        }\n\n        // now that we know the state matches, take the stored data\n        // and set it into the response so callers can get their state\n        // this is important for both success & error outcomes\n        logger.debug(\"state validated\");\n        response.userState = state.data;\n\n        if (response.error) {\n            logger.warn(\"Response was error\", response.error);\n            throw new ErrorResponse(response);\n        }\n    }\n\n    protected _processSigninState(response: SigninResponse, state: SigninState): void {\n        const logger = this._logger.create(\"_processSigninState\");\n        if (state.id !== response.state) {\n            logger.throw(new Error(\"State does not match\"));\n        }\n\n        if (!state.client_id) {\n            logger.throw(new Error(\"No client_id on state\"));\n        }\n\n        if (!state.authority) {\n            logger.throw(new Error(\"No authority on state\"));\n        }\n\n        // ensure we're using the correct authority\n        if (this._settings.authority !== state.authority) {\n            logger.throw(new Error(\"authority mismatch on settings vs. signin state\"));\n        }\n        if (this._settings.client_id && this._settings.client_id !== state.client_id) {\n            logger.throw(new Error(\"client_id mismatch on settings vs. signin state\"));\n        }\n\n        // now that we know the state matches, take the stored data\n        // and set it into the response so callers can get their state\n        // this is important for both success & error outcomes\n        logger.debug(\"state validated\");\n        response.userState = state.data;\n        response.url_state = state.url_state;\n        // if there's no scope on the response, then assume all scopes granted (per-spec) and copy over scopes from original request\n        response.scope ??= state.scope;\n\n        if (response.error) {\n            logger.warn(\"Response was error\", response.error);\n            throw new ErrorResponse(response);\n        }\n\n        if (state.code_verifier && !response.code) {\n            logger.throw(new Error(\"Expected code in response\"));\n        }\n\n    }\n\n    protected async _processClaims(response: SigninResponse, skipUserInfo = false, validateSub = true): Promise<void> {\n        const logger = this._logger.create(\"_processClaims\");\n        response.profile = this._claimsService.filterProtocolClaims(response.profile);\n\n        if (skipUserInfo || !this._settings.loadUserInfo || !response.access_token) {\n            logger.debug(\"not loading user info\");\n            return;\n        }\n\n        logger.debug(\"loading user info\");\n        const claims = await this._userInfoService.getClaims(response.access_token);\n        logger.debug(\"user info claims received from user info endpoint\");\n\n        if (validateSub && claims.sub !== response.profile.sub) {\n            logger.throw(new Error(\"subject from UserInfo response does not match subject in ID Token\"));\n        }\n\n        response.profile = this._claimsService.mergeClaims(response.profile, this._claimsService.filterProtocolClaims(claims as IdTokenClaims));\n        logger.debug(\"user info claims received, updated profile:\", response.profile);\n    }\n\n    protected async _processCode(response: SigninResponse, state: SigninState, extraHeaders?: Record<string, ExtraHeader>): Promise<void> {\n        const logger = this._logger.create(\"_processCode\");\n        if (response.code) {\n            logger.debug(\"Validating code\");\n            const tokenResponse = await this._tokenClient.exchangeCode({\n                client_id: state.client_id,\n                client_secret: state.client_secret,\n                code: response.code,\n                redirect_uri: state.redirect_uri,\n                code_verifier: state.code_verifier,\n                extraHeaders: extraHeaders,\n                ...state.extraTokenParams,\n            });\n            Object.assign(response, tokenResponse);\n            response.__oidc_spa_tokenResponse = tokenResponse;\n        } else {\n            logger.debug(\"No code to process\");\n        }\n    }\n\n    protected _validateIdTokenAttributes(response: SigninResponse, existingToken?: string): void {\n        const logger = this._logger.create(\"_validateIdTokenAttributes\");\n\n        logger.debug(\"decoding ID Token JWT\");\n        const incoming = JwtUtils.decode(response.id_token ?? \"\");\n\n        if (!incoming.sub) {\n            logger.throw(new Error(\"ID Token is missing a subject claim\"));\n        }\n\n        if (existingToken) {\n            const existing = JwtUtils.decode(existingToken);\n            if (incoming.sub !== existing.sub) {\n                logger.throw(new Error(\"sub in id_token does not match current sub\"));\n            }\n            if (incoming.auth_time && incoming.auth_time !== existing.auth_time) {\n                logger.throw(new Error(\"auth_time in id_token does not match original auth_time\"));\n            }\n            if (incoming.azp && incoming.azp !== existing.azp) {\n                logger.throw(new Error(\"azp in id_token does not match original azp\"));\n            }\n            if (!incoming.azp && existing.azp) {\n                logger.throw(new Error(\"azp not in id_token, but present in original id_token\"));\n            }\n        }\n\n        response.profile = incoming as UserProfile;\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, Timer } from \"./utils\";\nimport type { StateStore } from \"./StateStore\";\n\n/**\n * @public\n */\nexport class State {\n    public readonly id: string;\n    public readonly created: number;\n    public readonly request_type: string | undefined;\n    public readonly url_state: string | undefined;\n\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\n    public readonly data?: unknown;\n\n    public constructor(args: {\n        id?: string;\n        stateQueryParamValue: string | undefined;\n        data?: unknown;\n        created?: number;\n        request_type?: string;\n        url_state?: string;\n    }) {\n        this.id = args.id ?? (()=>{\n\n            const { stateQueryParamValue } = args;\n\n            if (stateQueryParamValue === undefined) {\n                const message= \"Error in oidc-spa patch for oidc-client-ts: stateQueryParamValue is required\";\n                console.error(message);\n                throw new Error(\"Error in oidc-spa patch for oidc-client-ts: stateQueryParamValue is required\");\n            }\n\n            return stateQueryParamValue;\n\n        })();\n        \n        this.data = args.data;\n\n        if (args.created && args.created > 0) {\n            this.created = args.created;\n        }\n        else {\n            this.created = Timer.getEpochTime();\n        }\n        this.request_type = args.request_type;\n        this.url_state = args.url_state;\n    }\n\n    public toStorageString(): string {\n        new Logger(\"State\").create(\"toStorageString\");\n        return JSON.stringify({\n            id: this.id,\n            data: this.data,\n            created: this.created,\n            request_type: this.request_type,\n            url_state: this.url_state,\n        });\n    }\n\n    public static fromStorageString(storageString: string): Promise<State> {\n        Logger.createStatic(\"State\", \"fromStorageString\");\n        return Promise.resolve(new State(JSON.parse(storageString)));\n    }\n\n    public static async clearStaleState(storage: StateStore, age: number): Promise<void> {\n        const logger = Logger.createStatic(\"State\", \"clearStaleState\");\n        const cutoff = Timer.getEpochTime() - age;\n\n        const keys = await storage.getAllKeys();\n        logger.debug(\"got keys\", keys);\n\n        for (let i = 0; i < keys.length; i++) {\n            const key = keys[i];\n            const item = await storage.get(key);\n            let remove = false;\n\n            if (item) {\n                try {\n                    const state = await State.fromStorageString(item);\n\n                    logger.debug(\"got item from key:\", key, state.created);\n                    if (state.created <= cutoff) {\n                        remove = true;\n                    }\n                }\n                catch (err) {\n                    logger.error(\"Error parsing state for key:\", key, err);\n                    remove = true;\n                }\n            }\n            else {\n                logger.debug(\"no item in storage for key:\", key);\n                remove = true;\n            }\n\n            if (remove) {\n                logger.debug(\"removed item for key:\", key);\n                void storage.remove(key);\n            }\n        }\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, CryptoUtils } from \"./utils\";\nimport { State } from \"./State\";\n\n/** @public */\nexport interface SigninStateArgs {\n    stateQueryParamValue: string;\n\n    data?: unknown;\n    created?: number;\n    request_type?: string;\n\n    code_verifier?: string;\n    code_challenge?: string;\n    authority: string;\n    client_id: string;\n    redirect_uri: string;\n    scope: string;\n    client_secret?: string;\n    extraTokenParams?: Record<string, unknown>;\n    response_mode?: \"query\" | \"fragment\";\n    skipUserInfo?: boolean;\n    url_state?: string;\n}\n\n/** @public */\nexport type SigninStateCreateArgs = Omit<SigninStateArgs, \"code_verifier\"> & {\n    code_verifier?: string | boolean;\n};\n\n/**\n * @public\n */\nexport class SigninState extends State {\n    // isCode\n    /** The same code_verifier that was used to obtain the authorization_code via PKCE. */\n    public readonly code_verifier: string | undefined;\n    /** Used to secure authorization code grants via Proof Key for Code Exchange (PKCE). */\n    public readonly code_challenge: string | undefined;\n\n    // to ensure state still matches settings\n    /** @see {@link OidcClientSettings.authority} */\n    public readonly authority: string;\n    /** @see {@link OidcClientSettings.client_id} */\n    public readonly client_id: string;\n    /** @see {@link OidcClientSettings.redirect_uri} */\n    public readonly redirect_uri: string;\n    /** @see {@link OidcClientSettings.scope} */\n    public readonly scope: string;\n    /** @see {@link OidcClientSettings.client_secret} */\n    public readonly client_secret: string | undefined;\n    /** @see {@link OidcClientSettings.extraTokenParams} */\n    public readonly extraTokenParams: Record<string, unknown> | undefined;\n    /** @see {@link OidcClientSettings.response_mode} */\n    public readonly response_mode: \"query\" | \"fragment\" | undefined;\n\n    public readonly skipUserInfo: boolean | undefined;\n\n    private constructor(args: SigninStateArgs) {\n        super(args);\n\n        this.code_verifier = args.code_verifier;\n        this.code_challenge = args.code_challenge;\n        this.authority = args.authority;\n        this.client_id = args.client_id;\n        this.redirect_uri = args.redirect_uri;\n        this.scope = args.scope;\n        this.client_secret = args.client_secret;\n        this.extraTokenParams = args.extraTokenParams;\n\n        this.response_mode = args.response_mode;\n        this.skipUserInfo = args.skipUserInfo;\n    }\n\n    public static async create(args: SigninStateCreateArgs): Promise<SigninState> {\n        const code_verifier = args.code_verifier === true ? CryptoUtils.generateCodeVerifier() : (args.code_verifier || undefined);\n        const code_challenge = code_verifier ? (await CryptoUtils.generateCodeChallenge(code_verifier)) : undefined;\n\n        return new SigninState({\n            ...args,\n            code_verifier,\n            code_challenge,\n        });\n    }\n\n    public toStorageString(): string {\n        new Logger(\"SigninState\").create(\"toStorageString\");\n        return JSON.stringify({\n            id: this.id,\n            data: this.data,\n            created: this.created,\n            request_type: this.request_type,\n            url_state: this.url_state,\n\n            code_verifier: this.code_verifier,\n            authority: this.authority,\n            client_id: this.client_id,\n            redirect_uri: this.redirect_uri,\n            scope: this.scope,\n            client_secret: this.client_secret,\n            extraTokenParams : this.extraTokenParams,\n            response_mode: this.response_mode,\n            skipUserInfo: this.skipUserInfo,\n        });\n    }\n\n    public static fromStorageString(storageString: string): Promise<SigninState> {\n        Logger.createStatic(\"SigninState\", \"fromStorageString\");\n        const data = JSON.parse(storageString);\n        return SigninState.create(data);\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, URL_STATE_DELIMITER } from \"./utils\";\nimport { SigninState } from \"./SigninState\";\n\n/**\n * @public\n * @see https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest\n */\nexport interface SigninRequestCreateArgs {\n    // mandatory\n    stateQueryParamValue: string;\n    url: string;\n    authority: string;\n    client_id: string;\n    redirect_uri: string;\n    response_type: string;\n    scope: string;\n\n    // optional\n    response_mode?: \"query\" | \"fragment\";\n    nonce?: string;\n    display?: string;\n    dpopJkt?: string;\n    prompt?: string;\n    max_age?: number;\n    ui_locales?: string;\n    id_token_hint?: string;\n    login_hint?: string;\n    acr_values?: string;\n\n    // other\n    resource?: string | string[];\n    request?: string;\n    request_uri?: string;\n    request_type?: string;\n    extraQueryParams?: Record<string, string | number | boolean>;\n\n    // special\n    extraTokenParams?: Record<string, unknown>;\n    client_secret?: string;\n    skipUserInfo?: boolean;\n    disablePKCE?: boolean;\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\n    state_data?: unknown;\n    url_state?: string;\n    omitScopeWhenRequesting?: boolean;\n\n    /** oidc-spa extra */\n    transformUrl: (url: string) => string;\n}\n\n/**\n * @public\n */\nexport class SigninRequest {\n    private static readonly _logger = new Logger(\"SigninRequest\");\n\n    public readonly url: string;\n    public readonly state: SigninState;\n\n    private constructor(args: {\n        url: string;\n        state: SigninState;\n    }) {\n        this.url = args.url;\n        this.state = args.state;\n    }\n\n    public static async create({\n        stateQueryParamValue,\n        // mandatory\n        url, authority, client_id, redirect_uri, response_type, scope,\n        // optional\n        state_data, response_mode, request_type, client_secret, nonce, url_state,\n        resource,\n        skipUserInfo,\n        extraQueryParams,\n        extraTokenParams,\n        disablePKCE,\n        dpopJkt,\n        omitScopeWhenRequesting,\n        transformUrl,\n        ...optionalParams\n    }: SigninRequestCreateArgs): Promise<SigninRequest> {\n        if (!url) {\n            this._logger.error(\"create: No url passed\");\n            throw new Error(\"url\");\n        }\n        if (!client_id) {\n            this._logger.error(\"create: No client_id passed\");\n            throw new Error(\"client_id\");\n        }\n        if (!redirect_uri) {\n            this._logger.error(\"create: No redirect_uri passed\");\n            throw new Error(\"redirect_uri\");\n        }\n        if (!response_type) {\n            this._logger.error(\"create: No response_type passed\");\n            throw new Error(\"response_type\");\n        }\n        if (!scope) {\n            this._logger.error(\"create: No scope passed\");\n            throw new Error(\"scope\");\n        }\n        if (!authority) {\n            this._logger.error(\"create: No authority passed\");\n            throw new Error(\"authority\");\n        }\n\n        const state = await SigninState.create({\n            stateQueryParamValue,\n            data: state_data,\n            request_type,\n            url_state,\n            code_verifier: !disablePKCE,\n            client_id, authority, redirect_uri,\n            response_mode,\n            client_secret, scope, extraTokenParams,\n            skipUserInfo,\n        });\n\n        const parsedUrl = new URL(url);\n        parsedUrl.searchParams.append(\"client_id\", client_id);\n        parsedUrl.searchParams.append(\"redirect_uri\", redirect_uri);\n        parsedUrl.searchParams.append(\"response_type\", response_type);\n        if (!omitScopeWhenRequesting) {\n            parsedUrl.searchParams.append(\"scope\", scope);\n        }\n        if (nonce) {\n            parsedUrl.searchParams.append(\"nonce\", nonce);\n        }\n\n        if (dpopJkt) {\n            parsedUrl.searchParams.append(\"dpop_jkt\", dpopJkt);\n        }\n\n        let stateParam = state.id;\n        if (url_state) {\n            stateParam = `${stateParam}${URL_STATE_DELIMITER}${url_state}`;\n        }\n        parsedUrl.searchParams.append(\"state\", stateParam);\n        if (state.code_challenge) {\n            parsedUrl.searchParams.append(\"code_challenge\", state.code_challenge);\n            parsedUrl.searchParams.append(\"code_challenge_method\", \"S256\");\n        }\n\n        if (resource) {\n            // https://datatracker.ietf.org/doc/html/rfc8707\n            const resources = Array.isArray(resource) ? resource : [resource];\n            resources\n                .forEach(r => parsedUrl.searchParams.append(\"resource\", r));\n        }\n\n        for (const [key, value] of Object.entries({ response_mode, ...optionalParams, ...extraQueryParams })) {\n            if (value != null) {\n                parsedUrl.searchParams.append(key, value.toString());\n            }\n        }\n\n        return new SigninRequest({\n            url: transformUrl(parsedUrl.href),\n            state,\n        });\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Timer, URL_STATE_DELIMITER } from \"./utils\";\nimport type { UserProfile } from \"./User\";\n\nconst OidcScope = \"openid\";\n\n/**\n * @public\n * @see https://openid.net/specs/openid-connect-core-1_0.html#AuthResponse\n * @see https://openid.net/specs/openid-connect-core-1_0.html#AuthError\n */\nexport class SigninResponse {\n\n    public __oidc_spa_tokenResponse: Record<string, unknown> | undefined;\n\n    // props present in the initial callback response regardless of success\n    public readonly state: string | null;\n    /** @see {@link User.session_state} */\n    public session_state: string | null;\n\n    // error props\n    /** @see {@link ErrorResponse.error} */\n    public readonly error: string | null;\n    /** @see {@link ErrorResponse.error_description} */\n    public readonly error_description: string | null;\n    /** @see {@link ErrorResponse.error_uri} */\n    public readonly error_uri: string | null;\n\n    // success props\n    public readonly code: string | null;\n\n    // props set after validation\n    /** @see {@link User.id_token} */\n    public id_token?: string;\n    /** @see {@link User.access_token} */\n    public access_token = \"\";\n    /** @see {@link User.token_type} */\n    public token_type = \"\";\n    /** @see {@link User.refresh_token} */\n    public refresh_token?: string;\n    /** @see {@link User.scope} */\n    public scope?: string;\n    /** @see {@link User.expires_at} */\n    public expires_at?: number;\n\n    /** custom state data set during the initial signin request */\n    public userState: unknown;\n    public url_state?: string;\n\n    /** @see {@link User.profile} */\n    public profile: UserProfile = {} as UserProfile;\n\n    public constructor(params: URLSearchParams) {\n        this.state = params.get(\"state\");\n        this.session_state = params.get(\"session_state\");\n        if (this.state) {\n            const splitState = decodeURIComponent(this.state).split(URL_STATE_DELIMITER);\n            this.state = splitState[0];\n            if (splitState.length > 1) {\n                this.url_state = splitState.slice(1).join(URL_STATE_DELIMITER);\n            }\n        }\n\n        this.error = params.get(\"error\");\n        this.error_description = params.get(\"error_description\");\n        this.error_uri = params.get(\"error_uri\");\n\n        this.code = params.get(\"code\");\n        this.__oidc_spa_tokenResponse = undefined;\n    }\n\n    public get expires_in(): number | undefined {\n        if (this.expires_at === undefined) {\n            return undefined;\n        }\n        return this.expires_at - Timer.getEpochTime();\n    }\n    public set expires_in(value: number | undefined) {\n        // spec expects a number, but normalize here just in case\n        if (typeof value === \"string\") value = Number(value);\n        if (value !== undefined && value >= 0) {\n            this.expires_at = Math.floor(value) + Timer.getEpochTime();\n        }\n    }\n\n    public get isOpenId(): boolean {\n        return this.scope?.split(\" \").includes(OidcScope) || !!this.id_token;\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"./utils\";\nimport { State } from \"./State\";\n\n/**\n * @public\n * @see https://openid.net/specs/openid-connect-rpinitiated-1_0.html#RPLogout\n */\nexport interface SignoutRequestArgs {\n    // mandatory\n    url: string;\n    stateQueryParamValue: string;\n\n    // optional\n    id_token_hint?: string;\n    client_id?: string;\n    post_logout_redirect_uri?: string;\n    extraQueryParams?: Record<string, string | number | boolean>;\n\n    // special\n    request_type?: string;\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\n    state_data?: unknown;\n}\n\n/**\n * @public\n */\nexport class SignoutRequest {\n    private readonly _logger = new Logger(\"SignoutRequest\");\n\n    public readonly url: string;\n    public readonly state?: State;\n\n    public constructor({\n        url,\n        stateQueryParamValue,\n        state_data, id_token_hint, post_logout_redirect_uri, extraQueryParams, request_type, client_id,\n    }: SignoutRequestArgs) {\n        if (!url) {\n            this._logger.error(\"ctor: No url passed\");\n            throw new Error(\"url\");\n        }\n\n        const parsedUrl = new URL(url);\n        if (id_token_hint) {\n            parsedUrl.searchParams.append(\"id_token_hint\", id_token_hint);\n        }\n        if (client_id) {\n            parsedUrl.searchParams.append(\"client_id\", client_id);\n        }\n\n        if (post_logout_redirect_uri) {\n            parsedUrl.searchParams.append(\"post_logout_redirect_uri\", post_logout_redirect_uri);\n\n            if (state_data) {\n                this.state = new State({ stateQueryParamValue, data: state_data, request_type });\n\n                parsedUrl.searchParams.append(\"state\", this.state.id);\n            }\n        }\n\n        for (const [key, value] of Object.entries({ ...extraQueryParams })) {\n            if (value != null) {\n                parsedUrl.searchParams.append(key, value.toString());\n            }\n        }\n\n        this.url = parsedUrl.href;\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\n/**\n * @public\n * @see https://openid.net/specs/openid-connect-core-1_0.html#AuthError\n */\nexport class SignoutResponse {\n    public readonly state: string | null;\n\n    // error props\n    /** @see {@link ErrorResponse.error} */\n    public error: string | null;\n    /** @see {@link ErrorResponse.error_description} */\n    public error_description: string | null;\n    /** @see {@link ErrorResponse.error_uri} */\n    public error_uri: string | null;\n\n    /** custom state data set during the initial signin request */\n    public userState: unknown;\n\n    public constructor(params: URLSearchParams) {\n        this.state = params.get(\"state\");\n\n        this.error = params.get(\"error\");\n        this.error_description = params.get(\"error_description\");\n        this.error_uri = params.get(\"error_uri\");\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport type { JwtClaims } from \"./Claims\";\nimport type { OidcClientSettingsStore } from \"./OidcClientSettings\";\nimport type { UserProfile } from \"./User\";\nimport { Logger } from \"./utils\";\n\n/**\n * Protocol claims that could be removed by default from profile.\n * Derived from the following sets of claims:\n * - {@link https://datatracker.ietf.org/doc/html/rfc7519.html#section-4.1}\n * - {@link https://openid.net/specs/openid-connect-core-1_0.html#IDToken}\n * - {@link https://openid.net/specs/openid-connect-core-1_0.html#CodeIDToken}\n *\n * @internal\n */\nconst DefaultProtocolClaims = [\n    \"nbf\",\n    \"jti\",\n    \"auth_time\",\n    \"nonce\",\n    \"acr\",\n    \"amr\",\n    \"azp\",\n    \"at_hash\", // https://openid.net/specs/openid-connect-core-1_0.html#CodeIDToken\n] as const;\n\n/**\n * Protocol claims that should never be removed from profile.\n * \"sub\" is needed internally and others should remain required as per the OIDC specs.\n *\n * @internal\n */\nconst InternalRequiredProtocolClaims = [\"sub\", \"iss\", \"aud\", \"exp\", \"iat\"];\n\n/**\n * @internal\n */\nexport class ClaimsService {\n    protected readonly _logger = new Logger(\"ClaimsService\");\n    public constructor(\n        protected readonly _settings: OidcClientSettingsStore,\n    ) {}\n\n    public filterProtocolClaims(claims: UserProfile): UserProfile {\n        const result = { ...claims };\n\n        if (this._settings.filterProtocolClaims) {\n            let protocolClaims;\n            if (Array.isArray(this._settings.filterProtocolClaims)) {\n                protocolClaims = this._settings.filterProtocolClaims;\n            } else {\n                protocolClaims = DefaultProtocolClaims;\n            }\n\n            for (const claim of protocolClaims) {\n                if (!InternalRequiredProtocolClaims.includes(claim)) {\n                    delete result[claim];\n                }\n            }\n        }\n\n        return result;\n    }\n\n    public mergeClaims(claims1: JwtClaims, claims2: JwtClaims): UserProfile;\n    public mergeClaims(claims1: UserProfile, claims2: JwtClaims): UserProfile {\n        const result = { ...claims1 };\n        for (const [claim, values] of Object.entries(claims2)) {\n            if (result[claim] !== values) {\n                if (Array.isArray(result[claim]) || Array.isArray(values)) {\n                    if (this._settings.mergeClaimsStrategy.array == \"replace\") {\n                        result[claim] = values;\n                    } else {\n                        const mergedValues = Array.isArray(result[claim]) ? result[claim] as unknown[] : [result[claim]];\n                        for (const value of Array.isArray(values) ? values : [values]) {\n                            if (!mergedValues.includes(value)) {\n                                mergedValues.push(value);\n                            }\n                        }\n                        result[claim] = mergedValues;\n                    }\n                } else if (typeof result[claim] === \"object\" && typeof values === \"object\") {\n                    result[claim] = this.mergeClaims(result[claim] as JwtClaims, values as JwtClaims);\n                } else {\n                    result[claim] = values;\n                }\n            }\n        }\n\n        return result;\n    }\n}\n", "/**\n * @public\n */\nexport interface DPoPStore {\n    set(key: string, value: DPoPState): Promise<void>;\n    get(key: string): Promise<DPoPState>;\n    remove(key: string): Promise<DPoPState>;\n    getAllKeys(): Promise<string[]>;\n}\n\n/**\n * @public\n */\nexport class DPoPState {\n    public constructor(\n        public readonly keys: CryptoKeyPair,\n        public nonce?: string,\n    ) { }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { CryptoUtils, Logger, UrlUtils } from \"./utils\";\nimport { ErrorResponse } from \"./errors\";\nimport { type ExtraHeader, type OidcClientSettings, OidcClientSettingsStore } from \"./OidcClientSettings\";\nimport { ResponseValidator } from \"./ResponseValidator\";\nimport { MetadataService } from \"./MetadataService\";\nimport type { RefreshState } from \"./RefreshState\";\nimport { SigninRequest, type SigninRequestCreateArgs } from \"./SigninRequest\";\nimport { SigninResponse } from \"./SigninResponse\";\nimport { SignoutRequest, type SignoutRequestArgs } from \"./SignoutRequest\";\nimport { SignoutResponse } from \"./SignoutResponse\";\nimport { SigninState } from \"./SigninState\";\nimport { State } from \"./State\";\nimport { TokenClient } from \"./TokenClient\";\nimport { ClaimsService } from \"./ClaimsService\";\nimport { DPoPState, type DPoPStore } from \"./DPoPStore\";\nimport { ErrorDPoPNonce } from \"./errors/ErrorDPoPNonce\";\nimport { setFetch } from \"./fetch\";\n\n/**\n * @public\n */\nexport interface CreateSigninRequestArgs\n    extends Omit<SigninRequestCreateArgs, \"url\" | \"authority\" | \"client_id\" | \"redirect_uri\" | \"response_type\" | \"scope\" | \"state_data\"> {\n    redirect_uri?: string;\n    response_type?: string;\n    scope?: string;\n    dpopJkt?: string;\n\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\n    state?: unknown;\n\n    /** oidc-spa extra */\n    transformUrl: (url: string) => string;\n}\n\n/**\n * @public\n */\nexport interface UseRefreshTokenArgs {\n    redirect_uri?: string;\n    resource?: string | string[];\n    extraTokenParams?: Record<string, unknown>;\n    timeoutInSeconds?: number;\n\n    state: RefreshState;\n\n    extraHeaders?: Record<string, ExtraHeader>;\n}\n\n/**\n * @public\n */\nexport type CreateSignoutRequestArgs = Omit<SignoutRequestArgs, \"url\" | \"state_data\"> & {\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\n    state?: unknown;\n};\n\n/**\n * @public\n */\nexport type ProcessResourceOwnerPasswordCredentialsArgs = {\n    username: string;\n    password: string;\n    skipUserInfo?: boolean;\n    extraTokenParams?: Record<string, unknown>;\n};\n\n/**\n * Provides the raw OIDC/OAuth2 protocol support for the authorization endpoint and the end session endpoint in the\n * authorization server. It provides a bare-bones protocol implementation and is used by the UserManager class.\n * Only use this class if you simply want protocol support without the additional management features of the\n * UserManager class.\n *\n * @public\n */\nexport class OidcClient {\n    public readonly settings: OidcClientSettingsStore;\n    protected readonly _logger = new Logger(\"OidcClient\");\n\n    public readonly metadataService: MetadataService;\n    protected readonly _claimsService: ClaimsService;\n    protected readonly _validator: ResponseValidator;\n    protected readonly _tokenClient: TokenClient;\n\n    protected readonly _stateQueryParamValue: string;\n\n    public constructor(settings: OidcClientSettings);\n    public constructor(settings: OidcClientSettingsStore, metadataService: MetadataService);\n    public constructor(settings: OidcClientSettings | OidcClientSettingsStore, metadataService?: MetadataService) {\n\n        this._stateQueryParamValue = settings.stateQueryParamValue;\n\n        setFetch(settings.fetch);\n\n        this.settings = settings instanceof OidcClientSettingsStore ? settings : new OidcClientSettingsStore(settings);\n\n        this.metadataService = metadataService ?? new MetadataService(this.settings);\n        this._claimsService = new ClaimsService(this.settings);\n        this._validator = new ResponseValidator(this.settings, this.metadataService, this._claimsService);\n        this._tokenClient = new TokenClient(this.settings, this.metadataService);\n    }\n\n    public async createSigninRequest({\n        state,\n        request,\n        request_uri,\n        request_type,\n        id_token_hint,\n        login_hint,\n        skipUserInfo,\n        nonce,\n        url_state,\n        response_type = this.settings.response_type,\n        scope = this.settings.scope,\n        redirect_uri = this.settings.redirect_uri,\n        prompt = this.settings.prompt,\n        display = this.settings.display,\n        max_age = this.settings.max_age,\n        ui_locales = this.settings.ui_locales,\n        acr_values = this.settings.acr_values,\n        resource = this.settings.resource,\n        response_mode = this.settings.response_mode,\n        extraQueryParams = this.settings.extraQueryParams,\n        extraTokenParams = this.settings.extraTokenParams,\n        dpopJkt,\n        omitScopeWhenRequesting = this.settings.omitScopeWhenRequesting,\n        transformUrl,\n    }: CreateSigninRequestArgs): Promise<SigninRequest> {\n        const logger = this._logger.create(\"createSigninRequest\");\n\n        if (response_type !== \"code\") {\n            throw new Error(\"Only the Authorization Code flow (with PKCE) is supported\");\n        }\n\n        const url = await this.metadataService.getAuthorizationEndpoint();\n        logger.debug(\"Received authorization endpoint\", url);\n\n        const signinRequest = await SigninRequest.create({\n            stateQueryParamValue: this._stateQueryParamValue,\n            url,\n            authority: this.settings.authority,\n            client_id: this.settings.client_id,\n            redirect_uri,\n            response_type,\n            scope,\n            state_data: state,\n            url_state,\n            prompt, display, max_age, ui_locales, id_token_hint, login_hint, acr_values, dpopJkt,\n            resource, request, request_uri, extraQueryParams, extraTokenParams, request_type, response_mode,\n            client_secret: this.settings.client_secret,\n            skipUserInfo,\n            nonce,\n            disablePKCE: this.settings.disablePKCE,\n            omitScopeWhenRequesting,\n            transformUrl,\n        });\n\n        // house cleaning\n        await this.clearStaleState();\n\n        const signinState = signinRequest.state;\n        await this.settings.stateStore.set(signinState.id, signinState.toStorageString());\n        return signinRequest;\n    }\n\n    public async readSigninResponseState(url: string, removeState = false): Promise<{ state: SigninState; response: SigninResponse }> {\n        const logger = this._logger.create(\"readSigninResponseState\");\n\n        const response = new SigninResponse(UrlUtils.readParams(url, this.settings.response_mode));\n        if (!response.state) {\n            logger.throw(new Error(\"No state in response\"));\n            // need to throw within this function's body for type narrowing to work\n            throw null; // https://github.com/microsoft/TypeScript/issues/46972\n        }\n\n        const storedStateString = await this.settings.stateStore[removeState ? \"remove\" : \"get\"](response.state);\n        if (!storedStateString) {\n            logger.throw(new Error(\"No matching state found in storage\"));\n            throw null; // https://github.com/microsoft/TypeScript/issues/46972\n        }\n\n        const state = await SigninState.fromStorageString(storedStateString);\n        return { state, response };\n    }\n\n    public async processSigninResponse(url: string, extraHeaders?: Record<string, ExtraHeader>): Promise<SigninResponse> {\n        const logger = this._logger.create(\"processSigninResponse\");\n\n        const { state, response } = await this.readSigninResponseState(url, true);\n        logger.debug(\"received state from storage; validating response\");\n\n        if (this.settings.dpop && this.settings.dpop.store) {\n            const dpopProof = await this.getDpopProof(this.settings.dpop.store);\n            extraHeaders = { ...extraHeaders, \"DPoP\": dpopProof };\n        }\n\n        /**\n         * The DPoP spec describes a method for Authorization Servers to supply a nonce value\n         * in order to limit the lifetime of a given DPoP proof.\n         * See https://datatracker.ietf.org/doc/html/rfc9449#name-authorization-server-provid\n         * This involves the AS returning a 400 bad request with a DPoP-Nonce header containing\n         * the nonce value. The client must then retry the request with a recomputed DPoP proof\n         * containing the supplied nonce value.\n         */\n        try {\n            await this._validator.validateSigninResponse(response, state, extraHeaders);\n        }\n        catch (err) {\n            if (err instanceof ErrorDPoPNonce && this.settings.dpop) {\n                const dpopProof = await this.getDpopProof(this.settings.dpop.store, err.nonce);\n                extraHeaders![\"DPoP\"] = dpopProof;\n                await this._validator.validateSigninResponse(response, state, extraHeaders);\n            } else {\n                throw err;\n            }\n        }\n\n        return response;\n    }\n\n    async getDpopProof(dpopStore: DPoPStore, nonce?: string): Promise<string> {\n        let keyPair: CryptoKeyPair;\n        let dpopState: DPoPState;\n\n        if (!(await dpopStore.getAllKeys()).includes(this.settings.client_id)) {\n            keyPair = await CryptoUtils.generateDPoPKeys();\n            dpopState = new DPoPState(keyPair, nonce);\n            await dpopStore.set(this.settings.client_id, dpopState);\n        } else {\n            dpopState = await dpopStore.get(this.settings.client_id);\n\n            // if the server supplied nonce has changed since the last request, update the nonce\n            if (dpopState.nonce !== nonce && nonce) {\n                dpopState.nonce = nonce;\n                await dpopStore.set(this.settings.client_id, dpopState);\n            }\n        }\n\n        return await CryptoUtils.generateDPoPProof({\n            url: await this.metadataService.getTokenEndpoint(false),\n            httpMethod: \"POST\",\n            keyPair: dpopState.keys,\n            nonce: dpopState.nonce,\n        });\n    }\n\n    public async processResourceOwnerPasswordCredentials({\n        username,\n        password,\n        skipUserInfo = false,\n        extraTokenParams = {},\n    }: ProcessResourceOwnerPasswordCredentialsArgs): Promise<SigninResponse> {\n        const tokenResponse: Record<string, unknown> = await this._tokenClient.exchangeCredentials({ username, password, ...extraTokenParams });\n        const signinResponse: SigninResponse = new SigninResponse(new URLSearchParams());\n        Object.assign(signinResponse, tokenResponse);\n        signinResponse.__oidc_spa_tokenResponse = tokenResponse;\n        await this._validator.validateCredentialsResponse(signinResponse, skipUserInfo);\n        return signinResponse;\n    }\n\n    public async useRefreshToken({\n        state,\n        redirect_uri,\n        resource,\n        timeoutInSeconds,\n        extraHeaders,\n        extraTokenParams,\n    }: UseRefreshTokenArgs): Promise<SigninResponse> {\n        const logger = this._logger.create(\"useRefreshToken\");\n\n        // https://github.com/authts/oidc-client-ts/issues/695\n        // In some cases (e.g. AzureAD), not all granted scopes are allowed on token refresh requests.\n        // Therefore, we filter all granted scopes by a list of allowable scopes.\n        let scope;\n        if (this.settings.refreshTokenAllowedScope === undefined) {\n            scope = state.scope;\n        } else {\n            const allowableScopes = this.settings.refreshTokenAllowedScope.split(\" \");\n            const providedScopes = state.scope?.split(\" \") || [];\n\n            scope = providedScopes.filter(s => allowableScopes.includes(s)).join(\" \");\n        }\n\n        if (this.settings.dpop && this.settings.dpop.store) {\n            const dpopProof = await this.getDpopProof(this.settings.dpop.store);\n            extraHeaders = { ...extraHeaders, \"DPoP\": dpopProof };\n        }\n\n        /**\n         * The DPoP spec describes a method for Authorization Servers to supply a nonce value\n         * in order to limit the lifetime of a given DPoP proof.\n         * See https://datatracker.ietf.org/doc/html/rfc9449#name-authorization-server-provid\n         * This involves the AS returning a 400 bad request with a DPoP-Nonce header containing\n         * the nonce value. The client must then retry the request with a recomputed DPoP proof\n         * containing the supplied nonce value.\n         */\n        let result;\n        try {\n            result = await this._tokenClient.exchangeRefreshToken({\n                refresh_token: state.refresh_token,\n                // provide the (possible filtered) scope list\n                scope,\n                redirect_uri,\n                resource,\n                timeoutInSeconds,\n                extraHeaders,\n                ...extraTokenParams,\n            });\n        } catch (err) {\n            if (err instanceof ErrorDPoPNonce && this.settings.dpop) {\n                extraHeaders![\"DPoP\"] = await this.getDpopProof(this.settings.dpop.store, err.nonce);\n                result = await this._tokenClient.exchangeRefreshToken({\n                    refresh_token: state.refresh_token,\n                    // provide the (possible filtered) scope list\n                    scope,\n                    redirect_uri,\n                    resource,\n                    timeoutInSeconds,\n                    extraHeaders,\n                    ...extraTokenParams,\n                });\n            } else {\n                throw err;\n            }\n        }\n\n        const response = new SigninResponse(new URLSearchParams());\n        Object.assign(response, result);\n        response.__oidc_spa_tokenResponse = result;\n        logger.debug(\"validating response\", response);\n        await this._validator.validateRefreshResponse(response, {\n            ...state,\n            // override the scope in the state handed over to the validator\n            // so it can set the granted scope to the requested scope in case none is included in the response\n            scope,\n        });\n        return response;\n    }\n\n    public async createSignoutRequest({\n        state,\n        id_token_hint,\n        client_id,\n        request_type,\n        post_logout_redirect_uri = this.settings.post_logout_redirect_uri,\n        extraQueryParams = this.settings.extraQueryParams,\n    }: CreateSignoutRequestArgs): Promise<SignoutRequest> {\n        const logger = this._logger.create(\"createSignoutRequest\");\n\n        const url = await this.metadataService.getEndSessionEndpoint();\n        if (!url) {\n            logger.throw(new Error(\"No end session endpoint\"));\n            throw null; // https://github.com/microsoft/TypeScript/issues/46972\n        }\n\n        logger.debug(\"Received end session endpoint\", url);\n\n        // specify the client identifier when post_logout_redirect_uri is used but id_token_hint is not\n        if (!client_id && post_logout_redirect_uri && !id_token_hint) {\n            client_id = this.settings.client_id;\n        }\n\n        const request = new SignoutRequest({\n            stateQueryParamValue: this._stateQueryParamValue,\n            url,\n            id_token_hint,\n            client_id,\n            post_logout_redirect_uri,\n            state_data: state,\n            extraQueryParams,\n            request_type,\n        });\n\n        // house cleaning\n        await this.clearStaleState();\n\n        const signoutState = request.state;\n        if (signoutState) {\n            logger.debug(\"Signout request has state to persist\");\n            await this.settings.stateStore.set(signoutState.id, signoutState.toStorageString());\n        }\n\n        return request;\n    }\n\n    public async readSignoutResponseState(url: string, removeState = false): Promise<{ state: State | undefined; response: SignoutResponse }> {\n        const logger = this._logger.create(\"readSignoutResponseState\");\n\n        const response = new SignoutResponse(UrlUtils.readParams(url, this.settings.response_mode));\n        if (!response.state) {\n            logger.debug(\"No state in response\");\n\n            if (response.error) {\n                logger.warn(\"Response was error:\", response.error);\n                throw new ErrorResponse(response);\n            }\n\n            return { state: undefined, response };\n        }\n\n        const storedStateString = await this.settings.stateStore[removeState ? \"remove\" : \"get\"](response.state);\n        if (!storedStateString) {\n            logger.throw(new Error(\"No matching state found in storage\"));\n            throw null; // https://github.com/microsoft/TypeScript/issues/46972\n        }\n\n        const state = await State.fromStorageString(storedStateString);\n        return { state, response };\n    }\n\n    public async processSignoutResponse(url: string): Promise<SignoutResponse> {\n        const logger = this._logger.create(\"processSignoutResponse\");\n\n        const { state, response } = await this.readSignoutResponseState(url, true);\n        if (state) {\n            logger.debug(\"Received state from storage; validating response\");\n            this._validator.validateSignoutResponse(response, state);\n        } else {\n            logger.debug(\"No state from storage; skipping response validation\");\n        }\n\n        return response;\n    }\n\n    public clearStaleState(): Promise<void> {\n        this._logger.create(\"clearStaleState\");\n        return State.clearStaleState(this.settings.stateStore, this.settings.staleStateAgeInSeconds);\n    }\n\n    public async revokeToken(token: string, type?: \"access_token\" | \"refresh_token\"): Promise<void> {\n        this._logger.create(\"revokeToken\");\n        return await this._tokenClient.revoke({\n            token,\n            token_type_hint: type,\n        });\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"./utils\";\nimport { CheckSessionIFrame } from \"./CheckSessionIFrame\";\nimport type { UserManager } from \"./UserManager\";\nimport type { User } from \"./User\";\n\n/**\n * @public\n */\nexport class SessionMonitor {\n    private readonly _logger = new Logger(\"SessionMonitor\");\n\n    private _sub: string | undefined;\n    private _checkSessionIFrame?: CheckSessionIFrame;\n\n    public constructor(private readonly _userManager: UserManager) {\n        if (!_userManager) {\n            this._logger.throw(new Error(\"No user manager passed\"));\n        }\n\n        this._userManager.events.addUserLoaded(this._start);\n        this._userManager.events.addUserUnloaded(this._stop);\n\n        this._init().catch((err: unknown) => {\n            // catch to suppress errors since we're in a ctor\n            this._logger.error(err);\n        });\n    }\n\n    protected async _init(): Promise<void> {\n        this._logger.create(\"_init\");\n        const user = await this._userManager.getUser();\n        // doing this manually here since calling getUser\n        // doesn't trigger load event.\n        if (user) {\n            void this._start(user);\n        }\n        else if (this._userManager.settings.monitorAnonymousSession) {\n            const session = await this._userManager.querySessionStatus();\n            if (session) {\n                const tmpUser = {\n                    session_state: session.session_state,\n                    profile: session.sub ? {\n                        sub: session.sub,\n                    } : null,\n                };\n                void this._start(tmpUser);\n            }\n        }\n    }\n\n    protected _start = async (\n        user: User | {\n            session_state: string;\n            profile: { sub: string } | null;\n        },\n    ): Promise<void> => {\n        const session_state = user.session_state;\n        if (!session_state) {\n            return;\n        }\n        const logger = this._logger.create(\"_start\");\n\n        if (user.profile) {\n            this._sub = user.profile.sub;\n            logger.debug(\"session_state\", session_state, \", sub\", this._sub);\n        }\n        else {\n            this._sub = undefined;\n            logger.debug(\"session_state\", session_state, \", anonymous user\");\n        }\n\n        if (this._checkSessionIFrame) {\n            this._checkSessionIFrame.start(session_state);\n            return;\n        }\n\n        try {\n            const url = await this._userManager.metadataService.getCheckSessionIframe();\n            if (url) {\n                logger.debug(\"initializing check session iframe\");\n\n                const client_id = this._userManager.settings.client_id;\n                const intervalInSeconds = this._userManager.settings.checkSessionIntervalInSeconds;\n                const stopOnError = this._userManager.settings.stopCheckSessionOnError;\n\n                const checkSessionIFrame = new CheckSessionIFrame(this._callback, client_id, url, intervalInSeconds, stopOnError);\n                await checkSessionIFrame.load();\n                this._checkSessionIFrame = checkSessionIFrame;\n                checkSessionIFrame.start(session_state);\n            }\n            else {\n                logger.warn(\"no check session iframe found in the metadata\");\n            }\n        }\n        catch (err) {\n            // catch to suppress errors since we're in non-promise callback\n            logger.error(\"Error from getCheckSessionIframe:\", err instanceof Error ? err.message : err);\n        }\n    };\n\n    protected _stop = (): void => {\n        const logger = this._logger.create(\"_stop\");\n        this._sub = undefined;\n\n        if (this._checkSessionIFrame) {\n            this._checkSessionIFrame.stop();\n        }\n\n        if (this._userManager.settings.monitorAnonymousSession) {\n            // using a timer to delay re-initialization to avoid race conditions during signout\n            // TODO rewrite to use promise correctly\n            // eslint-disable-next-line @typescript-eslint/no-misused-promises\n            const timerHandle = setInterval(async () => {\n                clearInterval(timerHandle);\n\n                try {\n                    const session = await this._userManager.querySessionStatus();\n                    if (session) {\n                        const tmpUser = {\n                            session_state: session.session_state,\n                            profile: session.sub ? {\n                                sub: session.sub,\n                            } : null,\n                        };\n                        void this._start(tmpUser);\n                    }\n                }\n                catch (err) {\n                    // catch to suppress errors since we're in a callback\n                    logger.error(\"error from querySessionStatus\", err instanceof Error ? err.message : err);\n                }\n            }, 1000);\n        }\n    };\n\n    protected _callback = async (): Promise<void> => {\n        const logger = this._logger.create(\"_callback\");\n        try {\n            const session = await this._userManager.querySessionStatus();\n            let raiseEvent = true;\n\n            if (session && this._checkSessionIFrame) {\n                if (session.sub === this._sub) {\n                    raiseEvent = false;\n                    this._checkSessionIFrame.start(session.session_state);\n\n                    logger.debug(\"same sub still logged in at OP, session state has changed, restarting check session iframe; session_state\", session.session_state);\n                    await this._userManager.events._raiseUserSessionChanged();\n                }\n                else {\n                    logger.debug(\"different subject signed into OP\", session.sub);\n                }\n            }\n            else {\n                logger.debug(\"subject no longer signed into OP\");\n            }\n\n            if (raiseEvent) {\n                if (this._sub) {\n                    await this._userManager.events._raiseUserSignedOut();\n                }\n                else {\n                    await this._userManager.events._raiseUserSignedIn();\n                }\n            } else {\n                logger.debug(\"no change in session detected, no event to raise\");\n            }\n        }\n        catch (err) {\n            if (this._sub) {\n                logger.debug(\"Error calling queryCurrentSigninSession; raising signed out event\", err);\n                await this._userManager.events._raiseUserSignedOut();\n            }\n        }\n    };\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, Timer } from \"./utils\";\nimport type { IdTokenClaims } from \"./Claims\";\n\n/**\n * Holds claims represented by a combination of the `id_token` and the user info endpoint.\n *\n * @public\n */\nexport type UserProfile = IdTokenClaims;\n\n/**\n * @public\n */\nexport class User {\n\n    public readonly __oidc_spa_tokenResponse: Record<string, unknown>;\n\n    /**\n     * A JSON Web Token (JWT). Only provided if `openid` scope was requested.\n     * The application can access the data decoded by using the `profile` property.\n     */\n    public id_token?: string;\n\n    /** The session state value returned from the OIDC provider. */\n    public session_state: string | null;\n\n    /**\n     * The requested access token returned from the OIDC provider. The application can use this token to\n     * authenticate itself to the secured resource.\n     */\n    public access_token: string;\n\n    /**\n     * An OAuth 2.0 refresh token. The app can use this token to acquire additional access tokens after the\n     * current access token expires. Refresh tokens are long-lived and can be used to maintain access to resources\n     * for extended periods of time.\n     */\n    public refresh_token?: string;\n\n    /** Typically \"Bearer\" */\n    public token_type: string;\n\n    /** The scopes that the requested access token is valid for. */\n    public scope?: string;\n\n    /** The claims represented by a combination of the `id_token` and the user info endpoint. */\n    public profile: UserProfile;\n\n    /** The expires at returned from the OIDC provider. */\n    public expires_at?: number;\n\n    /** custom state data set during the initial signin request */\n    public readonly state: unknown;\n    public readonly url_state?: string;\n\n    public constructor(args: {\n        id_token?: string;\n        session_state?: string | null;\n        access_token: string;\n        refresh_token?: string;\n        token_type: string;\n        scope?: string;\n        profile: UserProfile;\n        expires_at?: number;\n        userState?: unknown;\n        url_state?: string;\n        __oidc_spa_tokenResponse: Record<string, unknown>;\n    }) {\n        this.id_token = args.id_token;\n        this.session_state = args.session_state ?? null;\n        this.access_token = args.access_token;\n        this.refresh_token = args.refresh_token;\n\n        this.token_type = args.token_type;\n        this.scope = args.scope;\n        this.profile = args.profile;\n        this.expires_at = args.expires_at;\n        this.state = args.userState;\n        this.url_state = args.url_state;\n        this.__oidc_spa_tokenResponse = args.__oidc_spa_tokenResponse;\n    }\n\n    /** Computed number of seconds the access token has remaining. */\n    public get expires_in(): number | undefined {\n        if (this.expires_at === undefined) {\n            return undefined;\n        }\n        return this.expires_at - Timer.getEpochTime();\n    }\n\n    public set expires_in(value: number | undefined) {\n        if (value !== undefined) {\n            this.expires_at = Math.floor(value) + Timer.getEpochTime();\n        }\n    }\n\n    /** Computed value indicating if the access token is expired. */\n    public get expired(): boolean | undefined {\n        const expires_in = this.expires_in;\n        if (expires_in === undefined) {\n            return undefined;\n        }\n        return expires_in <= 0;\n    }\n\n    /** Array representing the parsed values from the `scope`. */\n    public get scopes(): string[] {\n        return this.scope?.split(\" \") ?? [];\n    }\n\n    public toStorageString(): string {\n        new Logger(\"User\").create(\"toStorageString\");\n        return JSON.stringify({\n            id_token: this.id_token,\n            session_state: this.session_state,\n            access_token: this.access_token,\n            refresh_token: this.refresh_token,\n            token_type: this.token_type,\n            scope: this.scope,\n            profile: this.profile,\n            expires_at: this.expires_at,\n            __oidc_spa_tokenResponse: this.__oidc_spa_tokenResponse,\n        });\n    }\n\n    public static fromStorageString(storageString: string): User {\n        Logger.createStatic(\"User\", \"fromStorageString\");\n        return new User(JSON.parse(storageString));\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Event, Logger, UrlUtils } from \"../utils\";\nimport type { IWindow, NavigateParams, NavigateResponse } from \"./IWindow\";\n\nconst messageSource = \"oidc-client\";\n\ninterface MessageData {\n    source: string;\n    url: string;\n    keepOpen: boolean;\n}\n\n/**\n * Window implementation which resolves via communication from a child window\n * via the `Window.postMessage()` interface.\n *\n * @internal\n */\nexport abstract class AbstractChildWindow implements IWindow {\n    protected abstract readonly _logger: Logger;\n    protected readonly _abort = new Event<[reason: Error]>(\"Window navigation aborted\");\n    protected readonly _disposeHandlers = new Set<() => void>();\n\n    protected _window: WindowProxy | null = null;\n\n    public async navigate(params: NavigateParams): Promise<NavigateResponse> {\n        const logger = this._logger.create(\"navigate\");\n        if (!this._window) {\n            throw new Error(\"Attempted to navigate on a disposed window\");\n        }\n\n        logger.debug(\"setting URL in window\");\n        console.log(\"==========================================> replace\", params.url);\n        this._window.location.replace(params.url);\n\n        const { url, keepOpen } = await new Promise<MessageData>((resolve, reject) => {\n            const listener = (e: MessageEvent) => {\n                const data: MessageData | undefined = e.data;\n                const origin = params.scriptOrigin ?? window.location.origin;\n                if (e.origin !== origin || data?.source !== messageSource) {\n                    // silently discard events not intended for us\n                    return;\n                }\n                try {\n                    const state = UrlUtils.readParams(data.url, params.response_mode).get(\"state\");\n                    if (!state) {\n                        logger.warn(\"no state found in response url\");\n                    }\n                    if (e.source !== this._window && state !== params.state) {\n                        // MessageEvent source is a relatively modern feature, we can't rely on it\n                        // so we also inspect the payload for a matching state key as an alternative\n                        return;\n                    }\n                }\n                catch (err) {\n                    this._dispose();\n                    reject(new Error(\"Invalid response from window\"));\n                }\n                resolve(data);\n            };\n            window.addEventListener(\"message\", listener, false);\n            this._disposeHandlers.add(() => window.removeEventListener(\"message\", listener, false));\n            this._disposeHandlers.add(this._abort.addHandler((reason) => {\n                this._dispose();\n                reject(reason);\n            }));\n        });\n        logger.debug(\"got response from window\");\n        this._dispose();\n\n        if (!keepOpen) {\n            this.close();\n        }\n\n        return { url };\n    }\n\n    public abstract close(): void;\n\n    private _dispose(): void {\n        this._logger.create(\"_dispose\");\n\n        for (const dispose of this._disposeHandlers) {\n            dispose();\n        }\n        this._disposeHandlers.clear();\n    }\n\n    protected static _notifyParent(parent: Window, url: string, keepOpen = false, targetOrigin = window.location.origin): void {\n        parent.postMessage({\n            source: messageSource,\n            url,\n            keepOpen,\n        } as MessageData, targetOrigin);\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { type OidcClientSettings, OidcClientSettingsStore } from \"./OidcClientSettings\";\nimport type { PopupWindowFeatures } from \"./utils/PopupUtils\";\nimport { WebStorageStateStore } from \"./WebStorageStateStore\";\nimport { InMemoryWebStorage } from \"./InMemoryWebStorage\";\n\nexport const DefaultPopupWindowFeatures: PopupWindowFeatures = {\n    location: false,\n    toolbar: false,\n    height: 640,\n    closePopupWindowAfterInSeconds: -1,\n};\nexport const DefaultPopupTarget = \"_blank\";\nconst DefaultAccessTokenExpiringNotificationTimeInSeconds = 60;\nconst DefaultCheckSessionIntervalInSeconds = 2;\nexport const DefaultSilentRequestTimeoutInSeconds = 10;\n\n/**\n * The settings used to configure the {@link UserManager}.\n *\n * @public\n */\nexport interface UserManagerSettings extends OidcClientSettings {\n    stateQueryParamValue: string;\n\n    /** The URL for the page containing the call to signinPopupCallback to handle the callback from the OIDC/OAuth2 */\n    popup_redirect_uri?: string;\n    popup_post_logout_redirect_uri?: string;\n    /**\n     * The features parameter to window.open for the popup signin window. By default, the popup is\n     * placed centered in front of the window opener.\n     * (default: \\{ location: false, menubar: false, height: 640, closePopupWindowAfterInSeconds: -1 \\})\n     */\n    popupWindowFeatures?: PopupWindowFeatures;\n    /** The target parameter to window.open for the popup signin window (default: \"_blank\") */\n    popupWindowTarget?: string;\n    /** The methods window.location method used to redirect (default: \"assign\") */\n    redirectMethod?: \"replace\" | \"assign\";\n    /** The methods target window being redirected (default: \"self\") */\n    redirectTarget?: \"top\" | \"self\";\n\n    /** The target to pass while calling postMessage inside iframe for callback (default: window.location.origin) */\n    iframeNotifyParentOrigin?: string;\n\n    /** The script origin to check during 'message' callback execution while performing silent auth via iframe (default: window.location.origin) */\n    iframeScriptOrigin?: string;\n\n    /** The URL for the page containing the code handling the silent renew */\n    silent_redirect_uri?: string;\n    /** Number of seconds to wait for the silent renew to return before assuming it has failed or timed out (default: 10) */\n    silentRequestTimeoutInSeconds?: number;\n    /** Flag to indicate if there should be an automatic attempt to renew the access token prior to its expiration. The automatic renew attempt starts 1 minute before the access token expires (default: true) */\n    automaticSilentRenew?: boolean;\n    /** Flag to validate user.profile.sub in silent renew calls (default: true) */\n    validateSubOnSilentRenew?: boolean;\n    /** Flag to control if id_token is included as id_token_hint in silent renew calls (default: false) */\n    includeIdTokenInSilentRenew?: boolean;\n\n    /** Will raise events for when user has performed a signout at the OP (default: false) */\n    monitorSession?: boolean;\n    monitorAnonymousSession?: boolean;\n    /** Interval in seconds to check the user's session (default: 2) */\n    checkSessionIntervalInSeconds?: number;\n    query_status_response_type?: string;\n    stopCheckSessionOnError?: boolean;\n\n    /**\n     * The `token_type_hint`s to pass to the authority server by default (default: [\"access_token\", \"refresh_token\"])\n     *\n     * Token types will be revoked in the same order as they are given here.\n     */\n    revokeTokenTypes?: (\"access_token\" | \"refresh_token\")[];\n    /** Will invoke the revocation endpoint on signout if there is an access token for the user (default: false) */\n    revokeTokensOnSignout?: boolean;\n    /** Flag to control if id_token is included as id_token_hint in silent signout calls (default: false) */\n    includeIdTokenInSilentSignout?: boolean;\n\n    /** The number of seconds before an access token is to expire to raise the accessTokenExpiring event (default: 60) */\n    accessTokenExpiringNotificationTimeInSeconds?: number;\n\n    /**\n     * Storage object used to persist User for currently authenticated user (default: window.sessionStorage, InMemoryWebStorage iff no window).\n     *  E.g. `userStore: new WebStorageStateStore({ store: window.localStorage })`\n     */\n    userStore?: WebStorageStateStore;\n}\n\n/**\n * The settings with defaults applied of the {@link UserManager}.\n * @see {@link UserManagerSettings}\n *\n * @public\n */\nexport class UserManagerSettingsStore extends OidcClientSettingsStore {\n    public readonly popup_redirect_uri: string;\n    public readonly popup_post_logout_redirect_uri: string | undefined;\n    public readonly popupWindowFeatures: PopupWindowFeatures;\n    public readonly popupWindowTarget: string;\n    public readonly redirectMethod: \"replace\" | \"assign\";\n    public readonly redirectTarget: \"top\" | \"self\";\n\n    public readonly iframeNotifyParentOrigin: string | undefined;\n    public readonly iframeScriptOrigin: string | undefined;\n\n    public readonly silent_redirect_uri: string;\n    public readonly silentRequestTimeoutInSeconds: number;\n    public readonly automaticSilentRenew: boolean;\n    public readonly validateSubOnSilentRenew: boolean;\n    public readonly includeIdTokenInSilentRenew: boolean;\n\n    public readonly monitorSession: boolean;\n    public readonly monitorAnonymousSession: boolean;\n    public readonly checkSessionIntervalInSeconds: number;\n    public readonly query_status_response_type: string;\n    public readonly stopCheckSessionOnError: boolean;\n\n    public readonly revokeTokenTypes: (\"access_token\" | \"refresh_token\")[];\n    public readonly revokeTokensOnSignout: boolean;\n    public readonly includeIdTokenInSilentSignout: boolean;\n\n    public readonly accessTokenExpiringNotificationTimeInSeconds: number;\n\n    public readonly userStore: WebStorageStateStore;\n\n    public constructor(args: UserManagerSettings) {\n        const {\n            popup_redirect_uri = args.redirect_uri,\n            popup_post_logout_redirect_uri = args.post_logout_redirect_uri,\n            popupWindowFeatures = DefaultPopupWindowFeatures,\n            popupWindowTarget = DefaultPopupTarget,\n            redirectMethod = \"assign\",\n            redirectTarget = \"self\",\n\n            iframeNotifyParentOrigin = args.iframeNotifyParentOrigin,\n            iframeScriptOrigin = args.iframeScriptOrigin,\n\n            requestTimeoutInSeconds,\n            silent_redirect_uri = args.redirect_uri,\n            silentRequestTimeoutInSeconds,\n            automaticSilentRenew = true,\n            validateSubOnSilentRenew = true,\n            includeIdTokenInSilentRenew = false,\n\n            monitorSession = false,\n            monitorAnonymousSession = false,\n            checkSessionIntervalInSeconds = DefaultCheckSessionIntervalInSeconds,\n            query_status_response_type = \"code\",\n            stopCheckSessionOnError = true,\n\n            revokeTokenTypes = [\"access_token\", \"refresh_token\"],\n            revokeTokensOnSignout = false,\n            includeIdTokenInSilentSignout = false,\n\n            accessTokenExpiringNotificationTimeInSeconds = DefaultAccessTokenExpiringNotificationTimeInSeconds,\n\n            userStore,\n        } = args;\n\n        super(args);\n\n        this.popup_redirect_uri = popup_redirect_uri;\n        this.popup_post_logout_redirect_uri = popup_post_logout_redirect_uri;\n        this.popupWindowFeatures = popupWindowFeatures;\n        this.popupWindowTarget = popupWindowTarget;\n        this.redirectMethod = redirectMethod;\n        this.redirectTarget = redirectTarget;\n\n        this.iframeNotifyParentOrigin = iframeNotifyParentOrigin;\n        this.iframeScriptOrigin = iframeScriptOrigin;\n\n        this.silent_redirect_uri = silent_redirect_uri;\n        this.silentRequestTimeoutInSeconds = silentRequestTimeoutInSeconds || requestTimeoutInSeconds || DefaultSilentRequestTimeoutInSeconds;\n        this.automaticSilentRenew = automaticSilentRenew;\n        this.validateSubOnSilentRenew = validateSubOnSilentRenew;\n        this.includeIdTokenInSilentRenew = includeIdTokenInSilentRenew;\n\n        this.monitorSession = monitorSession;\n        this.monitorAnonymousSession = monitorAnonymousSession;\n        this.checkSessionIntervalInSeconds = checkSessionIntervalInSeconds;\n        this.stopCheckSessionOnError = stopCheckSessionOnError;\n        this.query_status_response_type = query_status_response_type;\n\n        this.revokeTokenTypes = revokeTokenTypes;\n        this.revokeTokensOnSignout = revokeTokensOnSignout;\n        this.includeIdTokenInSilentSignout = includeIdTokenInSilentSignout;\n\n        this.accessTokenExpiringNotificationTimeInSeconds = accessTokenExpiringNotificationTimeInSeconds;\n\n        if (userStore) {\n            this.userStore = userStore;\n        }\n        else {\n            const store = typeof window !== \"undefined\" ? window.sessionStorage : new InMemoryWebStorage();\n            this.userStore = new WebStorageStateStore({ store });\n        }\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"../utils\";\nimport { ErrorTimeout } from \"../errors\";\nimport type { NavigateParams, NavigateResponse } from \"./IWindow\";\nimport { AbstractChildWindow } from \"./AbstractChildWindow\";\nimport { DefaultSilentRequestTimeoutInSeconds } from \"../UserManagerSettings\";\n\n/**\n * @public\n */\nexport interface IFrameWindowParams {\n    silentRequestTimeoutInSeconds?: number;\n}\n\n/**\n * @internal\n */\nexport class IFrameWindow extends AbstractChildWindow {\n    protected readonly _logger = new Logger(\"IFrameWindow\");\n    private _frame: HTMLIFrameElement | null;\n    private _timeoutInSeconds: number;\n\n    public constructor({\n        silentRequestTimeoutInSeconds = DefaultSilentRequestTimeoutInSeconds,\n    }: IFrameWindowParams) {\n        super();\n        this._timeoutInSeconds = silentRequestTimeoutInSeconds;\n\n        this._frame = IFrameWindow.createHiddenIframe();\n        this._window = this._frame.contentWindow;\n    }\n\n    private static createHiddenIframe(): HTMLIFrameElement {\n        const iframe = window.document.createElement(\"iframe\");\n\n        // shotgun approach\n        iframe.style.visibility = \"hidden\";\n        iframe.style.position = \"fixed\";\n        iframe.style.left = \"-1000px\";\n        iframe.style.top = \"0\";\n        iframe.width = \"0\";\n        iframe.height = \"0\";\n\n        window.document.body.appendChild(iframe);\n        return iframe;\n    }\n\n    public async navigate(params: NavigateParams): Promise<NavigateResponse> {\n        this._logger.debug(\"navigate: Using timeout of:\", this._timeoutInSeconds);\n        const timer = setTimeout(() => void this._abort.raise(new ErrorTimeout(\"IFrame timed out without a response\")), this._timeoutInSeconds * 1000);\n        this._disposeHandlers.add(() => clearTimeout(timer));\n\n        return await super.navigate(params);\n    }\n\n    public close(): void {\n        if (this._frame) {\n            if (this._frame.parentNode) {\n                this._frame.addEventListener(\"load\", (ev) => {\n                    const frame = ev.target as HTMLIFrameElement;\n                    frame.parentNode?.removeChild(frame);\n                    void this._abort.raise(new Error(\"IFrame removed from DOM\"));\n                }, true);\n                this._frame.contentWindow?.location.replace(\"about:blank\");\n            }\n            this._frame = null;\n        }\n        this._window = null;\n    }\n\n    public static notifyParent(url: string, targetOrigin?: string): void {\n        return super._notifyParent(window.parent, url, false, targetOrigin);\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"../utils\";\nimport type { UserManagerSettingsStore } from \"../UserManagerSettings\";\nimport { IFrameWindow, type IFrameWindowParams } from \"./IFrameWindow\";\nimport type { INavigator } from \"./INavigator\";\n\n/**\n * @internal\n */\nexport class IFrameNavigator implements INavigator {\n    private readonly _logger = new Logger(\"IFrameNavigator\");\n\n    constructor(private _settings: UserManagerSettingsStore) {}\n\n    public async prepare({\n        silentRequestTimeoutInSeconds = this._settings.silentRequestTimeoutInSeconds,\n    }: IFrameWindowParams): Promise<IFrameWindow> {\n        return new IFrameWindow({ silentRequestTimeoutInSeconds });\n    }\n\n    public async callback(url: string): Promise<void> {\n        this._logger.create(\"callback\");\n        IFrameWindow.notifyParent(url, this._settings.iframeNotifyParentOrigin);\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, PopupUtils, type PopupWindowFeatures } from \"../utils\";\nimport { DefaultPopupWindowFeatures, DefaultPopupTarget } from \"../UserManagerSettings\";\nimport { AbstractChildWindow } from \"./AbstractChildWindow\";\nimport type { NavigateParams, NavigateResponse } from \"./IWindow\";\n\nconst checkForPopupClosedInterval = 500;\nconst second = 1000;\n\n/**\n * @public\n */\nexport interface PopupWindowParams {\n    popupWindowFeatures?: PopupWindowFeatures;\n    popupWindowTarget?: string;\n    /** An AbortSignal to set request's signal. */\n    popupSignal?: AbortSignal | null;\n}\n\n/**\n * @internal\n */\nexport class PopupWindow extends AbstractChildWindow {\n    protected readonly _logger = new Logger(\"PopupWindow\");\n\n    protected _window: WindowProxy | null;\n\n    public constructor({\n        popupWindowTarget = DefaultPopupTarget,\n        popupWindowFeatures = {},\n        popupSignal,\n    }: PopupWindowParams) {\n        super();\n        const centeredPopup = PopupUtils.center({ ...DefaultPopupWindowFeatures, ...popupWindowFeatures });\n        this._window = window.open(undefined, popupWindowTarget, PopupUtils.serialize(centeredPopup));\n\n        if (popupSignal) {\n            popupSignal.addEventListener(\"abort\", () => {\n                void this._abort.raise(new Error(popupSignal.reason ?? \"Popup aborted\"));\n            });\n        }\n\n        if (popupWindowFeatures.closePopupWindowAfterInSeconds && popupWindowFeatures.closePopupWindowAfterInSeconds > 0) {\n            setTimeout(() => {\n                if (!this._window || typeof this._window.closed !== \"boolean\" || this._window.closed) {\n                    void this._abort.raise(new Error(\"Popup blocked by user\"));\n                    return;\n                }\n\n                this.close();\n            }, popupWindowFeatures.closePopupWindowAfterInSeconds * second);\n        }\n    }\n\n    public async navigate(params: NavigateParams): Promise<NavigateResponse> {\n        this._window?.focus();\n\n        const popupClosedInterval = setInterval(() => {\n            if (!this._window || this._window.closed) {\n                void this._abort.raise(new Error(\"Popup closed by user\"));\n            }\n        }, checkForPopupClosedInterval);\n        this._disposeHandlers.add(() => clearInterval(popupClosedInterval));\n\n        return await super.navigate(params);\n    }\n\n    public close(): void {\n        if (this._window) {\n            if (!this._window.closed) {\n                this._window.close();\n                void this._abort.raise(new Error(\"Popup closed\"));\n            }\n        }\n        this._window = null;\n    }\n\n    public static notifyOpener(url: string, keepOpen: boolean): void {\n        if (!window.opener) {\n            throw new Error(\"No window.opener. Can't complete notification.\");\n        }\n        return super._notifyParent(window.opener, url, keepOpen);\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"../utils\";\nimport { PopupWindow, type PopupWindowParams } from \"./PopupWindow\";\nimport type { INavigator } from \"./INavigator\";\nimport type { UserManagerSettingsStore } from \"../UserManagerSettings\";\n\n/**\n * @internal\n */\nexport class PopupNavigator implements INavigator {\n    private readonly _logger = new Logger(\"PopupNavigator\");\n\n    constructor(private _settings: UserManagerSettingsStore) { }\n\n    public async prepare({\n        popupWindowFeatures = this._settings.popupWindowFeatures,\n        popupWindowTarget = this._settings.popupWindowTarget,\n        popupSignal,\n    }: PopupWindowParams): Promise<PopupWindow> {\n        return new PopupWindow({ popupWindowFeatures, popupWindowTarget, popupSignal });\n    }\n\n    public async callback(url: string, { keepOpen = false }): Promise<void> {\n        this._logger.create(\"callback\");\n\n        PopupWindow.notifyOpener(url, keepOpen);\n    }\n}\n", "/* eslint-disable @typescript-eslint/no-unsafe-call */\n// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger } from \"../utils\";\nimport type { UserManagerSettingsStore } from \"../UserManagerSettings\";\nimport type { INavigator } from \"./INavigator\";\nimport type { IWindow } from \"./IWindow\";\n\n\n/**\n * @public\n */\nexport interface RedirectParams {\n    redirectMethod?: \"replace\" | \"assign\";\n    redirectTarget?: \"top\" | \"self\";\n}\n\n/**\n * @internal\n */\nexport class RedirectNavigator implements INavigator {\n    private readonly _logger = new Logger(\"RedirectNavigator\");\n\n    constructor(private _settings: UserManagerSettingsStore) {}\n\n    public async prepare({\n        redirectMethod = this._settings.redirectMethod,\n        redirectTarget = this._settings.redirectTarget,\n    }: RedirectParams): Promise<IWindow> {\n        this._logger.create(\"prepare\");\n        let targetWindow = window.self as Window;\n\n        if (redirectTarget === \"top\") {\n            targetWindow = window.top ?? window.self;\n        }\n    \n        const redirect = targetWindow.location[redirectMethod].bind(targetWindow.location) as (url: string) => never;\n        let abort: (reason: Error) => void;\n        return {\n            navigate: async (params): Promise<never> => {\n                this._logger.create(\"navigate\");\n                // We use a promise that never resolves to block the caller\n                const promise = new Promise((resolve, reject) => {\n                    abort = reject;\n                });\n                console.log(\"==============================> redirect to\", params.url);\n                if ( redirectMethod === \"assign\" ) {\n                    console.log(\"Use oidc safe assign\");\n                    // @ts-expect-error: ok\n                    window.__oidc_safe_assign(params.url);\n                } else {\n                    redirect(params.url);\n                }\n                return await (promise as Promise<never>);\n            },\n            close: () => {\n                this._logger.create(\"close\");\n                abort?.(new Error(\"Redirect aborted\"));\n                targetWindow.stop();\n            },\n        };\n    }\n\n    public async callback(): Promise<void> {\n        return;\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, Event } from \"./utils\";\nimport { AccessTokenEvents } from \"./AccessTokenEvents\";\nimport type { UserManagerSettingsStore } from \"./UserManagerSettings\";\nimport type { User } from \"./User\";\n\n/**\n * @public\n */\nexport type UserLoadedCallback = (user: User) => Promise<void> | void;\n/**\n * @public\n */\nexport type UserUnloadedCallback = () => Promise<void> | void;\n/**\n * @public\n */\nexport type SilentRenewErrorCallback = (error: Error) => Promise<void> | void;\n/**\n * @public\n */\nexport type UserSignedInCallback = () => Promise<void> | void;\n/**\n * @public\n */\nexport type UserSignedOutCallback = () => Promise<void> | void;\n/**\n * @public\n */\nexport type UserSessionChangedCallback = () => Promise<void> | void;\n\n/**\n * @public\n */\nexport class UserManagerEvents extends AccessTokenEvents {\n    protected readonly _logger = new Logger(\"UserManagerEvents\");\n\n    private readonly _userLoaded = new Event<[User]>(\"User loaded\");\n    private readonly _userUnloaded = new Event<[]>(\"User unloaded\");\n    private readonly _silentRenewError = new Event<[Error]>(\"Silent renew error\");\n    private readonly _userSignedIn = new Event<[]>(\"User signed in\");\n    private readonly _userSignedOut = new Event<[]>(\"User signed out\");\n    private readonly _userSessionChanged = new Event<[]>(\"User session changed\");\n\n    public constructor(settings: UserManagerSettingsStore) {\n        super({ expiringNotificationTimeInSeconds: settings.accessTokenExpiringNotificationTimeInSeconds });\n    }\n\n    public async load(user: User, raiseEvent=true): Promise<void> {\n        super.load(user);\n        if (raiseEvent) {\n            await this._userLoaded.raise(user);\n        }\n    }\n    public async unload(): Promise<void> {\n        super.unload();\n        await this._userUnloaded.raise();\n    }\n\n    /**\n     * Add callback: Raised when a user session has been established (or re-established).\n     */\n    public addUserLoaded(cb: UserLoadedCallback): () => void {\n        return this._userLoaded.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised when a user session has been established (or re-established).\n     */\n    public removeUserLoaded(cb: UserLoadedCallback): void {\n        return this._userLoaded.removeHandler(cb);\n    }\n\n    /**\n     * Add callback: Raised when a user session has been terminated.\n     */\n    public addUserUnloaded(cb: UserUnloadedCallback): () => void {\n        return this._userUnloaded.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised when a user session has been terminated.\n     */\n    public removeUserUnloaded(cb: UserUnloadedCallback): void {\n        return this._userUnloaded.removeHandler(cb);\n    }\n\n    /**\n     * Add callback: Raised when the automatic silent renew has failed.\n     */\n    public addSilentRenewError(cb: SilentRenewErrorCallback): () => void {\n        return this._silentRenewError.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised when the automatic silent renew has failed.\n     */\n    public removeSilentRenewError(cb: SilentRenewErrorCallback): void {\n        return this._silentRenewError.removeHandler(cb);\n    }\n    /**\n     * @internal\n     */\n    public async _raiseSilentRenewError(e: Error): Promise<void> {\n        await this._silentRenewError.raise(e);\n    }\n\n    /**\n     * Add callback: Raised when the user is signed in (when `monitorSession` is set).\n     * @see {@link UserManagerSettings.monitorSession}\n     */\n    public addUserSignedIn(cb: UserSignedInCallback): () => void {\n        return this._userSignedIn.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised when the user is signed in (when `monitorSession` is set).\n     */\n    public removeUserSignedIn(cb: UserSignedInCallback): void {\n        this._userSignedIn.removeHandler(cb);\n    }\n    /**\n     * @internal\n     */\n    public async _raiseUserSignedIn(): Promise<void> {\n        await this._userSignedIn.raise();\n    }\n\n    /**\n     * Add callback: Raised when the user's sign-in status at the OP has changed (when `monitorSession` is set).\n     * @see {@link UserManagerSettings.monitorSession}\n     */\n    public addUserSignedOut(cb: UserSignedOutCallback): () => void {\n        return this._userSignedOut.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised when the user's sign-in status at the OP has changed (when `monitorSession` is set).\n     */\n    public removeUserSignedOut(cb: UserSignedOutCallback): void {\n        this._userSignedOut.removeHandler(cb);\n    }\n    /**\n     * @internal\n     */\n    public async _raiseUserSignedOut(): Promise<void> {\n        await this._userSignedOut.raise();\n    }\n\n    /**\n     * Add callback: Raised when the user session changed (when `monitorSession` is set).\n     * @see {@link UserManagerSettings.monitorSession}\n     */\n    public addUserSessionChanged(cb: UserSessionChangedCallback): () => void {\n        return this._userSessionChanged.addHandler(cb);\n    }\n    /**\n     * Remove callback: Raised when the user session changed (when `monitorSession` is set).\n     */\n    public removeUserSessionChanged(cb: UserSessionChangedCallback): void {\n        this._userSessionChanged.removeHandler(cb);\n    }\n    /**\n     * @internal\n     */\n    public async _raiseUserSessionChanged(): Promise<void> {\n        await this._userSessionChanged.raise();\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { Logger, Timer } from \"./utils\";\nimport { ErrorTimeout } from \"./errors\";\nimport type { UserManager } from \"./UserManager\";\nimport type { AccessTokenCallback } from \"./AccessTokenEvents\";\n\n/**\n * @internal\n */\nexport class SilentRenewService {\n    protected _logger = new Logger(\"SilentRenewService\");\n    private _isStarted = false;\n    private readonly _retryTimer = new Timer(\"Retry Silent Renew\");\n\n    public constructor(private _userManager: UserManager) {}\n\n    public async start(): Promise<void> {\n        const logger = this._logger.create(\"start\");\n        if (!this._isStarted) {\n            this._isStarted = true;\n            this._userManager.events.addAccessTokenExpiring(this._tokenExpiring);\n            this._retryTimer.addHandler(this._tokenExpiring);\n\n            // this will trigger loading of the user so the expiring events can be initialized\n            try {\n                await this._userManager.getUser();\n                // deliberate nop\n            }\n            catch (err) {\n                // catch to suppress errors since we're in a ctor\n                logger.error(\"getUser error\", err);\n            }\n        }\n    }\n\n    public stop(): void {\n        if (this._isStarted) {\n            this._retryTimer.cancel();\n            this._retryTimer.removeHandler(this._tokenExpiring);\n            this._userManager.events.removeAccessTokenExpiring(this._tokenExpiring);\n            this._isStarted = false;\n        }\n    }\n\n    protected _tokenExpiring: AccessTokenCallback = async () => {\n        const logger = this._logger.create(\"_tokenExpiring\");\n        try {\n            await this._userManager.signinSilent({\n                transformUrl: (url) => url,\n            });\n            logger.debug(\"silent token renewal successful\");\n        }\n        catch (err) {\n            if (err instanceof ErrorTimeout) {\n                // no response from authority server, e.g. IFrame timeout, ...\n                logger.warn(\"ErrorTimeout from signinSilent:\", err, \"retry in 5s\");\n                this._retryTimer.init(5);\n                return;\n            }\n\n            logger.error(\"Error from signinSilent:\", err);\n            await this._userManager.events._raiseSilentRenewError(err as Error);\n        }\n    };\n}\n", "// Copyright (C) AuthTS Contributors\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport type { UserProfile } from \"./User\";\n\n/**\n * Fake state store implementation necessary for validating refresh token requests.\n *\n * @public\n */\nexport class RefreshState {\n    /** custom \"state\", which can be used by a caller to have \"data\" round tripped */\n    public readonly data?: unknown;\n\n    public readonly refresh_token: string;\n    public readonly id_token?: string;\n    public readonly session_state: string | null;\n    public readonly scope?: string;\n    public readonly profile: UserProfile;\n\n    constructor(args: {\n        refresh_token: string;\n        id_token?: string;\n        session_state: string | null;\n        scope?: string;\n        profile: UserProfile;\n\n        state?: unknown;\n    }) {\n        this.refresh_token = args.refresh_token;\n        this.id_token = args.id_token;\n        this.session_state = args.session_state;\n        this.scope = args.scope;\n        this.profile = args.profile;\n\n        this.data = args.state;\n\n    }\n}\n", "// Copyright (c) Brock Allen & Dominick Baier. All rights reserved.\n// Licensed under the Apache License, Version 2.0. See LICENSE in the project root for license information.\n\nimport { CryptoUtils, Logger } from \"./utils\";\nimport { ErrorResponse } from \"./errors\";\nimport { type NavigateResponse, type PopupWindowParams, type IWindow, type IFrameWindowParams, type RedirectParams, RedirectNavigator, PopupNavigator, IFrameNavigator, type INavigator } from \"./navigators\";\nimport { OidcClient, type CreateSigninRequestArgs, type CreateSignoutRequestArgs, type ProcessResourceOwnerPasswordCredentialsArgs, type UseRefreshTokenArgs } from \"./OidcClient\";\nimport { type UserManagerSettings, UserManagerSettingsStore } from \"./UserManagerSettings\";\nimport { User } from \"./User\";\nimport { UserManagerEvents } from \"./UserManagerEvents\";\nimport { SilentRenewService } from \"./SilentRenewService\";\nimport { SessionMonitor } from \"./SessionMonitor\";\nimport type { SessionStatus } from \"./SessionStatus\";\nimport type { SignoutResponse } from \"./SignoutResponse\";\nimport type { MetadataService } from \"./MetadataService\";\nimport { RefreshState } from \"./RefreshState\";\nimport type { SigninResponse } from \"./SigninResponse\";\nimport type { ExtraHeader, DPoPSettings } from \"./OidcClientSettings\";\nimport { DPoPState } from \"./DPoPStore\";\n\n/**\n * @public\n */\nexport type ExtraSigninRequestArgs = Pick<CreateSigninRequestArgs, \"nonce\" | \"extraQueryParams\" | \"extraTokenParams\" | \"state\" | \"redirect_uri\" | \"prompt\" | \"acr_values\" | \"login_hint\" | \"scope\" | \"max_age\" | \"ui_locales\" | \"resource\" | \"url_state\">;\n/**\n * @public\n */\nexport type ExtraSignoutRequestArgs = Pick<CreateSignoutRequestArgs, \"extraQueryParams\" | \"state\" | \"id_token_hint\" | \"post_logout_redirect_uri\">;\n\n/**\n * @public\n */\nexport type RevokeTokensTypes = UserManagerSettings[\"revokeTokenTypes\"];\n\n/**\n * @public\n */\nexport type SigninRedirectArgs = RedirectParams & ExtraSigninRequestArgs & { /** oidc-spa addition */transformUrl: (url: string) => string };\n\n/**\n * @public\n */\nexport type SigninPopupArgs = PopupWindowParams & ExtraSigninRequestArgs;\n\n/**\n * @public\n */\nexport type SigninSilentArgs = IFrameWindowParams & ExtraSigninRequestArgs & { /** oidc-spa addition */transformUrl: (url: string) => string };\n\n/**\n * @public\n */\nexport type SigninResourceOwnerCredentialsArgs = ProcessResourceOwnerPasswordCredentialsArgs;\n\n/**\n * @public\n */\nexport type QuerySessionStatusArgs = IFrameWindowParams & ExtraSigninRequestArgs;\n\n/**\n * @public\n */\nexport type SignoutRedirectArgs = RedirectParams & ExtraSignoutRequestArgs;\n\n/**\n * @public\n */\nexport type SignoutPopupArgs = PopupWindowParams & ExtraSignoutRequestArgs;\n\n/**\n * @public\n */\nexport type SignoutSilentArgs = IFrameWindowParams & ExtraSignoutRequestArgs;\n\n/**\n * Provides a higher level API for signing a user in, signing out, managing the user's claims returned from the identity provider,\n * and managing an access token returned from the identity provider (OAuth2/OIDC).\n *\n * @public\n */\nexport class UserManager {\n    /** Get the settings used to configure the `UserManager`. */\n    public readonly settings: UserManagerSettingsStore;\n    protected readonly _logger = new Logger(\"UserManager\");\n\n    protected readonly _client: OidcClient;\n    protected readonly _redirectNavigator: INavigator;\n    protected readonly _popupNavigator: INavigator;\n    protected readonly _iframeNavigator: INavigator;\n    protected readonly _events: UserManagerEvents;\n    protected readonly _silentRenewService: SilentRenewService;\n    protected readonly _sessionMonitor: SessionMonitor | null;\n\n    protected readonly _stateQueryParamValue: string;\n\n    public constructor(settings: UserManagerSettings, redirectNavigator?: INavigator, popupNavigator?: INavigator, iframeNavigator?: INavigator) {\n\n        this._stateQueryParamValue = settings.stateQueryParamValue;\n\n        this.settings = new UserManagerSettingsStore(settings);\n\n        this._client = new OidcClient(settings);\n\n        this._redirectNavigator = redirectNavigator ?? new RedirectNavigator(this.settings);\n        this._popupNavigator = popupNavigator ?? new PopupNavigator(this.settings);\n        this._iframeNavigator = iframeNavigator ?? new IFrameNavigator(this.settings);\n\n        this._events = new UserManagerEvents(this.settings);\n        this._silentRenewService = new SilentRenewService(this);\n\n        // order is important for the following properties; these services depend upon the events.\n        if (this.settings.automaticSilentRenew) {\n            this.startSilentRenew();\n        }\n\n        this._sessionMonitor = null;\n        if (this.settings.monitorSession) {\n            this._sessionMonitor = new SessionMonitor(this);\n        }\n    }\n\n    /**\n     * Get object used to register for events raised by the `UserManager`.\n     */\n    public get events(): UserManagerEvents {\n        return this._events;\n    }\n\n    /**\n     * Get object used to access the metadata configuration of the identity provider.\n     */\n    public get metadataService(): MetadataService {\n        return this._client.metadataService;\n    }\n\n    /**\n     * Load the `User` object for the currently authenticated user.\n     *\n     * @returns A promise\n     */\n    public async getUser(): Promise<User | null> {\n        const logger = this._logger.create(\"getUser\");\n        const user = await this._loadUser();\n        if (user) {\n            logger.info(\"user loaded\");\n            await this._events.load(user, false);\n            return user;\n        }\n\n        logger.info(\"user not found in storage\");\n        return null;\n    }\n\n    /**\n     * Remove from any storage the currently authenticated user.\n     *\n     * @returns A promise\n     */\n    public async removeUser(): Promise<void> {\n        const logger = this._logger.create(\"removeUser\");\n        await this.storeUser(null);\n        logger.info(\"user removed from storage\");\n        await this._events.unload();\n    }\n\n    /**\n     * Trigger a redirect of the current window to the authorization endpoint.\n     *\n     * @returns A promise\n     *\n     * @throws `Error` In cases of wrong authentication.\n     */\n    public async signinRedirect(args: SigninRedirectArgs): Promise<void> {\n        this._logger.create(\"signinRedirect\");\n        const {\n            redirectMethod,\n            ...requestArgs\n        } = args;\n\n        let dpopJkt: string | undefined;\n        if (this.settings.dpop?.bind_authorization_code) {\n            dpopJkt = await this.generateDPoPJkt(this.settings.dpop);\n        }\n\n        const handle = await this._redirectNavigator.prepare({ redirectMethod });\n        await this._signinStart({\n            stateQueryParamValue: this._stateQueryParamValue,\n            request_type: \"si:r\",\n            dpopJkt,\n            ...requestArgs,\n        }, handle);\n    }\n\n    /**\n     * Process the response (callback) from the authorization endpoint.\n     * It is recommended to use {@link UserManager.signinCallback} instead.\n     *\n     * @returns A promise containing the authenticated `User`.\n     *\n     * @see {@link UserManager.signinCallback}\n     */\n    public async signinRedirectCallback(url = window.location.href): Promise<User> {\n        const logger = this._logger.create(\"signinRedirectCallback\");\n        const user = await this._signinEnd(url);\n        if (user.profile && user.profile.sub) {\n            logger.info(\"success, signed in subject\", user.profile.sub);\n        }\n        else {\n            logger.info(\"no subject\");\n        }\n\n        return user;\n    }\n\n    /**\n     * Trigger the signin with user/password.\n     *\n     * @returns A promise containing the authenticated `User`.\n     * @throws {@link ErrorResponse} In cases of wrong authentication.\n     */\n    public async signinResourceOwnerCredentials({\n        username,\n        password,\n        skipUserInfo = false,\n    }: SigninResourceOwnerCredentialsArgs): Promise<User> {\n        const logger = this._logger.create(\"signinResourceOwnerCredential\");\n\n        const signinResponse = await this._client.processResourceOwnerPasswordCredentials({\n            username,\n            password,\n            skipUserInfo,\n            extraTokenParams: this.settings.extraTokenParams,\n        });\n        logger.debug(\"got signin response\");\n\n        const user = await this._buildUser(signinResponse);\n        if (user.profile && user.profile.sub) {\n            logger.info(\"success, signed in subject\", user.profile.sub);\n        } else {\n            logger.info(\"no subject\");\n        }\n        return user;\n    }\n\n    /**\n     * Trigger a request (via a popup window) to the authorization endpoint.\n     *\n     * @returns A promise containing the authenticated `User`.\n     * @throws `Error` In cases of wrong authentication.\n     */\n    public async signinPopup(args: SigninPopupArgs = {}): Promise<User> {\n        const logger = this._logger.create(\"signinPopup\");\n\n        let dpopJkt: string | undefined;\n        if (this.settings.dpop?.bind_authorization_code) {\n            dpopJkt = await this.generateDPoPJkt(this.settings.dpop);\n        }\n\n        const {\n            popupWindowFeatures,\n            popupWindowTarget,\n            popupSignal,\n            ...requestArgs\n        } = args;\n        const url = this.settings.popup_redirect_uri;\n        if (!url) {\n            logger.throw(new Error(\"No popup_redirect_uri configured\"));\n        }\n\n        const handle = await this._popupNavigator.prepare({ popupWindowFeatures, popupWindowTarget, popupSignal });\n        const user = await this._signin({\n            stateQueryParamValue: this._stateQueryParamValue,\n            request_type: \"si:p\",\n            redirect_uri: url,\n            display: \"popup\",\n            dpopJkt,\n            transformUrl: url => url,\n            ...requestArgs,\n        }, handle);\n        if (user) {\n            if (user.profile && user.profile.sub) {\n                logger.info(\"success, signed in subject\", user.profile.sub);\n            } else {\n                logger.info(\"no subject\");\n            }\n        }\n\n        return user;\n    }\n\n    /**\n     * Notify the opening window of response (callback) from the authorization endpoint.\n     * It is recommended to use {@link UserManager.signinCallback} instead.\n     *\n     * @returns A promise\n     *\n     * @see {@link UserManager.signinCallback}\n     */\n    public async signinPopupCallback(url = window.location.href, keepOpen = false): Promise<void> {\n        const logger = this._logger.create(\"signinPopupCallback\");\n        await this._popupNavigator.callback(url, { keepOpen });\n        logger.info(\"success\");\n    }\n\n    /**\n     * Trigger a silent request (via refresh token or an iframe) to the authorization endpoint.\n     *\n     * @returns A promise that contains the authenticated `User`.\n     */\n    public async signinSilent(args: SigninSilentArgs): Promise<User | null> {\n        const logger = this._logger.create(\"signinSilent\");\n        const {\n            silentRequestTimeoutInSeconds,\n            ...requestArgs\n        } = args;\n        // first determine if we have a refresh token, or need to use iframe\n        let user = await this._loadUser();\n        if (user?.refresh_token) {\n            logger.debug(\"using refresh token\");\n            const state = new RefreshState(user as Required<User>);\n            return await this._useRefreshToken({\n                state,\n                redirect_uri: requestArgs.redirect_uri,\n                resource: requestArgs.resource,\n                extraTokenParams: requestArgs.extraTokenParams,\n                timeoutInSeconds: silentRequestTimeoutInSeconds,\n            });\n        }\n\n        let dpopJkt: string | undefined;\n        if (this.settings.dpop?.bind_authorization_code) {\n            dpopJkt = await this.generateDPoPJkt(this.settings.dpop);\n        }\n\n        const url = this.settings.silent_redirect_uri;\n        if (!url) {\n            logger.throw(new Error(\"No silent_redirect_uri configured\"));\n        }\n\n        let verifySub: string | undefined;\n        if (user && this.settings.validateSubOnSilentRenew) {\n            logger.debug(\"subject prior to silent renew:\", user.profile.sub);\n            verifySub = user.profile.sub;\n        }\n\n        const handle = await this._iframeNavigator.prepare({ silentRequestTimeoutInSeconds });\n        user = await this._signin({\n            stateQueryParamValue: this._stateQueryParamValue,\n            request_type: \"si:s\",\n            redirect_uri: url,\n            prompt: \"none\",\n            id_token_hint: this.settings.includeIdTokenInSilentRenew ? user?.id_token : undefined,\n            dpopJkt,\n            ...requestArgs,\n        }, handle, verifySub);\n        if (user) {\n            if (user.profile?.sub) {\n                logger.info(\"success, signed in subject\", user.profile.sub);\n            }\n            else {\n                logger.info(\"no subject\");\n            }\n        }\n\n        return user;\n    }\n\n    protected async _useRefreshToken(args: UseRefreshTokenArgs): Promise<User> {\n        const response = await this._client.useRefreshToken({\n            timeoutInSeconds: this.settings.silentRequestTimeoutInSeconds,\n            ...args,\n        });\n        if (response.__oidc_spa_tokenResponse === undefined) {\n            throw new Error(\n                \"Wrong Assertion Encountered: Error in oidc-spa mod of oidc-client-ts\",\n            );\n        }\n        const user = new User({ ...args.state, ...response, __oidc_spa_tokenResponse: response.__oidc_spa_tokenResponse });\n\n        await this.storeUser(user);\n        await this._events.load(user);\n        return user;\n    }\n\n    /**\n     *\n     * Notify the parent window of response (callback) from the authorization endpoint.\n     * It is recommended to use {@link UserManager.signinCallback} instead.\n     *\n     * @returns A promise\n     *\n     * @see {@link UserManager.signinCallback}\n     */\n    public async signinSilentCallback(url = window.location.href): Promise<void> {\n        const logger = this._logger.create(\"signinSilentCallback\");\n        await this._iframeNavigator.callback(url);\n        logger.info(\"success\");\n    }\n\n    /**\n     * Process any response (callback) from the authorization endpoint, by dispatching the request_type\n     * and executing one of the following functions:\n     * - {@link UserManager.signinRedirectCallback}\n     * - {@link UserManager.signinPopupCallback}\n     * - {@link UserManager.signinSilentCallback}\n     *\n     * @throws `Error` If request_type is unknown or signin cannot be processed.\n     */\n    public async signinCallback(url = window.location.href): Promise<User | undefined> {\n        const { state } = await this._client.readSigninResponseState(url);\n        switch (state.request_type) {\n            case \"si:r\":\n                return await this.signinRedirectCallback(url);\n            case \"si:p\":\n                await this.signinPopupCallback(url);\n                break;\n            case \"si:s\":\n                await this.signinSilentCallback(url);\n                break;\n            default:\n                throw new Error(\"invalid response_type in state\");\n        }\n        return undefined;\n    }\n\n    /**\n     * Process any response (callback) from the end session endpoint, by dispatching the request_type\n     * and executing one of the following functions:\n     * - {@link UserManager.signoutRedirectCallback}\n     * - {@link UserManager.signoutPopupCallback}\n     * - {@link UserManager.signoutSilentCallback}\n     *\n     * @throws `Error` If request_type is unknown or signout cannot be processed.\n     */\n    public async signoutCallback(url = window.location.href, keepOpen = false): Promise<SignoutResponse | undefined> {\n        const { state } = await this._client.readSignoutResponseState(url);\n        if (!state) {\n            return undefined;\n        }\n\n        switch (state.request_type) {\n            case \"so:r\":\n                return await this.signoutRedirectCallback(url);\n            case \"so:p\":\n                await this.signoutPopupCallback(url, keepOpen);\n                break;\n            case \"so:s\":\n                await this.signoutSilentCallback(url);\n                break;\n            default:\n                throw new Error(\"invalid response_type in state\");\n        }\n        return undefined;\n    }\n\n    /**\n     * Query OP for user's current signin status.\n     *\n     * @returns A promise object with session_state and subject identifier.\n     */\n    public async querySessionStatus(args: QuerySessionStatusArgs = {}): Promise<SessionStatus | null> {\n        const logger = this._logger.create(\"querySessionStatus\");\n        const {\n            silentRequestTimeoutInSeconds,\n            ...requestArgs\n        } = args;\n        const url = this.settings.silent_redirect_uri;\n        if (!url) {\n            logger.throw(new Error(\"No silent_redirect_uri configured\"));\n        }\n\n        const user = await this._loadUser();\n        const handle = await this._iframeNavigator.prepare({ silentRequestTimeoutInSeconds });\n        const navResponse = await this._signinStart({\n            stateQueryParamValue: this._stateQueryParamValue,\n            request_type: \"si:s\", // this acts like a signin silent\n            redirect_uri: url,\n            prompt: \"none\",\n            id_token_hint: this.settings.includeIdTokenInSilentRenew ? user?.id_token : undefined,\n            response_type: this.settings.query_status_response_type,\n            scope: \"openid\",\n            skipUserInfo: true,\n            transformUrl: url => url,\n            ...requestArgs,\n        }, handle);\n        try {\n            const extraHeaders: Record<string, ExtraHeader> = {};\n            const signinResponse = await this._client.processSigninResponse(navResponse.url, extraHeaders);\n            logger.debug(\"got signin response\");\n\n            if (signinResponse.session_state && signinResponse.profile.sub) {\n                logger.info(\"success for subject\", signinResponse.profile.sub);\n                return {\n                    session_state: signinResponse.session_state,\n                    sub: signinResponse.profile.sub,\n                };\n            }\n\n            logger.info(\"success, user not authenticated\");\n            return null;\n        } catch (err) {\n            if (this.settings.monitorAnonymousSession && err instanceof ErrorResponse) {\n                switch (err.error) {\n                    case \"login_required\":\n                    case \"consent_required\":\n                    case \"interaction_required\":\n                    case \"account_selection_required\":\n                        logger.info(\"success for anonymous user\");\n                        return {\n                            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                            session_state: err.session_state!,\n                        };\n                }\n            }\n            throw err;\n        }\n    }\n\n    protected async _signin(args: CreateSigninRequestArgs, handle: IWindow, verifySub?: string): Promise<User> {\n        const navResponse = await this._signinStart(args, handle);\n        return await this._signinEnd(navResponse.url, verifySub);\n    }\n\n    protected async _signinStart(args: CreateSigninRequestArgs, handle: IWindow): Promise<NavigateResponse> {\n        const logger = this._logger.create(\"_signinStart\");\n\n        try {\n            const signinRequest = await this._client.createSigninRequest(args);\n            logger.debug(\"got signin request\");\n\n            return await handle.navigate({\n                url: signinRequest.url,\n                state: signinRequest.state.id,\n                response_mode: signinRequest.state.response_mode,\n                scriptOrigin: this.settings.iframeScriptOrigin,\n            });\n        } catch (err) {\n            logger.debug(\"error after preparing navigator, closing navigator window\");\n            handle.close();\n            throw err;\n        }\n    }\n\n    protected async _signinEnd(url: string, verifySub?: string): Promise<User> {\n        const logger = this._logger.create(\"_signinEnd\");\n        const extraHeaders: Record<string, ExtraHeader> = {};\n        const signinResponse = await this._client.processSigninResponse(url, extraHeaders);\n        logger.debug(\"got signin response\");\n\n        const user = await this._buildUser(signinResponse, verifySub);\n        return user;\n    }\n\n    protected async _buildUser(signinResponse: SigninResponse, verifySub?: string) {\n        const logger = this._logger.create(\"_buildUser\");\n        if (signinResponse.__oidc_spa_tokenResponse === undefined) {\n            throw new Error(\n                \"Wrong Assertion Encountered: Error in oidc-spa mod of oidc-client-ts\",\n            );\n        }\n        const user = new User({\n            ...signinResponse,\n            __oidc_spa_tokenResponse: signinResponse.__oidc_spa_tokenResponse,\n        });\n        if (verifySub) {\n            if (verifySub !== user.profile.sub) {\n                logger.debug(\"current user does not match user returned from signin. sub from signin:\", user.profile.sub);\n                throw new ErrorResponse({ ...signinResponse, error: \"login_required\" });\n            }\n            logger.debug(\"current user matches user returned from signin\");\n        }\n\n        await this.storeUser(user);\n        logger.debug(\"user stored\");\n        await this._events.load(user);\n\n        return user;\n    }\n\n    /**\n     * Trigger a redirect of the current window to the end session endpoint.\n     *\n     * @returns A promise\n     */\n    public async signoutRedirect(args: SignoutRedirectArgs = {}): Promise<void> {\n        const logger = this._logger.create(\"signoutRedirect\");\n        const {\n            redirectMethod,\n            ...requestArgs\n        } = args;\n        const handle = await this._redirectNavigator.prepare({ redirectMethod });\n        await this._signoutStart({\n            stateQueryParamValue: this._stateQueryParamValue,\n            request_type: \"so:r\",\n            post_logout_redirect_uri: this.settings.post_logout_redirect_uri,\n            ...requestArgs,\n        }, handle);\n        logger.info(\"success\");\n    }\n\n    /**\n     * Process response (callback) from the end session endpoint.\n     * It is recommended to use {@link UserManager.signoutCallback} instead.\n     *\n     * @returns A promise containing signout response\n     *\n     * @see {@link UserManager.signoutCallback}\n     */\n    public async signoutRedirectCallback(url = window.location.href): Promise<SignoutResponse> {\n        const logger = this._logger.create(\"signoutRedirectCallback\");\n        const response = await this._signoutEnd(url);\n        logger.info(\"success\");\n        return response;\n    }\n\n    /**\n     * Trigger a redirect of a popup window to the end session endpoint.\n     *\n     * @returns A promise\n     */\n    public async signoutPopup(args: SignoutPopupArgs = {}): Promise<void> {\n        const logger = this._logger.create(\"signoutPopup\");\n        const {\n            popupWindowFeatures,\n            popupWindowTarget,\n            popupSignal,\n            ...requestArgs\n        } = args;\n        const url = this.settings.popup_post_logout_redirect_uri;\n\n        const handle = await this._popupNavigator.prepare({ popupWindowFeatures, popupWindowTarget, popupSignal });\n        await this._signout({\n            stateQueryParamValue: this._stateQueryParamValue,\n            request_type: \"so:p\",\n            post_logout_redirect_uri: url,\n            // we're putting a dummy entry in here because we\n            // need a unique id from the state for notification\n            // to the parent window, which is necessary if we\n            // plan to return back to the client after signout\n            // and so we can close the popup after signout\n            state: url == null ? undefined : {},\n            ...requestArgs,\n        }, handle);\n        logger.info(\"success\");\n    }\n\n    /**\n     * Process response (callback) from the end session endpoint from a popup window.\n     * It is recommended to use {@link UserManager.signoutCallback} instead.\n     *\n     * @returns A promise\n     *\n     * @see {@link UserManager.signoutCallback}\n     */\n    public async signoutPopupCallback(url = window.location.href, keepOpen = false): Promise<void> {\n        const logger = this._logger.create(\"signoutPopupCallback\");\n        await this._popupNavigator.callback(url, { keepOpen });\n        logger.info(\"success\");\n    }\n\n    protected async _signout(args: CreateSignoutRequestArgs, handle: IWindow): Promise<SignoutResponse> {\n        const navResponse = await this._signoutStart(args, handle);\n        return await this._signoutEnd(navResponse.url);\n    }\n\n    protected async _signoutStart(args: CreateSignoutRequestArgs, handle: IWindow): Promise<NavigateResponse> {\n        const logger = this._logger.create(\"_signoutStart\");\n\n        try {\n            const user = await this._loadUser();\n            logger.debug(\"loaded current user from storage\");\n\n            if (this.settings.revokeTokensOnSignout) {\n                await this._revokeInternal(user);\n            }\n\n            const id_token = args.id_token_hint || user && user.id_token;\n            if (id_token) {\n                logger.debug(\"setting id_token_hint in signout request\");\n                args.id_token_hint = id_token;\n            }\n\n            await this.removeUser();\n            logger.debug(\"user removed, creating signout request\");\n\n            const signoutRequest = await this._client.createSignoutRequest(args);\n            logger.debug(\"got signout request\");\n\n            return await handle.navigate({\n                url: signoutRequest.url,\n                state: signoutRequest.state?.id,\n                scriptOrigin: this.settings.iframeScriptOrigin,\n            });\n        } catch (err) {\n            logger.debug(\"error after preparing navigator, closing navigator window\");\n            handle.close();\n            throw err;\n        }\n    }\n\n    protected async _signoutEnd(url: string): Promise<SignoutResponse> {\n        const logger = this._logger.create(\"_signoutEnd\");\n        const signoutResponse = await this._client.processSignoutResponse(url);\n        logger.debug(\"got signout response\");\n\n        return signoutResponse;\n    }\n\n    /**\n     * Trigger a silent request (via an iframe) to the end session endpoint.\n     *\n     * @returns A promise\n     */\n    public async signoutSilent(args: SignoutSilentArgs = {}): Promise<void> {\n        const logger = this._logger.create(\"signoutSilent\");\n        const {\n            silentRequestTimeoutInSeconds,\n            ...requestArgs\n        } = args;\n\n        const id_token_hint = this.settings.includeIdTokenInSilentSignout\n            ? (await this._loadUser())?.id_token\n            : undefined;\n\n        const url = this.settings.popup_post_logout_redirect_uri;\n        const handle = await this._iframeNavigator.prepare({ silentRequestTimeoutInSeconds });\n        await this._signout({\n            stateQueryParamValue: this._stateQueryParamValue,\n            request_type: \"so:s\",\n            post_logout_redirect_uri: url,\n            id_token_hint: id_token_hint,\n            ...requestArgs,\n        }, handle);\n\n        logger.info(\"success\");\n    }\n\n    /**\n     * Notify the parent window of response (callback) from the end session endpoint.\n     * It is recommended to use {@link UserManager.signoutCallback} instead.\n     *\n     * @returns A promise\n     *\n     * @see {@link UserManager.signoutCallback}\n     */\n    public async signoutSilentCallback(url = window.location.href): Promise<void> {\n        const logger = this._logger.create(\"signoutSilentCallback\");\n        await this._iframeNavigator.callback(url);\n        logger.info(\"success\");\n    }\n\n    public async revokeTokens(types?: RevokeTokensTypes): Promise<void> {\n        const user = await this._loadUser();\n        await this._revokeInternal(user, types);\n    }\n\n    protected async _revokeInternal(user: User | null, types = this.settings.revokeTokenTypes): Promise<void> {\n        const logger = this._logger.create(\"_revokeInternal\");\n        if (!user) return;\n\n        const typesPresent = types.filter(type => typeof user[type] === \"string\");\n\n        if (!typesPresent.length) {\n            logger.debug(\"no need to revoke due to no token(s)\");\n            return;\n        }\n\n        // don't Promise.all, order matters\n        for (const type of typesPresent) {\n            await this._client.revokeToken(\n                user[type]!, // eslint-disable-line @typescript-eslint/no-non-null-assertion\n                type,\n            );\n            logger.info(`${type} revoked successfully`);\n            if (type !== \"access_token\") {\n                user[type] = null as never;\n            }\n        }\n\n        await this.storeUser(user);\n        logger.debug(\"user stored\");\n        await this._events.load(user);\n    }\n\n    /**\n     * Enables silent renew for the `UserManager`.\n     */\n    public startSilentRenew(): void {\n        this._logger.create(\"startSilentRenew\");\n        void this._silentRenewService.start();\n    }\n\n    /**\n     * Disables silent renew for the `UserManager`.\n     */\n    public stopSilentRenew(): void {\n        this._silentRenewService.stop();\n    }\n\n    protected get _userStoreKey(): string {\n        return `user:${this.settings.authority}:${this.settings.client_id}`;\n    }\n\n    protected async _loadUser(): Promise<User | null> {\n        const logger = this._logger.create(\"_loadUser\");\n        const storageString = await this.settings.userStore.get(this._userStoreKey);\n        if (storageString) {\n            logger.debug(\"user storageString loaded\");\n            return User.fromStorageString(storageString);\n        }\n\n        logger.debug(\"no user storageString\");\n        return null;\n    }\n\n    public async storeUser(user: User | null): Promise<void> {\n        const logger = this._logger.create(\"storeUser\");\n        if (user) {\n            logger.debug(\"storing user\");\n            const storageString = user.toStorageString();\n            await this.settings.userStore.set(this._userStoreKey, storageString);\n        } else {\n            this._logger.debug(\"removing user\");\n            await this.settings.userStore.remove(this._userStoreKey);\n            if (this.settings.dpop) {\n                await this.settings.dpop.store.remove(this.settings.client_id);\n            }\n        }\n    }\n\n    /**\n     * Removes stale state entries in storage for incomplete authorize requests.\n     */\n    public async clearStaleState(): Promise<void> {\n        await this._client.clearStaleState();\n    }\n\n    /**\n     * Dynamically generates a DPoP proof for a given user, URL and optional Http method.\n     * This method is useful when you need to make a request to a resource server\n     * with fetch or similar, and you need to include a DPoP proof in a DPoP header.\n     * @param url - The URL to generate the DPoP proof for\n     * @param user - The user to generate the DPoP proof for\n     * @param httpMethod - Optional, defaults to \"GET\"\n     * @param nonce - Optional nonce provided by the resource server\n     *\n     * @returns A promise containing the DPoP proof or undefined if DPoP is not enabled/no user is found.\n     */\n    public async dpopProof(url: string, user: User, httpMethod?: string, nonce?: string): Promise<string | undefined> {\n        const dpopState = await this.settings.dpop?.store?.get(this.settings.client_id);\n        if (dpopState) {\n            return await CryptoUtils.generateDPoPProof({\n                url,\n                accessToken: user?.access_token,\n                httpMethod: httpMethod,\n                keyPair: dpopState.keys,\n                nonce,\n            });\n        }\n        return undefined;\n    }\n\n    async generateDPoPJkt(dpopSettings: DPoPSettings): Promise<string | undefined> {\n        let dpopState = await dpopSettings.store.get(this.settings.client_id);\n        if (!dpopState) {\n            const dpopKeys = await CryptoUtils.generateDPoPKeys();\n            dpopState = new DPoPState(dpopKeys);\n            await dpopSettings.store.set(this.settings.client_id, dpopState);\n        }\n        return await CryptoUtils.generateDPoPJkt(dpopState.keys);\n    }\n}\n", "{\n  \"name\": \"oidc-client-ts\",\n  \"version\": \"3.1.0\",\n  \"description\": \"OpenID Connect (OIDC) & OAuth2 client library\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git+https://github.com/authts/oidc-client-ts.git\"\n  },\n  \"homepage\": \"https://github.com/authts/oidc-client-ts#readme\",\n  \"license\": \"Apache-2.0\",\n  \"main\": \"dist/umd/oidc-client-ts.js\",\n  \"types\": \"dist/types/oidc-client-ts.d.ts\",\n  \"exports\": {\n    \".\": {\n      \"types\": \"./dist/types/oidc-client-ts.d.ts\",\n      \"import\": \"./dist/esm/oidc-client-ts.js\",\n      \"require\": \"./dist/umd/oidc-client-ts.js\"\n    },\n    \"./package.json\": \"./package.json\"\n  },\n  \"files\": [\n    \"dist\"\n  ],\n  \"keywords\": [\n    \"authentication\",\n    \"oauth2\",\n    \"oidc\",\n    \"openid\",\n    \"OpenID Connect\"\n  ],\n  \"scripts\": {\n    \"build\": \"node scripts/build.js && npm run build-types\",\n    \"build-types\": \"tsc -p tsconfig.build.json && api-extractor run\",\n    \"clean\": \"git clean -fdX dist lib *.tsbuildinfo\",\n    \"prepack\": \"npm run build\",\n    \"test\": \"tsc && jest\",\n    \"typedoc\": \"typedoc\",\n    \"lint\": \"eslint --max-warnings=0 --cache .\",\n    \"prepare\": \"husky\"\n  },\n  \"dependencies\": {\n    \"jwt-decode\": \"^4.0.0\"\n  },\n  \"devDependencies\": {\n    \"@microsoft/api-extractor\": \"^7.47.2\",\n    \"@testing-library/jest-dom\": \"^6.4.6\",\n    \"@types/jest\": \"^29.5.12\",\n    \"@types/node\": \"^22.4.1\",\n    \"@typescript-eslint/eslint-plugin\": \"^7.16.1\",\n    \"@typescript-eslint/parser\": \"^7.16.1\",\n    \"esbuild\": \"^0.24.0\",\n    \"eslint\": \"^8.57.0\",\n    \"eslint-plugin-testing-library\": \"^6.2.2\",\n    \"http-proxy-middleware\": \"^3.0.0\",\n    \"fake-indexeddb\": \"^6.0.0\",\n    \"husky\": \"^9.0.11\",\n    \"jest\": \"^29.7.0\",\n    \"jest-environment-jsdom\": \"^29.7.0\",\n    \"jest-mock\": \"^29.7.0\",\n    \"jose\": \"^5.6.3\",\n    \"lint-staged\": \"^15.2.7\",\n    \"ts-jest\": \"^29.2.2\",\n    \"typedoc\": \"^0.26.4\",\n    \"typescript\": \"~5.4.2\",\n    \"yn\": \"^5.0.0\"\n  },\n  \"engines\": {\n    \"node\": \">=18\"\n  },\n  \"lint-staged\": {\n    \"*.{js,jsx,ts,tsx}\": \"eslint --cache --fix\"\n  }\n}\n", "// @ts-expect-error avoid enabling resolveJsonModule to keep build process simple\nimport { version } from \"../package.json\";\n\n/**\n * @public\n */\nexport const Version: string = version;\n", "import { DPoPState, type DPoPStore } from \"./DPoPStore\";\n\n/**\n * Provides a default implementation of the DPoP store using IndexedDB.\n *\n * @public\n */\nexport class IndexedDbDPoPStore implements DPoPStore {\n    readonly _dbName: string = \"oidc\";\n    readonly _storeName: string = \"dpop\";\n\n    public async set(key: string, value: DPoPState): Promise<void> {\n        const store = await this.createStore(this._dbName, this._storeName);\n        await store(\"readwrite\", (str: IDBObjectStore) => {\n            str.put(value, key);\n            return this.promisifyRequest(str.transaction);\n        });\n    }\n\n    public async get(key: string): Promise<DPoPState> {\n        const store = await this.createStore(this._dbName, this._storeName);\n        return await store(\"readonly\", (str) => {\n            return this.promisifyRequest(str.get(key));\n        }) as DPoPState;\n    }\n\n    public async remove(key: string): Promise<DPoPState> {\n        const item = await this.get(key);\n        const store = await this.createStore(this._dbName, this._storeName);\n        await store(\"readwrite\", (str) => {\n            return this.promisifyRequest(str.delete(key));\n        });\n        return item;\n    }\n\n    public async getAllKeys(): Promise<string[]> {\n        const store = await this.createStore(this._dbName, this._storeName);\n        return await store(\"readonly\", (str) => {\n            return this.promisifyRequest(str.getAllKeys());\n        }) as string[];\n    }\n\n    promisifyRequest<T = undefined>(\n        request: IDBRequest<T> | IDBTransaction): Promise<T> {\n        return new Promise<T>((resolve, reject) => {\n            (request as IDBTransaction).oncomplete = (request as IDBRequest<T>).onsuccess = () => resolve((request as IDBRequest<T>).result);\n            (request as IDBTransaction).onabort = (request as IDBRequest<T>).onerror = () => reject((request as IDBRequest<T>).error);\n        });\n    }\n\n    async createStore<T>(\n        dbName: string,\n        storeName: string,\n    ): Promise<(txMode: IDBTransactionMode, callback: (store: IDBObjectStore) => T | PromiseLike<T>) => Promise<T>> {\n        const request = indexedDB.open(dbName);\n        request.onupgradeneeded = () => request.result.createObjectStore(storeName);\n        const db = await this.promisifyRequest<IDBDatabase>(request);\n\n        return async (\n            txMode: IDBTransactionMode,\n            callback: (store: IDBObjectStore) => T | PromiseLike<T>,\n        ) => {\n            const tx = db.transaction(storeName, txMode);\n            const store = tx.objectStore(storeName);\n            return await callback(store);\n        };\n    }\n}\n"],
+  "mappings": "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",
+  "names": ["Log", "logger", "logger", "logger", "logger", "logger", "logger", "logger", "logger", "logger", "logger", "logger", "_a", "logger", "logger", "url"]
 }
